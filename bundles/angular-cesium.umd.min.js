!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("geodesy"),require("util"),require("primitive-primitives"),require("json-string-mapper"),require("angular2parse"),require("lodash.get"),require("heatmap.js/build/heatmap.js"),require("@angular/common"),require("rxjs"),require("rxjs/operators"),require("@angular/core")):"function"==typeof define&&define.amd?define("angular-cesium",["exports","geodesy","util","primitive-primitives","json-string-mapper","angular2parse","lodash.get","heatmap.js/build/heatmap.js","@angular/common","rxjs","rxjs/operators","@angular/core"],t):t(e["angular-cesium"]={},e.geodesy,e.util,e.primitivePrimitives,e.jsonStringMapper,e.angular2parse,e._get,e.h337,e.ng.common,e.rxjs,e.rxjs.operators,e.ng.core)}(this,function(e,o,r,t,i,n,p,u,s,w,f,a){"use strict";var c=Cesium.AssociativeArray,M=Cesium.Color,I=Cesium.ColorGeometryInstanceAttribute,A=Cesium.defined,L=Cesium.DistanceDisplayCondition,D=Cesium.DistanceDisplayConditionGeometryInstanceAttribute,T=Cesium.ShowGeometryInstanceAttribute,O=Cesium.Primitive,R=Cesium.ShadowMode,l=Cesium.BoundingSphereState,x=Cesium.ColorMaterialProperty,j=Cesium.MaterialProperty,N=Cesium.Property,F=new M,k=new L,V=new L;function d(e,t,i,n,o,r,s){var a;this.translucent=t,this.appearanceType=i,this.depthFailAppearanceType=n,this.depthFailMaterialProperty=o,this.depthFailMaterial=undefined,this.closed=r,this.shadows=s,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=undefined,this.oldPrimitive=undefined,this.geometry=new c,this.updaters=new c,this.updatersWithAttributes=new c,this.attributes=new c,this.subscriptions=new c,this.showsUpdated=new c,this.itemsToRemove=[],this.invalidated=!1,A(o)&&(a=o.definitionChanged.addEventListener(d.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}d.prototype.onMaterialChanged=function(){this.invalidated=!0},d.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,i=e.depthFailMaterialProperty;return i===t||!!A(t)&&t.equals(i)},d.prototype.add=function(o,e){var t=o.id;if(this.createPrimitive=!0,this.geometry.set(t,e),this.updaters.set(t,o),o.hasConstantFill&&o.fillMaterialProperty.isConstant&&N.isConstant(o.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(t,o.entity.definitionChanged.addEventListener(function(e,t,i,n){"isShowing"===t&&r.showsUpdated.set(o.id,o)}))}else this.updatersWithAttributes.set(t,o)},d.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);A(i)&&(i(),this.subscriptions.remove(t))}},d.prototype.update=function(e){var t,i,n=!0,o=0,r=this.primitive,s=this.primitives;if(this.createPrimitive){var a=this.geometry.values,p=a.length;if(0<p){for(A(r)&&(A(this.oldPrimitive)?s.remove(r):this.oldPrimitive=r),i=0;i<p;i++){var c=a[i],l=c.attributes;t=this.attributes.get(c.id.id),A(t)&&(A(l.show)&&(l.show.value=t.show),A(l.color)&&(l.color.value=t.color),A(l.depthFailColor)&&(l.depthFailColor.value=t.depthFailColor))}var u;A(this.depthFailAppearanceType)&&(A(this.depthFailMaterialProperty)&&(this.depthFailMaterial=j.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),u=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),r=new O({show:!1,asynchronous:!0,geometryInstances:a,appearance:new this.appearanceType({flat:this.shadows===R.DISABLED||this.shadows===R.CAST_ONLY,translucent:this.translucent,closed:this.closed}),depthFailAppearance:u,shadows:this.shadows}),s.add(r),n=!1}else{A(r)&&(s.remove(r),r=undefined);var d=this.oldPrimitive;A(d)&&(s.remove(d),this.oldPrimitive=undefined)}this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(A(r)&&r.ready){r.show=!0,A(this.oldPrimitive)&&(s.remove(this.oldPrimitive),this.oldPrimitive=undefined),!A(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof x||(this.depthFailMaterial=j.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var h=this.updatersWithAttributes.values,y=h.length,m=this.waitingOnCreate;for(i=0;i<y;i++){var f=h[i],g=this.geometry.get(f.id);if(t=this.attributes.get(g.id.id),A(t)||(t=r.getGeometryInstanceAttributes(g.id),this.attributes.set(g.id.id,t)),!f.fillMaterialProperty.isConstant||m){var v=f.fillMaterialProperty.color,P=N.getValueOrDefault(v,e,M.WHITE,F);M.equals(t._lastColor,P)||(t._lastColor=M.clone(P,t._lastColor),t.color=I.toValue(P,t.color),(this.translucent&&255===t.color[3]||!this.translucent&&255!==t.color[3])&&(this.itemsToRemove[o++]=f))}if(A(this.depthFailAppearanceType)&&f.depthFailMaterialProperty instanceof x&&(!f.depthFailMaterialProperty.isConstant||m)){var b=f.depthFailMaterialProperty.color,C=N.getValueOrDefault(b,e,M.WHITE,F);M.equals(t._lastDepthFailColor,C)||(t._lastDepthFailColor=M.clone(C,t._lastDepthFailColor),t.depthFailColor=I.toValue(C,t.depthFailColor))}var E=f.entity.isShowing&&(f.hasConstantFill||f.isFilled(e));E!==(1===t.show[0])&&(t.show=T.toValue(E,t.show));var _=f.distanceDisplayConditionProperty;if(!N.isConstant(_)){var S=N.getValueOrDefault(_,e,V,k);L.equals(S,t._lastDistanceDisplayCondition)||(t._lastDistanceDisplayCondition=L.clone(S,t._lastDistanceDisplayCondition),t.distanceDisplayCondition=D.toValue(S,t.distanceDisplayCondition))}}this.updateShows(r),this.waitingOnCreate=!1}else A(r)&&!r.ready&&(n=!1);return this.itemsToRemove.length=o,n},d.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,n=0;n<i;n++){var o=t[n],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);A(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));var a=o.entity.isShowing;a!==(1===s.show[0])&&(s.show=T.toValue(a,s.show))}this.showsUpdated.removeAll()},d.prototype.contains=function(e){return this.updaters.contains(e.id)},d.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return l.PENDING;var n=i.getGeometryInstanceAttributes(e.entity);return!A(n)||!A(n.boundingSphere)||A(n.show)&&0===n.show[0]?l.FAILED:(n.boundingSphere.clone(t),l.DONE)},d.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;A(t)&&(e.remove(t),this.primitive=undefined,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;A(i)&&(e.remove(i),this.oldPrimitive=undefined)};var h=!(d.prototype.destroy=function(){var e=this.primitive,t=this.primitives;A(e)&&t.remove(e);var i=this.oldPrimitive;A(i)&&t.remove(i),A(this.removeMaterialSubscription)&&this.removeMaterialSubscription()});var y=new a.InjectionToken("ANGULAR_CESIUM_CONFIG"),m=(g.decorators=[{type:a.Injectable}],g.ctorParameters=function(){return[{type:undefined,decorators:[{type:a.Optional},{type:a.Inject,args:[y]}]}]},g);function g(e){!1!==(!(this.config=e)||e.fixEntitiesShadows)&&!function t(){h||(Cesium.StaticGeometryColorBatch.prototype.add=function(e,t){var i,n,o=t.createFillGeometryInstance(e);n=255===o.attributes.color.value[3]?(i=this._solidItems,!1):(i=this._translucentItems,!0);for(var r=i.length,s=0;s<r;s++){var a=i[s];if(a.isMaterial(t))return void a.add(t,o)}var p=new d(this._primitives,n,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);p.add(t,o),i.push(p)},h=!0)}()}var v={SCENE3D:0,COLUMBUS_VIEW:1,SCENE2D:2,PERFORMANCE_SCENE2D:3};v[v.SCENE3D]="SCENE3D",v[v.COLUMBUS_VIEW]="COLUMBUS_VIEW",v[v.SCENE2D]="SCENE2D",v[v.PERFORMANCE_SCENE2D]="PERFORMANCE_SCENE2D";var P=(b.prototype.init=function(e){this.viewer=e.getViewer(),this.scene=e.getScene(),this.screenSpaceCameraController=this.scene.screenSpaceCameraController,this.camera=this.scene.camera,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastLook=this.screenSpaceCameraController.enableLook},b.prototype._listenToSceneModeMorph=function(e){this.morphListenerCancelFn=this.scene.morphStart.addEventListener(e)},b.prototype._revertCameraProperties=function(){this.isSceneModePerformance2D=!1,this.enableTilt(this.lastTilt),this.enableRotate(this.lastRotate),this.enableLook(this.lastLook)},b.prototype.getCamera=function(){return this.camera},b.prototype.getScreenSpaceCameraController=function(){return this.screenSpaceCameraController},b.prototype.getMinimumZoom=function(){return this.screenSpaceCameraController.minimumZoomDistance},b.prototype.setMinimumZoom=function(e){this.screenSpaceCameraController.minimumZoomDistance=e},b.prototype.getMaximumZoom=function(){return this.screenSpaceCameraController.maximumZoomDistance},b.prototype.setMaximumZoom=function(e){this.screenSpaceCameraController.maximumZoomDistance=e},b.prototype.enableTilt=function(e){this.screenSpaceCameraController.enableTilt=e},b.prototype.enableRotate=function(e){this.screenSpaceCameraController.enableRotate=e},b.prototype.enableLook=function(e){this.screenSpaceCameraController.enableLook=e},b.prototype.enableTranslate=function(e){this.screenSpaceCameraController.enableTranslate=e},b.prototype.enableZoom=function(e){this.screenSpaceCameraController.enableZoom=e},b.prototype.enableInputs=function(e){this.screenSpaceCameraController.enableInputs=e},b.prototype.setSceneMode=function(e,t){var i=this;switch(e){case v.SCENE3D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo3D(t);break;case v.COLUMBUS_VIEW:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphToColumbusView(t);break;case v.SCENE2D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo2D(t);break;case v.PERFORMANCE_SCENE2D:this.isSceneModePerformance2D=!0,this.lastLook=this.screenSpaceCameraController.enableLook,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.screenSpaceCameraController.enableTilt=!1,this.screenSpaceCameraController.enableRotate=!1,this.screenSpaceCameraController.enableLook=!1,this.morphListenerCancelFn&&this.morphListenerCancelFn(),this.scene.morphToColumbusView(t);var n=this.scene.morphComplete.addEventListener(function(){i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(0,0,Math.min(b.PERFORMANCE_2D_ALTITUDE,i.getMaximumZoom())),orientation:{pitch:Cesium.Math.toRadians(-90)}}),n(),i._listenToSceneModeMorph(i._revertCameraProperties.bind(i))})}},b.prototype.cameraFlyTo=function(e){if(e)return this.camera.flyTo(e)},b.prototype.flyTo=function(e,t){return this.viewer.flyTo(e,t)},b.prototype.zoomIn=function(e){return this.camera.zoomIn(e||this.camera.defaultZoomAmount)},b.prototype.zoomOut=function(e){return this.camera.zoomIn(e||this.camera.defaultZoomAmount)},b.prototype.zoomTo=function(e,t){return this.viewer.zoomTo(e,t)},b.prototype.setView=function(e){this.camera.setView(e)},b.prototype.setRotation=function(e){this.setView({orientation:{heading:e}})},b.prototype.lockRotation=function(e){this.scene.screenSpaceCameraController.enableRotate=!e},b.prototype.trackEntity=function(a,p){var c=this,l=p&&p.flyTo||!1;return this.viewer.trackedEntity=undefined,new Promise(function(e){if(l){var t=p&&p.flyToDuration||1,i=p&&p.altitude||1e4,n=a.position.getValue(Cesium.JulianDate.now()),o=Cesium.Cartographic.fromCartesian(n),r=i-o.height;o.height=i;var s=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);c.cameraFlyTo({duration:t,destination:s,complete:function(){c.viewer.trackedEntity=a,setTimeout(function(){0<r?c.camera.zoomOut(r):c.camera.zoomIn(r)},0),e()}})}else c.viewer.trackedEntity=a,e()})},b.prototype.untrackEntity=function(){this.trackEntity()},b.PERFORMANCE_2D_ALTITUDE=25e6,b.decorators=[{type:a.Injectable}],b.ctorParameters=function(){return[]},b);function b(){this.isSceneModePerformance2D=!1}var C=function(e,t){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function E(e,t){function i(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var _=function(){return(_=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function S(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s}function H(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(S(arguments[t]));return e}var B=(G.prototype.createViewer=function(e,t){return t?new this.cesium.Viewer(e,_({contextOptions:{webgl:{preserveDrawingBuffer:!0}}},t)):new this.cesium.Viewer(e,{imageryProvider:Cesium.createTileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")}),baseLayerPicker:!1,geocoder:!1,contextOptions:{webgl:{preserveDrawingBuffer:!0}}})},G.decorators=[{type:a.Injectable}],G.ctorParameters=function(){return[]},G);function G(){this.cesium=Cesium}var U=(Object.defineProperty(z.prototype,"viewerOptions",{get:function(){return this._viewerOptions},set:function(e){this._viewerOptions=e},enumerable:!0,configurable:!0}),z.prototype.getNextViewerOptions=function(){return this._viewerOptions instanceof Array?this._viewerOptions[this.nextViewerOptionsIndex++]:this._viewerOptions},Object.defineProperty(z.prototype,"viewerModifier",{get:function(){return this._viewerModifier},set:function(e){this._viewerModifier=e},enumerable:!0,configurable:!0}),z.prototype.getNextViewerModifier=function(){return this._viewerModifier instanceof Array?this._viewerModifier[this.nextViewerModifierIndex++]:this._viewerModifier},z.decorators=[{type:a.Injectable}],z);function z(){this.nextViewerOptionsIndex=0,this.nextViewerModifierIndex=0}var K=(W.prototype.init=function(i,e){var n=this;this.map=e,this.ngZone.runOutsideAngular(function(){var e=n.viewerConfiguration?n.viewerConfiguration.getNextViewerOptions():undefined;n.cesiumViewer=n.viewerFactory.createViewer(i,e);var t=n.viewerConfiguration&&n.viewerConfiguration.getNextViewerModifier();"function"==typeof t&&t(n.cesiumViewer)})},W.prototype.getViewer=function(){return this.cesiumViewer},W.prototype.getScene=function(){return this.cesiumViewer.scene},W.prototype.getCanvas=function(){return this.cesiumViewer.canvas},W.prototype.getMap=function(){return this.map},W.decorators=[{type:a.Injectable}],W.ctorParameters=function(){return[{type:a.NgZone},{type:B},{type:U,decorators:[{type:a.Optional}]}]},W);function W(e,t,i){this.ngZone=e,this.viewerFactory=t,this.viewerConfiguration=i}var $={MOUSE_MOVE:Cesium.ScreenSpaceEventType.MOUSE_MOVE,LEFT_CLICK:Cesium.ScreenSpaceEventType.LEFT_CLICK,LEFT_DOUBLE_CLICK:Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,LEFT_DOWN:Cesium.ScreenSpaceEventType.LEFT_DOWN,LEFT_UP:Cesium.ScreenSpaceEventType.LEFT_UP,MIDDLE_CLICK:Cesium.ScreenSpaceEventType.MIDDLE_CLICK,MIDDLE_DOUBLE_CLICK:Cesium.ScreenSpaceEventType.MIDDLE_DOUBLE_CLICK,MIDDLE_DOWN:Cesium.ScreenSpaceEventType.MIDDLE_DOWN,MIDDLE_UP:Cesium.ScreenSpaceEventType.MIDDLE_UP,PINCH_START:Cesium.ScreenSpaceEventType.PINCH_START,PINCH_END:Cesium.ScreenSpaceEventType.PINCH_END,PINCH_MOVE:Cesium.ScreenSpaceEventType.PINCH_MOVE,RIGHT_CLICK:Cesium.ScreenSpaceEventType.RIGHT_CLICK,RIGHT_DOUBLE_CLICK:Cesium.ScreenSpaceEventType.RIGHT_DOUBLE_CLICK,RIGHT_DOWN:Cesium.ScreenSpaceEventType.RIGHT_DOWN,RIGHT_UP:Cesium.ScreenSpaceEventType.RIGHT_UP,WHEEL:Cesium.ScreenSpaceEventType.WHEEL,LONG_LEFT_PRESS:110,LONG_RIGHT_PRESS:111,LONG_MIDDLE_PRESS:112,LEFT_CLICK_DRAG:113,RIGHT_CLICK_DRAG:114,MIDDLE_CLICK_DRAG:115};$[$.LONG_LEFT_PRESS]="LONG_LEFT_PRESS",$[$.LONG_RIGHT_PRESS]="LONG_RIGHT_PRESS",$[$.LONG_MIDDLE_PRESS]="LONG_MIDDLE_PRESS",$[$.LEFT_CLICK_DRAG]="LEFT_CLICK_DRAG",$[$.RIGHT_CLICK_DRAG]="RIGHT_CLICK_DRAG",$[$.MIDDLE_CLICK_DRAG]="MIDDLE_CLICK_DRAG";var Z={NO_PICK:0,PICK_FIRST:1,PICK_ONE:2,PICK_ALL:3};Z[Z.NO_PICK]="NO_PICK",Z[Z.PICK_FIRST]="PICK_FIRST",Z[Z.PICK_ONE]="PICK_ONE",Z[Z.PICK_ALL]="PICK_ALL";var Y=(Object.defineProperty(q.prototype,"contextMenuChangeNotifier",{get:function(){return this._contextMenuChangeNotifier},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"showContextMenu",{get:function(){return this._showContextMenu},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onOpen",{get:function(){return this._onOpen},enumerable:!0,configurable:!0}),Object.defineProperty(q.prototype,"onClose",{get:function(){return this._onClose},enumerable:!0,configurable:!0}),q.prototype.init=function(e){this.mapEventsManager=e},q.prototype.open=function(e,t,i){var n=this;void 0===i&&(i={}),this.close(),this._content=e,this._position=t,this._options=Object.assign({},this._defaultContextMenuOptions,i),this._showContextMenu=!0,this.mapEventsManager&&this._options.closeOnLeftCLick&&(this.leftClickRegistration=this.mapEventsManager.register({event:$.LEFT_CLICK,pick:Z.NO_PICK,priority:this._options.closeOnLeftClickPriority}),this.leftClickSubscription=this.leftClickRegistration.subscribe(function(){n.leftClickSubscription.unsubscribe(),n.close()})),this._contextMenuChangeNotifier.emit(),this._onOpen.emit()},q.prototype.close=function(){this._content=undefined,this._position=undefined,this._options=undefined,this._showContextMenu=!1,this.leftClickRegistration&&(this.leftClickRegistration.dispose(),this.leftClickRegistration=undefined),this.leftClickSubscription&&(this.leftClickSubscription.unsubscribe(),this.leftClickSubscription=undefined),this._contextMenuChangeNotifier.emit(),this._onClose.emit()},q.decorators=[{type:a.Injectable}],q);function q(){this._showContextMenu=!1,this._contextMenuChangeNotifier=new a.EventEmitter,this._onOpen=new a.EventEmitter,this._onClose=new a.EventEmitter,this._defaultContextMenuOptions={closeOnLeftCLick:!0,closeOnLeftClickPriority:10}}var X=o.LatLonVectors;window.geodesy=o;var J=(Q.prototype.screenToCartesian3=function(e,t){if(this.cesiumService){var i=_({},e);if(t){var n=this.cesiumService.getViewer().canvas.getBoundingClientRect();i.x+=n.left,i.y+=n.top}return this.cesiumService.getViewer().camera.pickEllipsoid(i)}throw new Error("ANGULAR2-CESIUM - Cesium service should be provided in order to do screen position calculations")},Q.prototype.screenToCartographic=function(e,t){return this.cartesian3ToCartographic(this.screenToCartesian3(e),t)},Q.prototype.cartesian3ToCartographic=function(e,t){return Cesium.Cartographic.fromCartesian(e,t)},Q.prototype.degreesToCartographic=function(e,t,i){return Cesium.Cartographic.fromDegrees(e,t,i)},Q.prototype.radiansToCartographic=function(e,t,i){return Cesium.Cartographic.fromRadians(e,t,i)},Q.prototype.degreesToUTM=function(e,t){return new o.LatLonEllipsoidal(t,e).toUtm()},Q.prototype.UTMToDegrees=function(e,t,i,n){return this.geodesyToCesiumObject(new o.Utm(e,t,i,n).toLatLonE())},Q.prototype.geodesyToCesiumObject=function(e){return{longitude:e.lon,latitude:e.lat,height:e.height?e.height:0}},Q.prototype.midPointToCartesian3=function(e,t){function i(e){return Cesium.Math.toDegrees(e)}var n=new X(i(e.latitude),i(e.longitude)),o=new X(i(t.latitude),i(t.longitude)),r=n.midpointTo(o);return Cesium.Cartesian3.fromDegrees(r.lon,r.lat)},Q.prototype.middlePointByScreen=function(e,t){var i=this.cesiumService.getScene(),n=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,e),o=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,t),r=new Cesium.Cartesian2((o.x+n.x)/2,(o.y+n.y)/2);return i.pickPosition(r)},Q.prototype.bearingTo=function(e,t){function i(e){return Cesium.Math.toDegrees(e)}var n=new X(i(e.latitude),i(e.longitude)),o=new X(i(t.latitude),i(t.longitude));return n.bearingTo(o)},Q.prototype.bearingToCartesian=function(e,t){var i=Cesium.Cartographic.fromCartesian(e),n=Cesium.Cartographic.fromCartesian(t);return this.bearingTo(i,n)},Q.decorators=[{type:a.Injectable}],Q.ctorParameters=function(){return[{type:K,decorators:[{type:a.Optional}]}]},Q);function Q(e){this.cesiumService=e}var ee=(te.prototype.setPropsAssigner=function(e){this._propsAssigner=e},te);function te(){}var ie,ne=(E(oe,ie=ee),oe.prototype.init=function(){this._cesiumCollection=new this.drawerType,this._primitiveCollectionWrap=new Cesium.PrimitiveCollection({destroyPrimitives:!1}),this._primitiveCollectionWrap.add(this._cesiumCollection),this.cesiumService.getScene().primitives.add(this._primitiveCollectionWrap)},oe.prototype.add=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return this._cesiumCollection.add(e)},oe.prototype.update=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this._propsAssigner?this._propsAssigner(e,t):Object.assign(e,t)},oe.prototype.remove=function(e){this._cesiumCollection.remove(e)},oe.prototype.removeAll=function(){this._cesiumCollection.removeAll()},oe.prototype.setShow=function(e){this._show=e,this._primitiveCollectionWrap.show=e},oe.prototype.getShow=function(){return this._show},oe);function oe(e,t){var i=ie.call(this)||this;return i.drawerType=e,i.cesiumService=t,i._show=!0,i}var re=(se.pointByLocationDistanceAndAzimuth=function(e,t,i,n){for(var o,r,s=t/Cesium.Ellipsoid.WGS84.maximumRadius,a=e instanceof Cesium.Cartesian3?Cesium.Cartographic.fromCartesian(e):e,p=e instanceof Cesium.Cartesian3?e:Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height),c=0,l=.1,u=-.1;0===c||c<16&&1.000001<Math.max(r,t)/Math.min(r,t);)o=se._pointByLocationDistanceAndAzimuth(a,s*(1+(u+(l-u)/2)),i),t<(r=this.distance(p,o))?l=u+(l-u)/2:u+=(l-u)/2,c++;return o},se._pointByLocationDistanceAndAzimuth=function(e,t,i){var n=e.latitude,o=e.longitude,r=Math.asin(Math.sin(n)*Math.cos(t)+Math.cos(n)*Math.sin(t)*Math.cos(i)),s=o+Math.atan2(Math.sin(i)*Math.sin(t)*Math.cos(n),Math.cos(t)-Math.sin(n)*Math.sin(r));return s=(s+3*Math.PI)%(2*Math.PI)-Math.PI,Cesium.Cartesian3.fromRadians(s,r)},se.distance=function(e,t){return Cesium.Cartesian3.distance(e,t)},se.getPositionsDelta=function(e,t){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},se.addDeltaToPosition=function(e,t,i){if(void 0===i&&(i=!1),i){e.x+=t.x,e.y+=t.y,e.z+=t.z,(o=Cesium.Cartographic.fromCartesian(e)).height=0;var n=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);return e.x=n.x,e.y=n.y,e.z=n.z,e}var o;return n=new Cesium.Cartesian3(e.x+t.x,e.y+t.y,e.z+t.z),(o=Cesium.Cartographic.fromCartesian(n)).height=0,Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height)},se.middleCartesian3Point=function(e,t){return new Cesium.Cartesian3(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2)},se.prototype.screenPositionToCartesian3=function(e){return this.cesiumService.getViewer().camera.pickEllipsoid(e)},se.decorators=[{type:a.Injectable}],se.ctorParameters=function(){return[{type:K}]},se);function se(e){this.cesiumService=e}var ae,pe=(E(ce,ae=ne),ce.prototype._calculateArcPositions=function(e){for(var t=e.quality||18,i=e.delta/t,n=[],o=0;o<t+1;++o){var r=re.pointByLocationDistanceAndAzimuth(e.center,e.radius,e.angle+i*o,!0);n.push(r)}return n},ce.prototype._calculateTriangle=function(e){return[e.center,re.pointByLocationDistanceAndAzimuth(e.center,e.radius,e.angle,!0)]},ce.prototype._calculateArc=function(e){var t=this._calculateArcPositions(e);return e.drawEdges?t.concat(this._calculateTriangle(e)):t},ce.prototype.add=function(e){if(e.positions=this._calculateArc(e),e.color){var t=Cesium.Material.fromType("Color");t.uniforms.color=e.color,e.material=t}return this._cesiumCollection.add(e)},ce.prototype.update=function(e,t){return t.constantColor||!t.color||e.material.uniforms.color.equals(t.color)||(e.material.uniforms.color=t.color),e.width=t.width!==undefined?t.width:e.width,e.show=t.show!==undefined?t.show:e.show,e.distanceDisplayCondition=t.distanceDisplayCondition!==undefined?t.distanceDisplayCondition:e.distanceDisplayCondition,e.positions=this._calculateArc(t),e},ce.decorators=[{type:a.Injectable}],ce.ctorParameters=function(){return[{type:K}]},ce);function ce(e){return ae.call(this,Cesium.PolylineCollection,e)||this}var le={ellipse:Cesium.EllipseGraphics,ellipsoid:Cesium.EllipsoidGraphics,polygon:Cesium.PolygonGraphics,polyline:Cesium.PolylineGraphics,polylineVolume:Cesium.PolylineVolumeGraphics,box:Cesium.BoxGraphics,corridor:Cesium.CorridorGraphics,cylinder:Cesium.CylinderGraphics,label:Cesium.LabelGraphics,billboard:Cesium.BillboardGraphics,model:Cesium.ModelGraphics,path:Cesium.PathGraphics,point:Cesium.PointGraphics,rectangle:Cesium.RectangleGraphics,wall:Cesium.WallGraphics},ue=(de.prototype.setShow=function(e){this.entityCollection.show=e},Object.defineProperty(de.prototype,"isSuspended",{get:function(){return this._isSuspended},enumerable:!0,configurable:!0}),Object.defineProperty(de.prototype,"updateRate",{get:function(){return this._updateRate},set:function(e){this._updateRate=e},enumerable:!0,configurable:!0}),Object.defineProperty(de.prototype,"collectionSize",{get:function(){return this._collectionSize},set:function(e){this._collectionSize=e},enumerable:!0,configurable:!0}),de.prototype.collection=function(){return this.entityCollection},de.prototype.isFree=function(){return this._collectionSize<1||this.entityCollection.values.length<this._collectionSize},de.prototype.add=function(e){return this.suspend(),this.entityCollection.add(e)},de.prototype.remove=function(e){return this.suspend(),this.entityCollection.remove(e)},de.prototype.removeNoSuspend=function(e){this.entityCollection.remove(e)},de.prototype.removeAll=function(){this.suspend(),this.entityCollection.removeAll()},de.prototype.onEventSuspension=function(e,t){var i=this;return void 0===t&&(t=!1),this._onEventSuspensionCallback={callback:e,once:t},function(){i._onEventSuspensionCallback=undefined}},de.prototype.onEventResume=function(e,t){var i=this;return void 0===t&&(t=!1),this._onEventResumeCallback={callback:e,once:t},this._isSuspended||this.triggerEventResume(),function(){i._onEventResumeCallback=undefined}},de.prototype.triggerEventSuspension=function(){if(this._onEventSuspensionCallback!==undefined){var e=this._onEventSuspensionCallback.callback;this._onEventSuspensionCallback.once&&(this._onEventSuspensionCallback=undefined),e()}},de.prototype.triggerEventResume=function(){if(this._onEventResumeCallback!==undefined){var e=this._onEventResumeCallback.callback;this._onEventResumeCallback.once&&(this._onEventResumeCallback=undefined),e()}},de.prototype.suspend=function(){var e=this;this._updateRate<0||this._isHardSuspend||this._isSuspended||(this._isSuspended=!0,this.entityCollection.suspendEvents(),this.triggerEventSuspension(),this._suspensionTimeout=setTimeout(function(){e.entityCollection.resumeEvents(),e.triggerEventResume(),e._isSuspended=!1,e._suspensionTimeout=undefined},this._updateRate))},de.prototype.hardSuspend=function(){this.entityCollection.suspendEvents(),this._isHardSuspend=!0},de.prototype.hardResume=function(){this.entityCollection.resumeEvents(),this._isHardSuspend=!1},de);function de(e,t,i){void 0===t&&(t=-1),void 0===i&&(i=-1),this.entityCollection=e,this._isSuspended=!1,this._isHardSuspend=!1,this._updateRate=i,this._collectionSize=t}var he,ye=(E(me,he=ee),me.prototype.getFreeEntitiesCollection=function(){var t=null;return this.entityCollections.forEach(function(e){e.isFree()&&(t=e)}),t},me.prototype.init=function(e){for(var t=e||this.defaultOptions,i=[],n=0;n<t.collectionsNumber;n++){var o=new Cesium.CustomDataSource(this.graphicsTypeName);i.push(o),this.cesiumService.getViewer().dataSources.add(o),this.entityCollections.set(o.entities,new ue(o.entities,t.collectionMaxSize,t.collectionSuspensionTime))}return i},me.prototype.add=function(e){var t,i=this.getFreeEntitiesCollection();if(null===i)throw new Error("No more free entity collections");this.graphicsType;var n=((t={position:e.position!==undefined?e.position:undefined,description:e.description!==undefined?e.description:undefined,orientation:e.orientation!==undefined?e.orientation:undefined,viewFrom:e.viewFrom!==undefined?e.viewFrom:undefined})[this.graphicsTypeName]=e,t);return e.name!==undefined&&(n.name=e.name),i.add(n)},me.prototype.update=function(e,t){this.suspendEntityCollection(e),e.position instanceof Cesium.CallbackProperty&&e.position._isConstant&&(e.position=t.position),e.position=t.position!==undefined?t.position:undefined,e.name=t.name!==undefined?t.name:e.name,e.description=t.description!==undefined?t.description:e.description,e.orientation=t.orientation!==undefined?t.orientation:e.orientation,e.viewFrom=t.viewFrom!==undefined?t.viewFrom:e.viewFrom,this._propsAssigner?this._propsAssigner(e[this.graphicsTypeName],t):Object.assign(e[this.graphicsTypeName],t)},me.prototype.remove=function(e){this.entityCollections.get(e.entityCollection).remove(e)},me.prototype.removeAll=function(){this.entityCollections.forEach(function(e){e.removeAll()})},me.prototype.setShow=function(t){this.entityCollections.forEach(function(e){e.setShow(t)})},me.prototype.suspendEntityCollection=function(e){var t=e.entityCollection;if(!this.entityCollections.has(t))throw new Error("No EntityCollection for entity.entityCollection");this.entityCollections.get(t).suspend()},me);function me(e,t,i){void 0===i&&(i={collectionMaxSize:-1,collectionSuspensionTime:-1,collectionsNumber:1});var n=he.call(this)||this;for(var o in n.cesiumService=e,n.graphicsType=t,n.defaultOptions=i,n.entityCollections=new Map,n.graphicsTypeName=le[n.graphicsType],le)le[o]===n.graphicsType&&(n.graphicsTypeName=o);return n}var fe,ge=(E(ve,fe=ye),ve.decorators=[{type:a.Injectable}],ve.ctorParameters=function(){return[{type:K}]},ve);function ve(e){return fe.call(this,e,le.billboard)||this}var Pe,be=(E(Ce,Pe=ee),Ce.prototype.init=function(e){var t=[];return this.czmlStream=new Cesium.CzmlDataSource("czml"),t.push(this.czmlStream),this.cesiumService.getViewer().dataSources.add(this.czmlStream),t},Ce.prototype.add=function(e){return this.czmlStream.process(e.czmlPacket),e},Ce.prototype.update=function(e,t){this.czmlStream.process(t.czmlPacket)},Ce.prototype.remove=function(e){this.czmlStream.entities.removeById(e.acEntity.id)},Ce.prototype.removeAll=function(){this.czmlStream.entities.removeAll()},Ce.prototype.setShow=function(e){this.czmlStream.entities.show=e},Ce.decorators=[{type:a.Injectable}],Ce.ctorParameters=function(){return[{type:K}]},Ce);function Ce(e){var t=Pe.call(this)||this;return t.cesiumService=e,t}var Ee,_e=(E(Se,Ee=ye),Se.decorators=[{type:a.Injectable}],Se.ctorParameters=function(){return[{type:K}]},Se);function Se(e){return Ee.call(this,e,le.ellipse,{collectionsNumber:10,collectionMaxSize:450,collectionSuspensionTime:100})||this}var Me,Ie=(E(Ae,Me=ye),Ae.decorators=[{type:a.Injectable}],Ae.ctorParameters=function(){return[{type:K}]},Ae);function Ae(e){return Me.call(this,e,le.label)||this}var Le,De=(E(we,Le=ye),we.decorators=[{type:a.Injectable}],we.ctorParameters=function(){return[{type:K}]},we);function we(e){return Le.call(this,e,le.point)||this}var Te,Oe=(E(Re,Te=ye),Re.decorators=[{type:a.Injectable}],Re.ctorParameters=function(){return[{type:K}]},Re);function Re(e){return Te.call(this,e,le.polygon)||this}var xe,je=(E(Ne,xe=ye),Ne.decorators=[{type:a.Injectable}],Ne.ctorParameters=function(){return[{type:K}]},Ne);function Ne(e){return xe.call(this,e,le.polyline)||this}var Fe,ke=(E(Ve,Fe=ne),Ve.prototype.add=function(e){return this._cesiumCollection.add(this.withColorMaterial(e))},Ve.prototype.update=function(e,t){t.material instanceof Cesium.Color&&(e.material&&e.material.uniforms&&e.material.uniforms.color instanceof Cesium.Color?this.withColorMaterial(t):e.material.uniforms.color.equals(t.material)||(e.material.uniforms.color=t.material)),Fe.prototype.update.call(this,e,t)},Ve.prototype.withColorMaterial=function(e){if(e.material instanceof Cesium.Color){var t=Cesium.Material.fromType("Color");t.uniforms.color=e.material,e.material=t}return e},Ve.decorators=[{type:a.Injectable}],Ve.ctorParameters=function(){return[{type:K}]},Ve);function Ve(e){return Fe.call(this,Cesium.PolylineCollection,e)||this}var He,Be={CAMERA_FORWARD:0,CAMERA_BACKWARD:1,CAMERA_RIGHT:2,CAMERA_LEFT:3,CAMERA_UP:4,CAMERA_DOWN:5,CAMERA_LOOK_RIGHT:6,CAMERA_LOOK_LEFT:7,CAMERA_LOOK_UP:8,CAMERA_LOOK_DOWN:9,CAMERA_TWIST_RIGHT:10,CAMERA_TWIST_LEFT:11,CAMERA_ROTATE_RIGHT:12,CAMERA_ROTATE_LEFT:13,CAMERA_ROTATE_UP:14,CAMERA_ROTATE_DOWN:15,CAMERA_ZOOM_IN:16,CAMERA_ZOOM_OUT:17};Be[Be.CAMERA_FORWARD]="CAMERA_FORWARD",Be[Be.CAMERA_BACKWARD]="CAMERA_BACKWARD",Be[Be.CAMERA_RIGHT]="CAMERA_RIGHT",Be[Be.CAMERA_LEFT]="CAMERA_LEFT",Be[Be.CAMERA_UP]="CAMERA_UP",Be[Be.CAMERA_DOWN]="CAMERA_DOWN",Be[Be.CAMERA_LOOK_RIGHT]="CAMERA_LOOK_RIGHT",Be[Be.CAMERA_LOOK_LEFT]="CAMERA_LOOK_LEFT",Be[Be.CAMERA_LOOK_UP]="CAMERA_LOOK_UP",Be[Be.CAMERA_LOOK_DOWN]="CAMERA_LOOK_DOWN",Be[Be.CAMERA_TWIST_RIGHT]="CAMERA_TWIST_RIGHT",Be[Be.CAMERA_TWIST_LEFT]="CAMERA_TWIST_LEFT",Be[Be.CAMERA_ROTATE_RIGHT]="CAMERA_ROTATE_RIGHT",Be[Be.CAMERA_ROTATE_LEFT]="CAMERA_ROTATE_LEFT",Be[Be.CAMERA_ROTATE_UP]="CAMERA_ROTATE_UP",Be[Be.CAMERA_ROTATE_DOWN]="CAMERA_ROTATE_DOWN",Be[Be.CAMERA_ZOOM_IN]="CAMERA_ZOOM_IN",Be[Be.CAMERA_ZOOM_OUT]="CAMERA_ZOOM_OUT";var Ge=((He={})[Be.CAMERA_FORWARD]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveForward(n)},He[Be.CAMERA_BACKWARD]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveBackward(n)},He[Be.CAMERA_UP]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveUp(n)},He[Be.CAMERA_DOWN]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveDown(n)},He[Be.CAMERA_RIGHT]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveRight(n)},He[Be.CAMERA_LEFT]=function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height/(t.moveRate||100);i.moveLeft(n)},He[Be.CAMERA_LOOK_RIGHT]=function(e,t){var i=e.getViewer().camera,n=i.positionCartographic,o=t.lookFactor||.01;i.lookRight(n.latitude*o)},He[Be.CAMERA_LOOK_LEFT]=function(e,t){var i=e.getViewer().camera,n=i.positionCartographic,o=t.lookFactor||.01;i.lookLeft(n.latitude*o)},He[Be.CAMERA_LOOK_UP]=function(e,t){var i=e.getViewer().camera,n=i.positionCartographic,o=t.lookFactor||.01;i.lookUp(n.longitude*(-1*o))},He[Be.CAMERA_LOOK_DOWN]=function(e,t){var i=e.getViewer().camera,n=i.positionCartographic,o=t.lookFactor||.01;i.lookDown(n.longitude*(-1*o))},He[Be.CAMERA_TWIST_RIGHT]=function(e,t){var i=e.getViewer().camera,n=t.amount||.01;i.twistRight(n)},He[Be.CAMERA_TWIST_LEFT]=function(e,t){var i=e.getViewer().camera,n=t.amount||.01;i.twistLeft(n)},He[Be.CAMERA_ROTATE_RIGHT]=function(e,t){var i=e.getViewer().camera,n=t.angle||.01;i.rotateRight(n)},He[Be.CAMERA_ROTATE_LEFT]=function(e,t){var i=e.getViewer().camera,n=t.angle||.01;i.rotateLeft(n)},He[Be.CAMERA_ROTATE_UP]=function(e,t){var i=e.getViewer().camera,n=t.angle||.01;i.rotateUp(n)},He[Be.CAMERA_ROTATE_DOWN]=function(e,t){var i=e.getViewer().camera,n=t.angle||.01;i.rotateDown(n)},He[Be.CAMERA_ZOOM_IN]=function(e,t){var i=e.getViewer().camera,n=t.amount;i.zoomIn(n)},He[Be.CAMERA_ZOOM_OUT]=function(e,t){var i=e.getViewer().camera,n=t.amount;i.zoomOut(n)},He),Ue={IGNORED:0,NOT_PRESSED:1,PRESSED:2};Ue[Ue.IGNORED]="IGNORED",Ue[Ue.NOT_PRESSED]="NOT_PRESSED",Ue[Ue.PRESSED]="PRESSED";var ze=(Ke.prototype.init=function(){var e=this.cesiumService.getCanvas();e.addEventListener("click",function(){e.focus()}),this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.handleTick=this.handleTick.bind(this)},Ke.prototype.setKeyboardControls=function(e,t,i){var n=this;if(void 0===i&&(i=!1),!e)return this.removeKeyboardControls();this._currentDefinitions||this.registerEvents(i),this._currentDefinitions=e,this._keyMappingFn=t||this.defaultKeyMappingFn,Object.keys(this._currentDefinitions).forEach(function(e){n._activeDefinitions[e]={state:Ue.NOT_PRESSED,action:null,keyboardEvent:null}})},Ke.prototype.removeKeyboardControls=function(){this.unregisterEvents(),this._currentDefinitions=null},Ke.prototype.getAction=function(e){return this._currentDefinitions[e]||null},Ke.prototype.defaultKeyMappingFn=function(e){return String.fromCharCode(e.keyCode)},Ke.prototype.handleKeydown=function(e){var t=this._keyMappingFn(e),i=this.getAction(t);if(i&&this._activeDefinitions[t].state!==Ue.IGNORED){var n=!0,o=this.getParams(i.params,e);i.validation&&(n=i.validation(this.cesiumService,o,e)),!0===n&&(this._activeDefinitions[t]={state:Ue.PRESSED,action:i,keyboardEvent:e})}},Ke.prototype.handleKeyup=function(e){var t=this._keyMappingFn(e),i=this.getAction(t);i&&(this._activeDefinitions[t]={state:Ue.NOT_PRESSED,action:null,keyboardEvent:e},i.done&&"function"==typeof i.done&&i.done(this.cesiumService,e))},Ke.prototype.handleTick=function(){var i=this;Object.keys(this._activeDefinitions).forEach(function(e){var t=i._activeDefinitions[e];null!==t&&null!==t.action&&t.state===Ue.PRESSED&&i.executeAction(t.action,e,t.keyboardEvent)})},Ke.prototype.getParams=function(e,t){return e?"function"==typeof e?e(this.cesiumService,t):e:{}},Ke.prototype.executeAction=function(e,t,i){if(this._currentDefinitions){var n=this.getParams(e.params,i);if(r.isNumber(e.action)){var o=Ge[e.action];o&&o(this.cesiumService,n,i)}else"function"==typeof e.action&&!1===e.action(this.cesiumService,n,i)&&(this._activeDefinitions[t]={state:Ue.IGNORED,action:null,keyboardEvent:null})}},Ke.prototype.registerEvents=function(e){function t(){i.document.addEventListener("keydown",i.handleKeydown),i.document.addEventListener("keyup",i.handleKeyup),i.cesiumService.getViewer().clock.onTick.addEventListener(i.handleTick)}var i=this;e?this.ngZone.runOutsideAngular(t):t()},Ke.prototype.unregisterEvents=function(){this.document.removeEventListener("keydown",this.handleKeydown),this.document.removeEventListener("keyup",this.handleKeyup),this.cesiumService.getViewer().clock.onTick.removeEventListener(this.handleTick)},Ke.decorators=[{type:a.Injectable}],Ke.ctorParameters=function(){return[{type:a.NgZone},{type:K},{type:undefined,decorators:[{type:a.Inject,args:[s.DOCUMENT]}]}]},Ke);function Ke(e,t,i){this.ngZone=e,this.cesiumService=t,this.document=i,this._currentDefinitions=null,this._activeDefinitions={},this._keyMappingFn=this.defaultKeyMappingFn}var We=($e.prototype.init=function(e){var i=this;return this.observer=w.Observable.create(function(t){e.setInputAction(function(e){e.position&&(e.startPosition=e.position,e.endPosition=e.position),t.next(e)},i.event,i.modifier)}),this.observer},$e);function $e(e,t){this.event=e,this.modifier=t}var Ze,Ye=(E(qe,Ze=We),qe.prototype.init=function(){var e,t;this.event===$.LONG_LEFT_PRESS?(e=$.LEFT_DOWN,t=$.LEFT_UP):this.event===$.LONG_RIGHT_PRESS?(e=$.RIGHT_DOWN,t=$.RIGHT_UP):this.event===$.LONG_MIDDLE_PRESS&&(e=$.MIDDLE_DOWN,t=$.MIDDLE_UP);var i=this.eventFactory.get(e,this.modifier),n=this.eventFactory.get(t,this.modifier);return f.publish()(i.pipe(f.mergeMap(function(e){return w.of(e).pipe(f.delay(qe.LONG_PRESS_EVENTS_DURATION),f.takeUntil(n))})))},qe.LONG_PRESS_EVENTS_DURATION=250,qe);function qe(e,t,i){var n=Ze.call(this,e,t)||this;return n.event=e,n.modifier=t,n.eventFactory=i,n}var Xe=(Je.getEventFullName=function(e,t){return t?e+"_"+t:e.toString()},Je.prototype.init=function(){this.eventsHandler=this.cesiumService.getViewer().screenSpaceEventHandler},Je.prototype.get=function(e,t){var i=Je.getEventFullName(e,t);if(this.cesiumEventsObservables.has(i))return this.cesiumEventsObservables.get(i);var n=this.createCesiumEventObservable(e,t);return this.cesiumEventsObservables.set(i,n),n},Je.prototype.createCesiumEventObservable=function(e,t){var i;return(i=Je.longPressEvents.has(e)?this.createSpecialCesiumEventObservable(e,t):f.publish()(new We(e,t).init(this.eventsHandler))).connect(),i},Je.prototype.createSpecialCesiumEventObservable=function(e,t){return new Ye(e,t,this).init()},Je.longPressEvents=new Set([$.LONG_LEFT_PRESS,$.LONG_RIGHT_PRESS,$.LONG_MIDDLE_PRESS]),Je.decorators=[{type:a.Injectable}],Je.ctorParameters=function(){return[{type:K}]},Je);function Je(e){this.cesiumService=e,this.cesiumEventsObservables=new Map}var Qe=(Object.defineProperty(et.prototype,"plonterChangeNotifier",{get:function(){return this._plonterChangeNotifier},enumerable:!0,configurable:!0}),Object.defineProperty(et.prototype,"plonterShown",{get:function(){return this._plonterShown},enumerable:!0,configurable:!0}),Object.defineProperty(et.prototype,"entitesToPlonter",{get:function(){return this._entitesToPlonter},enumerable:!0,configurable:!0}),Object.defineProperty(et.prototype,"plonterClickPosition",{get:function(){return this._eventResult.movement},enumerable:!0,configurable:!0}),et.prototype.plonterIt=function(e){return this._eventResult=e,this._entitesToPlonter=e.entities,this._plonterShown=!0,this._plonterChangeNotifier.emit(),this._plonterObserver},et.prototype.resolvePlonter=function(e){this._plonterShown=!1,this._eventResult.entities=[e],this._plonterChangeNotifier.emit(),this._plonterObserver.next(this._eventResult)},et.decorators=[{type:a.Injectable}],et.ctorParameters=function(){return[]},et);function et(){this._entitesToPlonter=[],this._plonterChangeNotifier=new a.EventEmitter,this._plonterObserver=new w.Subject}var tt=function(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])},it=(nt.getDragEventTypes=function(e){var t,i;return e===$.LEFT_CLICK_DRAG?(t=$.LEFT_DOWN,i=$.LEFT_UP):e===$.RIGHT_CLICK_DRAG?(t=$.RIGHT_DOWN,i=$.RIGHT_UP):e===$.MIDDLE_CLICK_DRAG&&(t=$.MIDDLE_DOWN,i=$.MIDDLE_UP),{mouseDownEvent:t,mouseUpEvent:i}},nt.dragEvents=new Set([$.LEFT_CLICK_DRAG,$.RIGHT_CLICK_DRAG,$.MIDDLE_CLICK_DRAG]),nt);function nt(){}var ot=function Da(e,t,i,n){this.observable=e,this.stopper=t,this.priority=i,this.isPaused=n},rt=(st.prototype.init=function(){this.eventBuilder.init(),this.scene=this.cesiumService.getScene()},st.prototype.register=function(e){var t=this;if(this.scene===undefined)throw new Error("CesiumService has not been initialized yet - MapEventsManagerService must be injected  under ac-map");if(e.pick=e.pick||Z.NO_PICK,e.priority=e.priority||0,e.entityType&&e.pick===Z.NO_PICK)throw new Error("MapEventsManagerService: can't register an event with entityType and PickOptions.NO_PICK - It doesn't make sense ");var i=Xe.getEventFullName(e.event,e.modifier);this.eventRegistrations.has(i)||this.eventRegistrations.set(i,[]);var n=this.createEventRegistration(e.event,e.modifier,e.entityType,e.pick,e.priority,e.pickFilter),o=n.observable;return o.dispose=function(){return t.disposeObservable(n,i)},this.eventRegistrations.get(i).push(n),this.sortRegistrationsByPriority(i),o},st.prototype.disposeObservable=function(e,t){e.stopper.next(1);var i=this.eventRegistrations.get(t),n=i.indexOf(e);-1!==n&&i.splice(n,1),this.sortRegistrationsByPriority(t)},st.prototype.sortRegistrationsByPriority=function(e){var t=this.eventRegistrations.get(e);if(t.sort(function(e,t){return t.priority-e.priority}),0!==t.length){var i=t[0].priority;t.forEach(function(e){e.isPaused=e.priority<i})}},st.prototype.createEventRegistration=function(e,t,i,n,o,r){var s,a=this,p=this.eventBuilder.get(e,t),c=new w.Subject,l=new ot(undefined,c,o,!1);return s=it.dragEvents.has(e)?this.createDragEvent(e,t,i,n,o,r).pipe(f.takeUntil(c)):p.pipe(f.filter(function(){return!l.isPaused}),f.map(function(e){return a.triggerPick(e,n)}),f.filter(function(e){return null!==e.cesiumEntities||i===undefined}),f.map(function(e){return a.addEntities(e,i,n,r)}),f.filter(function(e){return null!==e.entities||i===undefined&&!r}),f.switchMap(function(e){return a.plonter(e,n)}),f.takeUntil(c)),l.observable=s,l},st.prototype.createDragEvent=function(e,t,i,n,o,r){var s=it.getDragEventTypes(e),a=s.mouseDownEvent,p=s.mouseUpEvent,c=this.eventBuilder.get(p),l=this.eventBuilder.get($.MOUSE_MOVE),u=this.createEventRegistration(a,t,i,n,o,r),d=new w.Subject,h=u.observable.pipe(f.mergeMap(function(t){var i=null,n=t.movement.startPosition.x,o=t.movement.startPosition.y;return l.pipe(f.map(function(e){return i={movement:{drop:!1,startPosition:{x:n,y:o},endPosition:e.endPosition},entities:t.entities,cesiumEntities:t.cesiumEntities}}),f.takeUntil(c),f.tap(undefined,undefined,function(){if(i){var e=Object.assign({},i);e.movement.drop=!0,d.next(e)}}))}));return w.merge(h,d)},st.prototype.triggerPick=function(e,t){var i=[];switch(t){case Z.PICK_ONE:case Z.PICK_ALL:i=0===(i=this.scene.drillPick(e.endPosition)).length?null:i;break;case Z.PICK_FIRST:var n=this.scene.pick(e.endPosition);i=n===undefined?null:[n];break;case Z.NO_PICK:}return{movement:e,cesiumEntities:i=i&&i.map(function(e){return e.id&&e.id instanceof Cesium.Entity?e.id:e.primitive})}},st.prototype.addEntities=function(e,t,i,n){if(null===e.cesiumEntities)return e.entities=null,e;var o=[];return i!==Z.NO_PICK&&(o=t?e.cesiumEntities.map(function(e){return e.acEntity}).filter(function(e){return e&&e instanceof t}):e.cesiumEntities.map(function(e){return e.acEntity}),o=tt(o),0===(o=n&&o?o.filter(n):o).length&&(o=null)),e.entities=o,e},st.prototype.plonter=function(e,t){return t===Z.PICK_ONE&&null!==e.entities&&1<e.entities.length?this.plonterService.plonterIt(e):w.of(e)},st.decorators=[{type:a.Injectable}],st.ctorParameters=function(){return[{type:K},{type:Xe},{type:Qe}]},st);function st(e,t,i){this.cesiumService=e,this.eventBuilder=t,this.plonterService=i,this.eventRegistrations=new Map}var at=(pt.prototype.registerLayerDataSources=function(e,t){var i=this;e.forEach(function(e){e.zIndex=t,i.layersDataSources.push(e)})},pt.prototype.drawAllLayers=function(){var t=this;this.layersDataSources.sort(function(e,t){return e.zIndex-t.zIndex}),this.layersDataSources.forEach(function(e){t.cesiumService.getViewer().dataSources.add(e)})},pt.prototype.updateAndRefresh=function(e,i){var n=this;e&&e.length&&(e.forEach(function(e){var t=n.layersDataSources.indexOf(e);-1!==t&&(n.layersDataSources[t].zIndex=i)}),this.cesiumService.getViewer().dataSources.removeAll(),this.drawAllLayers())},pt.prototype.removeDataSources=function(e){var i=this;e.forEach(function(e){var t=i.layersDataSources.indexOf(e);-1!==t&&(i.layersDataSources.splice(t,1),i.cesiumService.getViewer().dataSources.remove(e,!0))})},pt.decorators=[{type:a.Injectable}],pt.ctorParameters=function(){return[{type:K}]},pt);function pt(e){this.cesiumService=e,this.layersDataSources=[]}var ct=(lt.prototype.getMap=function(e){return e?this._Maps.get(e):this.firstMap},lt.prototype._registerMap=function(e,t){this.firstMap||(this.firstMap=t);var i=e||this.generateDefaultId();if(this._Maps.has(i))throw new Error("Map with id: "+i+" already exist");return this._Maps.set(i,t),i},lt.prototype._removeMapById=function(e){if(this._Maps.has(e)&&this._Maps.get(e)===this.firstMap){var t=this._Maps.values();t.next(),this.firstMap=t.next().value}return this._Maps["delete"](e)},lt.prototype.generateDefaultId=function(){return this.defaultIdCounter++,"default-map-id-"+this.defaultIdCounter},lt.prototype.sync2DMapsCameras=function(e){var o=this;this.unsyncMapsCameras();var r=e.map(function(e){var t=o.getMap(e.id);if(!t)throw new Error("Couldn't find map with id: "+e.id);return{map:t,options:{sensitivity:e.sensitivity,bindZoom:e.bindZoom}}});r.forEach(function(e){var s=e.map,t=e.options,i=s.getCameraService().getCamera(),a=i.positionCartographic;i.percentageChanged=t.sensitivity||.01;var n=i.changed.addEventListener(function(){r.forEach(function(e){var t=e.map,i=e.options;if(t!==s){var n=t.getCameraService().getCamera(),o=n.positionCartographic,r=Cesium.Ellipsoid.WGS84.cartographicToCartesian({longitude:a.longitude,latitude:a.latitude,height:i.bindZoom?a.height:o.height});t.getCesiumViewer().scene.mode!==Cesium.SceneMode.MORPHING&&n.setView({destination:r,orientation:{heading:n.heading,pitch:n.pitch}})}})});o.eventRemoveCallbacks.push(n)})},lt.prototype.unsyncMapsCameras=function(){this.eventRemoveCallbacks.forEach(function(e){return e()}),this.eventRemoveCallbacks=[]},lt.decorators=[{type:a.Injectable}],lt.ctorParameters=function(){return[]},lt);function lt(){this.defaultIdCounter=0,this._Maps=new Map,this.eventRemoveCallbacks=[]}var ut=(dt.prototype.getMapScreenshotDataUrlBase64=function(){return this.cesiumService.getCanvas().toDataURL()},dt.prototype.downloadMapScreenshot=function(e){void 0===e&&(e="map.png");var t=this.getMapScreenshotDataUrlBase64();this.downloadURI(t,e)},dt.prototype.downloadURI=function(e,t){var i=document.createElement("a");i.download=t,i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)},dt.decorators=[{type:a.Injectable}],dt.ctorParameters=function(){return[{type:K}]},dt);function dt(e){this.cesiumService=e}var ht=(yt.prototype.ngOnInit=function(){this.mapId=this.mapsManagerService._registerMap(this.mapId,this),this.containerId||this._elemRef.nativeElement.appendChild(this.mapContainer)},yt.prototype.ngOnChanges=function(e){if(e.sceneMode&&this._cameraService.setSceneMode(e.sceneMode.currentValue),e.flyTo&&this._cameraService.cameraFlyTo(e.flyTo.currentValue),e.containerId&&!e.containerId.firstChange){var t=this.document.getElementById(e.containerId.currentValue);if(!t)throw new Error("No element found with id: "+e.containerId.currentValue);t.appendChild(this.mapContainer)}},yt.prototype.ngAfterViewInit=function(){var t=this;this.mapLayersService.drawAllLayers(),this.containerId&&setTimeout(function(){var e=t.document.getElementById(t.containerId);if(!e)throw new Error("No element found with id: "+t.containerId);e.appendChild(t.mapContainer)},0)},yt.prototype.ngOnDestroy=function(){this.getCesiumViewer().destroy(),this.mapContainer.remove(),this.mapsManagerService._removeMapById(this.mapId)},yt.prototype.getCesiumSerivce=function(){return this._cesiumService},yt.prototype.getCesiumViewer=function(){return this._cesiumService.getViewer()},yt.prototype.getCameraService=function(){return this._cameraService},yt.prototype.getId=function(){return this.mapId},yt.prototype.getMapContainer=function(){return this.mapContainer},yt.prototype.getMapEventsManager=function(){return this.mapEventsManager},yt.prototype.getContextMenuService=function(){return this.contextMenuService},yt.prototype.getScreenshotService=function(){return this.screenshotService},yt.prototype.getKeyboardControlService=function(){return this.keyboardControlService},yt.prototype.getCoordinateConverter=function(){return this.coordinateConverter},yt.decorators=[{type:a.Component,args:[{selector:"ac-map",template:'\n    <ac-default-plonter *ngIf="!disableDefaultPlonter"></ac-default-plonter>\n    <ac-context-menu-wrapper></ac-context-menu-wrapper>\n    <ng-content></ng-content>\n  ',providers:[K,ge,Xe,ze,rt,Qe,Ie,je,ke,_e,De,pe,be,Oe,at,P,ut,Y,J]}]}],yt.ctorParameters=function(){return[{type:K},{type:P},{type:a.ElementRef},{type:undefined,decorators:[{type:a.Inject,args:[s.DOCUMENT]}]},{type:ct},{type:ge},{type:Ie},{type:_e},{type:je},{type:Oe},{type:pe},{type:De},{type:be},{type:rt},{type:ze},{type:at},{type:m},{type:ut},{type:Y},{type:J}]},yt.propDecorators={disableDefaultPlonter:[{type:a.Input}],mapId:[{type:a.Input}],flyTo:[{type:a.Input}],sceneMode:[{type:a.Input}],containerId:[{type:a.Input}]},yt);function yt(e,t,i,n,o,r,s,a,p,c,l,u,d,h,y,m,f,g,v,P){this._cesiumService=e,this._cameraService=t,this._elemRef=i,this.document=n,this.mapsManagerService=o,this.billboardDrawerService=r,this.labelDrawerService=s,this.ellipseDrawerService=a,this.polylineDrawerService=p,this.polygonDrawerService=c,this.arcDrawerService=l,this.pointDrawerService=u,this.czmlDrawerService=d,this.mapEventsManager=h,this.keyboardControlService=y,this.mapLayersService=m,this.configurationService=f,this.screenshotService=g,this.contextMenuService=v,this.coordinateConverter=P,this.disableDefaultPlonter=!1,this.mapContainer=this.document.createElement("div"),this.mapContainer.style.width="100%",this.mapContainer.style.height="100%",this.mapContainer.className="map-container",this._cesiumService.init(this.mapContainer,this),this._cameraService.init(this._cesiumService),this.mapEventsManager.init(),this.billboardDrawerService.init(),this.labelDrawerService.init(),this.ellipseDrawerService.init(),this.polylineDrawerService.init(),this.polygonDrawerService.init(),this.arcDrawerService.init(),this.pointDrawerService.init(),this.czmlDrawerService.init(),this.keyboardControlService.init(),this.contextMenuService.init(this.mapEventsManager)}var mt=(Object.defineProperty(ft.prototype,"cache",{get:function(){return this._cache},set:function(e){this._cache=e},enumerable:!0,configurable:!0}),Object.defineProperty(ft.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){e!==this._zIndex&&this.layerUpdate.emit(),this._zIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(ft.prototype,"show",{get:function(){return this._show},set:function(e){e!==this._show&&this.layerUpdate.emit(),this._show=e},enumerable:!0,configurable:!0}),Object.defineProperty(ft.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e,this.layerUpdate.emit()},enumerable:!0,configurable:!0}),Object.defineProperty(ft.prototype,"context",{get:function(){return this._context},set:function(e){this._context=e,this.layerUpdate.emit()},enumerable:!0,configurable:!0}),ft.prototype.setEntityName=function(e){this._entityName=e},ft.prototype.getEntityName=function(){return this._entityName},ft.prototype.registerDescription=function(e){this.descriptions.indexOf(e)<0&&this.descriptions.push(e)},ft.prototype.unregisterDescription=function(e){var t=this.descriptions.indexOf(e);-1<t&&this.descriptions.splice(t,1)},ft.prototype.getDescriptions=function(){return this.descriptions},ft.prototype.layerUpdates=function(){return this.layerUpdate},ft.decorators=[{type:a.Injectable}],ft);function ft(){this._cache=!0,this.descriptions=[],this.layerUpdate=new a.EventEmitter}var gt={ADD_UPDATE:0,DELETE:1};gt[gt.ADD_UPDATE]="ADD_UPDATE",gt[gt.DELETE]="DELETE";var vt=(Pt.prototype.get=function(e,t){if(this._cache.has(e))return this._cache.get(e);var i=t();return this._cache.set(e,i),i},Pt.prototype.clear=function(){this._cache.clear()},Pt.decorators=[{type:a.Injectable}],Pt);function Pt(){this._cache=new Map}var bt=(Ct.throwIfAnyNotPresent=function(t,e){e.forEach(function(e){return Ct.throwIfNotPresent(t,e)})},Ct.throwIfNotPresent=function(e,t){if(!Ct.present(e[t]))throw new Error("Error: "+t+" was not given.")},Ct.present=function(e){return e!==undefined&&null!==e},Ct);function Ct(){}var Et,_t=(E(St,Et=ne),St.prototype.add=function(e){return bt.throwIfAnyNotPresent(e,["center","semiMajorAxis","semiMinorAxis"]),Et.prototype.add.call(this,new t.EllipsePrimitive(e))},St.prototype.update=function(e,t){return e.updateLocationData(t),e},St.decorators=[{type:a.Injectable}],St.ctorParameters=function(){return[{type:K}]},St);function St(e){return Et.call(this,Cesium.PrimitiveCollection,e)||this}var Mt,It=(E(At,Mt=ne),At.decorators=[{type:a.Injectable}],At.ctorParameters=function(){return[{type:K}]},At);function At(e){return Mt.call(this,Cesium.PolylineCollection,e)||this}var Lt,Dt=(E(wt,Lt=ne),wt.prototype.add=function(e,t,i){t.geometry=new this.geometryType(e),i.geometryInstances=new Cesium.GeometryInstance(t),i.asynchronous=!1;var n=new Cesium.Primitive(i);return Lt.prototype.add.call(this,n)},wt.prototype.update=function(e,t,i,n){return i.geometry=new this.geometryType(t),n.geometryInstances=new Cesium.GeometryInstance(i),this._cesiumCollection.remove(e),Lt.prototype.add.call(this,new Cesium.Primitive(n))},wt);function wt(e,t){var i=Lt.call(this,Cesium.PrimitiveCollection,t)||this;return i.geometryType=e,i}var Tt,Ot=(E(Rt,Tt=Dt),Rt.decorators=[{type:a.Injectable}],Rt.ctorParameters=function(){return[{type:K}]},Rt);function Rt(e){return Tt.call(this,Cesium.CircleGeometry,e)||this}var xt,jt=(E(Nt,xt=Dt),Nt.prototype.update=function(e,t,i,n){var o=i.attributes.color.value;return e.ready?e.getGeometryInstanceAttributes().color=o:Cesium.when(e.readyPromise).then(function(e){e.getGeometryInstanceAttributes().color.value=o}),e},Nt.decorators=[{type:a.Injectable}],Nt.ctorParameters=function(){return[{type:K}]},Nt);function Nt(e){return xt.call(this,Cesium.PolylineGeometry,e)||this}var Ft,kt=(E(Vt,Ft=Dt),Vt.decorators=[{type:a.Injectable}],Vt.ctorParameters=function(){return[{type:K}]},Vt);function Vt(e){return Ft.call(this,Cesium.PolygonGeometry,e)||this}var Ht,Bt=(E(Gt,Ht=Dt),Gt.decorators=[{type:a.Injectable}],Gt.ctorParameters=function(){return[{type:K}]},Gt);function Gt(e){return Ht.call(this,Cesium.EllipseGeometry,e)||this}var Ut,zt=(E(Kt,Ut=ye),Kt.decorators=[{type:a.Injectable}],Kt.ctorParameters=function(){return[{type:K}]},Kt);function Kt(e){return Ut.call(this,e,le.model)||this}var Wt,$t=(E(Zt,Wt=ye),Zt.decorators=[{type:a.Injectable}],Zt.ctorParameters=function(){return[{type:K}]},Zt);function Zt(e){return Wt.call(this,e,le.box)||this}var Yt,qt=(E(Xt,Yt=ye),Xt.decorators=[{type:a.Injectable}],Xt.ctorParameters=function(){return[{type:K}]},Xt);function Xt(e){return Yt.call(this,e,le.corridor)||this}var Jt,Qt=(E(ei,Jt=ye),ei.decorators=[{type:a.Injectable}],ei.ctorParameters=function(){return[{type:K}]},ei);function ei(e){return Jt.call(this,e,le.cylinder)||this}var ti,ii=(E(ni,ti=ye),ni.decorators=[{type:a.Injectable}],ni.ctorParameters=function(){return[{type:K}]},ni);function ni(e){return ti.call(this,e,le.ellipsoid)||this}var oi,ri=(E(si,oi=ye),si.decorators=[{type:a.Injectable}],si.ctorParameters=function(){return[{type:K}]},si);function si(e){return oi.call(this,e,le.polylineVolume)||this}var ai,pi=(E(ci,ai=ye),ci.decorators=[{type:a.Injectable}],ci.ctorParameters=function(){return[{type:K}]},ci);function ci(e){return ai.call(this,e,le.wall)||this}var li,ui=(E(di,li=ye),di.decorators=[{type:a.Injectable}],di.ctorParameters=function(){return[{type:K}]},di);function di(e){return li.call(this,e,le.rectangle)||this}var hi,yi=(E(mi,hi=ne),mi.decorators=[{type:a.Injectable}],mi.ctorParameters=function(){return[{type:K}]},mi);function mi(e){return hi.call(this,Cesium.LabelCollection,e)||this}var fi,gi=(E(vi,fi=ne),vi.decorators=[{type:a.Injectable}],vi.ctorParameters=function(){return[{type:K}]},vi);function vi(e){return fi.call(this,Cesium.BillboardCollection,e)||this}var Pi,bi=(E(Ci,Pi=ne),Ci.decorators=[{type:a.Injectable}],Ci.ctorParameters=function(){return[{type:K}]},Ci);function Ci(e){return Pi.call(this,Cesium.PointPrimitiveCollection,e)||this}var Ei,_i=(E(Si,Ei=ne),Si.prototype.add=function(e){return e.scene=this._cesiumService.getScene(),e.mapContainer=this._cesiumService.getMap().getMapContainer(),Ei.prototype.add.call(this,e)},Si.decorators=[{type:a.Injectable}],Si.ctorParameters=function(){return[{type:K}]},Si);function Si(e){var t=Ei.call(this,Cesium.HtmlCollection,e)||this;return t._cesiumService=e,t}var Mi=(Ii.prototype.init=function(){var n=this;this.initValidParams(),w.merge(this._updateStream,this.observable).pipe(f.takeUntil(this.stopObservable)).subscribe(function(t){n._computationCache.clear();var i=t.entity;n.store&&(i=n.updateStore(t)),n.context[n.entityName]=i,n.layerService.getDescriptions().forEach(function(e){switch(t.actionType){case gt.ADD_UPDATE:e.draw(n.context,t.id,i);break;case gt.DELETE:e.remove(t.id);break;default:console.error("[ac-layer] unknown AcNotification.actionType for notification: "+t)}})})},Ii.prototype.updateStore=function(e){if(e.actionType===gt.DELETE)return this.entitiesStore["delete"](e.id),undefined;if(this.entitiesStore.has(e.id)){var t=this.entitiesStore.get(e.id);return Object.assign(t,e.entity),t}return this.entitiesStore.set(e.id,e.entity),e.entity},Ii.prototype.initValidParams=function(){if(!this.context)throw new Error("ac-layer: must initialize [context] ");if(!this.acForRgx.test(this.acFor))throw new Error('ac-layer: Invalid [acFor] syntax. Expected: [acFor]="let item of observable" .Instead received: '+this.acFor);var e=this.acFor.split(" ");if(this.observable=this.context[e[3]],this.entityName=e[1],!this.isObservable(this.observable))throw new Error("ac-layer: must initailize [acFor] with rx observable, instead received: "+this.observable);this.layerService.context=this.context,this.layerService.setEntityName(this.entityName)},Ii.prototype.isObservable=function(e){return e&&"function"==typeof e.subscribe},Ii.prototype.ngAfterContentInit=function(){this.init()},Ii.prototype.ngOnInit=function(){var r=this;this.layerService.context=this.context,this.layerService.options=this.options,this.layerService.show=this.show,this.layerService.zIndex=this.zIndex,this._drawerList.forEach(function(e,t){var i,n=r.options?r.options[t]:undefined,o=e.init(n);o&&(i=r.layerDrawerDataSources).push.apply(i,H(o)),e.setShow(r.show)})},Ii.prototype.ngOnChanges=function(e){if(e.show&&!e.show.firstChange){var t=e.show.currentValue;this.layerService.show=t,this._drawerList.forEach(function(e){return e.setShow(t)})}if(e.zIndex&&!e.zIndex.firstChange){var i=e.zIndex.currentValue;this.layerService.zIndex=i,this.mapLayersService.updateAndRefresh(this.layerDrawerDataSources,i)}},Ii.prototype.ngOnDestroy=function(){this.mapLayersService.removeDataSources(this.layerDrawerDataSources),this.stopObservable.next(!0),this.removeAll()},Ii.prototype.getLayerService=function(){return this.layerService},Ii.prototype.getLayerDrawerDataSources=function(){return this.layerDrawerDataSources},Ii.prototype.getDrawerDataSourcesByName=function(t){return this.layerDrawerDataSources.filter(function(e){return e.name===t})},Ii.prototype.getStore=function(){return this.entitiesStore},Ii.prototype.removeAll=function(){this.layerService.getDescriptions().forEach(function(e){return e.removeAll()}),this.entitiesStore.clear()},Ii.prototype.remove=function(e){this._updateStream.next({id:e,actionType:gt.DELETE}),this.entitiesStore["delete"](e)},Ii.prototype.updateNotification=function(e){this._updateStream.next(e)},Ii.prototype.update=function(e,t){this._updateStream.next({entity:e,id:t,actionType:gt.ADD_UPDATE})},Ii.prototype.refreshAll=function(e){var t=this;w.from(e).subscribe(function(e){return t._updateStream.next(e)})},Ii.decorators=[{type:a.Component,args:[{selector:"ac-layer",template:"<ng-content></ng-content>",providers:[mt,vt,ge,Ie,_e,je,pe,De,Oe,zt,$t,qt,Qt,ii,ri,pi,ui,ke,yi,gi,bi,_i,be,_t,It,Ot,jt,kt,Bt],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],Ii.ctorParameters=function(){return[{type:mt},{type:vt},{type:at},{type:ge},{type:Ie},{type:_e},{type:je},{type:Oe},{type:pe},{type:De},{type:zt},{type:$t},{type:qt},{type:Qt},{type:ii},{type:ri},{type:pi},{type:ui},{type:_t},{type:It},{type:Ot},{type:jt},{type:kt},{type:Bt},{type:ke},{type:yi},{type:gi},{type:bi},{type:_i},{type:be}]},Ii.propDecorators={show:[{type:a.Input}],acFor:[{type:a.Input}],context:[{type:a.Input}],store:[{type:a.Input}],options:[{type:a.Input}],zIndex:[{type:a.Input}]},Ii);function Ii(e,t,i,n,o,r,s,a,p,c,l,u,d,h,y,m,f,g,v,P,b,C,E,_,S,M,I,A,L,D){this.layerService=e,this._computationCache=t,this.mapLayersService=i,this.show=!0,this.store=!1,this.zIndex=0,this.acForRgx=/^let\s+.+\s+of\s+.+$/,this.stopObservable=new w.Subject,this._updateStream=new w.Subject,this.entitiesStore=new Map,this.layerDrawerDataSources=[],this._drawerList=new Map([["billboard",n],["label",o],["ellipse",r],["polyline",s],["polygon",a],["arc",p],["point",c],["model",l],["box",u],["corridor",d],["cylinder",h],["ellipsoid",y],["polylineVolume",m],["rectangle",g],["wall",f],["polylinePrimitive",S],["labelPrimitive",M],["billboardPrimitive",I],["pointPrimitive",A],["html",L],["czml",D],["dynamicEllipse",v],["dynamicPolyline",P],["staticCircle",b],["staticPolyline",C],["staticPolygon",E],["staticEllipse",_]])}var Ai=(Li.prototype.ngOnInit=function(){this.selfPrimitiveIsDraw=!1;var e=this._drawer.init();e&&(this.dataSources=e),this.drawOnMap()},Li.prototype.ngOnChanges=function(e){var t=e.props;t.currentValue!==t.previousValue&&this.updateOnMap()},Li.prototype.drawOnMap=function(){return this.selfPrimitiveIsDraw=!0,this.selfPrimitive=this._drawer.add(this.props)},Li.prototype.removeFromMap=function(){return this.selfPrimitiveIsDraw=!1,this._drawer.remove(this.selfPrimitive)},Li.prototype.updateOnMap=function(){if(this.selfPrimitiveIsDraw)return this._drawer.update(this.selfPrimitive,this.props)},Li.prototype.ngOnDestroy=function(){this.mapLayers.removeDataSources(this.dataSources),this.removeFromMap()},Li.propDecorators={props:[{type:a.Input}]},Li);function Li(e,t){this._drawer=e,this.mapLayers=t}var Di,wi=(E(Ti,Di=Ai),Ti.decorators=[{type:a.Component,args:[{selector:"ac-billboard",template:""}]}],Ti.ctorParameters=function(){return[{type:ge},{type:at}]},Ti);function Ti(e,t){return Di.call(this,e,t)||this}var Oi=(Ri.prototype._propsEvaluator=function(e){return this._propsEvaluateFn(this._computationCache,e)},Ri.prototype._getPropsAssigner=function(){var i=this;return function(e,t){return i._propsAssignerFn(e,t)}},Ri.prototype.getLayerService=function(){return this._layerService},Ri.prototype.setLayerService=function(e){this._layerService.unregisterDescription(this),this._layerService=e,this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache,!0),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)},Ri.prototype.ngOnInit=function(){this.props||console.error("ac-desc components error: [props] input is mandatory"),this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)},Ri.prototype.getCesiumObjectsMap=function(){return this._cesiumObjectsMap},Ri.prototype.draw=function(e,t,i){var n=this._propsEvaluator(e);if(this._cesiumObjectsMap.has(t))o=this._cesiumObjectsMap.get(t),this.onDraw.emit({acEntity:i,cesiumEntity:o,entityId:t}),o.acEntity=i,this._drawer.setPropsAssigner(this._getPropsAssigner()),this._drawer.update(o,n);else{var o=this._drawer.add(n);this.onDraw.emit({acEntity:i,cesiumEntity:o,entityId:t}),o.acEntity=i,this._cesiumObjectsMap.set(t,o)}},Ri.prototype.remove=function(e){var t=this._cesiumObjectsMap.get(e);t&&(this.onRemove.emit({acEntity:t.acEntity,cesiumEntity:t,entityId:e}),this._drawer.remove(t),this._cesiumObjectsMap["delete"](e))},Ri.prototype.removeAll=function(){this._cesiumObjectsMap.clear(),this._drawer.removeAll()},Ri.prototype.ngOnDestroy=function(){this._layerService.unregisterDescription(this),this.removeAll()},Ri.propDecorators={props:[{type:a.Input}],onDraw:[{type:a.Output}],onRemove:[{type:a.Output}]},Ri);function Ri(e,t,i,n){this._drawer=e,this._layerService=t,this._computationCache=i,this._cesiumProperties=n,this.onDraw=new a.EventEmitter,this.onRemove=new a.EventEmitter,this._cesiumObjectsMap=new Map}var xi=(ji.prototype.map=function(e){return this._mapper.map(e)},ji.decorators=[{type:a.Injectable}],ji.ctorParameters=function(){return[]},ji);function ji(){this._mapper=new i.JsonStringMapper}var Ni=(Fi.create=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=!0);var i="";e.forEach(function(e){i+=t?"if(!(obj1['"+e+"'] instanceof Cesium.CallbackProperty))obj1['"+e+"'] = obj2['"+e+"']; ":"if (!(obj1['"+e+"'] instanceof Cesium.CallbackProperty) && obj2['"+e+"'] !== undefined) { obj1['"+e+"'] = obj2['"+e+"']; } "}),i+="return obj1";var n=new Function("obj1","obj2",i);return function(e,t){return n(e,t)}},Fi);function Fi(){}var ki=(Vi.prototype._compile=function(e,i){var n=this;void 0===i&&(i=!0);var o={},r=new Map;this._jsonMapper.map(e).forEach(function(e,t){return r.set(t,{expression:e,get:n._parser.eval(e)})}),r.forEach(function(e,t){o[t||"undefined"]=i?"cache.get(`"+e.expression+"`, () => propsMap.get('"+t+"').get(context))":"propsMap.get('"+t+"').get(context)"});var t="return "+JSON.stringify(o).replace(/"/g,"")+";",s=new Function("propsMap","cache","context",t);return function(e,t){return s(r,e,t)}},Vi.prototype._build=function(e){var t=Array.from(this._jsonMapper.map(e).keys()),i=Ni.create(t);return function(e,t){return i(e,t)}},Vi.prototype.createEvaluator=function(e,t,i){if(void 0===t&&(t=!0),void 0===i&&(i=!1),!i&&this._evaluatorsCache.has(e))return this._evaluatorsCache.get(e);var n=this._compile(e,t);return this._evaluatorsCache.set(e,n),n},Vi.prototype.createAssigner=function(e){if(this._assignersCache.has(e))return this._assignersCache.get(e);var t=this._build(e);return this._assignersCache.set(e,t),t},Vi.decorators=[{type:a.Injectable}],Vi.ctorParameters=function(){return[{type:n.Parse},{type:xi}]},Vi);function Vi(e,t){this._parser=e,this._jsonMapper=t,this._assignersCache=new Map,this._evaluatorsCache=new Map}var Hi,Bi=(E(Gi,Hi=Oi),Gi.decorators=[{type:a.Component,args:[{selector:"ac-billboard-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Gi})}]}]}],Gi.ctorParameters=function(){return[{type:ge},{type:mt},{type:vt},{type:ki}]},Gi);function Gi(e,t,i,n){return Hi.call(this,e,t,i,n)||this}var Ui,zi=(E(Ki,Ui=Oi),Ki.decorators=[{type:a.Component,args:[{selector:"ac-ellipse-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Ki})}]}]}],Ki.ctorParameters=function(){return[{type:_e},{type:mt},{type:vt},{type:ki}]},Ki);function Ki(e,t,i,n){return Ui.call(this,e,t,i,n)||this}var Wi,$i=(E(Zi,Wi=Oi),Zi.decorators=[{type:a.Component,args:[{selector:"ac-polyline-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Zi})}]}]}],Zi.ctorParameters=function(){return[{type:je},{type:mt},{type:vt},{type:ki}]},Zi);function Zi(e,t,i,n){return Wi.call(this,e,t,i,n)||this}var Yi=(qi.prototype.transform=function(e,t){return new Cesium.Cartesian2(e[0],e[1])},qi.decorators=[{type:a.Pipe,args:[{name:"pixelOffset"}]}],qi);function qi(){}var Xi=(Ji.prototype.transform=function(e,t){return(360-Math.round(180*e/Math.PI))%360},Ji.decorators=[{type:a.Pipe,args:[{name:"radiansToDegrees"}]}],Ji);function Ji(){}var Qi,en=(E(tn,Qi=Oi),tn.decorators=[{type:a.Component,args:[{selector:"ac-label-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return tn})}]}]}],tn.ctorParameters=function(){return[{type:Ie},{type:mt},{type:vt},{type:ki}]},tn);function tn(e,t,i,n){return Qi.call(this,e,t,i,n)||this}var nn=(on.decorators=[{type:a.NgModule,args:[{imports:[s.CommonModule],providers:[]}]}],on);function on(){}var rn,sn=(E(an,rn=Oi),an.prototype._propsEvaluator=function(e){var t=rn.prototype._propsEvaluator.call(this,e);return t.semiMajorAxis=t.radius,t.semiMinorAxis=t.radius,delete t.radius,t},an.prototype._getPropsAssigner=function(){return function(e,t){return Object.assign(e,t)}},an.decorators=[{type:a.Component,args:[{selector:"ac-circle-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return an})}]}]}],an.ctorParameters=function(){return[{type:_e},{type:mt},{type:vt},{type:ki}]},an);function an(e,t,i,n){return rn.call(this,e,t,i,n)||this}var pn,cn=(E(ln,pn=Oi),ln.decorators=[{type:a.Component,args:[{selector:"ac-arc-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return ln})}]}]}],ln.ctorParameters=function(){return[{type:pe},{type:mt},{type:vt},{type:ki}]},ln);function ln(e,t,i,n){return pn.call(this,e,t,i,n)||this}var un=(dn.create=function(e){return e?Object.assign(new dn,e):new dn},dn);function dn(e){Object.assign(this,e)}function hn(){}var yn={ArcGisMapServer:Cesium.ArcGisMapServerImageryProvider,WebMapTileService:Cesium.WebMapTileServiceImageryProvider,MapTileService:Cesium.createTileMapServiceImageryProvider,WebMapService:Cesium.WebMapServiceImageryProvider,SingleTileImagery:Cesium.SingleTileImageryProvider,OpenStreetMap:Cesium.createOpenStreetMapImageryProvider,BingMaps:Cesium.BingMapsImageryProvider,GoogleEarthEnterpriseMaps:Cesium.GoogleEarthEnterpriseMapsProvider,MapBox:Cesium.MapboxImageryProvider,UrlTemplateImagery:Cesium.UrlTemplateImageryProvider,OFFLINE:null},mn=(fn.prototype.createOfflineMapProvider=function(){return Cesium.createTileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")})},fn.prototype.ngOnInit=function(){if(!bt.present(this.options.url)&&this.provider!==yn.OFFLINE)throw new Error("options must have a url");switch(this.provider){case yn.WebMapService:case yn.WebMapTileService:case yn.ArcGisMapServer:case yn.SingleTileImagery:case yn.BingMaps:case yn.GoogleEarthEnterpriseMaps:case yn.MapBox:case yn.UrlTemplateImagery:this.layerProvider=new this.provider(this.options);break;case yn.MapTileService:case yn.OpenStreetMap:this.layerProvider=this.provider(this.options);break;case yn.OFFLINE:this.layerProvider=this.createOfflineMapProvider();break;default:console.log("ac-map-layer-provider: [provider] wasn't found. setting OFFLINE provider as default"),this.layerProvider=this.createOfflineMapProvider()}this.show&&(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness)},fn.prototype.ngOnChanges=function(e){e.show&&!e.show.isFirstChange()&&(e.show.currentValue?this.imageryLayer?this.imageryLayersCollection.add(this.imageryLayer,this.index):(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness):this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!1)),e.alpha&&!e.alpha.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.alpha=this.alpha),e.contrast&&!e.contrast.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.contrast=this.contrast),e.brightness&&!e.brightness.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.brightness=this.brightness)},fn.prototype.ngOnDestroy=function(){this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!0)},fn.decorators=[{type:a.Component,args:[{selector:"ac-map-layer-provider",template:""}]}],fn.ctorParameters=function(){return[{type:K}]},fn.propDecorators={options:[{type:a.Input}],provider:[{type:a.Input}],index:[{type:a.Input}],show:[{type:a.Input}],alpha:[{type:a.Input}],brightness:[{type:a.Input}],contrast:[{type:a.Input}]},fn);function fn(e){this.cesiumService=e,this.options={},this.provider=yn.OFFLINE,this.show=!0,this.alpha=1,this.brightness=1,this.contrast=1,this.imageryLayersCollection=this.cesiumService.getScene().imageryLayers}var gn,vn=(E(Pn,gn=Oi),Pn.decorators=[{type:a.Component,args:[{selector:"ac-point-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Pn})}]}]}],Pn.ctorParameters=function(){return[{type:De},{type:mt},{type:vt},{type:ki}]},Pn);function Pn(e,t,i,n){return gn.call(this,e,t,i,n)||this}var bn,Cn=(E(En,bn=Ai),En.decorators=[{type:a.Component,args:[{selector:"ac-label",template:""}]}],En.ctorParameters=function(){return[{type:Ie},{type:at}]},En);function En(e,t){return bn.call(this,e,t)||this}var _n,Sn=(E(Mn,_n=Ai),Mn.decorators=[{type:a.Component,args:[{selector:"ac-polyline",template:""}]}],Mn.ctorParameters=function(){return[{type:je},{type:at}]},Mn);function Mn(e,t){return _n.call(this,e,t)||this}var In,An=(E(Ln,In=Ai),Ln.decorators=[{type:a.Component,args:[{selector:"ac-ellipse",template:""}]}],Ln.ctorParameters=function(){return[{type:_e},{type:at}]},Ln);function Ln(e,t){return In.call(this,e,t)||this}var Dn,wn=(E(Tn,Dn=Ai),Tn.decorators=[{type:a.Component,args:[{selector:"ac-point",template:""}]}],Tn.ctorParameters=function(){return[{type:De},{type:at}]},Tn);function Tn(e,t){return Dn.call(this,e,t)||this}var On=(Rn.prototype.setScreenPosition=function(e){e&&(this.renderer.setStyle(this.elementRef.nativeElement,"top",e.y+"px"),this.renderer.setStyle(this.elementRef.nativeElement,"left",e.x+"px"))},Rn.prototype.ngOnInit=function(){this.cesiumService.getMap().getMapContainer().appendChild(this.elementRef.nativeElement),!1===this.props.show&&this.hideElement()},Rn.prototype.remove=function(){this.isDraw&&(this.isDraw=!1,this.cesiumService.getScene().preRender.removeEventListener(this.preRenderEventListener),this.hideElement())},Rn.prototype.hideElement=function(){this.renderer.setStyle(this.elementRef.nativeElement,"display","none")},Rn.prototype.add=function(){var t=this;this.isDraw||(this.isDraw=!0,this.preRenderEventListener=function(){var e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t.cesiumService.getScene(),t.props.position);t.setScreenPosition(e)},this.renderer.setStyle(this.elementRef.nativeElement,"display","block"),this.cesiumService.getScene().preRender.addEventListener(this.preRenderEventListener))},Rn.prototype.ngDoCheck=function(){this.props.show===undefined||this.props.show?this.add():this.remove()},Rn.prototype.ngOnDestroy=function(){this.remove()},Rn.decorators=[{type:a.Component,args:[{selector:"ac-html",template:"<ng-content></ng-content>",styles:[":host {\n                position: absolute;\n                z-index: 100;\n\t\t\t\t}"]}]}],Rn.ctorParameters=function(){return[{type:K},{type:a.ElementRef},{type:a.Renderer2}]},Rn.propDecorators={props:[{type:a.Input}]},Rn);function Rn(e,t,i){this.cesiumService=e,this.elementRef=t,this.renderer=i,this.isDraw=!1}var xn,jn=(E(Nn,xn=Ai),Nn.prototype.updateEllipseProps=function(){this.props.semiMajorAxis=this.props.radius,this.props.semiMinorAxis=this.props.radius,this.props.rotation=0},Nn.prototype.drawOnMap=function(){this.updateEllipseProps(),xn.prototype.drawOnMap.call(this)},Nn.prototype.updateOnMap=function(){this.updateEllipseProps(),xn.prototype.updateOnMap.call(this)},Nn.decorators=[{type:a.Component,args:[{selector:"ac-circle",template:""}]}],Nn.ctorParameters=function(){return[{type:_e},{type:at}]},Nn);function Nn(e,t){return xn.call(this,e,t)||this}var Fn,kn=(E(Vn,Fn=Ai),Vn.prototype.updateOnMap=function(){this.selfPrimitiveIsDraw&&(this.removeFromMap(),this.drawOnMap())},Vn.prototype.drawOnMap=function(){return this.selfPrimitiveIsDraw=!0,this.selfPrimitive=this._drawer.add(this.geometryProps,this.instanceProps,this.primitiveProps)},Vn.prototype.ngOnChanges=function(e){var t=e.geometryProps,i=e.instanceProps,n=e.primitiveProps;t.currentValue===t.previousValue&&i.currentValue===i.previousValue&&n.currentValue===n.previousValue||this.updateOnMap()},Vn.decorators=[{type:a.Component,args:[{selector:"ac-arc",template:""}]}],Vn.ctorParameters=function(){return[{type:pe},{type:at}]},Vn.propDecorators={geometryProps:[{type:a.Input}],instanceProps:[{type:a.Input}],primitiveProps:[{type:a.Input}]},Vn);function Vn(e,t){return Fn.call(this,e,t)||this}var Hn,Bn=(E(Gn,Hn=Oi),Gn.decorators=[{type:a.Component,args:[{selector:"ac-polygon-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Gn})}]}]}],Gn.ctorParameters=function(){return[{type:Oe},{type:mt},{type:vt},{type:ki}]},Gn);function Gn(e,t,i,n){return Hn.call(this,e,t,i,n)||this}var Un=(zn.prototype.ngOnInit=function(){var e=this;this.plonterService.plonterChangeNotifier.subscribe(function(){return e.cd.detectChanges()})},Object.defineProperty(zn.prototype,"plonterPosition",{get:function(){if(this.plonterService.plonterShown){var e=this.plonterService.plonterClickPosition.endPosition;return this.geoConverter.screenToCartesian3(e)}},enumerable:!0,configurable:!0}),zn.prototype.chooseEntity=function(e){this.plonterService.resolvePlonter(e)},zn.decorators=[{type:a.Component,args:[{selector:"ac-default-plonter",template:'\n      <ac-html *ngIf="plonterService.plonterShown" [props]="{\n        position: plonterPosition\n      }">\n        <div class="plonter-context-menu">\n          <div *ngFor="let entity of plonterService.entitesToPlonter">\n            <div class="plonter-item" (click)="chooseEntity(entity)">{{ entity?.name || entity?.id }}\n            </div>\n          </div>\n        </div>\n      </ac-html>\n    ',changeDetection:a.ChangeDetectionStrategy.OnPush,providers:[J],styles:["\n        .plonter-context-menu {\n            background-color: rgba(250, 250, 250, 0.8);\n            box-shadow: 1px 1px 5px 0px rgba(0, 0, 0, 0.15);\n        }\n\n        .plonter-item {\n            cursor: pointer;\n            padding: 2px 15px;\n            text-align: start;\n        }\n\n        .plonter-item:hover {\n            background-color: rgba(0, 0, 0, 0.15);\n        }\n\n    "]}]}],zn.ctorParameters=function(){return[{type:Qe},{type:a.ChangeDetectorRef},{type:J}]},zn);function zn(e,t,i){this.plonterService=e,this.cd=t,this.geoConverter=i}var Kn,Wn=(E($n,Kn=Ai),$n.decorators=[{type:a.Component,args:[{selector:"ac-polygon",template:""}]}],$n.ctorParameters=function(){return[{type:Oe},{type:at}]},$n);function $n(e,t){return Kn.call(this,e,t)||this}var Zn,Yn=(E(qn,Zn=Oi),qn.prototype.ngOnInit=function(){this._layerService.registerDescription(this),this._geometryPropsEvaluator=this._cesiumProperties.createEvaluator(this.geometryProps),this._instancePropsEvaluator=this._cesiumProperties.createEvaluator(this.instanceProps),this._primitivePropsEvaluator=this._cesiumProperties.createEvaluator(this.primitiveProps)},qn.prototype.draw=function(e,t,i){var n,o=this._geometryPropsEvaluator(this._computationCache,e),r=this._instancePropsEvaluator(this._computationCache,e),s=this._primitivePropsEvaluator(this._computationCache,e);this._cesiumObjectsMap.has(t)?(n=this._cesiumObjectsMap.get(t),this._staticPrimitiveDrawer.update(n,o,r,s)):((n=this._staticPrimitiveDrawer.add(o,r,s)).acEntity=i,this._cesiumObjectsMap.set(t,n))},qn.propDecorators={geometryProps:[{type:a.Input}],instanceProps:[{type:a.Input}],primitiveProps:[{type:a.Input}]},qn);function qn(e,t,i,n){var o=Zn.call(this,e,t,i,n)||this;return o._staticPrimitiveDrawer=e,o}var Xn,Jn=(E(Qn,Xn=Yn),Qn.decorators=[{type:a.Component,args:[{selector:"ac-static-ellipse-desc",template:""}]}],Qn.ctorParameters=function(){return[{type:Bt},{type:mt},{type:vt},{type:ki}]},Qn);function Qn(e,t,i,n){return Xn.call(this,e,t,i,n)||this}var eo,to=(E(io,eo=Oi),io.decorators=[{type:a.Component,args:[{selector:"ac-dynamic-ellipse-desc",template:""}]}],io.ctorParameters=function(){return[{type:_t},{type:mt},{type:vt},{type:ki}]},io);function io(e,t,i,n){return eo.call(this,e,t,i,n)||this}var no,oo=(E(ro,no=Oi),ro.decorators=[{type:a.Component,args:[{selector:"ac-dynamic-polyline-desc",template:""}]}],ro.ctorParameters=function(){return[{type:It},{type:mt},{type:vt},{type:ki}]},ro);function ro(e,t,i,n){return no.call(this,e,t,i,n)||this}var so,ao=(E(po,so=Yn),po.decorators=[{type:a.Component,args:[{selector:"ac-static-polygon-desc",template:""}]}],po.ctorParameters=function(){return[{type:kt},{type:mt},{type:vt},{type:ki}]},po);function po(e,t,i,n){return so.call(this,e,t,i,n)||this}var co,lo=(E(uo,co=Yn),uo.decorators=[{type:a.Component,args:[{selector:"ac-static-circle",template:""}]}],uo.ctorParameters=function(){return[{type:Ot},{type:mt},{type:vt},{type:ki}]},uo);function uo(e,t,i,n){return co.call(this,e,t,i,n)||this}var ho,yo=(E(mo,ho=Oi),mo.prototype._propsEvaluator=function(e){var t=ho.prototype._propsEvaluator.call(this,e);return t.semiMajorAxis=t.radius,t.semiMinorAxis=t.radius,t},mo.decorators=[{type:a.Component,args:[{selector:"ac-dynamic-circle-desc",template:""}]}],mo.ctorParameters=function(){return[{type:_t},{type:mt},{type:vt},{type:ki}]},mo);function mo(e,t,i,n){return ho.call(this,e,t,i,n)||this}var fo,go=(E(vo,fo=Yn),vo.decorators=[{type:a.Component,args:[{selector:"ac-static-polyline-desc",template:""}]}],vo.ctorParameters=function(){return[{type:jt},{type:mt},{type:vt},{type:ki}]},vo);function vo(e,t,i,n){return fo.call(this,e,t,i,n)||this}var Po,bo=(E(Co,Po=Oi),Co.decorators=[{type:a.Component,args:[{selector:"ac-model-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Co})}]}]}],Co.ctorParameters=function(){return[{type:zt},{type:mt},{type:vt},{type:ki}]},Co);function Co(e,t,i,n){return Po.call(this,e,t,i,n)||this}var Eo=(_o.prototype.ngOnInit=function(){if(!bt.present(this.options.url))throw new Error("Options must have a url");this._3dtilesCollection=new Cesium.PrimitiveCollection,this.cesiumService.getScene().primitives.add(this._3dtilesCollection),this.show&&(this.tilesetInstance=this._3dtilesCollection.add(new Cesium.Cesium3DTileset(this.options),this.index),this.style&&(this.tilesetInstance.style=new Cesium.Cesium3DTileStyle(this.style)))},_o.prototype.ngOnChanges=function(e){e.show&&!e.show.isFirstChange()&&(e.show.currentValue?this.tilesetInstance?this._3dtilesCollection.add(this.tilesetInstance,this.index):(this.tilesetInstance=this._3dtilesCollection.add(new Cesium.Cesium3DTileset(this.options),this.index),this.style&&(this.tilesetInstance.style=new Cesium.Cesium3DTileStyle(this.style))):this.tilesetInstance&&this._3dtilesCollection.remove(this.tilesetInstance,!1)),e.style&&!e.style.isFirstChange()&&(e.style.currentValue,this.tilesetInstance&&(this.tilesetInstance.style=new Cesium.Cesium3DTileStyle(this.style)))},_o.prototype.ngOnDestroy=function(){this.tilesetInstance&&this._3dtilesCollection.remove(this.tilesetInstance,!1)},_o.decorators=[{type:a.Component,args:[{selector:"ac-3d-tile-layer",template:""}]}],_o.ctorParameters=function(){return[{type:K}]},_o.propDecorators={options:[{type:a.Input}],index:[{type:a.Input}],show:[{type:a.Input}],style:[{type:a.Input}]},_o);function _o(e){this.cesiumService=e,this.options={},this.show=!0,this.tilesetInstance=null}var So,Mo=(E(Io,So=Oi),Io.decorators=[{type:a.Component,args:[{selector:"ac-box-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Io})}]}]}],Io.ctorParameters=function(){return[{type:$t},{type:mt},{type:vt},{type:ki}]},Io);function Io(e,t,i,n){return So.call(this,e,t,i,n)||this}var Ao,Lo=(E(Do,Ao=Oi),Do.decorators=[{type:a.Component,args:[{selector:"ac-cylinder-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Do})}]}]}],Do.ctorParameters=function(){return[{type:Qt},{type:mt},{type:vt},{type:ki}]},Do);function Do(e,t,i,n){return Ao.call(this,e,t,i,n)||this}var wo,To=(E(Oo,wo=Oi),Oo.decorators=[{type:a.Component,args:[{selector:"ac-corridor-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Oo})}]}]}],Oo.ctorParameters=function(){return[{type:qt},{type:mt},{type:vt},{type:ki}]},Oo);function Oo(e,t,i,n){return wo.call(this,e,t,i,n)||this}var Ro,xo=(E(jo,Ro=Oi),jo.decorators=[{type:a.Component,args:[{selector:"ac-ellipsoid-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return jo})}]}]}],jo.ctorParameters=function(){return[{type:ii},{type:mt},{type:vt},{type:ki}]},jo);function jo(e,t,i,n){return Ro.call(this,e,t,i,n)||this}var No,Fo=(E(ko,No=Oi),ko.decorators=[{type:a.Component,args:[{selector:"ac-polyline-volume-desc",template:""}]}],ko.ctorParameters=function(){return[{type:ri},{type:mt},{type:vt},{type:ki}]},ko);function ko(e,t,i,n){return No.call(this,e,t,i,n)||this}var Vo,Ho=(E(Bo,Vo=Oi),Bo.decorators=[{type:a.Component,args:[{selector:"ac-wall-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Bo})}]}]}],Bo.ctorParameters=function(){return[{type:pi},{type:mt},{type:vt},{type:ki}]},Bo);function Bo(e,t,i,n){return Vo.call(this,e,t,i,n)||this}var Go,Uo=(E(zo,Go=Oi),zo.decorators=[{type:a.Component,args:[{selector:"ac-rectangle-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return zo})}]}]}],zo.ctorParameters=function(){return[{type:ui},{type:mt},{type:vt},{type:ki}]},zo);function zo(e,t,i,n){return Go.call(this,e,t,i,n)||this}var Ko,Wo=(E($o,Ko=Oi),$o.decorators=[{type:a.Component,args:[{selector:"ac-billboard-primitive-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return $o})}]}]}],$o.ctorParameters=function(){return[{type:gi},{type:mt},{type:vt},{type:ki}]},$o);function $o(e,t,i,n){return Ko.call(this,e,t,i,n)||this}var Zo,Yo=(E(qo,Zo=Oi),qo.decorators=[{type:a.Component,args:[{selector:"ac-label-primitive-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return qo})}]}]}],qo.ctorParameters=function(){return[{type:yi},{type:mt},{type:vt},{type:ki}]},qo);function qo(e,t,i,n){return Zo.call(this,e,t,i,n)||this}var Xo,Jo=(E(Qo,Xo=Oi),Qo.decorators=[{type:a.Component,args:[{selector:"ac-polyline-primitive-desc",template:"",providers:[{provide:Oi,useExisting:a.forwardRef(function(){return Qo})}]}]}],Qo.ctorParameters=function(){return[{type:ke},{type:mt},{type:vt},{type:ki}]},Qo);function Qo(e,t,i,n){return Xo.call(this,e,t,i,n)||this}var er=(Object.defineProperty(tr.prototype,"scene",{set:function(e){this._scene=e},enumerable:!0,configurable:!0}),Object.defineProperty(tr.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e,Cesium.defined(this.element)&&(this._element.style.display=e?"block":"none")},enumerable:!0,configurable:!0}),Object.defineProperty(tr.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),Object.defineProperty(tr.prototype,"pixelOffset",{get:function(){return this._pixelOffset},set:function(e){this._pixelOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(tr.prototype,"element",{get:function(){return this._element},set:function(e){this._element=e,Cesium.defined(e)&&(this._mapContainer.appendChild(e),this._element.style.position="absolute",this._element.style.zIndex=Number.MAX_VALUE.toString())},enumerable:!0,configurable:!0}),Object.defineProperty(tr.prototype,"collection",{get:function(){return this._collection},set:function(e){this._collection=e},enumerable:!0,configurable:!0}),tr.prototype.update=function(){if(Cesium.defined(this._show)&&Cesium.defined(this._element)){var e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this._scene,this._position);Cesium.defined(e)?Cesium.defined(this._pixelOffset)&&Cesium.defined(this._pixelOffset.x)&&Cesium.defined(this._pixelOffset.y)&&(e.y+=this._pixelOffset.y,e.x+=this._pixelOffset.x):e=new Cesium.Cartesian2(-1e3,-1e3),this._lastPosition&&this._lastPosition.equals(e)||(this._element.style.top=e.y+"px",this._element.style.left=e.x+"px",this._lastPosition=e)}},tr);function tr(e,t){if(void 0===t&&(t=null),"object"!=typeof e)throw new Error("HtmlPrimitive ERROR: invalid html options!");this.scene=e.scene,this._mapContainer=e.mapContainer,this.show=e.show||!0,this.position=e.position,this.pixelOffset=e.pixelOffset,this.element=e.element,this.collection=t}var ir=(Object.defineProperty(nr.prototype,"length",{get:function(){return this._collection.length},enumerable:!0,configurable:!0}),nr.prototype.get=function(e){return this._collection[e]},nr.prototype.add=function(e){var t=new er(e,this);return this._collection.push(t),t},nr.prototype.remove=function(e){var t=this._collection.indexOf(e);return-1!==t&&(this._collection.splice(t,1),!0)},nr.prototype.update=function(){for(var e=0,t=this._collection.length;e<t;e++)this._collection[e].update()},nr.prototype.removeAll=function(){for(;0<this._collection.length;)this._collection.pop()},nr.prototype.contains=function(e){return Cesium.defined(e)&&e.collection===this},nr);function nr(){this._collection=[]}var or=(rr.extend=function(){Cesium.HtmlPrimitive=er,Cesium.HtmlCollection=ir},rr);function rr(){}var sr=(ar.prototype.has=function(e){return this._entities.has(e)},ar.prototype.get=function(e){return this._entities.get(e)},ar.prototype.addOrUpdate=function(e,t){this._entities.set(e,t)},ar.prototype.remove=function(e){this._entities["delete"](e)},ar.prototype.forEach=function(e){this._entities.forEach(e)},ar.decorators=[{type:a.Injectable}],ar.ctorParameters=function(){return[]},ar);function ar(){this._entities=new Map}var pr=function wa(e,t){this.id=e,this.context=t},cr=(lr.prototype.ngOnInit=function(){},lr.prototype._handleView=function(e,t,i){if(!this._views.has(e)&&t.show){var n=new pr(e,{$implicit:i}),o=this._viewContainerRef.createEmbeddedView(this._templateRef,n);this._views.set(e,{viewRef:o,context:n}),this._changeDetector.detectChanges()}else this._views.has(e)&&!t.show?this.remove(e,t):this._views.has(e)&&t.show&&this._changeDetector.detectChanges()},lr.prototype.addOrUpdate=function(e,t){var i=this._layerService.context[this._layerService.getEntityName()];this._views.has(e)&&(this._views.get(e).context.context.$implicit=i),this._acHtmlManager.addOrUpdate(e,{entity:i,primitive:t}),this._handleView(e,t,i)},lr.prototype.remove=function(e,t){if(this._views.has(e)){var i=this._views.get(e).viewRef;this._viewContainerRef.remove(this._viewContainerRef.indexOf(i)),this._views["delete"](e),this._acHtmlManager.remove(e),t.element=null}},lr.decorators=[{type:a.Directive,args:[{selector:"[acHtml]"}]}],lr.ctorParameters=function(){return[{type:a.TemplateRef},{type:a.ViewContainerRef},{type:a.ChangeDetectorRef},{type:mt},{type:sr}]},lr);function lr(e,t,i,n,o){this._templateRef=e,this._viewContainerRef=t,this._changeDetector=i,this._layerService=n,this._acHtmlManager=o,this._views=new Map}var ur,dr=(E(hr,ur=Oi),hr.prototype.ngOnInit=function(){if(ur.prototype.ngOnInit.call(this),!this.acHtmlCreator)throw new Error("AcHtml desc ERROR: ac html directive not found.");if(!this.acHtmlTemplate)throw new Error("AcHtml desc ERROR: html template not found.")},hr.prototype.draw=function(e,t){var i=this._propsEvaluator(e);if(this._cesiumObjectsMap.has(t))n=this._cesiumObjectsMap.get(t),this._drawer.update(n,i),this.acHtmlCreator.addOrUpdate(t,n);else{var n=this._drawer.add(i);this._cesiumObjectsMap.set(t,n),this.acHtmlCreator.addOrUpdate(t,n)}},hr.prototype.remove=function(e){var t=this._cesiumObjectsMap.get(e);this._drawer.remove(t),this._cesiumObjectsMap["delete"](e),this.acHtmlCreator.remove(e,t)},hr.prototype.removeAll=function(){var i=this;this._cesiumObjectsMap.forEach(function(e,t){i.acHtmlCreator.remove(t,e)}),this._cesiumObjectsMap.clear(),this._drawer.removeAll()},hr.decorators=[{type:a.Component,args:[{selector:"ac-html-desc",providers:[sr],template:'\n      <div *acHtml="let acHtmlEntityId = id; let acHtmlContext = context">\n          <div [acHtmlContainer]="acHtmlEntityId">\n              <ng-template [ngTemplateOutlet]="acHtmlTemplate"\n                           [ngTemplateOutletContext]="acHtmlContext"></ng-template>\n          </div>\n      </div>'}]}],hr.ctorParameters=function(){return[{type:_i},{type:mt},{type:vt},{type:ki}]},hr.propDecorators={acHtmlCreator:[{type:a.ViewChild,args:[cr]}],acHtmlTemplate:[{type:a.ContentChild,args:[a.TemplateRef]}]},hr);function hr(e,t,i,n){return ur.call(this,e,t,i,n)||this}var yr=(Object.defineProperty(mr.prototype,"acHtmlContainer",{set:function(e){this._id=e},enumerable:!0,configurable:!0}),mr.prototype.ngOnInit=function(){if(this._id===undefined)throw new Error("AcHtml container ERROR: entity id not defined");this._acHtmlManager.get(this._id).primitive.element=this._element.nativeElement},mr.decorators=[{type:a.Directive,args:[{selector:"[acHtmlContainer]"}]}],mr.ctorParameters=function(){return[{type:a.ElementRef},{type:sr}]},mr.propDecorators={acHtmlContainer:[{type:a.Input}]},mr);function mr(e,t){this._element=e,this._acHtmlManager=t}var fr=(gr.prototype.ngOnInit=function(){var t=this;this.contextMenuChangeSubscription=this.contextMenuService.contextMenuChangeNotifier.subscribe(function(){return t.cd.detectChanges()}),this.contextMenuOpenSubscription=this.contextMenuService.onOpen.subscribe(function(){var e=t.componentFactoryResolver.resolveComponentFactory(t.contextMenuService.content);t.viewContainerRef.clear(),t.viewContainerRef.createComponent(e).instance.data=t.contextMenuService.options.data,t.cd.detectChanges()})},gr.prototype.ngOnDestroy=function(){this.contextMenuChangeSubscription&&this.contextMenuChangeSubscription.unsubscribe(),this.contextMenuOpenSubscription&&this.contextMenuOpenSubscription.unsubscribe()},gr.decorators=[{type:a.Component,args:[{selector:"ac-context-menu-wrapper",template:'\n    <ac-html *ngIf="contextMenuService.showContextMenu" [props]="{position: contextMenuService.position}">\n      <div #contextMenuContainer></div>\n    </ac-html>\n  ',changeDetection:a.ChangeDetectionStrategy.OnPush}]}],gr.ctorParameters=function(){return[{type:Y},{type:a.ChangeDetectorRef},{type:a.ComponentFactoryResolver}]},gr.propDecorators={viewContainerRef:[{type:a.ViewChild,args:["contextMenuContainer",{read:a.ViewContainerRef}]}]},gr);function gr(e,t,i){this.contextMenuService=e,this.cd=t,this.componentFactoryResolver=i}var vr=(Pr.prototype.ngOnChanges=function(e){if(e.acFor.firstChange){var t=e.acFor.currentValue;if(!this.acForRgx.test(t))throw new Error('ac-layer: Invalid [acFor] syntax. Expected: [acFor]="let item of observable" .Instead received: '+t);var i=e.acFor.currentValue.split(" ");this.arrayPath=i[3],this.entityName=i[1]}},Pr.prototype.ngOnInit=function(){var e=this;this.layer.getLayerService().cache=!1,this.layerServiceSubscription=this.layerService.layerUpdates().subscribe(function(){e.cd.detectChanges()})},Pr.prototype.ngAfterContentInit=function(){var t=this;this.layerService.context.arrayObservable$=this.arrayObservable$,this.layerService.registerDescription(this),this.basicDescs._results.forEach(function(e){e.setLayerService(t.layer.getLayerService())}),this.arrayDescs._results.splice(0,1),this.arrayDescs._results.forEach(function(e){t.layerService.unregisterDescription(e),t.layer.getLayerService().registerDescription(e),e.layerService=t.layer.getLayerService(),e.setLayerService(t.layer.getLayerService())})},Pr.prototype.ngOnDestroy=function(){this.layerServiceSubscription&&this.layerServiceSubscription.unsubscribe()},Pr.prototype.setLayerService=function(e){this.layerService=e},Pr.prototype.draw=function(e,n,o){var r=this,t=p(e,this.arrayPath);if(t){var i=this.entitiesMap.get(n),s=[];if(this.entitiesMap.set(n,s),t.forEach(function(e,t){r.layerService.context[r.entityName]=e;var i=r.generateCombinedId(n,e,t);s.push(i),r.layer.update(o,i)}),i){var a=this.idGetter?i.filter(function(e){return s.indexOf(e)<0}):i;a&&a.forEach(function(e){return r.layer.remove(e)})}}},Pr.prototype.remove=function(e){var t=this,i=this.entitiesMap.get(e);i&&i.forEach(function(e){return t.layer.remove(e)}),this.entitiesMap["delete"](e)},Pr.prototype.removeAll=function(){this.layer.removeAll(),this.entitiesMap.clear()},Pr.prototype.getAcForString=function(){return"let "+this.entityName+"___temp of arrayObservable$"},Pr.prototype.generateCombinedId=function(e,t,i){return e+(this.idGetter?this.idGetter(t,i):this.id++%Number.MAX_SAFE_INTEGER)},Pr.decorators=[{type:a.Component,args:[{selector:"ac-array-desc",template:'\n    <ac-layer #layer [acFor]="getAcForString()"\n              [context]="layerService.context"\n              [options]="layerService.options"\n              [show]="layerService.show && show"\n              [zIndex]="layerService.zIndex">\n      <ng-content #content></ng-content>\n    </ac-layer>\n  ',changeDetection:a.ChangeDetectionStrategy.OnPush}]}],Pr.ctorParameters=function(){return[{type:mt},{type:a.ChangeDetectorRef}]},Pr.propDecorators={acFor:[{type:a.Input}],idGetter:[{type:a.Input}],show:[{type:a.Input}],layer:[{type:a.ViewChild,args:["layer"]}],basicDescs:[{type:a.ContentChildren,args:[Oi,{descendants:!1}]}],arrayDescs:[{type:a.ContentChildren,args:[Pr,{descendants:!1}]}]},Pr);function Pr(e,t){this.layerService=e,this.cd=t,this.show=!0,this.entitiesMap=new Map,this.id=0,this.acForRgx=/^let\s+.+\s+of\s+.+$/,this.arrayObservable$=new w.Subject}var br,Cr=(E(Er,br=Oi),Er.decorators=[{type:a.Component,args:[{selector:"ac-point-primitive-desc",template:""}]}],Er.ctorParameters=function(){return[{type:bi},{type:mt},{type:vt},{type:ki}]},Er);function Er(e,t,i,n){return br.call(this,e,t,i,n)||this}var _r,Sr=(E(Mr,_r=Ai),Mr.decorators=[{type:a.Component,args:[{selector:"ac-primitive-polyline",template:""}]}],Mr.ctorParameters=function(){return[{type:ke},{type:at}]},Mr);function Mr(e,t){return _r.call(this,e,t)||this}var Ir,Ar=[{pipeName:"pixelOffset",pipeInstance:new Yi},{pipeName:"radiansToDegrees",pipeInstance:new Xi}],Lr=(E(Dr,Ir=Oi),Dr.decorators=[{type:a.Component,args:[{selector:"ac-czml-desc",template:""}]}],Dr.ctorParameters=function(){return[{type:be},{type:mt},{type:vt},{type:ki}]},Dr);function Dr(e,t,i,n){return Ir.call(this,e,t,i,n)||this}var wr=(Tr.forRoot=function(e){return{ngModule:Tr,providers:[{provide:y,useValue:e},{provide:n.PIPES_CONFIG,multi:!0,useValue:e&&e.customPipes||[]},{provide:n.PIPES_CONFIG,multi:!0,useValue:Ar}]}},Tr.decorators=[{type:a.NgModule,args:[{imports:[s.CommonModule,n.Angular2ParseModule,nn],declarations:[ht,Mi,wi,Bi,Wo,en,Yo,zi,$i,Jo,Yi,Xi,sn,cn,mn,vn,Cn,Sn,Sr,An,wn,wi,On,jn,kn,Bn,Wn,Un,bo,Eo,Mo,Lo,To,xo,Fo,Ho,Uo,fr,Cr,dr,cr,yr,vr,Lr,Jn,to,oo,go,yo,lo,ao],exports:[ht,wi,Bi,Wo,en,Yo,zi,$i,Jo,Mi,sn,cn,mn,vn,Cn,Sn,Sr,An,wn,wi,On,jn,kn,Bn,Wn,Un,bo,Eo,Mo,Lo,To,xo,Fo,Ho,Uo,fr,Cr,dr,vr,Lr,Jn,to,oo,go,yo,lo,ao],providers:[xi,ki,re,B,ct,m]}]}],Tr.ctorParameters=function(){return[]},Tr);function Tr(){or.extend()}var Or,Rr=(E(xr,Or=w.Observable),xr);function xr(){return null!==Or&&Or.apply(this,arguments)||this}var jr={ALT:Cesium.KeyboardEventModifier.ALT,CTRL:Cesium.KeyboardEventModifier.CTRL,SHIFT:Cesium.KeyboardEventModifier.SHIFT},Nr=(Fr.prototype.selectedEntities$=function(){return this.selectedEntitiesItems$.asObservable()},Fr.prototype.selectedEntities=function(){return this.selectedEntitiesItems$.getValue()},Fr.prototype.selectedEntity$=function(){return this.selectedEntitySubject$},Fr.prototype.toggleSelection=function(e,t){-1===this.selectedEntities().indexOf(e)?this.addToSelected(e,t):this.removeSelected(e,t)},Fr.prototype.addToSelected=function(e,t){t&&(e.selected=!0);var i=this.selectedEntities();this.selectedEntitySubject$.next(e),this.selectedEntitiesItems$.next(H(i,[e]))},Fr.prototype.removeSelected=function(e,t){t&&(e.selected=!1);var i=this.selectedEntities(),n=i.indexOf(e);-1!==n&&(i.splice(n,1),this.selectedEntitiesItems$.next(i),this.selectedEntitySubject$.next(e))},Fr.prototype.initSelection=function(e,i,t,n){var o=this;void 0===i&&(i=!0);var r=this.mapsManager.getMap(n);r&&(this.mapEventsManagerService=r.getMapEventsManager(),e||Object.assign(e,{event:$.LEFT_CLICK}),this.mapEventsManagerService.register({event:e.event,pick:Z.PICK_ONE,modifier:e.modifier,entityType:e.entityType,priority:t}).pipe(f.map(function(e){return e.entities}),f.filter(function(e){return e&&0<e.length})).subscribe(function(e){var t=e[0];o.toggleSelection(t,i)}))},Fr.decorators=[{type:a.Injectable}],Fr.ctorParameters=function(){return[{type:ct}]},Fr);function Fr(e){this.mapsManager=e,this.selectedEntitiesItems$=new w.BehaviorSubject([]),this.selectedEntitySubject$=new w.Subject}if(!u)throw new Error("must install heatmap.js. please do npm -i heatmap.js ");var kr=(Vr.calcCircleContainingRect=function(e,t){return Vr.calcEllipseContainingRect(e,t,t)},Vr.calcEllipseContainingRect=function(e,t,i){var n=[re.pointByLocationDistanceAndAzimuth(e,i,0,!0),re.pointByLocationDistanceAndAzimuth(e,t,Math.PI/2,!0),re.pointByLocationDistanceAndAzimuth(e,t,Math.PI,!0),re.pointByLocationDistanceAndAzimuth(e,t,1.5*Math.PI,!0)];return Cesium.Rectangle.fromCartesianArray(n)},Vr.calculateContainingRectFromPoints=function(e){return Cesium.Rectangle.fromCartesianArray(e)},Vr.prototype.setData=function(e,t,i){return!!(i&&0<i.length&&null!==e&&!1!==e&&null!==t&&!1!==t)&&(this.heatmap.setData({min:e,max:t,data:i}),!0)},Vr.prototype.setWGS84Data=function(e,t,i){if(i&&0<i.length&&null!==e&&!1!==e&&null!==t&&!1!==t){for(var n=[],o=0;o<i.length;o++){var r=i[o],s=this.wgs84PointToHeatmapPoint(r);!r.value&&0!==r.value||(s.value=r.value),n.push(s)}return this.setData(e,t,n)}return!1},Vr.prototype.mercatorPointToHeatmapPoint=function(e){var t={};return t.x=Math.round((e.x-this._xoffset)/this._factor+this._spacing),t.y=Math.round((e.y-this._yoffset)/this._factor+this._spacing),t.y=this.height-t.y,t},Vr.prototype.createContainer=function(e,t){var i="heatmap"+Vr.containerCanvasCounter++,n=document.createElement("div");return n.setAttribute("id",i),n.setAttribute("style","width: "+t+"px; height: "+e+"px; margin: 0px; display: none;"),document.body.appendChild(n),{container:n,id:i}},Vr.prototype.wgs84ToMercator=function(e){var t=this.WMP.project(Cesium.Cartographic.fromDegrees(e.x,e.y));return{x:t.x,y:t.y}},Vr.prototype.wgs84ToMercatorBB=function(e){var t=this.WMP.project(Cesium.Cartographic.fromRadians(e.west,e.south)),i=this.WMP.project(Cesium.Cartographic.fromRadians(e.east,e.north));return{north:i.y,east:i.x,south:t.y,west:t.x}},Vr.prototype.mercatorToWgs84BB=function(e){var t=this.WMP.unproject(new Cesium.Cartesian3(e.west,e.south)),i=this.WMP.unproject(new Cesium.Cartesian3(e.east,e.north));return{north:this.rad2deg(i.latitude),east:this.rad2deg(i.longitude),south:this.rad2deg(t.latitude),west:this.rad2deg(t.longitude)}},Vr.prototype.setWidthAndHeight=function(e){this.width=0<e.east&&e.west<0?e.east+Math.abs(e.west):Math.abs(e.east-e.west),this.height=0<e.north&&e.south<0?e.north+Math.abs(e.south):Math.abs(e.north-e.south),this._factor=1,this.width>this.height&&this.width>this.heatmapOptionsDefaults.maxCanvasSize?(this._factor=this.width/this.heatmapOptionsDefaults.maxCanvasSize,this.height/this._factor<this.heatmapOptionsDefaults.minCanvasSize&&(this._factor=this.height/this.heatmapOptionsDefaults.minCanvasSize)):this.height>this.width&&this.height>this.heatmapOptionsDefaults.maxCanvasSize?(this._factor=this.height/this.heatmapOptionsDefaults.maxCanvasSize,this.width/this._factor<this.heatmapOptionsDefaults.minCanvasSize&&(this._factor=this.width/this.heatmapOptionsDefaults.minCanvasSize)):this.width<this.height&&this.width<this.heatmapOptionsDefaults.minCanvasSize?(this._factor=this.width/this.heatmapOptionsDefaults.minCanvasSize,this.height/this._factor>this.heatmapOptionsDefaults.maxCanvasSize&&(this._factor=this.height/this.heatmapOptionsDefaults.maxCanvasSize)):this.height<this.width&&this.height<this.heatmapOptionsDefaults.minCanvasSize&&(this._factor=this.height/this.heatmapOptionsDefaults.minCanvasSize,this.width/this._factor>this.heatmapOptionsDefaults.maxCanvasSize&&(this._factor=this.width/this.heatmapOptionsDefaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},Vr.prototype.create=function(e,t,i){var n=e,o=t.heatPointsData,r=(t.min,t.max,Object.assign({},this.heatmapOptionsDefaults,i));this._mbounds=this.wgs84ToMercatorBB(n),this.setWidthAndHeight(this._mbounds),r.radius=Math.round(i.radius?i.radius:this.width>this.height?this.width/this.heatmapOptionsDefaults.radiusFactor:this.height/this.heatmapOptionsDefaults.radiusFactor),this._spacing=r.radius*this.heatmapOptionsDefaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._rectangle=Cesium.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north);var s=this.createContainer(this.height,this.width),a=s.container,p=s.id;Object.assign(r,{container:a}),this.heatmap=u.create(r),this.setWGS84Data(0,100,o);var c=this.heatmap._renderer.canvas,l=new Cesium.ImageMaterialProperty({image:c,transparent:!0});return this.setClear(l,p),l},Vr.prototype.setClear=function(e,t){e.clear=function(){var e=document.getElementById(t);return e.parentNode.removeChild(e)}},Vr.containerCanvasCounter=0,Vr.decorators=[{type:a.Injectable}],Vr);function Vr(){this.heatmapOptionsDefaults={minCanvasSize:700,maxCanvasSize:2e3,radiusFactor:60,spacingFactor:1,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{".3":"blue",".65":"yellow",".8":"orange",".95":"red"}},this.WMP=new Cesium.WebMercatorProjection,this.wgs84PointToHeatmapPoint=function(e){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(e))},this.rad2deg=function(e){return e/(Math.PI/180)}}var Hr={CREATE:0,EDIT:1,CREATE_OR_EDIT:2};Hr[Hr.CREATE]="CREATE",Hr[Hr.EDIT]="EDIT",Hr[Hr.CREATE_OR_EDIT]="CREATE_OR_EDIT";var Br={INIT:0,MOUSE_MOVE:1,ADD_POINT:2,ADD_LAST_POINT:3,CHANGE_TO_EDIT:4,REMOVE_POINT:5,DRAG_POINT:6,DRAG_POINT_FINISH:7,DRAG_SHAPE:8,DRAG_SHAPE_FINISH:9,DONE:10,DISABLE:11,ENABLE:12,DISPOSE:13,SET_EDIT_LABELS_RENDER_CALLBACK:14,UPDATE_EDIT_LABELS:15,SET_MANUALLY:16,TRANSFORM:17};Br[Br.INIT]="INIT",Br[Br.MOUSE_MOVE]="MOUSE_MOVE",Br[Br.ADD_POINT]="ADD_POINT",Br[Br.ADD_LAST_POINT]="ADD_LAST_POINT",Br[Br.CHANGE_TO_EDIT]="CHANGE_TO_EDIT",Br[Br.REMOVE_POINT]="REMOVE_POINT",Br[Br.DRAG_POINT]="DRAG_POINT",Br[Br.DRAG_POINT_FINISH]="DRAG_POINT_FINISH",Br[Br.DRAG_SHAPE]="DRAG_SHAPE",Br[Br.DRAG_SHAPE_FINISH]="DRAG_SHAPE_FINISH",Br[Br.DONE]="DONE",Br[Br.DISABLE]="DISABLE",Br[Br.ENABLE]="ENABLE",Br[Br.DISPOSE]="DISPOSE",Br[Br.SET_EDIT_LABELS_RENDER_CALLBACK]="SET_EDIT_LABELS_RENDER_CALLBACK",Br[Br.UPDATE_EDIT_LABELS]="UPDATE_EDIT_LABELS",Br[Br.SET_MANUALLY]="SET_MANUALLY",Br[Br.TRANSFORM]="TRANSFORM";var Gr,Ur=(E(zr,Gr=un),Object.defineProperty(zr.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e},enumerable:!0,configurable:!0}),Object.defineProperty(zr.prototype,"props",{get:function(){return this.pointProps},set:function(e){this.pointProps=e},enumerable:!0,configurable:!0}),zr.prototype.isVirtualEditPoint=function(){return this._virtualEditPoint},zr.prototype.setVirtualEditPoint=function(e){this._virtualEditPoint=e},zr.prototype.getEditedEntityId=function(){return this.editedEntityId},zr.prototype.getPosition=function(){return this.position},zr.prototype.setPosition=function(e){this.position.x=e.x,this.position.y=e.y,this.position.z=e.z},zr.prototype.getId=function(){return this.id},zr.prototype.generateId=function(){return"edit-point-"+zr.counter++},zr.counter=0,zr);function zr(e,t,i,n){void 0===n&&(n=!1);var o=Gr.call(this)||this;return o._show=!0,o.editedEntityId=e,o.position=t,o.id=o.generateId(),o.pointProps=i,o._virtualEditPoint=n,o}var Kr,Wr=(E($r,Kr=un),Object.defineProperty($r.prototype,"props",{get:function(){return this._polylineProps},set:function(e){this._polylineProps=e},enumerable:!0,configurable:!0}),$r.prototype.getEditedEntityId=function(){return this.editedEntityId},$r.prototype.getPositions=function(){return this.positions},$r.prototype.validatePositions=function(){return this.positions[0]!==undefined&&this.positions[1]!==undefined},$r.prototype.getStartPosition=function(){return this.positions[0]},$r.prototype.getEndPosition=function(){return this.positions[1]},$r.prototype.setStartPosition=function(e){this.positions[0]=e},$r.prototype.setEndPosition=function(e){this.positions[1]=e},$r.prototype.getId=function(){return this.id},$r.prototype.generateId=function(){return"edit-polyline-"+$r.counter++},$r.counter=0,$r);function $r(e,t,i,n){var o=Kr.call(this)||this;return o.editedEntityId=e,o.id=o.generateId(),o.positions=[t,i],o._polylineProps=n,o}var Zr,Yr={backgroundColor:new Cesium.Color(.165,.165,.165,.7),backgroundPadding:new Cesium.Cartesian2(7,5),distanceDisplayCondition:undefined,eyeOffset:new Cesium.Cartesian3(0,0,-999),fillColor:Cesium.Color.WHITE,font:"30px sans-serif",heightReference:Cesium.HeightReference.NONE,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelOffset:Cesium.Cartesian2.ZERO,pixelOffsetScaleByDistance:undefined,scale:1,scaleByDistance:undefined,show:!0,showBackground:!1,style:Cesium.LabelStyle.FILL,text:"",translucencyByDistance:undefined,verticalOrigin:Cesium.VerticalOrigin.BASELINE},qr=(E(Xr,Zr=un),Object.defineProperty(Xr.prototype,"labels",{get:function(){return this._labels},set:function(e){if(e){var i=this.getRealPositions();this._labels=e.map(function(e,t){return e.position||(e.position=i[t]),Object.assign({},Yr,e)})}},enumerable:!0,configurable:!0}),Object.defineProperty(Xr.prototype,"defaultPolylineProps",{get:function(){return this._defaultPolylineProps},set:function(e){this._defaultPolylineProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xr.prototype,"defaultPointProps",{get:function(){return this._defaultPointProps},set:function(e){this._defaultPointProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xr.prototype,"polygonProps",{get:function(){return this._polygonProps},set:function(e){this._polygonProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Xr.prototype,"enableEdit",{get:function(){return this._enableEdit},set:function(t){var i=this;this._enableEdit=t,this.positions.forEach(function(e){e.show=t,i.updatePointsLayer(!1,e)})},enumerable:!0,configurable:!0}),Xr.prototype.createFromExisting=function(e){var t=this;e.forEach(function(e){t.addPointFromExisting(e)}),this.addAllVirtualEditPoints(),this.updatePolygonsLayer(),this.doneCreation=!0},Xr.prototype.setPointsManually=function(e,t){var i=this;if(!this.doneCreation)throw new Error("Update manually only in edit mode, after polygon is created");this.positions.forEach(function(e){return i.pointsLayer.remove(e.getId())});for(var n=[],o=0;o<e.length;o++){var r=e[o],s=null;s=r.pointProps?new Ur(this.id,r.position,r.pointProps):new Ur(this.id,r,this.defaultPointProps),n.push(s)}this.positions=n,this.polygonProps=t||this.polygonProps,this.updatePointsLayer.apply(this,H([!0],this.positions)),this.addAllVirtualEditPoints(),this.updatePolygonsLayer()},Xr.prototype.addAllVirtualEditPoints=function(){var s=this,a=H(this.positions);a.forEach(function(e,t){var i=e,n=(t+1)%a.length,o=a[n],r=s.setMiddleVirtualPoint(i,o);s.updatePointsLayer(!1,r)})},Xr.prototype.setMiddleVirtualPoint=function(e,t){var i=Cesium.Cartographic.fromCartesian(e.getPosition()),n=Cesium.Cartographic.fromCartesian(t.getPosition()),o=this.coordinateConverter.midPointToCartesian3(i,n),r=new Ur(this.id,o,this.defaultPointProps);r.setVirtualEditPoint(!0);var s=this.positions.indexOf(e);return this.positions.splice(s+1,0,r),r},Xr.prototype.updateMiddleVirtualPoint=function(e,t,i){var n=Cesium.Cartographic.fromCartesian(t.getPosition()),o=Cesium.Cartographic.fromCartesian(i.getPosition());e.setPosition(this.coordinateConverter.midPointToCartesian3(n,o))},Xr.prototype.changeVirtualPointToRealPoint=function(e){e.setVirtualEditPoint(!1);var t=this.positions.length,i=this.positions.indexOf(e),n=(i+1)%t,o=(i-1+t)%t,r=this.positions[n],s=this.positions[o],a=this.setMiddleVirtualPoint(s,e),p=this.setMiddleVirtualPoint(e,r);this.updatePointsLayer(!0,a,p,e),this.updatePolygonsLayer()},Xr.prototype.renderPolylines=function(){var r=this;this.polylines.forEach(function(e){return r.polylinesLayer.remove(e.getId())}),this.polylines=[];var s=this.positions.filter(function(e){return!e.isVirtualEditPoint()});s.forEach(function(e,t){var i=(t+1)%s.length,n=s[i],o=new Wr(r.id,e.getPosition(),n.getPosition(),r.defaultPolylineProps);r.polylines.push(o),r.polylinesLayer.update(o,o.getId())})},Xr.prototype.addPointFromExisting=function(e){var t=new Ur(this.id,e,this.defaultPointProps);this.positions.push(t),this.updatePointsLayer(!0,t)},Xr.prototype.addPoint=function(e){if(!this.doneCreation){if(!this.positions.length){var t=new Ur(this.id,e,this.defaultPointProps);this.positions.push(t),this.updatePointsLayer(!0,t)}this.movingPoint=new Ur(this.id,e.clone(),this.defaultPointProps),this.positions.push(this.movingPoint),this.updatePointsLayer(!0,this.movingPoint),this.updatePolygonsLayer()}},Xr.prototype.movePoint=function(e,t){if(t.setPosition(e),this.updatePolygonsLayer(),this.doneCreation){t.isVirtualEditPoint()&&this.changeVirtualPointToRealPoint(t);var i=this.positions.length,n=this.positions.indexOf(t),o=this.positions[(n+1)%i],r=this.positions[(n+2)%i],s=this.positions[(n-1+i)%i],a=this.positions[(n-2+i)%i];this.updateMiddleVirtualPoint(o,t,r),this.updateMiddleVirtualPoint(s,t,a),this.updatePointsLayer(!1,o),this.updatePointsLayer(!1,s)}this.updatePointsLayer(!0,t)},Xr.prototype.moveTempMovingPoint=function(e){this.movingPoint&&this.movePoint(e,this.movingPoint)},Xr.prototype.movePolygon=function(e,t){var i=this;if(this.doneCreation){this.lastDraggedToPosition||(this.lastDraggedToPosition=e);var n=re.getPositionsDelta(this.lastDraggedToPosition,t);this.positions.forEach(function(e){re.addDeltaToPosition(e.getPosition(),n,!0)}),this.updatePointsLayer(),this.lastDraggedToPosition=t,this.positions.forEach(function(e){return i.updatePointsLayer(!0,e)})}},Xr.prototype.endMovePolygon=function(){this.lastDraggedToPosition=undefined},Xr.prototype.removePoint=function(e){var t=this;this.removePosition(e),this.positions.filter(function(e){return e.isVirtualEditPoint()}).forEach(function(e){return t.removePosition(e)}),this.addAllVirtualEditPoints(),this.renderPolylines(),3<=this.getPointsCount()&&this.polygonsLayer.update(this,this.id)},Xr.prototype.addLastPoint=function(e){this.doneCreation=!0,this.removePosition(this.movingPoint),this.movingPoint=null,this.updatePolygonsLayer(),this.addAllVirtualEditPoints()},Xr.prototype.getRealPositions=function(){return this.getRealPoints().map(function(e){return e.getPosition()})},Xr.prototype.getRealPoints=function(){var t=this;return this.positions.filter(function(e){return!e.isVirtualEditPoint()&&e!==t.movingPoint})},Xr.prototype.getPositionsHierarchy=function(){return this.positions.filter(function(e){return!e.isVirtualEditPoint()}).map(function(e){return e.getPosition()})},Xr.prototype.getPositionsHierarchyCallbackProperty=function(){return new Cesium.CallbackProperty(this.getPositionsHierarchy.bind(this),!1)},Xr.prototype.removePosition=function(t){var e=this.positions.findIndex(function(e){return e===t});e<0||(this.positions.splice(e,1),this.pointsLayer.remove(t.getId()))},Xr.prototype.updatePolygonsLayer=function(){3<=this.getPointsCount()&&this.polygonsLayer.update(this,this.id)},Xr.prototype.updatePointsLayer=function(e){var t=this;void 0===e&&(e=!0);for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];e&&this.renderPolylines(),i.forEach(function(e){return t.pointsLayer.update(e,e.getId())})},Xr.prototype.dispose=function(){var t=this;this.polygonsLayer.remove(this.id),this.positions.forEach(function(e){t.pointsLayer.remove(e.getId())}),this.polylines.forEach(function(e){return t.polylinesLayer.remove(e.getId())}),this.movingPoint&&(this.pointsLayer.remove(this.movingPoint.getId()),this.movingPoint=undefined),this.positions.length=0},Xr.prototype.getPointsCount=function(){return this.positions.length},Xr.prototype.getId=function(){return this.id},Xr);function Xr(e,t,i,n,o,r,s){var a=Zr.call(this)||this;return a.id=e,a.polygonsLayer=t,a.pointsLayer=i,a.polylinesLayer=n,a.coordinateConverter=o,a.positions=[],a.polylines=[],a.doneCreation=!1,a._enableEdit=!0,a._labels=[],a.polygonProps=r.polygonProps,a.defaultPointProps=r.pointProps,a.defaultPolylineProps=r.polylineProps,s&&3<=s.length&&a.createFromExisting(s),a}var Jr=(Qr.prototype.createEditablePolygon=function(e,t,i,n,o,r,s){var a=new qr(e,t,i,n,o,r,s);this.polygons.set(e,a)},Qr.prototype.dispose=function(e){this.polygons.get(e).dispose(),this.polygons["delete"](e)},Qr.prototype.get=function(e){return this.polygons.get(e)},Qr.prototype.clear=function(){this.polygons.forEach(function(e){return e.dispose()}),this.polygons.clear()},Qr.decorators=[{type:a.Injectable}],Qr);function Qr(){this.polygons=new Map}function es(e){void 0===e&&(e=12);for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}var ts={addPointEvent:$.LEFT_CLICK,addLastPointEvent:$.LEFT_DOUBLE_CLICK,removePointEvent:$.RIGHT_CLICK,dragPointEvent:$.LEFT_CLICK_DRAG,dragShapeEvent:$.LEFT_CLICK_DRAG,allowDrag:!0,pointProps:{color:Cesium.Color.WHITE.withAlpha(.9),outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelSize:15,virtualPointPixelSize:8,show:!0,showVirtual:!0},polygonProps:{material:new Cesium.Color(.1,.5,.2,.4)},polylineProps:{material:function(){return Cesium.Color.BLACK},width:1}},is=(ns.prototype.init=function(e,t,i,n){this.mapEventsManager=e,this.coordinateConverter=t,this.cameraService=i,this.polygonsManager=n,this.updatePublisher.connect()},ns.prototype.onUpdate=function(){return this.updatePublisher},ns.prototype.create=function(e,r){var s=this;void 0===e&&(e=ts),void 0===r&&(r=100);var a=[],p=es(),c=this.setOptions(e),l=new w.BehaviorSubject({id:p,editAction:null,editMode:Hr.CREATE}),u=!1;this.updateSubject.next({id:p,positions:a,editMode:Hr.CREATE,editAction:Br.INIT,polygonOptions:c});var t=this.mapEventsManager.register({event:$.MOUSE_MOVE,pick:Z.NO_PICK,priority:r}),i=this.mapEventsManager.register({event:c.addPointEvent,pick:Z.NO_PICK,priority:r}),n=this.mapEventsManager.register({event:c.addLastPointEvent,pick:Z.NO_PICK,priority:r});this.observablesMap.set(p,[t,i,n]);var d=this.createEditorObservable(l,p);return t.subscribe(function(e){var t=e.movement.endPosition,i=s.coordinateConverter.screenToCartesian3(t);i&&s.updateSubject.next({id:p,positions:s.getPositions(p),editMode:Hr.CREATE,updatedPosition:i,editAction:Br.MOUSE_MOVE})}),i.subscribe(function(e){var t=e.movement.endPosition;if(!u){var i=s.coordinateConverter.screenToCartesian3(t);if(i){var n=s.getPositions(p);if(!n.find(function(e){return e.equals(i)})){var o={id:p,positions:n,editMode:Hr.CREATE,updatedPosition:i,editAction:Br.ADD_POINT};s.updateSubject.next(o),l.next(_({},o,{positions:s.getPositions(p),points:s.getPoints(p)})),c.maximumNumberOfPoints&&n.length+1===c.maximumNumberOfPoints&&(u=s.switchToEditMode(p,i,l,a,r,c,d,u))}}}}),n.subscribe(function(e){var t=e.movement.endPosition,i=s.coordinateConverter.screenToCartesian3(t);i&&(u=s.switchToEditMode(p,i,l,a,r,c,d,u))}),d},ns.prototype.switchToEditMode=function(e,t,i,n,o,r,s,a){var p={id:e,positions:this.getPositions(e),editMode:Hr.CREATE,updatedPosition:t,editAction:Br.ADD_LAST_POINT};this.updateSubject.next(p),i.next(_({},p,{positions:this.getPositions(e),points:this.getPoints(e)}));var c={id:e,editMode:Hr.CREATE,editAction:Br.CHANGE_TO_EDIT};return this.updateSubject.next(c),i.next(c),this.observablesMap.has(e)&&this.observablesMap.get(e).forEach(function(e){return e.dispose()}),this.observablesMap["delete"](e),this.editPolygon(e,n,o,i,r,s),!0},ns.prototype.edit=function(e,t,i){if(void 0===t&&(t=ts),void 0===i&&(i=100),e.length<3)throw new Error("Polygons editor error edit(): polygon should have at least 3 positions");var n=es(),o=this.setOptions(t),r=new w.BehaviorSubject({id:n,editAction:null,editMode:Hr.EDIT}),s={id:n,positions:e,editMode:Hr.EDIT,editAction:Br.INIT,polygonOptions:o};return this.updateSubject.next(s),r.next(_({},s,{positions:this.getPositions(n),points:this.getPoints(n)})),this.editPolygon(n,e,i,r,o)},ns.prototype.editPolygon=function(p,e,t,c,i,n){var o,l=this,r=this.mapEventsManager.register({event:i.dragPointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.editedEntityId}});i.allowDrag&&(o=this.mapEventsManager.register({event:i.dragShapeEvent,entityType:qr,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.id}}));var s=this.mapEventsManager.register({event:i.removePointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.editedEntityId}});r.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.endPosition,n=t.drop,o=e.entities,r=l.coordinateConverter.screenToCartesian3(i);if(r){var s=o[0],a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,updatedPoint:s,editAction:n?Br.DRAG_POINT_FINISH:Br.DRAG_POINT};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p)}))}}),o&&o.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.startPosition,n=t.endPosition,o=t.drop,r=(e.entities,l.coordinateConverter.screenToCartesian3(n)),s=l.coordinateConverter.screenToCartesian3(i);if(r){var a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,draggedPosition:s,editAction:o?Br.DRAG_SHAPE_FINISH:Br.DRAG_SHAPE};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p)}))}}),s.subscribe(function(e){var t=e.entities[0],i=H(l.getPositions(p));if(!(i.length<4||i.findIndex(function(e){return t.getPosition().equals(e)})<0)){var n={id:p,positions:i,editMode:Hr.EDIT,updatedPoint:t,editAction:Br.REMOVE_POINT};l.updateSubject.next(n),c.next(_({},n,{positions:l.getPositions(p),points:l.getPoints(p)}))}});var a=[r,s];return o&&a.push(o),this.observablesMap.set(p,a),n||this.createEditorObservable(c,p)},ns.prototype.setOptions=function(e){e.maximumNumberOfPoints&&e.maximumNumberOfPoints<3&&(console.warn("Warn: PolygonEditor invalid option. maximumNumberOfPoints smaller then 3, maximumNumberOfPoints changed to 3"),e.maximumNumberOfPoints=3);var t=JSON.parse(JSON.stringify(ts)),i=Object.assign(t,e);return i.pointProps=Object.assign({},ts.pointProps,e.pointProps),i.polygonProps=Object.assign({},ts.polygonProps,e.polygonProps),i.polylineProps=Object.assign({},ts.polylineProps,e.polylineProps),i},ns.prototype.createEditorObservable=function(e,i){var n=this;return e.dispose=function(){var e=n.observablesMap.get(i);e&&e.forEach(function(e){return e.dispose()}),n.observablesMap["delete"](i),n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.CREATE_OR_EDIT,editAction:Br.DISPOSE})},e.enable=function(){n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.EDIT,editAction:Br.ENABLE})},e.disable=function(){n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.EDIT,editAction:Br.DISABLE})},e.setManually=function(e,t){n.polygonsManager.get(i).setPointsManually(e,t),n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_MANUALLY})},e.setLabelsRenderFn=function(e){n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_EDIT_LABELS_RENDER_CALLBACK,labelsRenderFn:e})},e.updateLabels=function(e){n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.UPDATE_EDIT_LABELS,updateLabels:e})},e.getCurrentPoints=function(){return n.getPoints(i)},e.getEditValue=function(){return e.getValue()},e.getLabels=function(){return n.polygonsManager.get(i).labels},e},ns.prototype.getPositions=function(e){return this.polygonsManager.get(e).getRealPositions()},ns.prototype.getPoints=function(e){return this.polygonsManager.get(e).getRealPoints()},ns.decorators=[{type:a.Injectable}],ns);function ns(){this.updateSubject=new w.Subject,this.updatePublisher=f.publish()(this.updateSubject),this.observablesMap=new Map}var os=(rs.prototype.startListeningToEditorUpdates=function(){var t=this;this.polygonsEditor.onUpdate().subscribe(function(e){e.editMode===Hr.CREATE||e.editMode===Hr.CREATE_OR_EDIT?t.handleCreateUpdates(e):e.editMode===Hr.EDIT&&t.handleEditUpdates(e)})},rs.prototype.getLabelId=function(e,t){return t.toString()},rs.prototype.renderEditLabels=function(e,t,i){if(t.positions=e.getRealPositions(),t.points=e.getRealPoints(),i)return e.labels=i,void this.editPolygonsLayer.update(e,e.getId());this.editLabelsRenderFn&&(e.labels=this.editLabelsRenderFn(t,e.labels),this.editPolygonsLayer.update(e,e.getId()))},rs.prototype.removeEditLabels=function(e){e.labels=[],this.editPolygonsLayer.update(e,e.getId())},rs.prototype.handleCreateUpdates=function(e){switch(e.editAction){case Br.INIT:this.polygonsManager.createEditablePolygon(e.id,this.editPolygonsLayer,this.editPointsLayer,this.editPolylinesLayer,this.coordinateConverter,e.polygonOptions);break;case Br.MOUSE_MOVE:var t=this.polygonsManager.get(e.id);e.updatedPosition&&(t.moveTempMovingPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.ADD_POINT:t=this.polygonsManager.get(e.id),e.updatedPosition&&(t.addPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.ADD_LAST_POINT:t=this.polygonsManager.get(e.id),e.updatedPosition&&(t.addLastPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DISPOSE:(t=this.polygonsManager.get(e.id)).dispose(),this.removeEditLabels(t),this.editLabelsRenderFn=undefined;break;case Br.SET_EDIT_LABELS_RENDER_CALLBACK:t=this.polygonsManager.get(e.id),this.editLabelsRenderFn=e.labelsRenderFn,this.renderEditLabels(t,e);break;case Br.UPDATE_EDIT_LABELS:case Br.SET_MANUALLY:t=this.polygonsManager.get(e.id),this.renderEditLabels(t,e,e.updateLabels);break;default:return}},rs.prototype.handleEditUpdates=function(e){switch(e.editAction){case Br.INIT:this.polygonsManager.createEditablePolygon(e.id,this.editPolygonsLayer,this.editPointsLayer,this.editPolylinesLayer,this.coordinateConverter,e.polygonOptions,e.positions);break;case Br.DRAG_POINT:(t=this.polygonsManager.get(e.id))&&t.enableEdit&&(t.movePoint(e.updatedPosition,e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DRAG_POINT_FINISH:(t=this.polygonsManager.get(e.id))&&t.enableEdit&&e.updatedPoint.isVirtualEditPoint()&&(t.changeVirtualPointToRealPoint(e.updatedPoint),this.renderEditLabels(t,e));break;case Br.REMOVE_POINT:(t=this.polygonsManager.get(e.id))&&t.enableEdit&&(t.removePoint(e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DISABLE:(t=this.polygonsManager.get(e.id))&&(t.enableEdit=!1,this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE:(t=this.polygonsManager.get(e.id))&&t.enableEdit&&(t.movePolygon(e.draggedPosition,e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE_FINISH:(t=this.polygonsManager.get(e.id))&&t.enableEdit&&(t.endMovePolygon(),this.renderEditLabels(t,e));break;case Br.ENABLE:var t;(t=this.polygonsManager.get(e.id))&&(t.enableEdit=!0,this.renderEditLabels(t,e));break;default:return}},rs.prototype.ngOnDestroy=function(){this.polygonsManager.clear()},rs.prototype.getPointSize=function(e){return e.isVirtualEditPoint()?e.props.virtualPointPixelSize:e.props.pixelSize},rs.prototype.getPointShow=function(e){return e.show&&(e.isVirtualEditPoint()?e.props.showVirtual:e.props.show)},rs.decorators=[{type:a.Component,args:[{selector:"polygons-editor",template:'\n    <ac-layer #editPolylinesLayer acFor="let polyline of editPolylines$" [context]="this">\n      <ac-polyline-primitive-desc\n        props="{\n        positions: polyline.getPositions(),\n        width: polyline.props.width,\n        material: polyline.props.material()\n    }"\n      >\n      </ac-polyline-primitive-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor="let point of editPoints$" [context]="this">\n      <ac-point-desc\n        props="{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editPolygonsLayer acFor="let polygon of editPolygons$" [context]="this">\n      <ac-polygon-desc\n        props="{\n        hierarchy: polygon.getPositionsHierarchyCallbackProperty(),\n        material: polygon.polygonProps.material\n    }"\n      >\n      </ac-polygon-desc>\n      \x3c!-- <ac-static-polygon-desc --\x3e\n      \x3c!-- geometryProps="{ --\x3e\n      \x3c!-- polygonHierarchy: polygon.getHierarchy(), --\x3e\n      \x3c!-- height: 1 --\x3e\n      \x3c!-- }" --\x3e\n      \x3c!-- instanceProps="{ --\x3e\n      \x3c!-- attributes: attributes --\x3e\n      \x3c!-- }" --\x3e\n      \x3c!-- primitiveProps="{ --\x3e\n      \x3c!-- appearance: appearance --\x3e\n      \x3c!-- }"> --\x3e\n      \x3c!-- </ac-static-polygon-desc --\x3e\n      <ac-array-desc acFor="let label of polygon.labels" [idGetter]="getLabelId">\n        <ac-label-primitive-desc\n          props="{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  ',providers:[J,Jr],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],rs.ctorParameters=function(){return[{type:is},{type:J},{type:rt},{type:P},{type:Jr}]},rs.propDecorators={editPolygonsLayer:[{type:a.ViewChild,args:["editPolygonsLayer"]}],editPointsLayer:[{type:a.ViewChild,args:["editPointsLayer"]}],editPolylinesLayer:[{type:a.ViewChild,args:["editPolylinesLayer"]}]},rs);function rs(e,t,i,n,o){this.polygonsEditor=e,this.coordinateConverter=t,this.mapEventsManager=i,this.cameraService=n,this.polygonsManager=o,this.Cesium=Cesium,this.editPoints$=new w.Subject,this.editPolylines$=new w.Subject,this.editPolygons$=new w.Subject,this.appearance=new Cesium.PerInstanceColorAppearance({flat:!0}),this.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(.2,.2,.5,.5))},this.polygonColor=new Cesium.Color(.1,.5,.2,.4),this.lineColor=new Cesium.Color(0,0,0,.6),this.polygonsEditor.init(this.mapEventsManager,this.coordinateConverter,this.cameraService,o),this.startListeningToEditorUpdates()}var ss,as=(E(ps,ss=un),Object.defineProperty(ps.prototype,"props",{get:function(){return this._arcProps},set:function(e){this._arcProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"delta",{get:function(){return this._delta},set:function(e){this._delta=e},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(ps.prototype,"center",{get:function(){return this._center},set:function(e){this._center=e},enumerable:!0,configurable:!0}),ps.prototype.updateCenter=function(e){this._center.x=e.x,this._center.y=e.y,this._center.z=e.z},ps.prototype.getId=function(){return this.id},ps.prototype.generateId=function(){return"edit-arc-"+ps.counter++},ps.counter=0,ps);function ps(e,t,i,n,o,r){var s=ss.call(this)||this;return s._arcProps=r,s.id=s.generateId(),s.editedEntityId=e,s._center=t,s._radius=i,s._delta=n,s._angle=o,s}var cs,ls=(E(us,cs=un),Object.defineProperty(us.prototype,"labels",{get:function(){return this._labels},set:function(i){var n=this;i&&this._center&&this._radiusPoint&&(this._labels=i.map(function(e,t){return e.position||(t!==i.length-1?e.position=n._center.getPosition():e.position=n._radiusPoint.getPosition()),Object.assign({},Yr,e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"polylineProps",{get:function(){return this._polylineProps},set:function(e){this._polylineProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"pointProps",{get:function(){return this._pointProps},set:function(e){this._pointProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"circleProps",{get:function(){return this._circleProps},set:function(e){this._circleProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"center",{get:function(){return this._center},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"radiusPoint",{get:function(){return this._radiusPoint},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"enableEdit",{get:function(){return this._enableEdit},set:function(e){this._enableEdit=e,this._center.show=e,this._radiusPoint.show=e,this.updatePointsLayer()},enumerable:!0,configurable:!0}),us.prototype.setManually=function(e,t,i,n,o){void 0===i&&(i=this.pointProps),void 0===n&&(n=this.pointProps),void 0===o&&(o=this.circleProps),this._center?this._center.setPosition(e):this._center=new Ur(this.id,e,i),this._radiusPoint?this._radiusPoint.setPosition(t):this._radiusPoint=new Ur(this.id,t,n),this._outlineArc?this._outlineArc.radius=this.getRadius():this.createOutlineArc(),this.circleProps=o,this.doneCreation=!0,this.updateArcsLayer(),this.updatePointsLayer(),this.updateCirclesLayer()},us.prototype.addPoint=function(e){this.doneCreation||(this._center||(this._center=new Ur(this.id,e,this.pointProps),this._radiusPoint=new Ur(this.id,e.clone(),this.pointProps),this._outlineArc||this.createOutlineArc()),this.updateArcsLayer(),this.updatePointsLayer(),this.updateCirclesLayer())},us.prototype.addLastPoint=function(e){!this.doneCreation&&this._center&&this._radiusPoint&&(this._radiusPoint.setPosition(e),this.doneCreation=!0,this.updatePointsLayer(),this.updateCirclesLayer())},us.prototype.movePoint=function(e){this._center&&this._radiusPoint&&(this._radiusPoint.setPosition(e),this._outlineArc.radius=this.getRadius(),this.updateArcsLayer(),this.updatePointsLayer(),this.updateCirclesLayer())},us.prototype.moveCircle=function(e,t){if(this.doneCreation){this.lastDraggedToPosition||(this.lastDraggedToPosition=e);var i=this.getRadius(),n=re.getPositionsDelta(this.lastDraggedToPosition,t);re.addDeltaToPosition(this.getCenter(),n,!0),this.radiusPoint.setPosition(re.pointByLocationDistanceAndAzimuth(this.getCenter(),i,Math.PI/2,!0)),this._outlineArc.radius=this.getRadius(),this.updateArcsLayer(),this.updatePointsLayer(),this.updateCirclesLayer(),this.lastDraggedToPosition=t}},us.prototype.endMovePolygon=function(){this.lastDraggedToPosition=undefined},us.prototype.getRadius=function(){return this._center&&this._radiusPoint?re.distance(this._center.getPosition(),this._radiusPoint.getPosition()):0},us.prototype.getRadiusCallbackProperty=function(){return new Cesium.CallbackProperty(this.getRadius.bind(this),!1)},us.prototype.getCenter=function(){return this._center?this._center.getPosition():undefined},us.prototype.getCenterCallbackProperty=function(){return new Cesium.CallbackProperty(this.getCenter.bind(this),!1)},us.prototype.getRadiusPoint=function(){return this._radiusPoint?this._radiusPoint.getPosition():undefined},us.prototype.dispose=function(){this._center&&this.pointsLayer.remove(this._center.getId()),this._radiusPoint&&this.pointsLayer.remove(this._radiusPoint.getId()),this._outlineArc&&this.arcsLayer.remove(this._outlineArc.getId()),this.circlesLayer.remove(this.id)},us.prototype.getId=function(){return this.id},us.prototype.updateCirclesLayer=function(){this.circlesLayer.update(this,this.id)},us.prototype.updatePointsLayer=function(){this._center&&this.pointsLayer.update(this._center,this._center.getId()),this._radiusPoint&&this.pointsLayer.update(this._radiusPoint,this._radiusPoint.getId())},us.prototype.updateArcsLayer=function(){this._outlineArc&&this.arcsLayer.update(this._outlineArc,this._outlineArc.getId())},us.prototype.createOutlineArc=function(){this._center&&this._radiusPoint&&(this._outlineArc=new as(this.id,this.getCenter(),this.getRadius(),2*Math.PI,0,this.polylineProps))},us);function us(e,t,i,n,o){var r=cs.call(this)||this;return r.id=e,r.circlesLayer=t,r.pointsLayer=i,r.arcsLayer=n,r.options=o,r.doneCreation=!1,r._enableEdit=!0,r._labels=[],r._circleProps=o.circleProps,r._pointProps=o.pointProps,r._polylineProps=o.polylineProps,r}var ds=(hs.prototype.createEditableCircle=function(e,t,i,n,o){var r=new ls(e,t,i,n,o);return this.circles.set(e,r),r},hs.prototype.dispose=function(e){this.circles.get(e).dispose(),this.circles["delete"](e)},hs.prototype.get=function(e){return this.circles.get(e)},hs.prototype.clear=function(){this.circles.forEach(function(e){return e.dispose()}),this.circles.clear()},hs.decorators=[{type:a.Injectable}],hs);function hs(){this.circles=new Map}var ys={addPointEvent:$.LEFT_CLICK,dragPointEvent:$.LEFT_CLICK_DRAG,dragShapeEvent:$.LEFT_CLICK_DRAG,allowDrag:!0,circleProps:{material:Cesium.Color.GREEN.withAlpha(.5),outline:!1,outlineWidth:1,outlineColor:Cesium.Color.BLACK},pointProps:{color:Cesium.Color.WHITE.withAlpha(.9),outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelSize:15,virtualPointPixelSize:8,show:!0,showVirtual:!0},polylineProps:{width:1,material:function(){return Cesium.Color.BLACK}}},ms=(fs.prototype.init=function(e,t,i,n){this.mapEventsManager=e,this.coordinateConverter=t,this.cameraService=i,this.circlesManager=n,this.updatePublisher.connect()},fs.prototype.onUpdate=function(){return this.updatePublisher},fs.prototype.create=function(e,r){var s,a=this;void 0===e&&(e=ys),void 0===r&&(r=100);var p=es(),c=this.setOptions(e),l=new w.BehaviorSubject({id:p,editAction:null,editMode:Hr.CREATE}),u=!1;this.updateSubject.next({id:p,editMode:Hr.CREATE,editAction:Br.INIT,circleOptions:c});var t=this.mapEventsManager.register({event:$.MOUSE_MOVE,pick:Z.NO_PICK,priority:r}),i=this.mapEventsManager.register({event:$.LEFT_CLICK,pick:Z.NO_PICK,priority:r});this.observablesMap.set(p,[t,i]);var d=this.createEditorObservable(l,p);return i.subscribe(function(e){var t=e.movement.endPosition;if(!u){var i=a.coordinateConverter.screenToCartesian3(t);if(i)if(s){o={id:p,center:s,radiusPoint:i,editMode:Hr.CREATE,editAction:Br.ADD_LAST_POINT},a.updateSubject.next(o),l.next(_({},o,a.getCircleProperties(p)));var n={id:p,center:s,radiusPoint:i,editMode:Hr.CREATE,editAction:Br.CHANGE_TO_EDIT};a.updateSubject.next(n),l.next(_({},o,a.getCircleProperties(p))),a.observablesMap.has(p)&&a.observablesMap.get(p).forEach(function(e){return e.dispose()}),a.observablesMap["delete"](p),a.editCircle(p,r,l,c,d),u=!0}else{var o={id:p,center:i,editMode:Hr.CREATE,editAction:Br.ADD_POINT};a.updateSubject.next(o),l.next(_({},o,a.getCircleProperties(p))),s=i}}}),t.subscribe(function(e){var t=e.movement.endPosition;if(s){var i=a.coordinateConverter.screenToCartesian3(t);if(i){var n={id:p,center:s,radiusPoint:i,editMode:Hr.CREATE,editAction:Br.MOUSE_MOVE};a.updateSubject.next(n),l.next(_({},n,a.getCircleProperties(p)))}}}),d},fs.prototype.edit=function(e,t,i,n){void 0===i&&(i=ys),void 0===n&&(n=100);var o=es(),r=this.setOptions(i),s=new w.BehaviorSubject({id:o,editAction:null,editMode:Hr.EDIT}),a={id:o,center:e,radiusPoint:re.pointByLocationDistanceAndAzimuth(e,t,Math.PI/2,!0),editMode:Hr.EDIT,editAction:Br.INIT,circleOptions:r};return this.updateSubject.next(a),s.next(_({},a,this.getCircleProperties(o))),this.editCircle(o,n,s,r)},fs.prototype.editCircle=function(u,e,d,h,t){var i,y=this,n=this.mapEventsManager.register({event:$.LEFT_CLICK_DRAG,entityType:Ur,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return u===e.editedEntityId}});h.allowDrag&&(i=this.mapEventsManager.register({event:$.LEFT_CLICK_DRAG,entityType:ls,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return u===e.id}})),n.pipe(f.tap(function(e){var t=e.movement.drop;return y.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.endPosition,n=t.startPosition,o=t.drop,r=e.entities,s=y.coordinateConverter.screenToCartesian3(n),a=y.coordinateConverter.screenToCartesian3(i);if(a){var p,c=r[0]===y.getCenterPoint(u);if(p=o?c?Br.DRAG_SHAPE_FINISH:Br.DRAG_POINT_FINISH:c?Br.DRAG_SHAPE:Br.DRAG_POINT,h.allowDrag||p!==Br.DRAG_SHAPE&&p!==Br.DRAG_SHAPE_FINISH){var l={id:u,center:y.getCenterPosition(u),radiusPoint:y.getRadiusPosition(u),startDragPosition:s,endDragPosition:a,editMode:Hr.EDIT,editAction:p};y.updateSubject.next(l),d.next(_({},l,y.getCircleProperties(u)))}else y.cameraService.enableInputs(!0)}}),i&&i.pipe(f.tap(function(e){var t=e.movement.drop;return y.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.startPosition,n=t.endPosition,o=t.drop,r=y.coordinateConverter.screenToCartesian3(i),s=y.coordinateConverter.screenToCartesian3(n);if(s&&r){var a={id:u,center:y.getCenterPosition(u),radiusPoint:y.getRadiusPosition(u),startDragPosition:r,endDragPosition:s,editMode:Hr.EDIT,editAction:o?Br.DRAG_SHAPE_FINISH:Br.DRAG_SHAPE};y.updateSubject.next(a),d.next(_({},a,y.getCircleProperties(u)))}});var o=[n];return i&&o.push(i),this.observablesMap.set(u,o),t||this.createEditorObservable(d,u)},fs.prototype.createEditorObservable=function(e,s){var a=this;return e.dispose=function(){var e=a.observablesMap.get(s);e&&e.forEach(function(e){return e.dispose()}),a.observablesMap["delete"](s),a.updateSubject.next({id:s,center:a.getCenterPosition(s),radiusPoint:a.getRadiusPosition(s),editMode:Hr.CREATE_OR_EDIT,editAction:Br.DISPOSE})},e.enable=function(){a.updateSubject.next({id:s,center:a.getCenterPosition(s),radiusPoint:a.getRadiusPosition(s),editMode:Hr.EDIT,editAction:Br.ENABLE})},e.disable=function(){a.updateSubject.next({id:s,center:a.getCenterPosition(s),radiusPoint:a.getRadiusPosition(s),editMode:Hr.EDIT,editAction:Br.DISABLE})},e.setManually=function(e,t,i,n,o){var r=re.pointByLocationDistanceAndAzimuth(e,t,Math.PI/2,!0);a.circlesManager.get(s).setManually(e,r,i,n,o),a.updateSubject.next({id:s,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_MANUALLY})},e.setLabelsRenderFn=function(e){a.updateSubject.next({id:s,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_EDIT_LABELS_RENDER_CALLBACK,labelsRenderFn:e})},e.updateLabels=function(e){a.updateSubject.next({id:s,editMode:Hr.CREATE_OR_EDIT,editAction:Br.UPDATE_EDIT_LABELS,updateLabels:e})},e.getEditValue=function(){return e.getValue()},e.getLabels=function(){return a.circlesManager.get(s).labels},e.getCenter=function(){return a.getCenterPosition(s)},e.getRadius=function(){return a.getRadius(s)},e},fs.prototype.setOptions=function(e){var t=JSON.parse(JSON.stringify(ys)),i=Object.assign(t,e);return i.pointProps=Object.assign({},ys.pointProps,e.pointProps),i.circleProps=Object.assign({},ys.circleProps,e.circleProps),i.polylineProps=Object.assign({},ys.polylineProps,e.polylineProps),i},fs.prototype.getCenterPosition=function(e){return this.circlesManager.get(e).getCenter()},fs.prototype.getCenterPoint=function(e){return this.circlesManager.get(e).center},fs.prototype.getRadiusPosition=function(e){return this.circlesManager.get(e).getRadiusPoint()},fs.prototype.getRadius=function(e){return this.circlesManager.get(e).getRadius()},fs.prototype.getCircleProperties=function(e){var t=this.circlesManager.get(e);return{center:t.getCenter(),radiusPoint:t.getRadiusPoint(),radius:t.getRadius()}},fs.decorators=[{type:a.Injectable}],fs);function fs(){this.updateSubject=new w.Subject,this.updatePublisher=f.publish()(this.updateSubject),this.observablesMap=new Map}var gs=(vs.prototype.startListeningToEditorUpdates=function(){var t=this;this.circlesEditor.onUpdate().subscribe(function(e){e.editMode===Hr.CREATE||e.editMode===Hr.CREATE_OR_EDIT?t.handleCreateUpdates(e):e.editMode===Hr.EDIT&&t.handleEditUpdates(e)})},vs.prototype.getLabelId=function(e,t){return t.toString()},vs.prototype.renderEditLabels=function(e,t,i){if(t.center=e.getCenter(),t.radiusPoint=e.getRadiusPoint(),t.radius=e.getRadius(),i)return e.labels=i,void this.editCirclesLayer.update(e,e.getId());this.editLabelsRenderFn&&(e.labels=this.editLabelsRenderFn(t,e.labels),this.editCirclesLayer.update(e,e.getId()))},vs.prototype.removeEditLabels=function(e){e.labels=[],this.editCirclesLayer.update(e,e.getId())},vs.prototype.handleCreateUpdates=function(e){switch(e.editAction){case Br.INIT:this.circlesManager.createEditableCircle(e.id,this.editCirclesLayer,this.editPointsLayer,this.editArcsLayer,e.circleOptions);break;case Br.MOUSE_MOVE:var t=this.circlesManager.get(e.id);e.radiusPoint&&(t.movePoint(e.radiusPoint),this.renderEditLabels(t,e));break;case Br.ADD_POINT:t=this.circlesManager.get(e.id),e.center&&(t.addPoint(e.center),this.renderEditLabels(t,e));break;case Br.ADD_LAST_POINT:t=this.circlesManager.get(e.id),e.radiusPoint&&(t.addLastPoint(e.radiusPoint),this.renderEditLabels(t,e));break;case Br.DISPOSE:t=this.circlesManager.get(e.id),this.removeEditLabels(t),this.circlesManager.dispose(e.id);break;case Br.SET_EDIT_LABELS_RENDER_CALLBACK:t=this.circlesManager.get(e.id),this.editLabelsRenderFn=e.labelsRenderFn,this.renderEditLabels(t,e);break;case Br.UPDATE_EDIT_LABELS:case Br.SET_MANUALLY:t=this.circlesManager.get(e.id),this.renderEditLabels(t,e,e.updateLabels);break;default:return}},vs.prototype.handleEditUpdates=function(e){switch(e.editAction){case Br.INIT:(t=this.circlesManager.createEditableCircle(e.id,this.editCirclesLayer,this.editPointsLayer,this.editArcsLayer,e.circleOptions)).setManually(e.center,e.radiusPoint);break;case Br.DRAG_POINT_FINISH:case Br.DRAG_POINT:(t=this.circlesManager.get(e.id))&&t.enableEdit&&(t.movePoint(e.endDragPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE:(t=this.circlesManager.get(e.id))&&t.enableEdit&&(t.moveCircle(e.startDragPosition,e.endDragPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE_FINISH:(t=this.circlesManager.get(e.id))&&t.enableEdit&&(t.endMovePolygon(),this.renderEditLabels(t,e));break;case Br.DISABLE:(t=this.circlesManager.get(e.id))&&(t.enableEdit=!1,this.renderEditLabels(t,e));break;case Br.ENABLE:var t;(t=this.circlesManager.get(e.id))&&(t.enableEdit=!0,this.renderEditLabels(t,e));break;default:return}},vs.prototype.ngOnDestroy=function(){this.circlesManager.clear()},vs.prototype.getPointSize=function(e){return e.isVirtualEditPoint()?e.props.virtualPointPixelSize:e.props.pixelSize},vs.prototype.getPointShow=function(e){return e.show&&(e.isVirtualEditPoint()?e.props.showVirtual:e.props.show)},vs.decorators=[{type:a.Component,args:[{selector:"circles-editor",template:'\n    <ac-layer #editArcsLayer acFor="let arc of editArcs$" [context]="this">\n      <ac-arc-desc\n        props="{\n        angle: arc.angle,\n        delta: arc.delta,\n        center: arc.center,\n        radius: arc.radius,\n        quality: 30,\n        color: arc.props.material()\n    }"\n      >\n      </ac-arc-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor="let point of editPoints$" [context]="this">\n      <ac-point-desc\n        props="{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editCirclesLayer acFor="let circle of editCircles$" [context]="this" [zIndex]="0">\n      <ac-ellipse-desc\n        props="{\n        position: circle.getCenterCallbackProperty(),\n        semiMajorAxis: circle.getRadiusCallbackProperty(),\n        semiMinorAxis: circle.getRadiusCallbackProperty(),\n        material: circle.circleProps.material,\n        outline: circle.circleProps.outline,\n        height: 0\n    }"\n      >\n      </ac-ellipse-desc>\n\n      <ac-array-desc acFor="let label of circle.labels" [idGetter]="getLabelId">\n        <ac-label-primitive-desc\n          props="{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  ',providers:[J,ds],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],vs.ctorParameters=function(){return[{type:ms},{type:J},{type:rt},{type:P},{type:ds}]},vs.propDecorators={editCirclesLayer:[{type:a.ViewChild,args:["editCirclesLayer"]}],editArcsLayer:[{type:a.ViewChild,args:["editArcsLayer"]}],editPointsLayer:[{type:a.ViewChild,args:["editPointsLayer"]}]},vs);function vs(e,t,i,n,o){this.circlesEditor=e,this.coordinateConverter=t,this.mapEventsManager=i,this.cameraService=n,this.circlesManager=o,this.Cesium=Cesium,this.editPoints$=new w.Subject,this.editCircles$=new w.Subject,this.editArcs$=new w.Subject,this.circlesEditor.init(this.mapEventsManager,this.coordinateConverter,this.cameraService,this.circlesManager),this.startListeningToEditorUpdates()}var Ps,bs=(E(Cs,Ps=un),Object.defineProperty(Cs.prototype,"labels",{get:function(){return this._labels},set:function(e){var i=this;e&&this._center&&(this._labels=e.map(function(e,t){return e.position||(0===t?e.position=i._center.getPosition():1===t?e.position=i._majorRadiusPoint?Cesium.Cartesian3.midpoint(i.getCenter(),i._majorRadiusPoint.getPosition(),new Cesium.Cartesian3):new Cesium.Cartesian3:2===t&&(e.position=0<i._minorRadiusPoints.length&&i._minorRadius?Cesium.Cartesian3.midpoint(i.getCenter(),i.getMinorRadiusPointPosition(),new Cesium.Cartesian3):new Cesium.Cartesian3)),Object.assign({},Yr,e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(Cs.prototype,"polylineProps",{get:function(){return this._polylineProps},set:function(e){this._polylineProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cs.prototype,"pointProps",{get:function(){return this._pointProps},set:function(e){this._pointProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cs.prototype,"ellipseProps",{get:function(){return this._ellipseProps},set:function(e){this._ellipseProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Cs.prototype,"center",{get:function(){return this._center},enumerable:!0,configurable:!0}),Object.defineProperty(Cs.prototype,"majorRadiusPoint",{get:function(){return this._majorRadiusPoint},enumerable:!0,configurable:!0}),Cs.prototype.getMajorRadiusPointPosition=function(){return this._majorRadiusPoint?this._majorRadiusPoint.getPosition():undefined},Cs.prototype.getMinorRadiusPointPosition=function(){return this._minorRadiusPoints.length<1?undefined:this._minorRadiusPoints[0].getPosition()},Object.defineProperty(Cs.prototype,"enableEdit",{get:function(){return this._enableEdit},set:function(e){this._enableEdit=e,this._center.show=e,this._majorRadiusPoint.show=e,this.updatePointsLayer()},enumerable:!0,configurable:!0}),Cs.prototype.setManually=function(e,t,i,n,o,r,s){if(void 0===i&&(i=Math.PI/2),void 0===o&&(o=this.pointProps),void 0===r&&(r=this.pointProps),void 0===s&&(s=this.ellipseProps),t<n)throw new Error("Major radius muse be equal or greater than minor radius");this._rotation=i,this._majorRadius=t,this._center?this._center.setPosition(e):this._center=new Ur(this.id,e,o);var a=re.pointByLocationDistanceAndAzimuth(this.center.getPosition(),t,i);this._majorRadiusPoint?this._majorRadiusPoint.setPosition(a):this._majorRadiusPoint=new Ur(this.id,a,r),n&&(this._minorRadius=n),this.ellipseProps=s,this.doneCreation=!0,this.updateMinorRadiusEditPoints(),this.updatePointsLayer(),this.updateEllipsesLayer()},Cs.prototype.addPoint=function(e){this.doneCreation||(this._center||(this._center=new Ur(this.id,e,this.pointProps),this._majorRadiusPoint=new Ur(this.id,e.clone(),this.pointProps),this._majorRadius=0),this.updateRotation(),this.updateMinorRadiusEditPoints(),this.updatePointsLayer(),this.updateEllipsesLayer())},Cs.prototype.transformToEllipse=function(){this._minorRadius||(this._minorRadius=this.getMajorRadius(),this.updateMinorRadiusEditPoints(),this.updatePointsLayer(),this.updateEllipsesLayer())},Cs.prototype.addLastPoint=function(e){if(!this.doneCreation&&this._center&&this._majorRadiusPoint){var t=re.distance(this._center.getPosition(),e);this._majorRadiusPoint.setPosition(e),this._majorRadius=t,this.doneCreation=!0,this.options.circleToEllipseTransformation||(this._minorRadius=this._majorRadius),this.updateRotation(),this.updateMinorRadiusEditPoints(),this.updatePointsLayer(),this.updateEllipsesLayer()}},Cs.prototype.movePoint=function(e,t){if(this._center&&this._majorRadiusPoint){var i=re.distance(this._center.getPosition(),e);this.majorRadiusPoint===t?i<this._minorRadius?(this._majorRadius=this._minorRadius,this._majorRadiusPoint.setPosition(re.pointByLocationDistanceAndAzimuth(this.getCenter(),this._minorRadius,this._rotation))):(this.majorRadiusPoint.setPosition(e),this._majorRadius=i):i>this._majorRadius?this._minorRadius=this._majorRadius:this._minorRadius=i,this.updateRotation(),this.updateMinorRadiusEditPoints(),this.updatePointsLayer(),this.updateEllipsesLayer()}},Cs.prototype.moveEllipse=function(e,t){if(this.doneCreation){this.lastDraggedToPosition||(this.lastDraggedToPosition=e);var i=this.getMajorRadius(),n=this.getRotation(),o=re.getPositionsDelta(this.lastDraggedToPosition,t);re.addDeltaToPosition(this.getCenter(),o,!0),this.majorRadiusPoint.setPosition(re.pointByLocationDistanceAndAzimuth(this.getCenter(),i,n)),this.updatePointsLayer(),this.updateMinorRadiusEditPoints(),this.updateEllipsesLayer(),this.lastDraggedToPosition=t}},Cs.prototype.endMoveEllipse=function(){this.lastDraggedToPosition=undefined},Cs.prototype.updateMinorRadiusEditPoints=function(){this._minorRadius!==undefined&&(0===this._minorRadiusPoints.length&&(this._minorRadiusPoints.push(new Ur(this.id,new Cesium.Cartesian3,this.pointProps,!0)),this._minorRadiusPoints.push(new Ur(this.id,new Cesium.Cartesian3,this.pointProps,!0))),this._minorRadiusPoints[0].setPosition(re.pointByLocationDistanceAndAzimuth(this._center.getPosition(),this._minorRadius,this.getRotation()-Math.PI/2)),this._minorRadiusPoints[1].setPosition(re.pointByLocationDistanceAndAzimuth(this._center.getPosition(),this._minorRadius,this.getRotation()+Math.PI/2)))},Cs.prototype.getMajorRadius=function(){return this._majorRadius||0},Cs.prototype.getMinorRadius=function(){return this._minorRadius===undefined?this.getMajorRadius():this._minorRadius},Cs.prototype.getRotation=function(){return this._rotation||0},Cs.prototype.updateRotation=function(){if(!this._majorRadiusPoint)return 0;var e=this.coordinateConverter.bearingToCartesian(this.getCenter(),this._majorRadiusPoint.getPosition());return this._rotation=Cesium.Math.toRadians(e),this._rotation},Cs.prototype.getRotationCallbackProperty=function(){var e=this;return new Cesium.CallbackProperty(function(){return Math.PI/2-e.getRotation()},!1)},Cs.prototype.getMinorRadiusCallbackProperty=function(){var e=this;return new Cesium.CallbackProperty(function(){return e.getMinorRadius()},!1)},Cs.prototype.getMajorRadiusCallbackProperty=function(){var e=this;return new Cesium.CallbackProperty(function(){return e.getMajorRadius()},!1)},Cs.prototype.getCenter=function(){return this._center?this._center.getPosition():undefined},Cs.prototype.getCenterCallbackProperty=function(){var e=this;return new Cesium.CallbackProperty(function(){return e.getCenter()},!1)},Cs.prototype.dispose=function(){var t=this;this._center&&this.pointsLayer.remove(this._center.getId()),this._majorRadiusPoint&&this.pointsLayer.remove(this._majorRadiusPoint.getId()),this._minorRadiusPoints&&this._minorRadiusPoints.forEach(function(e){return t.pointsLayer.remove(e.getId())}),this.ellipsesLayer.remove(this.id)},Cs.prototype.getId=function(){return this.id},Cs.prototype.updateEllipsesLayer=function(){this.ellipsesLayer.update(this,this.id)},Cs.prototype.updatePointsLayer=function(){this._center&&this.pointsLayer.update(this._center,this._center.getId()),this._majorRadiusPoint&&this.pointsLayer.update(this._majorRadiusPoint,this._majorRadiusPoint.getId()),0<this._minorRadiusPoints.length&&(this.pointsLayer.update(this._minorRadiusPoints[0],this._minorRadiusPoints[0].getId()),this.pointsLayer.update(this._minorRadiusPoints[1],this._minorRadiusPoints[1].getId()))},Cs);function Cs(e,t,i,n,o){var r=Ps.call(this)||this;return r.id=e,r.ellipsesLayer=t,r.pointsLayer=i,r.coordinateConverter=n,r.options=o,r._rotation=0,r.doneCreation=!1,r._enableEdit=!0,r._minorRadiusPoints=[],r._labels=[],r._ellipseProps=o.ellipseProps,r._pointProps=o.pointProps,r}var Es=(_s.prototype.createEditableEllipse=function(e,t,i,n,o){var r=new bs(e,t,i,n,o);return this.ellipses.set(e,r),r},_s.prototype.dispose=function(e){this.ellipses.get(e).dispose(),this.ellipses["delete"](e)},_s.prototype.get=function(e){return this.ellipses.get(e)},_s.prototype.clear=function(){this.ellipses.forEach(function(e){return e.dispose()}),this.ellipses.clear()},_s.decorators=[{type:a.Injectable}],_s);function _s(){this.ellipses=new Map}var Ss={addPointEvent:$.LEFT_CLICK,dragPointEvent:$.LEFT_CLICK_DRAG,dragShapeEvent:$.LEFT_CLICK_DRAG,circleToEllipseTransformEvent:$.LEFT_CLICK,circleToEllipseTransformEventModifier:jr.ALT,allowDrag:!0,ellipseProps:{material:Cesium.Color.GREEN.withAlpha(.5),outline:!0,outlineWidth:1,outlineColor:Cesium.Color.BLACK},pointProps:{color:Cesium.Color.WHITE.withAlpha(.9),outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelSize:15,virtualPointPixelSize:8,show:!0,showVirtual:!0},polylineProps:{width:1,material:function(){return Cesium.Color.BLACK}},circleToEllipseTransformation:!1},Ms=(Is.prototype.init=function(e,t,i,n){this.mapEventsManager=e,this.coordinateConverter=t,this.cameraService=i,this.ellipsesManager=n,this.updatePublisher.connect()},Is.prototype.onUpdate=function(){return this.updatePublisher},Is.prototype.create=function(e,r){var s,a=this;void 0===e&&(e=Ss),void 0===r&&(r=100);var p=es(),c=this.setOptions(e),l=new w.BehaviorSubject({id:p,editAction:null,editMode:Hr.CREATE}),u=!1;this.updateSubject.next({id:p,editMode:Hr.CREATE,editAction:Br.INIT,ellipseOptions:c});var t=this.mapEventsManager.register({event:$.MOUSE_MOVE,pick:Z.NO_PICK,priority:r}),i=this.mapEventsManager.register({event:c.addPointEvent,pick:Z.NO_PICK,priority:r});this.observablesMap.set(p,[t,i]);var d=this.createEditorObservable(l,p);return i.subscribe(function(e){var t=e.movement.endPosition;if(!u){var i=a.coordinateConverter.screenToCartesian3(t);if(i)if(s){o={id:p,center:s,updatedPosition:i,editMode:Hr.CREATE,editAction:Br.ADD_LAST_POINT},a.updateSubject.next(o),l.next(_({},o));var n={id:p,center:s,editMode:Hr.CREATE,editAction:Br.CHANGE_TO_EDIT};a.updateSubject.next(n),l.next(_({},o)),a.observablesMap.has(p)&&a.observablesMap.get(p).forEach(function(e){return e.dispose()}),a.observablesMap["delete"](p),a.editEllipse(p,r,l,c,d),u=!0}else{var o={id:p,center:i,editMode:Hr.CREATE,editAction:Br.ADD_POINT};a.updateSubject.next(o),l.next(_({},o)),s=i}}}),t.subscribe(function(e){var t=e.movement.endPosition;if(s){var i=a.coordinateConverter.screenToCartesian3(t);if(i){var n={id:p,center:s,updatedPosition:i,editMode:Hr.CREATE,editAction:Br.MOUSE_MOVE};a.updateSubject.next(n),l.next(_({},n))}}}),d},Is.prototype.edit=function(e,t,i,n,o,r){void 0===i&&(i=Math.PI/2),void 0===o&&(o=Ss),void 0===r&&(r=100);var s=es(),a=this.setOptions(o),p=new w.BehaviorSubject({id:s,editAction:null,editMode:Hr.EDIT}),c={id:s,center:e,majorRadius:t,rotation:i,minorRadius:n,editMode:Hr.EDIT,editAction:Br.INIT,ellipseOptions:a};return this.updateSubject.next(c),p.next(_({},c)),this.editEllipse(s,r,p,a)},Is.prototype.editEllipse=function(d,e,h,y,t){var i,n,m=this,o=this.mapEventsManager.register({event:y.dragPointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return d===e.editedEntityId}});y.circleToEllipseTransformation&&(i=this.mapEventsManager.register({event:y.circleToEllipseTransformEvent,modifier:y.circleToEllipseTransformEventModifier,entityType:bs,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return d===e.id}})),y.allowDrag&&(n=this.mapEventsManager.register({event:y.dragShapeEvent,entityType:bs,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return d===e.id}})),o.pipe(f.tap(function(e){var t=e.movement.drop;return m.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.endPosition,n=t.startPosition,o=t.drop,r=e.entities,s=m.coordinateConverter.screenToCartesian3(n),a=m.coordinateConverter.screenToCartesian3(i);if(a){var p,c=r[0],l=c===m.getCenterPoint(d);if(p=o?l?Br.DRAG_SHAPE_FINISH:Br.DRAG_POINT_FINISH:l?Br.DRAG_SHAPE:Br.DRAG_POINT,y.allowDrag||p!==Br.DRAG_SHAPE&&p!==Br.DRAG_SHAPE_FINISH){var u=_({id:d,updatedPoint:c,startDragPosition:s,endDragPosition:a,editMode:Hr.EDIT,editAction:p},m.getEllipseProperties(d));m.updateSubject.next(u),h.next(_({},u))}else m.cameraService.enableInputs(!0)}}),i&&i.subscribe(function(e){var t=e.movement,i=(t.endPosition,t.startPosition,t.drop,e.entities,_({id:d,editMode:Hr.EDIT,editAction:Br.TRANSFORM},m.getEllipseProperties(d)));m.updateSubject.next(i),h.next(_({},i))}),n&&n.pipe(f.tap(function(e){var t=e.movement.drop;return m.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.startPosition,n=t.endPosition,o=t.drop,r=m.coordinateConverter.screenToCartesian3(i),s=m.coordinateConverter.screenToCartesian3(n);if(s&&r){var a=_({id:d,startDragPosition:r,endDragPosition:s,editMode:Hr.EDIT,editAction:o?Br.DRAG_SHAPE_FINISH:Br.DRAG_SHAPE},m.getEllipseProperties(d));m.updateSubject.next(a),h.next(_({},a))}});var r=[o,i];return n&&r.push(n),i&&r.push(i),this.observablesMap.set(d,r),t||this.createEditorObservable(h,d)},Is.prototype.createEditorObservable=function(e,a){var p=this;return e.dispose=function(){var e=p.observablesMap.get(a);e&&e.forEach(function(e){return e.dispose()}),p.observablesMap["delete"](a),p.updateSubject.next(_({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.DISPOSE},p.getEllipseProperties(a)))},e.enable=function(){p.updateSubject.next(_({id:a,editMode:Hr.EDIT,editAction:Br.ENABLE},p.getEllipseProperties(a)))},e.disable=function(){p.updateSubject.next(_({id:a,editMode:Hr.EDIT,editAction:Br.DISABLE},p.getEllipseProperties(a)))},e.setManually=function(e,t,i,n,o,r,s){p.ellipsesManager.get(a).setManually(e,t,i,n,o,r,s),p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_MANUALLY})},e.setLabelsRenderFn=function(e){p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_EDIT_LABELS_RENDER_CALLBACK,labelsRenderFn:e})},e.updateLabels=function(e){p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.UPDATE_EDIT_LABELS,updateLabels:e})},e.getEditValue=function(){return e.getValue()},e.getLabels=function(){return p.ellipsesManager.get(a).labels},e.getCenter=function(){return p.getCenterPosition(a)},e.getMajorRadius=function(){return p.getMajorRadius(a)},e.getMinorRadius=function(){return p.getMinorRadius(a)},e},Is.prototype.setOptions=function(e){var t=JSON.parse(JSON.stringify(Ss)),i=Object.assign(t,e);return i.pointProps=Object.assign({},Ss.pointProps,e.pointProps),i.ellipseProps=Object.assign({},Ss.ellipseProps,e.ellipseProps),i.polylineProps=Object.assign({},Ss.polylineProps,e.polylineProps),i},Is.prototype.getCenterPosition=function(e){return this.ellipsesManager.get(e).getCenter()},Is.prototype.getCenterPoint=function(e){return this.ellipsesManager.get(e).center},Is.prototype.getMajorRadius=function(e){return this.ellipsesManager.get(e).getMajorRadius()},Is.prototype.getMinorRadius=function(e){return this.ellipsesManager.get(e).getMinorRadius()},Is.prototype.getEllipseProperties=function(e){var t=this.ellipsesManager.get(e);return{center:t.getCenter(),rotation:t.getRotation(),minorRadius:t.getMinorRadius(),majorRadius:t.getMajorRadius(),minorRadiusPointPosition:t.getMinorRadiusPointPosition(),majorRadiusPointPosition:t.getMajorRadiusPointPosition()}},Is.decorators=[{type:a.Injectable}],Is);function Is(){this.updateSubject=new w.Subject,this.updatePublisher=f.publish()(this.updateSubject),this.observablesMap=new Map}var As=(Ls.prototype.startListeningToEditorUpdates=function(){var t=this;this.ellipsesEditor.onUpdate().subscribe(function(e){e.editMode===Hr.CREATE||e.editMode===Hr.CREATE_OR_EDIT?t.handleCreateUpdates(e):e.editMode===Hr.EDIT&&t.handleEditUpdates(e)})},Ls.prototype.getLabelId=function(e,t){return t.toString()},Ls.prototype.renderEditLabels=function(e,t,i){if(t.center=e.getCenter(),t.majorRadius=e.getMajorRadius(),t.minorRadius=e.getMinorRadius(),t.rotation=e.getRotation(),i)return e.labels=i,void this.editEllipsesLayer.update(e,e.getId());this.editLabelsRenderFn&&(e.labels=this.editLabelsRenderFn(t,e.labels),this.editEllipsesLayer.update(e,e.getId()))},Ls.prototype.removeEditLabels=function(e){e.labels=[],this.editEllipsesLayer.update(e,e.getId())},Ls.prototype.handleCreateUpdates=function(e){switch(e.editAction){case Br.INIT:this.ellipsesManager.createEditableEllipse(e.id,this.editEllipsesLayer,this.editPointsLayer,this.coordinateConverter,e.ellipseOptions);break;case Br.MOUSE_MOVE:var t=this.ellipsesManager.get(e.id);e.updatedPosition&&(t.movePoint(e.updatedPosition,t.majorRadiusPoint),this.renderEditLabels(t,e));break;case Br.ADD_POINT:t=this.ellipsesManager.get(e.id),e.center&&(t.addPoint(e.center),this.renderEditLabels(t,e));break;case Br.ADD_LAST_POINT:t=this.ellipsesManager.get(e.id),e.updatedPosition&&(t.addLastPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DISPOSE:t=this.ellipsesManager.get(e.id),this.removeEditLabels(t),this.ellipsesManager.dispose(e.id);break;case Br.SET_EDIT_LABELS_RENDER_CALLBACK:t=this.ellipsesManager.get(e.id),this.editLabelsRenderFn=e.labelsRenderFn,this.renderEditLabels(t,e);break;case Br.UPDATE_EDIT_LABELS:case Br.SET_MANUALLY:t=this.ellipsesManager.get(e.id),this.renderEditLabels(t,e,e.updateLabels);break;default:return}},Ls.prototype.handleEditUpdates=function(e){switch(e.editAction){case Br.INIT:(t=this.ellipsesManager.createEditableEllipse(e.id,this.editEllipsesLayer,this.editPointsLayer,this.coordinateConverter,e.ellipseOptions)).setManually(e.center,e.majorRadius,e.rotation,e.minorRadius,e.ellipseOptions&&e.ellipseOptions.pointProps||undefined,e.ellipseOptions&&e.ellipseOptions.pointProps||undefined,e.ellipseOptions&&e.ellipseOptions.ellipseProps||undefined),this.renderEditLabels(t,e);break;case Br.DRAG_POINT_FINISH:case Br.DRAG_POINT:(t=this.ellipsesManager.get(e.id))&&t.enableEdit&&(t.movePoint(e.endDragPosition,e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE:(t=this.ellipsesManager.get(e.id))&&t.enableEdit&&(t.moveEllipse(e.startDragPosition,e.endDragPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE_FINISH:(t=this.ellipsesManager.get(e.id))&&t.enableEdit&&(t.endMoveEllipse(),this.renderEditLabels(t,e));break;case Br.TRANSFORM:(t=this.ellipsesManager.get(e.id))&&t.enableEdit&&(t.transformToEllipse(),this.renderEditLabels(t,e));break;case Br.DISABLE:(t=this.ellipsesManager.get(e.id))&&(t.enableEdit=!1,this.renderEditLabels(t,e));break;case Br.ENABLE:var t;(t=this.ellipsesManager.get(e.id))&&(t.enableEdit=!0,this.renderEditLabels(t,e));break;default:return}},Ls.prototype.ngOnDestroy=function(){this.ellipsesManager.clear()},Ls.prototype.getPointSize=function(e){return e.isVirtualEditPoint()?e.props.virtualPointPixelSize:e.props.pixelSize},Ls.prototype.getPointShow=function(e){return e.show&&(e.isVirtualEditPoint()?e.props.showVirtual:e.props.show)},Ls.decorators=[{type:a.Component,args:[{selector:"ellipses-editor",template:'\n    <ac-layer #editPointsLayer acFor="let point of editPoints$" [context]="this">\n      <ac-point-desc\n        props="{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editEllipsesLayer acFor="let ellipse of editEllipses$" [context]="this" [zIndex]="0">\n      <ac-ellipse-desc\n        props="{\n        position: ellipse.getCenterCallbackProperty(),\n        semiMajorAxis: ellipse.getMajorRadiusCallbackProperty(),\n        semiMinorAxis: ellipse.getMinorRadiusCallbackProperty(),\n        rotation: ellipse.getRotationCallbackProperty(),\n        material: ellipse.ellipseProps.material,\n        outline: ellipse.ellipseProps.outline,\n        outlineWidth: ellipse.ellipseProps.outlineWidth,\n        outlineColor: ellipse.ellipseProps.outlineColor,\n        height: 0\n    }"\n      >\n      </ac-ellipse-desc>\n\n      <ac-array-desc acFor="let label of ellipse.labels" [idGetter]="getLabelId">\n        <ac-label-primitive-desc\n          props="{\n            position: label.position,\n            text: label.text,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  ',providers:[J,Es],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],Ls.ctorParameters=function(){return[{type:Ms},{type:J},{type:rt},{type:P},{type:Es}]},Ls.propDecorators={editEllipsesLayer:[{type:a.ViewChild,args:["editEllipsesLayer"]}],editPointsLayer:[{type:a.ViewChild,args:["editPointsLayer"]}]},Ls);function Ls(e,t,i,n,o){this.ellipsesEditor=e,this.coordinateConverter=t,this.mapEventsManager=i,this.cameraService=n,this.ellipsesManager=o,this.Cesium=Cesium,this.editPoints$=new w.Subject,this.editEllipses$=new w.Subject,this.ellipsesEditor.init(this.mapEventsManager,this.coordinateConverter,this.cameraService,this.ellipsesManager),this.startListeningToEditorUpdates()}var Ds,ws=(E(Ts,Ds=un),Object.defineProperty(Ts.prototype,"labels",{get:function(){return this._labels},set:function(e){if(e){var i=this.getRealPositions();this._labels=e.map(function(e,t){return e.position||(e.position=i[t]),Object.assign({},Yr,e)})}},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"props",{get:function(){return this.polylineProps},set:function(e){this.polylineProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"pointProps",{get:function(){return this._pointProps},set:function(e){this._pointProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"enableEdit",{get:function(){return this._enableEdit},set:function(t){var i=this;this._enableEdit=t,this.positions.forEach(function(e){e.show=t,i.updatePointsLayer(!1,e)})},enumerable:!0,configurable:!0}),Ts.prototype.createFromExisting=function(e){var t=this;e.forEach(function(e){t.addPointFromExisting(e)}),this.addAllVirtualEditPoints(),this.doneCreation=!0},Ts.prototype.setManually=function(e,t){var i=this;if(!this.doneCreation)throw new Error("Update manually only in edit mode, after polyline is created");this.positions.forEach(function(e){return i.pointsLayer.remove(e.getId())});for(var n=[],o=0;o<e.length;o++){var r=e[o],s=null;s=r.pointProps?new Ur(this.id,r.position,r.pointProps):new Ur(this.id,r,this._pointProps),n.push(s)}this.positions=n,this.polylineProps=t||this.polylineProps,this.updatePointsLayer.apply(this,H([!0],this.positions)),this.addAllVirtualEditPoints()},Ts.prototype.addAllVirtualEditPoints=function(){var s=this,a=H(this.positions);a.forEach(function(e,t){if(t!==a.length-1){var i=e,n=(t+1)%a.length,o=a[n],r=s.setMiddleVirtualPoint(i,o);s.updatePointsLayer(!1,r)}})},Ts.prototype.setMiddleVirtualPoint=function(e,t){var i=Cesium.Cartographic.fromCartesian(e.getPosition()),n=Cesium.Cartographic.fromCartesian(t.getPosition()),o=this.coordinateConverter.midPointToCartesian3(i,n),r=new Ur(this.id,o,this._pointProps);r.setVirtualEditPoint(!0);var s=this.positions.indexOf(e);return this.positions.splice(s+1,0,r),r},Ts.prototype.updateMiddleVirtualPoint=function(e,t,i){var n=Cesium.Cartographic.fromCartesian(t.getPosition()),o=Cesium.Cartographic.fromCartesian(i.getPosition());e.setPosition(this.coordinateConverter.midPointToCartesian3(n,o))},Ts.prototype.changeVirtualPointToRealPoint=function(e){e.setVirtualEditPoint(!1);var t=this.positions.length,i=this.positions.indexOf(e),n=(i+1)%t,o=(i-1+t)%t,r=this.positions[n],s=this.positions[o],a=this.setMiddleVirtualPoint(s,e),p=this.setMiddleVirtualPoint(e,r);this.updatePointsLayer(!1,a,p,e)},Ts.prototype.renderPolylines=function(){var o=this;this.polylines.forEach(function(e){return o.polylinesLayer.remove(e.getId())}),this.polylines=[];var r=this.positions.filter(function(e){return!e.isVirtualEditPoint()});r.forEach(function(e,t){if(t!==r.length-1){var i=r[t+1],n=new Wr(o.id,e.getPosition(),i.getPosition(),o.polylineProps);o.polylines.push(n),o.polylinesLayer.update(n,n.getId())}})},Ts.prototype.addPointFromExisting=function(e){var t=new Ur(this.id,e,this._pointProps);this.positions.push(t),this.updatePointsLayer(!0,t)},Ts.prototype.addPoint=function(e){if(!this.doneCreation){if(!this.positions.length){var t=new Ur(this.id,e,this._pointProps);this.positions.push(t),this.updatePointsLayer(!0,t)}this.movingPoint=new Ur(this.id,e.clone(),this._pointProps),this.positions.push(this.movingPoint),this.updatePointsLayer(!0,this.movingPoint)}},Ts.prototype.movePoint=function(e,t){if(t.setPosition(e),this.doneCreation){t.isVirtualEditPoint()&&this.changeVirtualPointToRealPoint(t);var i=this.positions.length,n=this.positions.indexOf(t);if(n<this.positions.length-1){var o=this.positions[(n+1)%i],r=this.positions[(n+2)%i];this.updateMiddleVirtualPoint(o,t,r),this.updatePointsLayer(!1,o)}if(0<n){var s=this.positions[(n-1+i)%i],a=this.positions[(n-2+i)%i];this.updateMiddleVirtualPoint(s,t,a),this.updatePointsLayer(!1,s)}}this.updatePointsLayer(!0,t)},Ts.prototype.moveTempMovingPoint=function(e){this.movingPoint&&this.movePoint(e,this.movingPoint)},Ts.prototype.moveShape=function(e,t){if(this.doneCreation){this.lastDraggedToPosition||(this.lastDraggedToPosition=e);var i=re.getPositionsDelta(this.lastDraggedToPosition,t);this.positions.forEach(function(e){re.addDeltaToPosition(e.getPosition(),i,!0)}),this.updatePointsLayer.apply(this,H([!0],this.positions)),this.lastDraggedToPosition=t}},Ts.prototype.endMoveShape=function(){this.lastDraggedToPosition=undefined,this.updatePointsLayer.apply(this,H([!0],this.positions))},Ts.prototype.removePoint=function(e){var t=this;this.removePosition(e),this.positions.filter(function(e){return e.isVirtualEditPoint()}).forEach(function(e){return t.removePosition(e)}),this.addAllVirtualEditPoints(),this.renderPolylines()},Ts.prototype.addLastPoint=function(e){this.doneCreation=!0,this.removePosition(this.movingPoint),this.movingPoint=null,this.addAllVirtualEditPoints()},Ts.prototype.getRealPositions=function(){return this.getRealPoints().map(function(e){return e.getPosition()})},Ts.prototype.getRealPoints=function(){var t=this;return this.positions.filter(function(e){return!e.isVirtualEditPoint()&&e!==t.movingPoint})},Ts.prototype.getPositions=function(){return this.positions.map(function(e){return e.getPosition()})},Ts.prototype.removePosition=function(t){var e=this.positions.findIndex(function(e){return e===t});e<0||(this.positions.splice(e,1),this.pointsLayer.remove(t.getId()))},Ts.prototype.updatePointsLayer=function(e){var t=this;void 0===e&&(e=!0);for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];e&&this.renderPolylines(),i.forEach(function(e){return t.pointsLayer.update(e,e.getId())})},Ts.prototype.update=function(){this.updatePointsLayer()},Ts.prototype.dispose=function(){var t=this;this.positions.forEach(function(e){t.pointsLayer.remove(e.getId())}),this.polylines.forEach(function(e){return t.polylinesLayer.remove(e.getId())}),this.movingPoint&&(this.pointsLayer.remove(this.movingPoint.getId()),this.movingPoint=undefined),this.positions.length=0},Ts.prototype.getPointsCount=function(){return this.positions.length},Ts.prototype.getId=function(){return this.id},Ts);function Ts(e,t,i,n,o,r){var s=Ds.call(this)||this;return s.id=e,s.pointsLayer=t,s.polylinesLayer=i,s.coordinateConverter=n,s.editOptions=o,s.positions=[],s.polylines=[],s.doneCreation=!1,s._enableEdit=!0,s._labels=[],s._pointProps=o.pointProps,s.props=o.polylineProps,r&&2<=r.length&&s.createFromExisting(r),s}var Os,Rs=(E(xs,Os=w.Observable),xs);function xs(){return null!==Os&&Os.apply(this,arguments)||this}var js,Ns=(E(Fs,js=Rs),Fs);function Fs(){return null!==js&&js.apply(this,arguments)||this}var ks,Vs=(E(Hs,ks=Rs),Hs);function Hs(){return null!==ks&&ks.apply(this,arguments)||this}var Bs,Gs=(E(Us,Bs=Rs),Us);function Us(){return null!==Bs&&Bs.apply(this,arguments)||this}var zs,Ks=(E(Ws,zs=Rs),Ws);function Ws(){return null!==zs&&zs.apply(this,arguments)||this}var $s,Zs=(E(Ys,$s=Rs),Ys);function Ys(){return null!==$s&&$s.apply(this,arguments)||this}var qs,Xs=(E(Js,qs=un),Object.defineProperty(Js.prototype,"labels",{get:function(){return this._labels},set:function(e){if(e){var i=this.getRealPositions();this._labels=e.map(function(e,t){return e.position||(e.position=i[t]),Object.assign({},Yr,e)})}},enumerable:!0,configurable:!0}),Object.defineProperty(Js.prototype,"hippodromeProps",{get:function(){return this._hippodromeProps},set:function(e){this._hippodromeProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Js.prototype,"defaultPointProps",{get:function(){return this._defaultPointProps},set:function(e){this._defaultPointProps=e},enumerable:!0,configurable:!0}),Object.defineProperty(Js.prototype,"enableEdit",{get:function(){return this._enableEdit},set:function(t){var i=this;this._enableEdit=t,this.positions.forEach(function(e){e.show=t,i.updatePointsLayer(e)})},enumerable:!0,configurable:!0}),Js.prototype.createFromExisting=function(e){var t=this;e.forEach(function(e){t.addPointFromExisting(e)}),this.createHeightEditPoints(),this.updateHippdromeLayer(),this.updatePointsLayer.apply(this,H(this.positions)),this.done=!0},Js.prototype.setPointsManually=function(e,t){var i=this;if(!this.done)throw new Error("Update manually only in edit mode, after polyline is created");this.hippodromeProps.width=t||this.hippodromeProps.width,this.positions.forEach(function(e){return i.pointsLayer.remove(e.getId())}),this.positions=e,this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(e)),this.updateHippdromeLayer()},Js.prototype.addPointFromExisting=function(e){var t=new Ur(this.id,e,this.defaultPointProps);this.positions.push(t),this.updatePointsLayer(t)},Js.prototype.addPoint=function(e){if(!this.done)if(this.positions.length)this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(this.positions)),this.updateHippdromeLayer(),this.done=!0,this.movingPoint=null;else{var t=new Ur(this.id,e,this.defaultPointProps);this.positions.push(t),this.movingPoint=new Ur(this.id,e.clone(),this.defaultPointProps),this.positions.push(this.movingPoint),this.updatePointsLayer(t)}},Js.prototype.createHeightEditPoints=function(){var t=this;this.positions.filter(function(e){return e.isVirtualEditPoint()}).forEach(function(e){return t.removePosition(e)});var e=this.getRealPoints()[0],i=this.getRealPoints()[1],n=Cesium.Cartesian3.lerp(e.getPosition(),i.getPosition(),.5,new Cesium.Cartesian3),o=this.coordinateConverter.bearingToCartesian(e.getPosition(),i.getPosition()),r=Cesium.Math.toRadians(o)-Math.PI/2;this.createMiddleEditablePoint(n,r);var s=Cesium.Math.toRadians(o)+Math.PI/2;this.createMiddleEditablePoint(n,s)},Js.prototype.createMiddleEditablePoint=function(e,t){var i=re.pointByLocationDistanceAndAzimuth(e,this.hippodromeProps.width/2,t,!0),n=new Ur(this.id,i,this.defaultPointProps);n.setVirtualEditPoint(!0),this.positions.push(n)},Js.prototype.movePoint=function(e,t){t.isVirtualEditPoint()?this.changeWidthByNewPoint(e):(t.setPosition(e),this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(this.positions)),this.updateHippdromeLayer())},Js.prototype.changeWidthByNewPoint=function(e){var t=this.getRealPoints()[0],i=this.getRealPoints()[1],n=Cesium.Cartesian3.lerp(t.getPosition(),i.getPosition(),.5,new Cesium.Cartesian3),o=this.coordinateConverter.bearingToCartesian(n,e),r=o;270<o?r=o-270:180<o&&(r=o-180);var s=this.coordinateConverter.bearingToCartesian(t.getPosition(),i.getPosition());180<s&&(s=this.coordinateConverter.bearingToCartesian(i.getPosition(),t.getPosition()));var a=r<s?s-r:r-s;270<o&&(a=o-s);var p=Math.abs(re.distance(n,e)),c=Math.sin(Cesium.Math.toRadians(a))*p;this.hippodromeProps.width=2*Math.abs(c),this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(this.positions)),this.updateHippdromeLayer()},Js.prototype.moveShape=function(e,t){this.lastDraggedToPosition||(this.lastDraggedToPosition=e);var i=re.getPositionsDelta(this.lastDraggedToPosition,t);this.getRealPoints().forEach(function(e){re.addDeltaToPosition(e.getPosition(),i,!0)}),this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(this.positions)),this.updateHippdromeLayer(),this.lastDraggedToPosition=t},Js.prototype.endMoveShape=function(){var t=this;this.lastDraggedToPosition=undefined,this.createHeightEditPoints(),this.positions.forEach(function(e){return t.updatePointsLayer(e)}),this.updateHippdromeLayer()},Js.prototype.endMovePoint=function(){this.createHeightEditPoints(),this.updatePointsLayer.apply(this,H(this.positions))},Js.prototype.moveTempMovingPoint=function(e){this.movingPoint&&this.movePoint(e,this.movingPoint)},Js.prototype.removePoint=function(e){var t=this;this.removePosition(e),this.positions.filter(function(e){return e.isVirtualEditPoint()}).forEach(function(e){return t.removePosition(e)})},Js.prototype.addLastPoint=function(e){this.done=!0,this.removePosition(this.movingPoint),this.movingPoint=null},Js.prototype.getRealPositions=function(){return this.getRealPoints().map(function(e){return e.getPosition()})},Js.prototype.getRealPositionsCallbackProperty=function(){return new Cesium.CallbackProperty(this.getRealPositions.bind(this),!1)},Js.prototype.getRealPoints=function(){return this.positions.filter(function(e){return!e.isVirtualEditPoint()})},Js.prototype.getWidth=function(){return this.hippodromeProps.width},Js.prototype.getPositions=function(){return this.positions.map(function(e){return e.getPosition()})},Js.prototype.removePosition=function(t){var e=this.positions.findIndex(function(e){return e===t});e<0||(this.positions.splice(e,1),this.pointsLayer.remove(t.getId()))},Js.prototype.updatePointsLayer=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e){return t.pointsLayer.update(e,e.getId())})},Js.prototype.updateHippdromeLayer=function(){this.hippodromeLayer.update(this,this.id)},Js.prototype.dispose=function(){var t=this;this.hippodromeLayer.remove(this.id),this.positions.forEach(function(e){t.pointsLayer.remove(e.getId())}),this.movingPoint&&(this.pointsLayer.remove(this.movingPoint.getId()),this.movingPoint=undefined),this.positions.length=0},Js.prototype.getPointsCount=function(){return this.positions.length},Js.prototype.getId=function(){return this.id},Js);function Js(e,t,i,n,o,r){var s=qs.call(this)||this;if(s.id=e,s.pointsLayer=t,s.hippodromeLayer=i,s.coordinateConverter=n,s.positions=[],s.done=!1,s._enableEdit=!0,s._labels=[],s.defaultPointProps=o.pointProps,s.hippodromeProps=o.hippodromeProps,r&&2===r.length)s.createFromExisting(r);else if(r)throw new Error("Hippodrome consist of 2 points but provided "+r.length);return s}var Qs={addPointEvent:$.LEFT_CLICK,addLastPointEvent:$.LEFT_DOUBLE_CLICK,removePointEvent:$.RIGHT_CLICK,dragPointEvent:$.LEFT_CLICK_DRAG,dragShapeEvent:$.LEFT_CLICK_DRAG,allowDrag:!0,pointProps:{color:Cesium.Color.WHITE.withAlpha(.9),outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelSize:15,virtualPointPixelSize:8,show:!0,showVirtual:!0},polylineProps:{material:function(){return Cesium.Color.BLACK},width:3}},ea=(ta.prototype.init=function(e,t,i,n){this.mapEventsManager=e,this.coordinateConverter=t,this.cameraService=i,this.polylinesManager=n,this.updatePublisher.connect()},ta.prototype.onUpdate=function(){return this.updatePublisher},ta.prototype.create=function(e,r){var s=this;void 0===e&&(e=Qs),void 0===r&&(r=100);var a=[],p=es(),c=this.setOptions(e),l=new w.BehaviorSubject({id:p,editAction:null,editMode:Hr.CREATE}),u=!1;this.updateSubject.next({id:p,positions:a,editMode:Hr.CREATE,editAction:Br.INIT,polylineOptions:c});var t=this.mapEventsManager.register({event:$.MOUSE_MOVE,pick:Z.NO_PICK,priority:r}),i=this.mapEventsManager.register({event:c.addPointEvent,pick:Z.NO_PICK,priority:r}),n=this.mapEventsManager.register({event:c.addLastPointEvent,pick:Z.NO_PICK,priority:r});this.observablesMap.set(p,[t,i,n]);var d=this.createEditorObservable(l,p);return t.subscribe(function(e){var t=e.movement.endPosition,i=s.coordinateConverter.screenToCartesian3(t);i&&s.updateSubject.next({id:p,positions:s.getPositions(p),editMode:Hr.CREATE,updatedPosition:i,editAction:Br.MOUSE_MOVE})}),i.subscribe(function(e){var t=e.movement.endPosition;if(!u){var i=s.coordinateConverter.screenToCartesian3(t);if(i){var n=s.getPositions(p);if(!n.find(function(e){return e.equals(i)})){var o={id:p,positions:n,editMode:Hr.CREATE,updatedPosition:i,editAction:Br.ADD_POINT};s.updateSubject.next(o),l.next(_({},o,{positions:s.getPositions(p),points:s.getPoints(p)})),c.maximumNumberOfPoints&&n.length+1===c.maximumNumberOfPoints&&(u=s.switchToEditMode(p,i,l,a,r,c,d,u))}}}}),n.subscribe(function(e){var t=e.movement.endPosition,i=s.coordinateConverter.screenToCartesian3(t);i&&(u=s.switchToEditMode(p,i,l,a,r,c,d,u))}),d},ta.prototype.switchToEditMode=function(e,t,i,n,o,r,s,a){var p={id:e,positions:this.getPositions(e),editMode:Hr.CREATE,updatedPosition:t,editAction:Br.ADD_LAST_POINT};this.updateSubject.next(p),i.next(_({},p,{positions:this.getPositions(e),points:this.getPoints(e)}));var c={id:e,editMode:Hr.CREATE,editAction:Br.CHANGE_TO_EDIT};return this.updateSubject.next(c),i.next(c),this.observablesMap.has(e)&&this.observablesMap.get(e).forEach(function(e){return e.dispose()}),this.observablesMap["delete"](e),this.editPolyline(e,n,o,i,r,s),!0},ta.prototype.edit=function(e,t,i){if(void 0===t&&(t=Qs),void 0===i&&(i=100),e.length<2)throw new Error("Polylines editor error edit(): polyline should have at least 2 positions");var n=es(),o=this.setOptions(t),r=new w.BehaviorSubject({id:n,editAction:null,editMode:Hr.EDIT}),s={id:n,positions:e,editMode:Hr.EDIT,editAction:Br.INIT,polylineOptions:o};return this.updateSubject.next(s),r.next(_({},s,{positions:this.getPositions(n),points:this.getPoints(n)})),this.editPolyline(n,e,i,r,o)},ta.prototype.editPolyline=function(p,e,t,c,i,n){var o,l=this,r=this.mapEventsManager.register({event:i.dragPointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.editedEntityId}}),s=this.mapEventsManager.register({event:i.removePointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.editedEntityId}});i.allowDrag&&(o=this.mapEventsManager.register({event:i.dragShapeEvent,entityType:Wr,pick:Z.PICK_FIRST,priority:t,pickFilter:function(e){return p===e.editedEntityId}})),o&&o.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.startPosition,n=t.endPosition,o=t.drop,r=(e.entities,l.coordinateConverter.screenToCartesian3(n)),s=l.coordinateConverter.screenToCartesian3(i);if(r){var a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,draggedPosition:s,editAction:o?Br.DRAG_SHAPE_FINISH:Br.DRAG_SHAPE};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p)}))}}),r.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.endPosition,n=t.drop,o=e.entities,r=l.coordinateConverter.screenToCartesian3(i);if(r){var s=o[0],a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,updatedPoint:s,editAction:n?Br.DRAG_POINT_FINISH:Br.DRAG_POINT};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p)}))}}),s.subscribe(function(e){var t=e.entities[0],i=H(l.getPositions(p));if(!(i.length<3||i.findIndex(function(e){return t.getPosition().equals(e)})<0)){var n={id:p,positions:i,editMode:Hr.EDIT,updatedPoint:t,editAction:Br.REMOVE_POINT};l.updateSubject.next(n),c.next(_({},n,{positions:l.getPositions(p),points:l.getPoints(p)}))}});var a=[r,s];return o&&a.push(o),this.observablesMap.set(p,a),this.createEditorObservable(c,p)},ta.prototype.setOptions=function(e){var t=JSON.parse(JSON.stringify(Qs)),i=Object.assign(t,e);return i.pointProps=Object.assign({},Qs.pointProps,e.pointProps),i.polylineProps=Object.assign({},Qs.polylineProps,e.polylineProps),i},ta.prototype.createEditorObservable=function(e,i){var n=this;return e.dispose=function(){var e=n.observablesMap.get(i);e&&e.forEach(function(e){return e.dispose()}),n.observablesMap["delete"](i),n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.CREATE_OR_EDIT,editAction:Br.DISPOSE})},e.enable=function(){n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.EDIT,editAction:Br.ENABLE})},e.disable=function(){n.updateSubject.next({id:i,positions:n.getPositions(i),editMode:Hr.EDIT,editAction:Br.DISABLE})},e.setManually=function(e,t){n.polylinesManager.get(i).setManually(e,t),n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_MANUALLY})},e.setLabelsRenderFn=function(e){n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_EDIT_LABELS_RENDER_CALLBACK,labelsRenderFn:e})},e.updateLabels=function(e){n.updateSubject.next({id:i,editMode:Hr.CREATE_OR_EDIT,editAction:Br.UPDATE_EDIT_LABELS,updateLabels:e})},e.getCurrentPoints=function(){return n.getPoints(i)},e.getEditValue=function(){return e.getValue()},e.getLabels=function(){return n.polylinesManager.get(i).labels},e},ta.prototype.getPositions=function(e){return this.polylinesManager.get(e).getRealPositions()},ta.prototype.getPoints=function(e){return this.polylinesManager.get(e).getRealPoints()},ta.decorators=[{type:a.Injectable}],ta);function ta(){this.updateSubject=new w.Subject,this.updatePublisher=f.publish()(this.updateSubject),this.observablesMap=new Map}var ia=(na.prototype.createEditablePolyline=function(e,t,i,n,o,r){var s=new ws(e,t,i,n,o,r);this.polylines.set(e,s)},na.prototype.get=function(e){return this.polylines.get(e)},na.prototype.clear=function(){this.polylines.forEach(function(e){return e.dispose()}),this.polylines.clear()},na.decorators=[{type:a.Injectable}],na);function na(){this.polylines=new Map}var oa=(ra.prototype.startListeningToEditorUpdates=function(){var t=this;this.polylinesEditor.onUpdate().subscribe(function(e){e.editMode===Hr.CREATE||e.editMode===Hr.CREATE_OR_EDIT?t.handleCreateUpdates(e):e.editMode===Hr.EDIT&&t.handleEditUpdates(e)})},ra.prototype.getLabelId=function(e,t){return t.toString()},ra.prototype.renderEditLabels=function(e,t,i){if(t.positions=e.getRealPositions(),t.points=e.getRealPoints(),i)return e.labels=i,void this.polylineLabelsLayer.update(e,e.getId());this.editLabelsRenderFn&&(e.labels=this.editLabelsRenderFn(t,e.labels),this.polylineLabelsLayer.update(e,e.getId()))},ra.prototype.removeEditLabels=function(e){e.labels=[],this.polylineLabelsLayer.remove(e.getId())},ra.prototype.handleCreateUpdates=function(e){switch(e.editAction){case Br.INIT:this.polylinesManager.createEditablePolyline(e.id,this.editPointsLayer,this.editPolylinesLayer,this.coordinateConverter,e.polylineOptions);break;case Br.MOUSE_MOVE:var t=this.polylinesManager.get(e.id);e.updatedPosition&&(t.moveTempMovingPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.ADD_POINT:t=this.polylinesManager.get(e.id),e.updatedPosition&&(t.addPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.ADD_LAST_POINT:t=this.polylinesManager.get(e.id),e.updatedPosition&&(t.addLastPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DISPOSE:(t=this.polylinesManager.get(e.id)).dispose(),this.removeEditLabels(t),this.editLabelsRenderFn=undefined;break;case Br.SET_EDIT_LABELS_RENDER_CALLBACK:t=this.polylinesManager.get(e.id),this.editLabelsRenderFn=e.labelsRenderFn,this.renderEditLabels(t,e);break;case Br.UPDATE_EDIT_LABELS:case Br.SET_MANUALLY:t=this.polylinesManager.get(e.id),this.renderEditLabels(t,e,e.updateLabels);break;default:return}},ra.prototype.handleEditUpdates=function(e){switch(e.editAction){case Br.INIT:this.polylinesManager.createEditablePolyline(e.id,this.editPointsLayer,this.editPolylinesLayer,this.coordinateConverter,e.polylineOptions,e.positions);break;case Br.DRAG_POINT:(t=this.polylinesManager.get(e.id))&&t.enableEdit&&(t.movePoint(e.updatedPosition,e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DRAG_POINT_FINISH:(t=this.polylinesManager.get(e.id))&&t.enableEdit&&e.updatedPoint.isVirtualEditPoint()&&(t.changeVirtualPointToRealPoint(e.updatedPoint),this.renderEditLabels(t,e));break;case Br.REMOVE_POINT:(t=this.polylinesManager.get(e.id))&&t.enableEdit&&(t.removePoint(e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DISABLE:(t=this.polylinesManager.get(e.id))&&(t.enableEdit=!1,this.renderEditLabels(t,e));break;case Br.ENABLE:(t=this.polylinesManager.get(e.id))&&(t.enableEdit=!0,this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE:(t=this.polylinesManager.get(e.id))&&t.enableEdit&&(t.moveShape(e.draggedPosition,e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE_FINISH:var t;(t=this.polylinesManager.get(e.id))&&t.enableEdit&&(t.endMoveShape(),this.renderEditLabels(t,e));break;default:return}},ra.prototype.ngOnDestroy=function(){this.polylinesManager.clear()},ra.prototype.getPointSize=function(e){return e.isVirtualEditPoint()?e.props.virtualPointPixelSize:e.props.pixelSize},ra.prototype.getPointShow=function(e){return e.show&&(e.isVirtualEditPoint()?e.props.showVirtual:e.props.show)},ra.decorators=[{type:a.Component,args:[{selector:"polylines-editor",template:'\n    <ac-layer #editPolylinesLayer acFor="let polyline of editPolylines$" [context]="this">\n      <ac-polyline-primitive-desc\n        props="{\n        positions: polyline.getPositions(),\n        width: polyline.props.width,\n        material: polyline.props.material()\n    }"\n      >\n      </ac-polyline-primitive-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor="let point of editPoints$" [context]="this">\n      <ac-point-desc\n        props="{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #polylineLabelsLayer acFor="let polylineLabels of polylineLabels$" [context]="this">\n      <ac-array-desc acFor="let label of polylineLabels.labels" [idGetter]="getLabelId">\n        <ac-label-primitive-desc\n          props="{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  ',providers:[J,ia],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],ra.ctorParameters=function(){return[{type:ea},{type:J},{type:rt},{type:P},{type:ia}]},ra.propDecorators={editPointsLayer:[{type:a.ViewChild,args:["editPointsLayer"]}],editPolylinesLayer:[{type:a.ViewChild,args:["editPolylinesLayer"]}],polylineLabelsLayer:[{type:a.ViewChild,args:["polylineLabelsLayer"]}]},ra);function ra(e,t,i,n,o){this.polylinesEditor=e,this.coordinateConverter=t,this.mapEventsManager=i,this.cameraService=n,this.polylinesManager=o,this.Cesium=Cesium,this.editPoints$=new w.Subject,this.editPolylines$=new w.Subject,this.polylineLabels$=new w.Subject,this.polylinesEditor.init(this.mapEventsManager,this.coordinateConverter,this.cameraService,o),this.startListeningToEditorUpdates()}var sa=(aa.prototype.createEditableHippodrome=function(e,t,i,n,o,r){var s=new Xs(e,t,i,n,o,r);this.hippodromes.set(e,s)},aa.prototype.get=function(e){return this.hippodromes.get(e)},aa.prototype.clear=function(){this.hippodromes.forEach(function(e){return e.dispose()}),this.hippodromes.clear()},aa.decorators=[{type:a.Injectable}],aa);function aa(){this.hippodromes=new Map}var pa={addPointEvent:$.LEFT_CLICK,dragPointEvent:$.LEFT_CLICK_DRAG,dragShapeEvent:$.LEFT_CLICK_DRAG,allowDrag:!0,hippodromeProps:{material:Cesium.Color.GREEN.withAlpha(.5),width:2e5,outline:!1},pointProps:{color:Cesium.Color.WHITE.withAlpha(.9),outlineColor:Cesium.Color.BLACK,outlineWidth:1,pixelSize:15,virtualPointPixelSize:8,show:!0,showVirtual:!0}},ca=(la.prototype.init=function(e,t,i,n){this.mapEventsManager=e,this.coordinateConverter=t,this.cameraService=i,this.hippodromeManager=n,this.updatePublisher.connect()},la.prototype.onUpdate=function(){return this.updatePublisher},la.prototype.create=function(e,a){var p=this;void 0===e&&(e=pa),void 0===a&&(a=100);var c=es(),l=this.setOptions(e),u=new w.BehaviorSubject({id:c,editAction:null,editMode:Hr.CREATE}),d=!1;this.updateSubject.next({id:c,positions:[],editMode:Hr.CREATE,editAction:Br.INIT,hippodromeOptions:l});var t=this.mapEventsManager.register({event:$.MOUSE_MOVE,pick:Z.NO_PICK,priority:a}),i=this.mapEventsManager.register({event:l.addPointEvent,pick:Z.NO_PICK,priority:a});this.observablesMap.set(c,[t,i]);var h=this.createEditorObservable(u,c);return t.subscribe(function(e){var t=e.movement.endPosition,i=p.coordinateConverter.screenToCartesian3(t);i&&p.updateSubject.next({id:c,positions:p.getPositions(c),editMode:Hr.CREATE,updatedPosition:i,editAction:Br.MOUSE_MOVE})}),i.subscribe(function(e){var t=e.movement.endPosition;if(!d){var i=p.coordinateConverter.screenToCartesian3(t);if(i){var n=p.getPositions(c),o=0===p.getPositions(c).length,r={id:c,positions:n,editMode:Hr.CREATE,updatedPosition:i,editAction:Br.ADD_POINT};if(p.updateSubject.next(r),u.next(_({},r,{positions:p.getPositions(c),points:p.getPoints(c),width:p.getWidth(c)})),!o){var s={id:c,editMode:Hr.CREATE,editAction:Br.CHANGE_TO_EDIT};p.updateSubject.next(s),u.next(s),p.observablesMap.has(c)&&p.observablesMap.get(c).forEach(function(e){return e.dispose()}),p.observablesMap["delete"](c),p.editHippodrome(c,a,u,l,h),d=!0}}}}),h},la.prototype.edit=function(e,t,i){if(void 0===t&&(t=pa),void 0===i&&(i=100),2!==e.length)throw new Error("Hippodrome editor error edit(): polygon should have 2 positions but received "+e);var n=es(),o=this.setOptions(t),r=new w.BehaviorSubject({id:n,editAction:null,editMode:Hr.EDIT}),s={id:n,positions:e,editMode:Hr.EDIT,editAction:Br.INIT,hippodromeOptions:o};return this.updateSubject.next(s),r.next(_({},s,{positions:this.getPositions(n),points:this.getPoints(n),width:this.getWidth(n)})),this.editHippodrome(n,i,r,o)},la.prototype.editHippodrome=function(p,e,c,t,i){var n,l=this;t.allowDrag&&(n=this.mapEventsManager.register({event:t.dragShapeEvent,entityType:Xs,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return p===e.id}}));var o=this.mapEventsManager.register({event:t.dragPointEvent,entityType:Ur,pick:Z.PICK_FIRST,priority:e,pickFilter:function(e){return p===e.editedEntityId}});o.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.endPosition,n=t.drop,o=e.entities,r=l.coordinateConverter.screenToCartesian3(i);if(r){var s=o[0],a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,updatedPoint:s,editAction:n?Br.DRAG_POINT_FINISH:Br.DRAG_POINT};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p),width:l.getWidth(p)}))}}),n&&n.pipe(f.tap(function(e){var t=e.movement.drop;return l.cameraService.enableInputs(t)})).subscribe(function(e){var t=e.movement,i=t.startPosition,n=t.endPosition,o=t.drop,r=(e.entities,l.coordinateConverter.screenToCartesian3(n)),s=l.coordinateConverter.screenToCartesian3(i);if(r){var a={id:p,positions:l.getPositions(p),editMode:Hr.EDIT,updatedPosition:r,draggedPosition:s,editAction:o?Br.DRAG_SHAPE_FINISH:Br.DRAG_SHAPE};l.updateSubject.next(a),c.next(_({},a,{positions:l.getPositions(p),points:l.getPoints(p),width:l.getWidth(p)}))}});var r=[o];return n&&r.push(n),this.observablesMap.set(p,r),this.createEditorObservable(c,p)},la.prototype.setOptions=function(e){var t=JSON.parse(JSON.stringify(pa)),i=Object.assign(t,e);return i.hippodromeProps=Object.assign({},pa.hippodromeProps,e.hippodromeProps),i.pointProps=Object.assign({},pa.pointProps,e.pointProps),i},la.prototype.createEditorObservable=function(e,a){var p=this;return e.dispose=function(){var e=p.observablesMap.get(a);e&&e.forEach(function(e){return e.dispose()}),p.observablesMap["delete"](a),p.updateSubject.next({id:a,positions:p.getPositions(a),editMode:Hr.CREATE_OR_EDIT,editAction:Br.DISPOSE})},e.enable=function(){p.updateSubject.next({id:a,positions:p.getPositions(a),editMode:Hr.EDIT,editAction:Br.ENABLE})},e.disable=function(){p.updateSubject.next({id:a,positions:p.getPositions(a),editMode:Hr.EDIT,editAction:Br.DISABLE})},e.setManually=function(e,t,i,n,o){var r=new Ur(a,e,n||pa.pointProps),s=new Ur(a,t,o||pa.pointProps);p.hippodromeManager.get(a).setPointsManually([r,s],i),p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_MANUALLY})},e.setLabelsRenderFn=function(e){p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.SET_EDIT_LABELS_RENDER_CALLBACK,labelsRenderFn:e})},e.updateLabels=function(e){p.updateSubject.next({id:a,editMode:Hr.CREATE_OR_EDIT,editAction:Br.UPDATE_EDIT_LABELS,updateLabels:e})},e.getCurrentPoints=function(){return p.getPoints(a)},e.getEditValue=function(){return e.getValue()},e.getLabels=function(){return p.hippodromeManager.get(a).labels},e.getCurrentWidth=function(){return p.getWidth(a)},e},la.prototype.getPositions=function(e){return this.hippodromeManager.get(e).getRealPositions()},la.prototype.getPoints=function(e){return this.hippodromeManager.get(e).getRealPoints()},la.prototype.getWidth=function(e){return this.hippodromeManager.get(e).getWidth()},la.decorators=[{type:a.Injectable}],la);function la(){this.updateSubject=new w.Subject,this.updatePublisher=f.publish()(this.updateSubject),this.observablesMap=new Map}var ua=(da.prototype.startListeningToEditorUpdates=function(){var t=this;this.hippodromesEditor.onUpdate().subscribe(function(e){e.editMode===Hr.CREATE||e.editMode===Hr.CREATE_OR_EDIT?t.handleCreateUpdates(e):e.editMode===Hr.EDIT&&t.handleEditUpdates(e)})},da.prototype.getLabelId=function(e,t){return t.toString()},da.prototype.renderEditLabels=function(e,t,i){if(t.positions=e.getRealPositions(),t.points=e.getRealPoints(),i)return e.labels=i,void this.editHippodromesLayer.update(e,e.getId());this.editLabelsRenderFn&&(e.labels=this.editLabelsRenderFn(t,e.labels),this.editHippodromesLayer.update(e,e.getId()))},da.prototype.removeEditLabels=function(e){e.labels=[],this.editHippodromesLayer.update(e,e.getId())},da.prototype.handleCreateUpdates=function(e){switch(e.editAction){case Br.INIT:this.hippodromesManager.createEditableHippodrome(e.id,this.editPointsLayer,this.editHippodromesLayer,this.coordinateConverter,e.hippodromeOptions);break;case Br.MOUSE_MOVE:var t=this.hippodromesManager.get(e.id);e.updatedPosition&&(t.moveTempMovingPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.ADD_POINT:t=this.hippodromesManager.get(e.id),e.updatedPosition&&(t.addPoint(e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DISPOSE:(t=this.hippodromesManager.get(e.id)).dispose(),this.removeEditLabels(t);break;case Br.SET_EDIT_LABELS_RENDER_CALLBACK:t=this.hippodromesManager.get(e.id),this.editLabelsRenderFn=e.labelsRenderFn,this.renderEditLabels(t,e);break;case Br.UPDATE_EDIT_LABELS:case Br.SET_MANUALLY:t=this.hippodromesManager.get(e.id),this.renderEditLabels(t,e,e.updateLabels);break;default:return}},da.prototype.handleEditUpdates=function(e){switch(e.editAction){case Br.INIT:this.hippodromesManager.createEditableHippodrome(e.id,this.editPointsLayer,this.editHippodromesLayer,this.coordinateConverter,e.hippodromeOptions,e.positions);break;case Br.DRAG_POINT:(t=this.hippodromesManager.get(e.id))&&t.enableEdit&&(t.movePoint(e.updatedPosition,e.updatedPoint),this.renderEditLabels(t,e));break;case Br.DRAG_POINT_FINISH:(t=this.hippodromesManager.get(e.id))&&t.enableEdit&&(t.endMovePoint(),this.renderEditLabels(t,e));break;case Br.DISABLE:(t=this.hippodromesManager.get(e.id))&&(t.enableEdit=!1,this.renderEditLabels(t,e));break;case Br.ENABLE:(t=this.hippodromesManager.get(e.id))&&(t.enableEdit=!0,this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE:(t=this.hippodromesManager.get(e.id))&&t.enableEdit&&(t.moveShape(e.draggedPosition,e.updatedPosition),this.renderEditLabels(t,e));break;case Br.DRAG_SHAPE_FINISH:var t;(t=this.hippodromesManager.get(e.id))&&t.enableEdit&&(t.endMoveShape(),this.renderEditLabels(t,e));break;default:return}},da.prototype.ngOnDestroy=function(){this.hippodromesManager.clear()},da.prototype.getPointSize=function(e){return e.isVirtualEditPoint()?e.props.virtualPointPixelSize:e.props.pixelSize},da.prototype.getPointShow=function(e){return e.show&&(e.isVirtualEditPoint()?e.props.showVirtual:e.props.show)},da.decorators=[{type:a.Component,args:[{selector:"hippodrome-editor",template:'\n    <ac-layer #editHippodromesLayer acFor="let hippodrome of editHippodromes$" [context]="this">\n      <ac-corridor-desc\n        props="{\n\t\tpositions: hippodrome.getRealPositionsCallbackProperty(),\n\t\tcornerType: Cesium.CornerType.ROUNDED,\n\t\tmaterial: hippodrome.hippodromeProps.material,\n\t\twidth : hippodrome.hippodromeProps.width,\n\t\toutline: hippodrome.hippodromeProps.outline,\n\t\toutlineColor: hippodrome.hippodromeProps.outlineColor,\n        outlineWidth: hippodrome.hippodromeProps.outlineWidth,\n        height: 0\n\t}"\n      >\n      </ac-corridor-desc>\n\n      <ac-array-desc acFor="let label of hippodrome.labels" [idGetter]="getLabelId">\n        <ac-label-primitive-desc\n          props="{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor="let point of editPoints$" [context]="this">\n      <ac-point-desc\n        props="{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }"\n      >\n      </ac-point-desc>\n    </ac-layer>\n  ',providers:[J,sa],changeDetection:a.ChangeDetectionStrategy.OnPush}]}],da.ctorParameters=function(){return[{type:ca},{type:J},{type:rt},{type:P},{type:sa}]},da.propDecorators={editPointsLayer:[{type:a.ViewChild,args:["editPointsLayer"]}],editHippodromesLayer:[{type:a.ViewChild,args:["editHippodromesLayer"]}]},da);function da(e,t,i,n,o){this.hippodromesEditor=e,this.coordinateConverter=t,this.mapEventsManager=i,this.cameraService=n,this.hippodromesManager=o,this.Cesium=Cesium,this.editPoints$=new w.Subject,this.editHippodromes$=new w.Subject,this.hippodromesEditor.init(this.mapEventsManager,this.coordinateConverter,this.cameraService,o),this.startListeningToEditorUpdates()}var ha=(ya.prototype.setCoordinateConverter=function(e){this.coordinateConverter=e},ya.prototype.drag=function(e,t){var i=this;if(!this.coordinateConverter){var n=this.mapsManager.getMap();n&&(this.coordinateConverter=n.getCoordinateConverter())}this.cancel();var o=document.createElement("img");o.src=e,o.style.position="fixed",o.style.visibility="hidden",o.style.width="30px",o.style.height="30px",o.style["user-drag"]="none",o.style["user-select"]="none",o.style["-moz-user-select"]="none",o.style["-webkit-user-drag"]="none",o.style["-webkit-user-select"]="none",o.style["-ms-user-select"]="none",Object.assign(o.style,t),document.body.appendChild(o),this.createDragObservable(),this.dragObservable.subscribe(function(e){o.style.visibility="visible",o.style.left=e.screenPosition.x-o.clientWidth/2+"px",o.style.top=e.screenPosition.y-o.clientHeight/2+"px",i.mainSubject.next(e),e.drop&&o.remove()},function(e){o.remove()},function(){o.remove()})},ya.prototype.dragUpdates=function(){return this.mainSubject},ya.prototype.cancel=function(){this.stopper&&(this.stopper.next(!0),this.stopper=undefined,this.dragObservable=undefined)},ya.prototype.createDragObservable=function(){var t,i,n,o=this,e=new w.Subject,r=new w.Subject,s=w.fromEvent(document,"pointerup"),a=w.fromEvent(document,"pointermove").pipe(f.map(function(e){return t=t||e.x,i=i||e.y,n={drop:!1,initialScreenPosition:{x:t,y:i},screenPosition:{x:e.x,y:e.y},mapPosition:o.coordinateConverter?o.coordinateConverter.screenToCartesian3({x:e.x,y:e.y}):undefined}}),f.takeUntil(s),f.tap(undefined,undefined,function(){if(n){var e=Object.assign({},n);e.drop=!0,r.next(e)}}));this.dragObservable=a.pipe(f.merge(r),f.takeUntil(e)),this.stopper=e},ya.decorators=[{type:a.Injectable}],ya.ctorParameters=function(){return[{type:undefined,decorators:[{type:a.Inject,args:[s.DOCUMENT]}]},{type:ct}]},ya);function ya(e,t){this.document=e,this.mapsManager=t,this.mainSubject=new w.Subject}var ma=(fa.prototype.ngOnInit=function(){"string"==typeof this.draggableToMap?this.src=this.draggableToMap:(this.src=this.draggableToMap.src,this.style=this.draggableToMap.style)},fa.prototype.onMouseDown=function(){this.iconDragService.drag(this.src,this.style)},fa.decorators=[{type:a.Directive,args:[{selector:"[draggableToMap]"}]}],fa.ctorParameters=function(){return[{type:a.ElementRef},{type:ha}]},fa.propDecorators={draggableToMap:[{type:a.Input}],onMouseDown:[{type:a.HostListener,args:["mousedown"]}]},fa);function fa(e,t){this.iconDragService=t,e.nativeElement.style["user-drag"]="none",e.nativeElement.style["user-select"]="none",e.nativeElement.style["-moz-user-select"]="none",e.nativeElement.style["-webkit-user-drag"]="none",e.nativeElement.style["-webkit-user-select"]="none",e.nativeElement.style["-ms-user-select"]="none"}var ga=(va.prototype.ngOnInit=function(){var t=this;if(this.cesiumService.getMap().getMapContainer().appendChild(this.element.nativeElement),this.allowDrag){var e=w.fromEvent(this.element.nativeElement,"mousedown"),i=w.fromEvent(document,"mousemove"),n=w.fromEvent(document,"mouseup"),o=e.pipe(f.switchMap(function(){return i.pipe(f.takeUntil(n))}));this.subscription=o.subscribe(function(e){t.element.nativeElement.style.left=e.x+"px",t.element.nativeElement.style.top=e.y+"px"})}},va.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},va.decorators=[{type:a.Component,args:[{selector:"ac-toolbar",template:'\n        <div class="{{toolbarClass}}">\n            <div *ngIf="allowDrag">\n                <ac-toolbar-button>\n                    <ac-drag-icon></ac-drag-icon>\n                </ac-toolbar-button>\n            </div>\n\n            <ng-content></ng-content>\n        </div>\n    ',changeDetection:a.ChangeDetectionStrategy.OnPush,styles:["\n        :host {\n            position: absolute;\n            top: 20px;\n            left: 20px;\n            width: 20px;\n            height: 20px;\n            z-index: 999;\n            -webkit-user-drag: none;\n        }\n    "]}]}],va.ctorParameters=function(){return[{type:a.ElementRef},{type:K}]},va.propDecorators={toolbarClass:[{type:a.Input}],allowDrag:[{type:a.Input}]},va);function va(e,t){this.element=e,this.cesiumService=t,this.allowDrag=!0,this.dragStyle={"height.px":20,"width.px":20}}var Pa=(ba.decorators=[{type:a.Component,args:[{selector:"ac-drag-icon",template:'\n        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"  x="0px" y="0px"  height="25"  width="25"\n\t viewBox="0 0 476.737 476.737" style="enable-background:new 0 0 476.737 476.737;" xml:space="preserve">\n<g>\n\t<g>\n\t\t<path style="fill:#010002;" d="M475.498,232.298l-3.401-5.149l-63.565-63.565c-6.198-6.198-16.304-6.198-22.47,0\n\t\t\tc-6.198,6.198-6.198,16.273,0,22.47l36.423,36.423H254.26V54.253l36.423,36.423c6.166,6.198,16.273,6.198,22.47,0\n\t\t\tc6.166-6.198,6.166-16.273,0-22.47L249.588,4.64l-0.159-0.095l-4.99-3.305L238.369,0h-0.064l-6.007,1.24l-4.99,3.305l-0.191,0.095\n\t\t\tl-63.565,63.565c-6.198,6.198-6.198,16.273,0,22.47s16.273,6.198,22.47,0l36.455-36.423v168.225H54.253l36.423-36.423\n\t\t\tc6.198-6.198,6.198-16.273,0-22.47s-16.273-6.198-22.47,0L4.64,227.149l-0.095,0.159l-3.305,4.99L0,238.369v0.064l1.24,6.007\n\t\t\tl3.305,4.958l0.095,0.191l63.565,63.565c6.198,6.198,16.273,6.198,22.47,0c6.198-6.166,6.198-16.273,0-22.47L54.253,254.26\n\t\t\th168.225v168.225l-36.423-36.423c-6.198-6.166-16.273-6.166-22.47,0c-6.198,6.198-6.198,16.304,0,22.47l63.565,63.565l5.149,3.432\n\t\t\tl6.007,1.208h0.064l6.07-1.24l5.149-3.401l63.565-63.565c6.166-6.198,6.166-16.304,0-22.47c-6.198-6.198-16.304-6.198-22.47,0\n\t\t\tl-36.423,36.423V254.26h168.225l-36.423,36.423c-6.166,6.166-6.166,16.273,0,22.47c6.198,6.166,16.304,6.166,22.47,0\n\t\t\tl63.565-63.565l3.432-5.149l1.208-6.007v-0.064L475.498,232.298z"/>\n\t</g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n</svg>\n    '}]}],ba.ctorParameters=function(){return[]},ba);function ba(){}var Ca=(Ea.prototype.ngOnInit=function(){},Ea.decorators=[{type:a.Component,args:[{selector:"ac-toolbar-button",template:'\n        <div (click)="onClick.emit()" class="button-container {{buttonClass}}">\n            <img *ngIf="iconUrl" [src]="iconUrl" class="icon {{iconClass}}"/>\n            <ng-content></ng-content>\n        </div>\n    ',changeDetection:a.ChangeDetectionStrategy.OnPush,styles:["\n        .button-container {\n            border-radius: 1px;\n            background-color: rgba(255, 255, 255, 0.8);\n            height: 30px;\n            width: 30px;\n            padding: 5px;\n            transition: all 0.2s;\n            cursor: pointer;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n        }\n\n        .button-container:hover {\n            background-color: rgba(255, 255, 255, 0.95);\n        }\n\n        .icon {\n            height: 30px;\n            width: 30px;\n        }\n    "]}]}],Ea.ctorParameters=function(){return[]},Ea.propDecorators={iconUrl:[{type:a.Input}],buttonClass:[{type:a.Input}],iconClass:[{type:a.Input}],onClick:[{type:a.Output}]},Ea);function Ea(){this.onClick=new a.EventEmitter}var _a=(Sa.prototype.create=function(e){var p=this,t=void 0===e?{lineEditOptions:{},labelsStyle:{},distanceLabelsStyle:{},bearingLabelsStyle:{}}:e,i=t.lineEditOptions,n=void 0===i?{}:i,o=t.labelsStyle,c=void 0===o?{}:o,r=t.distanceLabelsStyle,l=void 0===r?{}:r,s=t.bearingLabelsStyle,u=void 0===s?{}:s,d=t.bearingStringFn,h=t.distanceStringFn,a=t.labelsRenderFn,y=this.polylineEditor.create(_({allowDrag:!1,pointProps:{showVirtual:!1,pixelSize:8},polylineProps:{width:2}},this.lineEditOptions,n));return a?y.setLabelsRenderFn(a):this.labelsRenderFn?y.setLabelsRenderFn(this.labelsRenderFn):y.setLabelsRenderFn(function(e){var t=e.positions,a=0;return t&&0!==t.length?(e.editMode===Hr.CREATE&&e.editAction!==Br.ADD_LAST_POINT?H(t,[e.updatedPosition]):t).reduce(function(e,t,i,n){if(0!==i){var o=n[i-1],r=p.coordinateConverter.bearingToCartesian(o,t),s=Cesium.Cartesian3.distance(o,t)/1e3;e.push(_({text:d&&d(r)||p.bearingStringFn&&p.bearingStringFn(r)||r.toFixed(2)+"",scale:.2,font:"80px Helvetica",pixelOffset:new Cesium.Cartesian2(-20,-8),position:new Cesium.Cartesian3((t.x+o.x)/2,(t.y+o.y)/2,(t.z+o.z)/2),fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.WHITE,showBackground:!0},p.labelsStyle,c,p.bearingLabelsStyle,u),_({text:h&&h(a+s)||p.distanceStringFn&&p.distanceStringFn(a+s)||(a+s).toFixed(2)+" Km",scale:.2,font:"80px Helvetica",pixelOffset:new Cesium.Cartesian2(-35,-8),position:t,fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.WHITE,showBackground:!0},p.labelsStyle,c,p.distanceLabelsStyle,l)),a+=s}return e},[_({text:h&&h(0)||p.distanceStringFn&&p.distanceStringFn(0)||"0 Km",scale:.2,font:"80px Helvetica",pixelOffset:new Cesium.Cartesian2(-20,-8),position:t[0],fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.WHITE,showBackground:!0},p.labelsStyle,c,p.distanceLabelsStyle,l)]):[]}),y},Sa.decorators=[{type:a.Component,args:[{selector:"range-and-bearing",template:"\n    <polylines-editor></polylines-editor>\n  ",changeDetection:a.ChangeDetectionStrategy.OnPush,providers:[ea]}]}],Sa.ctorParameters=function(){return[{type:ea},{type:J}]},Sa.propDecorators={lineEditOptions:[{type:a.Input}],labelsStyle:[{type:a.Input}],distanceLabelsStyle:[{type:a.Input}],bearingLabelsStyle:[{type:a.Input}],bearingStringFn:[{type:a.Input}],distanceStringFn:[{type:a.Input}],labelsRenderFn:[{type:a.Input}]},Sa);function Sa(e,t){this.polylineEditor=e,this.coordinateConverter=t,this.lineEditOptions={},this.labelsStyle={},this.distanceLabelsStyle={},this.bearingLabelsStyle={}}var Ma=(Ia.prototype.init=function(e,t){this.cameraService=t,this.cesiumService=e},Ia.prototype.activate=function(o,i){var n=this;if(void 0===o&&(o={}),!(this.cameraService&&this.cesiumService||i))throw new Error("The function must receive a mapId if the service wasn't initialized");var e,r,s=Object.assign({},this.defaultOptions,o),a=this.cameraService;if(this.cesiumService&&(e=this.cesiumService.getViewer().container,r=this.cesiumService.getMap()),i){if(!(r=this.mapsManager.getMap(i)))throw new Error("Map not found with id: "+i);a=r.getCameraService(),e=r.getCesiumViewer().container}if(!a||!e)throw new Error("The function must receive a mapId if the service wasn't initialized");this.disable(i);var p=document.createElement("div");e.style.position="relative",p.style.position="absolute",p.style.width="100%",p.style.height="100%",p.style.top="0",p.style.left="0",e.appendChild(p);var c={container:p};this.mapsZoomElements.set(i||this.cesiumService.getMap().getId(),c);var l,u={endX:0,endY:0,startX:0,startY:0};function t(e){e.keyCode===s.resetKeyCode&&l&&(l.remove(),l=undefined,c.borderElement=undefined,u={endX:0,endY:0,startX:0,startY:0})}p.onmousedown=function(e){if(!l){o&&o.onStart&&o.onStart(r);var t=e.currentTarget.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;u.startX=i,u.startY=n,(l=document.createElement("div")).className="zoom-to-rectangle-border",l.style.position="absolute",l.style.border=s.borderStyle,l.style.backgroundColor=s.backgroundColor,l.style.left=u.startX+"px",l.style.top=u.startY+"px",p.appendChild(l),c.borderElement=l}},p.onmouseup=function(e){if(l){var t=n.zoomCameraToRectangle(a,u,s.animationDurationInSeconds);l&&(l.remove(),l=undefined,c.borderElement=undefined),u={endX:0,endY:0,startX:0,startY:0},s.onComplete&&s.onComplete(r),s.autoDisableOnZoom&&t&&n.disable(i)}},p.onmousemove=function(e){if(l){var t=e.currentTarget.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;u.endX=i,u.endY=n,l.style.width=Math.abs(u.endX-u.startX)+"px",l.style.height=Math.abs(u.endY-u.startY)+"px",l.style.left=Math.min(u.startX,u.endX)+"px",l.style.top=Math.min(u.startY,u.endY)+"px"}},document.addEventListener("keydown",t),c.resetOnEscapePressFunc=t},Ia.prototype.disable=function(e){if(!this.cesiumService&&!e)throw new Error("If the service was not initialized with CesiumService, mapId must be provided");var t=this.mapsZoomElements.get(e||this.cesiumService.getMap().getId());t&&(t.container.remove(),t.borderElement&&t.borderElement.remove(),t.resetOnEscapePressFunc&&document.removeEventListener("keydown",t.resetOnEscapePressFunc)),this.mapsZoomElements["delete"](e)},Ia.prototype.zoomCameraToRectangle=function(e,t,i){var n=e.getCamera(),o=n.pickEllipsoid({x:t.startX,y:t.startY}),r=n.pickEllipsoid({x:t.endX,y:t.endY});if(!o||!r)return!1;var s=Cesium.Cartographic.fromCartesian(o),a=Cesium.Cartographic.fromCartesian(r);return e.cameraFlyTo({destination:new Cesium.Rectangle(Math.min(s.longitude,a.longitude),Math.min(s.latitude,a.latitude),Math.max(s.longitude,a.longitude),Math.max(s.latitude,a.latitude)),duration:i}),!0},Ia.decorators=[{type:a.Injectable}],Ia.ctorParameters=function(){return[{type:ct},{type:P,decorators:[{type:a.Optional}]},{type:K,decorators:[{type:a.Optional}]}]},Ia);function Ia(e,t,i){this.mapsManager=e,this.mapsZoomElements=new Map,this.defaultOptions={animationDurationInSeconds:.5,resetKeyCode:27,borderStyle:"2px solid rgba(0,0,0,0.5)",backgroundColor:"rgba(0,0,0,0.2)",autoDisableOnZoom:!0}}var Aa=(La.decorators=[{type:a.NgModule,args:[{imports:[s.CommonModule,wr],declarations:[ua,os,gs,As,oa,ma,Pa,ga,Ca,_a],exports:[ua,os,gs,As,oa,ma,ga,Ca,_a],providers:[ha,Ma]}]}],La);function La(){}e.AngularCesiumModule=wr,e.AcEntity=un,e.AcNotification=hn,e.ActionType=gt,e.MapLayerProviderOptions=yn,e.SceneMode=v,e.KeyboardAction=Be,e.AcMapComponent=ht,e.AcLayerComponent=Mi,e.AcArcDescComponent=cn,e.AcBillboardComponent=wi,e.AcBillboardDescComponent=Bi,e.AcBillboardPrimitiveDescComponent=Wo,e.AcCircleDescComponent=sn,e.AcEllipseDescComponent=zi,e.AcPolylineDescComponent=$i,e.AcPolylinePrimitiveDescComponent=Jo,e.AcLabelComponent=Cn,e.AcLabelDescComponent=en,e.AcLabelPrimitiveDescComponent=Yo,e.AcPolygonDescComponent=Bn,e.AcPolygonComponent=Wn,e.AcPolylineComponent=Sn,e.AcPrimitivePolylineComponent=Sr,e.AcPointComponent=wn,e.AcPointDescComponent=vn,e.AcCircleComponent=jn,e.AcArcComponent=kn,e.AcEllipseComponent=An,e.AcHtmlComponent=On,e.AcMapLayerProviderComponent=mn,e.AcDefaultPlonterComponent=Un,e.AcBoxDescComponent=Mo,e.AcCorridorDescComponent=To,e.AcCylinderDescComponent=Lo,e.AcEllipsoidDescComponent=xo,e.AcPolylineVolumeDescComponent=Fo,e.AcWallDescComponent=Ho,e.AcRectangleDescComponent=Uo,e.AcTileset3dComponent=Eo,e.AcHtmlDescComponent=dr,e.AcArrayDescComponent=vr,e.AcDynamicCircleDescComponent=yo,e.AcDynamicEllipseDescComponent=to,e.AcDynamicPolylineDescComponent=oo,e.AcStaticCircleDescComponent=lo,e.AcStaticEllipseDescComponent=Jn,e.AcStaticPolygonDescComponent=ao,e.AcStaticPolylineDescComponent=go,e.MapEventsManagerService=rt,e.DisposableObservable=Rr,e.CesiumEventModifier=jr,e.CesiumEvent=$,e.PickOptions=Z,e.CesiumService=K,e.CameraService=P,e.CoordinateConverter=J,e.GeoUtilsService=re,e.PlonterService=Qe,e.ViewerConfiguration=U,e.MapsManagerService=ct,e.KeyboardControlService=ze,e.PREDEFINED_KEYBOARD_ACTIONS=Ge,e.ScreenshotService=ut,e.SelectionManagerService=Nr,e.ContextMenuService=Y,e.PixelOffsetPipe=Yi,e.RadiansToDegreesPipe=Xi,e.CesiumHeatMapMaterialCreator=kr,e.AngularCesiumWidgetsModule=Aa,e.EditActions=Br,e.EditModes=Hr,e.EditPoint=Ur,e.EditPolyline=Wr,e.EditArc=as,e.EditablePolygon=qr,e.EditableCircle=ls,e.EditablePolyline=ws,e.EditableEllipse=bs,e.EditorObservable=Rs,e.PolylineEditorObservable=Ns,e.PolygonEditorObservable=Vs,e.CircleEditorObservable=Gs,e.EllipseEditorObservable=Ks,e.defaultLabelProps=Yr,e.HippodromeEditorObservable=Zs,e.EditableHippodrome=Xs,e.PolygonsEditorComponent=os,e.CirclesEditorComponent=gs,e.PolylinesEditorComponent=oa,e.HippodromeEditorComponent=ua,e.EllipsesEditorComponent=As,e.DraggableToMapDirective=ma,e.AcToolbarComponent=ga,e.AcToolbarButtonComponent=Ca,e.RangeAndBearingComponent=_a,e.DEFAULT_POLYGON_OPTIONS=ts,e.PolygonsEditorService=is,e.DEFAULT_CIRCLE_OPTIONS=ys,e.CirclesEditorService=ms,e.DEFAULT_POLYLINE_OPTIONS=Qs,e.PolylinesEditorService=ea,e.DEFAULT_HIPPODROME_OPTIONS=pa,e.HippodromeEditorService=ca,e.DEFAULT_ELLIPSE_OPTIONS=Ss,e.EllipsesEditorService=Ms,e.DraggableToMapService=ha,e.ZoomToRectangleService=Ma,e.cg=Pa,e.cd=ds,e.ce=Es,e.cb=sa,e.cc=Jr,e.cf=ia,e.r=y,e.s=m,e.bt=fr,e.bz=Lr,e.bs=bo,e.bu=Cr,e.by=yr,e.bw=pr,e.bx=cr,e.bv=sr,e.bp=Oi,e.ca=Yn,e.bq=ki,e.u=vt,e.n=pe,e.e=ee,e.c=ge,e.be=gi,e.w=$t,e.x=qt,e.y=Qt,e.o=be,e.z=ii,e.l=_e,e.d=ye,e.f=le,e.bg=_i,e.h=Ie,e.bd=yi,e.v=zt,e.m=De,e.bf=bi,e.p=Oe,e.i=je,e.j=ke,e.ba=ri,e.k=ne,e.bc=ui,e.bi=It,e.bh=_t,e.bn=Bt,e.bj=Ot,e.bm=kt,e.bl=jt,e.bk=Dt,e.bb=pi,e.bo=Ai,e.br=xi,e.t=mt,e.g=Xe,e.q=at,e.b=B,e.a=nn,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-cesium.umd.min.js.map
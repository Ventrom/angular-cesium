{"version":3,"sources":["ng://angular-cesium/lib/angular-cesium/cesium-enhancements/StaticGeometryColorBatch.ts","ng://angular-cesium/lib/angular-cesium/cesium-enhancements/ConfigurationService.ts","ng://angular-cesium/lib/angular-cesium/models/scene-mode.enum.ts","ng://angular-cesium/lib/angular-cesium/services/camera/camera.service.ts","node_modules/tslib/tslib.es6.js","ng://angular-cesium/lib/angular-cesium/services/viewer-factory/viewer-factory.service.ts","ng://angular-cesium/lib/angular-cesium/services/viewer-configuration/viewer-configuration.service.ts","ng://angular-cesium/lib/angular-cesium/services/cesium/cesium.service.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/consts/cesium-event.enum.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/consts/pickOptions.enum.ts","ng://angular-cesium/lib/angular-cesium/services/context-menu/context-menu.service.ts","ng://angular-cesium/lib/angular-cesium/services/coordinate-converter/coordinate-converter.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/basic-drawer/basic-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/primitives-drawer/primitives-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/geo-utils/geo-utils.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/arc-drawer/arc-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/entities-drawer/enums/graphics-type.enum.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/entities-drawer/optimized-entity-collection.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/entities-drawer/entities-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/billboard-drawer/billboard-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/czml-drawer/czml-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/ellipse-drawer/ellipse-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/label-drawer/label-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/point-drawer/point-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/polygon-drawer/polygon-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/polyline-drawer/polyline-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/polyline-primitive-drawer/polyline-primitive-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/models/ac-keyboard-action.enum.ts","ng://angular-cesium/lib/angular-cesium/services/keyboard-control/predefined-actions.ts","ng://angular-cesium/lib/angular-cesium/services/keyboard-control/keyboard-control.service.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/event-observers/cesium-pure-event-observer.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/event-observers/cesium-long-press-observer.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/cesium-event-builder.ts","ng://angular-cesium/lib/angular-cesium/services/plonter/plonter.service.ts","ng://angular-cesium/lib/angular-cesium/utils/utils.service.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/event-observers/cesium-drag-drop-helper.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/map-events-manager.ts","ng://angular-cesium/lib/angular-cesium/services/map-layers/map-layers.service.ts","ng://angular-cesium/lib/angular-cesium/services/maps-manager/maps-manager.service.ts","ng://angular-cesium/lib/angular-cesium/services/screenshot/screenshot.service.ts","ng://angular-cesium/lib/angular-cesium/components/ac-map/ac-map.component.ts","ng://angular-cesium/lib/angular-cesium/services/layer-service/layer-service.service.ts","ng://angular-cesium/lib/angular-cesium/models/action-type.enum.ts","ng://angular-cesium/lib/angular-cesium/services/computation-cache/computation-cache.service.ts","ng://angular-cesium/lib/angular-cesium/utils/checker.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/ellipse-drawer/dynamic-ellipse-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/dynamic-polyline-drawer/dynamic-polyline-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/static-primitive-drawer/static-primitive-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/static-circle-drawer/static-circle-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/static-polyline-drawer/static-polyline-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/static-polygon-drawer/polygon-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/static-dynamic/ellipse-drawer/ellipse-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/model-drawer/model-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/box-dawer/box-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/corridor-dawer/corridor-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/cylinder-dawer/cylinder-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/ellipoid-drawer/ellipsoid-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/polyline-volume-dawer/polyline-volume-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/wall-dawer/wall-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/rectangle-dawer/rectangle-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/label-primitive-drawer/label-primitive-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/billboard-primitive-drawer/billboard-primitive-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/point-primitive-drawer/point-primitive-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/services/drawers/html-drawer/html-drawer.service.ts","ng://angular-cesium/lib/angular-cesium/components/ac-layer/ac-layer.component.ts","ng://angular-cesium/lib/angular-cesium/services/entity-on-map/entity-on-map.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-billboard/ac-billboard.component.ts","ng://angular-cesium/lib/angular-cesium/services/basic-desc/basic-desc.service.ts","ng://angular-cesium/lib/angular-cesium/services/json-mapper/json-mapper.service.ts","ng://angular-cesium/lib/angular-cesium/services/smart-assigner/smart-assigner.service.ts","ng://angular-cesium/lib/angular-cesium/services/cesium-properties/cesium-properties.service.ts","ng://angular-cesium/lib/angular-cesium/components/ac-billborad-desc/ac-billborad-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-ellipse-desc/ac-ellipse-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polyline-desc/ac-polyline-desc.component.ts","ng://angular-cesium/lib/angular-cesium/pipes/pixel-offset/pixel-offset.pipe.ts","ng://angular-cesium/lib/angular-cesium/pipes/radians-to-degrees/radians-to-degrees.pipe.ts","ng://angular-cesium/lib/angular-cesium/components/ac-label-desc/ac-label-desc.component.ts","ng://angular-cesium/lib/angular-cesium/utils/utils.module.ts","ng://angular-cesium/lib/angular-cesium/components/ac-circle-desc/ac-circle-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-arc-desc/ac-arc-desc.component.ts","ng://angular-cesium/lib/angular-cesium/models/ac-entity.ts","ng://angular-cesium/lib/angular-cesium/models/ac-notification.ts","ng://angular-cesium/lib/angular-cesium/models/map-layer-provider-options.enum.ts","ng://angular-cesium/lib/angular-cesium/components/ac-map-layer-provider/ac-map-layer-provider.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-point-desc/ac-point-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-label/ac-label.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polyline/ac-polyline.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-ellipse/ac-ellipse.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-point/ac-point.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-html/ac-html.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-circle/ac-circle.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-arc/ac-arc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polygon-desc/ac-polygon-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-default-plonter/ac-default-plonter.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polygon/ac-polygon.component.ts","ng://angular-cesium/lib/angular-cesium/services/basic-primitive-desc/basic-static-primitive-desc.service.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-static-ellipse-desc/ac-static-ellipse-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-dynamic-ellipse-desc/ac-dynamic-ellipse-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-dynamic-polyline-desc/ac-dynamic-polyline-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-static-polygon-desc/ac-static-polygon-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-static-circle-desc/ac-static-circle-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-dynamic-circle-desc/ac-dynamic-circle-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/static-dynamic/ac-static-polyline-desc/ac-static-polyline-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-model-desc/ac-model-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-3d-tileset/ac-tileset-3d.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-box-desc/ac-box-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-cylinder-desc/ac-cylinder-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-corridor-desc/ac-corridor-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-ellipsoid-desc/ac-ellipsoid-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polyline-volume-desc/ac-polyline-volume-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-wall-desc/ac-wall-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-rectangle-desc/ac-rectangle-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-billboard-primitive-desc/ac-billboard-primitive-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-label-primitive-desc/ac-label-primitive-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-polyline-primitive-desc/ac-polyline-primitive-desc.component.ts","ng://angular-cesium/lib/cesium-extender/primitives/html.ts","ng://angular-cesium/lib/cesium-extender/collections/html.ts","ng://angular-cesium/lib/cesium-extender/extender.ts","ng://angular-cesium/lib/angular-cesium/services/ac-html-manager/ac-html-manager.service.ts","ng://angular-cesium/lib/angular-cesium/directives/ac-html/ac-html.directive.ts","ng://angular-cesium/lib/angular-cesium/components/ac-html-desc/ac-html-desc.component.ts","ng://angular-cesium/lib/angular-cesium/directives/ac-html-container/ac-html-container.directive.ts","ng://angular-cesium/lib/angular-cesium/components/ac-context-menu-wrapper/ac-context-menu-wrapper.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-array-desc/ac-array-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-point-primitive-desc/ac-point-primitive-desc.component.ts","ng://angular-cesium/lib/angular-cesium/components/ac-primitive-polyline/ac-primitive-polyline.component.ts","ng://angular-cesium/lib/angular-cesium/pipes/pipe-config-map.ts","ng://angular-cesium/lib/angular-cesium/components/ac-czml-desc/ac-czml-desc.component.ts","ng://angular-cesium/lib/angular-cesium/angular-cesium.module.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/disposable-observable.ts","ng://angular-cesium/lib/angular-cesium/services/map-events-mananger/consts/cesium-event-modifier.enum.ts","ng://angular-cesium/lib/angular-cesium/services/selection-manager/selection-manager.service.ts","ng://angular-cesium/lib/heatmap/cesium-heatmap-material-creator.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/edit-mode.enum.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/edit-actions.enum.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/edit-point.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/edit-polyline.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/label-props.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editable-polygon.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/polygons-editor/polygons-manager.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/utils.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/polygons-editor/polygons-editor.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/polygons-editor/polygons-editor.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/edit-arc.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editable-circle.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/circles-editor/circles-manager.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/circles-editor/circles-editor.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/circles-editor/circles-editor.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editable-ellipse.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/ellipses-editor/ellipses-manager.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/ellipses-editor/ellipses-editor.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/ellipses-editor/ellipses-editor.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editable-polyline.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editor-observable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/polyline-editor-observable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/polygon-editor-observable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/circle-editor-observable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/ellipse-editor-observable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/hippodrome-editor-oboservable.ts","ng://angular-cesium/lib/angular-cesium-widgets/models/editable-hippodrome.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/polyline-editor/polylines-editor.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/polyline-editor/polylines-manager.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/polylines-editor/polylines-editor.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/hippodrome-editor/hippodrome-manager.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/entity-editors/hippodrome-editor/hippodrome-editor.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/hippodrome-editor/hippodrome-editor.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/draggable-to-map.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/directives/draggable-to-map.directive.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/toolbar/ac-toolbar/ac-toolbar.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/toolbar/ac-toolbar/drag-icon.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/toolbar/ac-toolbar-button/ac-toolbar-button.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/components/range-and-bearing/range-and-bearing.component.ts","ng://angular-cesium/lib/angular-cesium-widgets/services/zoom-to-rectangle.service.ts","ng://angular-cesium/lib/angular-cesium-widgets/angular-cesium-widgets.module.ts"],"names":["AssociativeArray","Cesium","Color","ColorGeometryInstanceAttribute","defined","DistanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","ShowGeometryInstanceAttribute","Primitive","ShadowMode","BoundingSphereState","ColorMaterialProperty","MaterialProperty","Property","colorScratch","distanceDisplayConditionScratch","defaultDistanceDisplayCondition","Batch","primitives","translucent","appearanceType","depthFailAppearanceType","depthFailMaterialProperty","closed","shadows","removeMaterialSubscription","this","depthFailMaterial","undefined","createPrimitive","waitingOnCreate","primitive","oldPrimitive","geometry","updaters","updatersWithAttributes","attributes","subscriptions","showsUpdated","itemsToRemove","invalidated","definitionChanged","addEventListener","prototype","onMaterialChanged","isMaterial","updater","material","updaterMaterial","equals","add","instance","id","set","hasConstantFill","fillMaterialProperty","isConstant","distanceDisplayConditionProperty","that","entity","propertyName","newValue","oldValue","remove","unsubscribe","get","update","time","i","isUpdated","removedCount","geometries","values","geometriesLength","length","geometryItem","originalAttributes","show","value","color","depthFailColor","depthFailAppearance","getValue","asynchronous","geometryInstances","appearance","flat","DISABLED","CAST_ONLY","removeAll","ready","getGeometryInstanceAttributes","colorProperty","resultColor","getValueOrDefault","WHITE","_lastColor","clone","toValue","depthFailColorProperty","depthColor","_lastDepthFailColor","isShowing","isFilled","distanceDisplayCondition","_lastDistanceDisplayCondition","updateShows","contains","getBoundingSphere","result","PENDING","boundingSphere","FAILED","DONE","removeAllPrimitives","wasFixed","destroy","ANGULAR_CESIUM_CONFIG","InjectionToken","ConfigurationService","config","fixEntitiesShadows","fixCesiumEntitiesShadows","StaticGeometryColorBatch","items","createFillGeometryInstance","_solidItems","_translucentItems","item","batch","_primitives","_appearanceType","_depthFailAppearanceType","_closed","_shadows","push","Injectable","Optional","type","Inject","args","SCENE3D","COLUMBUS_VIEW","SCENE2D","PERFORMANCE_SCENE2D","CameraService","isSceneModePerformance2D","init","cesiumService","viewer","getViewer","scene","getScene","screenSpaceCameraController","camera","lastRotate","enableRotate","lastTilt","enableTilt","lastLook","enableLook","_listenToSceneModeMorph","callback","morphListenerCancelFn","morphStart","_revertCameraProperties","getCamera","getScreenSpaceCameraController","getMinimumZoom","minimumZoomDistance","setMinimumZoom","amount","getMaximumZoom","maximumZoomDistance","setMaximumZoom","tilt","rotate","lock","enableTranslate","translate","enableZoom","zoom","enableInputs","inputs","setSceneMode","sceneMode","duration","_this","SceneMode","morphTo3D","morphToColumbusView","morphTo2D","morphCompleteEventListener_1","morphComplete","setView","destination","Cartesian3","fromDegrees","Math","min","PERFORMANCE_2D_ALTITUDE","orientation","pitch","toRadians","bind","cameraFlyTo","options","flyTo","target","zoomIn","defaultZoomAmount","zoomOut","zoomTo","offset","setRotation","degreesInRadians","heading","lockRotation","trackEntity","trackedEntity","Promise","resolve","flyToDuration","altitude","entPosCar3","position","JulianDate","now","entPosCart","Cartographic","fromCartesian","zoomAmount_1","height","flyToPosition","fromRadians","longitude","latitude","complete","setTimeout","untrackEntity","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","create","__assign","assign","t","s","n","arguments","call","apply","__read","o","m","Symbol","iterator","r","e","ar","next","done","error","__spread","concat","ViewerFactory","cesium","createViewer","mapContainer","Viewer","contextOptions","webgl","preserveDrawingBuffer","imageryProvider","createTileMapServiceImageryProvider","url","buildModuleUrl","baseLayerPicker","geocoder","ViewerConfiguration","nextViewerOptionsIndex","nextViewerModifierIndex","defineProperty","_viewerOptions","getNextViewerOptions","_viewerModifier","getNextViewerModifier","CesiumService","ngZone","viewerFactory","viewerConfiguration","map","runOutsideAngular","cesiumViewer","viewerModifier","getCanvas","getMap","NgZone","decorators","MOUSE_MOVE","ScreenSpaceEventType","LEFT_CLICK","LEFT_DOUBLE_CLICK","LEFT_DOWN","LEFT_UP","MIDDLE_CLICK","MIDDLE_DOUBLE_CLICK","MIDDLE_DOWN","MIDDLE_UP","PINCH_START","PINCH_END","PINCH_MOVE","RIGHT_CLICK","RIGHT_DOUBLE_CLICK","RIGHT_DOWN","RIGHT_UP","WHEEL","LONG_LEFT_PRESS","LONG_RIGHT_PRESS","LONG_MIDDLE_PRESS","LEFT_CLICK_DRAG","RIGHT_CLICK_DRAG","MIDDLE_CLICK_DRAG","NO_PICK","PICK_FIRST","PICK_ONE","PICK_ALL","ContextMenuService","_showContextMenu","_contextMenuChangeNotifier","EventEmitter","_onOpen","_onClose","_defaultContextMenuOptions","closeOnLeftCLick","closeOnLeftClickPriority","_options","_position","_content","mapEventsManager","open","content","close","leftClickRegistration","register","event","CesiumEvent","pick","PickOptions","priority","leftClickSubscription","subscribe","emit","dispose","LatLonVectors","geodesy['LatLonVectors']","window","geodesy","CoordinateConverter","screenToCartesian3","screenPos","addMapCanvasBoundsToPos","screenPosition","mapBounds","canvas","getBoundingClientRect","x","left","y","top","pickEllipsoid","Error","screenToCartographic","ellipsoid","cartesian3ToCartographic","cartesian","degreesToCartographic","radiansToCartographic","degreesToUTM","LatLonEllipsoidal","toUtm","UTMToDegrees","zone","hemisphereType","easting","northing","geodesyToCesiumObject","Utm","toLatLonE","geodesyRadians","lon","lat","midPointToCartesian3","first","second","toDeg","rad","toDegrees","firstPoint","secondPoint","middlePoint","midpointTo","middlePointByScreen","position0","position1","screenPosition1","SceneTransforms","wgs84ToWindowCoordinates","screenPosition2","middleScreenPoint","Cartesian2","pickPosition","bearingTo","bearingToCartesian","firstCartesian3","secondCartesian3","firstCart","secondCart","BasicDrawerService","setPropsAssigner","assigner","_propsAssigner","PrimitivesDrawerService","drawerType","_super","_show","tslib_1.__extends","_cesiumCollection","_primitiveCollectionWrap","PrimitiveCollection","destroyPrimitives","cesiumProps","_i","setShow","showValue","getShow","GeoUtilsService","pointByLocationDistanceAndAzimuth","currentLocation","meterDistance","radianAzimuth","deprecated","resultPosition","resultDistance","distance","Ellipsoid","WGS84","maximumRadius","cartographicLocation","cartesianLocation","counter","distanceFactorRangeMax","distanceFactorRangeMin","max","_pointByLocationDistanceAndAzimuth","curLat","curLon","destinationLat","asin","sin","cos","destinationLon","atan2","PI","pos0","pos1","getPositionsDelta","z","addDeltaToPosition","delta","updateReference","cartographic","middleCartesian3Point","screenPositionToCartesian3","ArcDrawerService","PolylineCollection","_calculateArcPositions","quality","pointsArray","point","center","radius","angle","_calculateTriangle","_calculateArc","arcPoints","drawEdges","positions","Material","fromType","uniforms","constantColor","width","ellipse","EllipseGraphics","EllipsoidGraphics","polygon","PolygonGraphics","polyline","PolylineGraphics","polylineVolume","PolylineVolumeGraphics","box","BoxGraphics","corridor","CorridorGraphics","cylinder","CylinderGraphics","label","LabelGraphics","billboard","BillboardGraphics","model","ModelGraphics","path","PathGraphics","PointGraphics","rectangle","RectangleGraphics","wall","WallGraphics","OptimizedEntityCollection","entityCollection","collectionSize","updateRate","_isSuspended","_isHardSuspend","_updateRate","_collectionSize","collection","isFree","suspend","removeNoSuspend","onEventSuspension","once","_onEventSuspensionCallback","onEventResume","_onEventResumeCallback","triggerEventResume","triggerEventSuspension","suspendEvents","_suspensionTimeout","resumeEvents","hardSuspend","hardResume","EntitiesDrawerService","graphicsType","defaultOptions","collectionMaxSize","collectionSuspensionTime","collectionsNumber","entityCollections","Map","graphicsTypeName","GraphicsType","getFreeEntitiesCollection","freeEntityCollection","forEach","finalOptions","dataSources","dataSource","CustomDataSource","entities","optimizedEntityCollection","entityObject","_a","description","viewFrom","name","suspendEntityCollection","CallbackProperty","_isConstant","has","BillboardDrawerService","CzmlDrawerService","czmlStream","CzmlDataSource","process","czmlPacket","removeById","acEntity","EllipseDrawerService","LabelDrawerService","PointDrawerService","PolygonDrawerService","PolylineDrawerService","PolylinePrimitiveDrawerService","withColorMaterial","cesiumObject","CAMERA_FORWARD","CAMERA_BACKWARD","CAMERA_RIGHT","CAMERA_LEFT","CAMERA_UP","CAMERA_DOWN","CAMERA_LOOK_RIGHT","CAMERA_LOOK_LEFT","CAMERA_LOOK_UP","CAMERA_LOOK_DOWN","CAMERA_TWIST_RIGHT","CAMERA_TWIST_LEFT","CAMERA_ROTATE_RIGHT","CAMERA_ROTATE_LEFT","CAMERA_ROTATE_UP","CAMERA_ROTATE_DOWN","CAMERA_ZOOM_IN","CAMERA_ZOOM_OUT","PREDEFINED_KEYBOARD_ACTIONS","KeyboardAction","params","moveRate","globe","cartesianToCartographic","moveForward","moveBackward","moveUp","moveDown","moveRight","moveLeft","currentPosition","positionCartographic","lookFactor","lookRight","lookLeft","lookUp","lookDown","twistRight","twistLeft","rotateRight","rotateLeft","rotateUp","rotateDown","IGNORED","NOT_PRESSED","PRESSED","KeyboardControlService","document","_currentDefinitions","_activeDefinitions","_keyMappingFn","defaultKeyMappingFn","focus","handleKeydown","handleKeyup","handleTick","setKeyboardControls","definitions","keyMappingFn","outsideOfAngularZone","removeKeyboardControls","registerEvents","keys","key","state","KeyEventState","action","keyboardEvent","unregisterEvents","getAction","char","keyEvent","String","fromCharCode","keyCode","execute","getParams","validation","actionState","executeAction","paramsDef","execution","isNumber","predefinedAction","registerToEvents","clock","onTick","removeEventListener","DOCUMENT","CesiumPureEventObserver","modifier","eventsHandler","observer","Observable","setInputAction","movement","startPosition","endPosition","CesiumLongPressObserver","eventFactory","startEvent","stopEvent","startEventObservable","stopEventObservable","publish","pipe","mergeMap","observableOf","delay","LONG_PRESS_EVENTS_DURATION","takeUntil","CesiumEventBuilder","cesiumEventsObservables","getEventFullName","toString","screenSpaceEventHandler","eventName","eventObserver","createCesiumEventObservable","cesiumEventObservable","longPressEvents","createSpecialCesiumEventObservable","connect","Set","PlonterService","_entitesToPlonter","_plonterChangeNotifier","_plonterObserver","Subject","_plonterShown","_eventResult","plonterIt","eventResult","resolvePlonter","UtilsService","array","reduce","accumulator","currentValue","indexOf","CesiumDragDropHelper","getDragEventTypes","dragEvent","mouseDownEvent","mouseUpEvent","dragEvents","Registration","observable","stopper","isPaused","MapEventsManagerService","eventBuilder","plonterService","eventRegistrations","input","entityType","eventRegistration","createEventRegistration","pickFilter","registrationObservable","disposeObservable","sortRegistrationsByPriority","registrations","index","splice","sort","a","currentPriority","registration","pickOption","createDragEvent","filter","triggerPick","cesiumEntities","picksAndMovement","addEntities","switchMap","entitiesAndMovement","plonter","mouseUpObservable","mouseMoveObservable","mouseDownRegistration","dropSubject","dragObserver","lastMove","dragStartPositionX","dragStartPositionY","drop","tap","dropEvent","merge","pickOptions","picks","drillPick","Entity","MapLayersService","layersDataSources","registerLayerDataSources","zIndex","ds","drawAllLayers","updateAndRefresh","newZIndex","removeDataSources","MapsManagerService","defaultIdCounter","_Maps","eventRemoveCallbacks","firstMap","_registerMap","acMap","mapId","generateDefaultId","_removeMapById","iter","delete","sync2DMapsCameras","mapsConfiguration","unsyncMapsCameras","maps","sensitivity","bindZoom","masterMapConfig","masterMap","masterCamera","getCameraService","masterCameraCartographic","percentageChanged","removeCallback","changed","slaveMapConfig","slaveMap","slaveMapOptions","slaveCamera","slaveCameraCartographic","cartographicToCartesian","getCesiumViewer","mode","MORPHING","ScreenshotService","getMapScreenshotDataUrlBase64","toDataURL","downloadMapScreenshot","filename","dataUrl","downloadURI","uri","link","createElement","download","href","body","appendChild","click","removeChild","AcMapComponent","_cesiumService","_cameraService","_elemRef","mapsManagerService","billboardDrawerService","labelDrawerService","ellipseDrawerService","polylineDrawerService","polygonDrawerService","arcDrawerService","pointDrawerService","czmlDrawerService","keyboardControlService","mapLayersService","configurationService","screenshotService","contextMenuService","coordinateConverter","disableDefaultPlonter","style","className","ngOnInit","containerId","nativeElement","ngOnChanges","changes","firstChange","element","getElementById","ngAfterViewInit","ngOnDestroy","getCesiumSerivce","getId","getMapContainer","getMapEventsManager","getContextMenuService","getScreenshotService","getKeyboardControlService","getCoordinateConverter","Component","selector","template","providers","ElementRef","Input","LayerService","_cache","descriptions","layerUpdate","_zIndex","_context","context","setEntityName","_entityName","getEntityName","registerDescription","descriptionComponent","unregisterDescription","getDescriptions","layerUpdates","ADD_UPDATE","DELETE","ComputationCache","expression","insertFn","clear","Checker","throwIfAnyNotPresent","propertyNames","throwIfNotPresent","present","DynamicEllipseDrawerService","EllipsePrimitive","updateLocationData","DynamicPolylineDrawerService","StaticPrimitiveDrawer","geometryType","geometryProps","instanceProps","primitiveProps","GeometryInstance","StaticCircleDrawerService","CircleGeometry","StaticPolylineDrawerService","PolylineGeometry","when","readyPromise","then","readyPrimitive","StaticPolygonDrawerService","PolygonGeometry","StaticEllipseDrawerService","EllipseGeometry","ModelDrawerService","BoxDrawerService","CorridorDrawerService","CylinderDrawerService","EllipsoidDrawerService","PolylineVolumeDrawerService","WallDrawerService","RectangleDrawerService","LabelPrimitiveDrawerService","LabelCollection","BillboardPrimitiveDrawerService","BillboardCollection","PointPrimitiveDrawerService","PointPrimitiveCollection","HtmlDrawerService","HtmlCollection","AcLayerComponent","layerService","_computationCache","modelDrawerService","boxDrawerService","corridorDrawerService","cylinderDrawerService","ellipsoidDrawerSerice","polylineVolumeDrawerService","wallDrawerService","rectangleDrawerService","dynamicEllipseDrawerService","dynamicPolylineDrawerService","staticCircleDrawerService","staticPolylineDrawerService","staticPolygonDrawerService","staticEllipseDrawerService","polylinePrimitiveDrawerService","labelPrimitiveDrawerService","billboardPrimitiveDrawerService","pointPrimitiveDrawerService","htmlDrawerService","store","acForRgx","stopObservable","_updateStream","entitiesStore","layerDrawerDataSources","_drawerList","initValidParams","observableMerge","notification","contextEntity","updateStore","entityName","actionType","ActionType","draw","console","test","acFor","acForArr","split","isObservable","obj","ngAfterContentInit","drawer","drawerName","initOptions","drawerDataSources","showValue_1","zIndexValue","getLayerService","getLayerDrawerDataSources","getDrawerDataSourcesByName","getStore","entityId","updateNotification","refreshAll","observableFrom","changeDetection","ChangeDetectionStrategy","OnPush","EntityOnMapComponent","_drawer","mapLayers","selfPrimitiveIsDraw","drawOnMap","props","previousValue","updateOnMap","selfPrimitive","removeFromMap","AcBillboardComponent","billboardDrawer","BasicDesc","_layerService","_cesiumProperties","onDraw","onRemove","_cesiumObjectsMap","_propsEvaluator","_propsEvaluateFn","_getPropsAssigner","desc","_propsAssignerFn","setLayerService","createEvaluator","cache","createAssigner","getCesiumObjectsMap","cesiumEntity","Output","JsonMapper","_mapper","JsonStringMapper","SmartAssigner","allowUndefined","fnBody","prop","assignFn","Function","obj1","obj2","CesiumProperties","_parser","_jsonMapper","_assignersCache","_evaluatorsCache","_compile","withCache","cesiumDesc","propsMap","resultExpression","eval","JSON","stringify","replace","getFn","_build","from","smartAssigner","oldVal","newVal","newEvaluator","evaluatorFn","Parse","AcBillboardDescComponent","computationCache","cesiumProperties","provide","useExisting","forwardRef","AcEllipseDescComponent","ellipseDrawer","AcPolylineDescComponent","PixelOffsetPipe","transform","Pipe","RadiansToDegreesPipe","round","AcLabelDescComponent","labelDrawer","UtilsModule","NgModule","imports","CommonModule","AcCircleDescComponent","semiMajorAxis","semiMinorAxis","AcArcDescComponent","arcDrawer","AcEntity","json","AcNotification","ArcGisMapServer","ArcGisMapServerImageryProvider","WebMapTileService","WebMapTileServiceImageryProvider","MapTileService","WebMapService","WebMapServiceImageryProvider","SingleTileImagery","SingleTileImageryProvider","OpenStreetMap","createOpenStreetMapImageryProvider","BingMaps","BingMapsImageryProvider","GoogleEarthEnterpriseMaps","GoogleEarthEnterpriseMapsProvider","MapBox","MapboxImageryProvider","UrlTemplateImagery","UrlTemplateImageryProvider","OFFLINE","AcMapLayerProviderComponent","provider","MapLayerProviderOptions","alpha","brightness","contrast","imageryLayersCollection","imageryLayers","createOfflineMapProvider","layerProvider","log","imageryLayer","addImageryProvider","isFirstChange","AcPointDescComponent","AcLabelComponent","AcPolylineComponent","polylineDrawer","AcEllipseComponent","AcPointComponent","pointDrawer","AcHtmlComponent","elementRef","renderer","isDraw","setScreenPosition","setStyle","hideElement","preRender","preRenderEventListener","ngDoCheck","Renderer2","AcCircleComponent","updateEllipseProps","rotation","AcArcComponent","AcPolygonDescComponent","polygonDrawer","AcDefaultPlonterComponent","cd","geoConverter","plonterChangeNotifier","detectChanges","plonterShown","plonterClickPosition","chooseEntity","ChangeDetectorRef","AcPolygonComponent","BasicStaticPrimitiveDesc","_staticPrimitiveDrawer","_geometryPropsEvaluator","_instancePropsEvaluator","_primitivePropsEvaluator","AcStaticEllipseDescComponent","AcDynamicEllipseDescComponent","AcDynamicPolylineDescComponent","AcStaticPolygonDescComponent","AcStaticCircleDescComponent","staticCircleDrawer","AcDynamicCircleDescComponent","AcStaticPolylineDescComponent","AcModelDescComponent","modelDrawer","AcTileset3dComponent","tilesetInstance","_3dtilesCollection","Cesium3DTileset","Cesium3DTileStyle","AcBoxDescComponent","drawerService","AcCylinderDescComponent","AcCorridorDescComponent","AcEllipsoidDescComponent","AcPolylineVolumeDescComponent","AcWallDescComponent","AcRectangleDescComponent","AcBillboardPrimitiveDescComponent","billboardPrimitiveDrawer","AcLabelPrimitiveDescComponent","labelPrimitiveDrawer","AcPolylinePrimitiveDescComponent","HtmlPrimitive","_mapContainer","pixelOffset","_scene","_element","display","_pixelOffset","Number","MAX_VALUE","_collection","_lastPosition","html","len","pop","CesiumExtender","extend","AcHtmlManager","_entities","addOrUpdate","info","AcHtmlContext","AcHtmlDirective","_templateRef","_viewContainerRef","_changeDetector","_acHtmlManager","_views","_handleView","$implicit","viewRef","createEmbeddedView","Directive","TemplateRef","ViewContainerRef","AcHtmlDescComponent","htmlDrawer","acHtmlCreator","acHtmlTemplate","ViewChild","ContentChild","AcHtmlContainerDirective","_id","AcContextMenuWrapperComponent","componentFactoryResolver","contextMenuChangeSubscription","contextMenuChangeNotifier","contextMenuOpenSubscription","onOpen","componentFactory","resolveComponentFactory","viewContainerRef","createComponent","data","ComponentFactoryResolver","read","AcArrayDescComponent","entitiesMap","arrayObservable$","acForString","arrayPath","layer","layerServiceSubscription","basicDescs","_results","component","arrayDescs","entitiesArray","_get","previousEntitiesIdArray","entitiesIdArray","arrayItemId","generateCombinedId","entitiesToRemove","idGetter","getAcForString","arrayItem","MAX_SAFE_INTEGER","ContentChildren","descendants","AcPointPrimitiveDescComponent","AcPrimitivePolylineComponent","PARSE_PIPES_CONFIG_MAP","pipeName","pipeInstance","AcCzmlDescComponent","czmlDrawer","AngularCesiumModule","forRoot","ngModule","useValue","PIPES_CONFIG","multi","customPipes","Angular2ParseModule","declarations","exports","DisposableObservable","ALT","KeyboardEventModifier","CTRL","SHIFT","SelectionManagerService","mapsManager","selectedEntitiesItems$","BehaviorSubject","selectedEntitySubject$","selectedEntities$","asObservable","selectedEntities","selectedEntity$","toggleSelection","addSelectedIndicator","addToSelected","removeSelected","current","entityIndex","initSelection","selectionOptions","eventPriority","mapComponent","mapEventsManagerService","h337","CesiumHeatMapMaterialCreator","heatmapOptionsDefaults","minCanvasSize","maxCanvasSize","radiusFactor","spacingFactor","maxOpacity","minOpacity","blur","gradient",".3",".65",".8",".95","WMP","WebMercatorProjection","wgs84PointToHeatmapPoint","mercatorPointToHeatmapPoint","wgs84ToMercator","rad2deg","calcCircleContainingRect","calcEllipseContainingRect","ellipsePoints","Rectangle","fromCartesianArray","calculateContainingRectFromPoints","points","setData","heatmap","setWGS84Data","convdata","gp","hp","pn","_xoffset","_factor","_spacing","_yoffset","createContainer","containerCanvasCounter","container","setAttribute","mp","project","wgs84ToMercatorBB","bb","sw","west","south","ne","east","north","mercatorToWgs84BB","unproject","setWidthAndHeight","mbb","abs","containingBoundingRect","heatmapDataSet","heatmapOptions","userBB","heatPointsData","finalHeatmapOptions","_mbounds","bounds","_rectangle","_c","h337.create","heatMapCanvas","_renderer","heatMapMaterial","ImageMaterialProperty","image","transparent","setClear","elem","parentNode","CREATE","EDIT","CREATE_OR_EDIT","INIT","ADD_POINT","ADD_LAST_POINT","CHANGE_TO_EDIT","REMOVE_POINT","DRAG_POINT","DRAG_POINT_FINISH","DRAG_SHAPE","DRAG_SHAPE_FINISH","DISABLE","ENABLE","DISPOSE","SET_EDIT_LABELS_RENDER_CALLBACK","UPDATE_EDIT_LABELS","SET_MANUALLY","TRANSFORM","EditPoint","pointProps","virtualPoint","editedEntityId","generateId","_virtualEditPoint","isVirtualEditPoint","setVirtualEditPoint","getEditedEntityId","getPosition","setPosition","EditPolyline","polylineProps","_polylineProps","getPositions","validatePositions","getStartPosition","getEndPosition","setStartPosition","setEndPosition","defaultLabelProps","backgroundColor","backgroundPadding","eyeOffset","fillColor","font","heightReference","HeightReference","NONE","horizontalOrigin","HorizontalOrigin","LEFT","outlineColor","BLACK","outlineWidth","ZERO","pixelOffsetScaleByDistance","scale","scaleByDistance","showBackground","LabelStyle","FILL","text","translucencyByDistance","verticalOrigin","VerticalOrigin","BASELINE","EditablePolygon","polygonsLayer","pointsLayer","polylinesLayer","polygonOptions","polylines","doneCreation","_enableEdit","_labels","polygonProps","defaultPointProps","defaultPolylineProps","createFromExisting","labels","getRealPositions","_defaultPolylineProps","_defaultPointProps","_polygonProps","updatePointsLayer","addPointFromExisting","addAllVirtualEditPoints","updatePolygonsLayer","setPointsManually","newPoints","pointOrCartesian","newPoint","currentPoints","pos","currentPoint","nextIndex","nextPoint","midPoint","setMiddleVirtualPoint","firstP","secondP","currentCart","nextCart","midPointCartesian3","firstIndex","updateMiddleVirtualPoint","virtualEditPoint","prevPoint","prevPointCart","nextPointCart","changeVirtualPointToRealPoint","pointsCount","pointIndex","preIndex","prePoint","firstMidPoint","secMidPoint","renderPolylines","realPoints","addPoint","movingPoint","movePoint","toPosition","editPoint","nextVirtualPoint","nextRealPoint","prevVirtualPoint","prevRealPoint","moveTempMovingPoint","movePolygon","startMovingPosition","draggedToPosition","lastDraggedToPosition","endMovePolygon","removePoint","pointToRemove","removePosition","getPointsCount","addLastPoint","getRealPoints","getPositionsHierarchy","getPositionsHierarchyCallbackProperty","findIndex","line","PolygonsManagerService","polygons","createEditablePolygon","editPolygonsLayer","editPointsLayer","editPolylinesLayer","editablePolygon","generateKey","possible","charAt","floor","random","DEFAULT_POLYGON_OPTIONS","addPointEvent","addLastPointEvent","removePointEvent","dragPointEvent","dragShapeEvent","allowDrag","withAlpha","pixelSize","virtualPointPixelSize","showVirtual","PolygonsEditorService","updateSubject","updatePublisher","observablesMap","cameraService","polygonsManager","onUpdate","setOptions","clientEditSubject","editAction","editMode","EditModes","finishedCreate","EditActions","mouseMoveRegistration","addPointRegistration","addLastPointRegistration","editorObservable","createEditorObservable","updatedPosition","allPositions","find","updateValue","getPoints","maximumNumberOfPoints","switchToEditMode","changeMode","editPolygon","edit","editSubject","editObservable","shapeDragRegistration","pointDragRegistration","pointRemoveRegistration","_b","updatedPoint","endDragPosition","startDragPosition","draggedPosition","observables","warn","defaultClone","parse","observableToExtend","obs","enable","disable","setManually","setLabelsRenderFn","labelsRenderFn","updateLabels","getCurrentPoints","getEditValue","getLabels","PolygonsEditorComponent","polygonsEditor","editPoints$","editPolylines$","editPolygons$","PerInstanceColorAppearance","fromColor","polygonColor","lineColor","startListeningToEditorUpdates","handleCreateUpdates","handleEditUpdates","getLabelId","renderEditLabels","editLabelsRenderFn","removeEditLabels","enableEdit","getPointSize","getPointShow","EditArc","_arcProps","_center","_radius","_delta","_angle","updateCenter","EditableCircle","circlesLayer","arcsLayer","_circleProps","circleProps","_pointProps","_radiusPoint","radiusPoint","centerPointProp","radiusPointProp","circleProp","_outlineArc","getRadius","createOutlineArc","updateArcsLayer","updateCirclesLayer","moveCircle","dragStartPosition","dragEndPosition","getCenter","getRadiusCallbackProperty","getCenterCallbackProperty","getRadiusPoint","CirclesManagerService","circles","createEditableCircle","editCirclesLayer","editArcsLayer","circleOptions","editableCircle","circle","DEFAULT_CIRCLE_OPTIONS","GREEN","outline","CirclesEditorService","circlesManager","getCircleProperties","editCircle","pointIsCenter","getCenterPoint","getCenterPosition","getRadiusPosition","CirclesEditorComponent","circlesEditor","editCircles$","editArcs$","EditableEllipse","ellipsesLayer","_rotation","_minorRadiusPoints","_ellipseProps","ellipseProps","_majorRadiusPoint","midpoint","_minorRadius","getMinorRadiusPointPosition","getMajorRadiusPointPosition","majorRadius","minorRadius","ellipseProp","_majorRadius","majorRadiusPosition","updateMinorRadiusEditPoints","updateEllipsesLayer","updateRotation","transformToEllipse","getMajorRadius","newRadius","circleToEllipseTransformation","majorRadiusPoint","moveEllipse","getRotation","endMoveEllipse","getMinorRadius","azimuthInDegrees","getRotationCallbackProperty","getMinorRadiusCallbackProperty","getMajorRadiusCallbackProperty","EllipsesManagerService","ellipses","createEditableEllipse","editEllipsesLayer","ellipseOptions","editableEllipse","DEFAULT_ELLIPSE_OPTIONS","circleToEllipseTransformEvent","circleToEllipseTransformEventModifier","CesiumEventModifier","EllipsesEditorService","ellipsesManager","editEllipse","addSecondRadiusRegistration","getEllipseProperties","minorRadiusPointPosition","majorRadiusPointPosition","EllipsesEditorComponent","ellipsesEditor","editEllipses$","EditablePolyline","editOptions","moveShape","endMoveShape","EditorObservable","PolylineEditorObservable","PolygonEditorObservable","CircleEditorObservable","EllipseEditorObservable","HippodromeEditorObservable","EditableHippodrome","hippodromeLayer","hippodromeProps","_hippodromeProps","createHeightEditPoints","updateHippdromeLayer","widthMeters","secP","lerp","bearingDeg","upAzimuth","createMiddleEditablePoint","downAzimuth","azimuth","upEditCartesian3","changeWidthByNewPoint","normalizedBearingDeb","bearingDegHippodromeDots","fixedBearingDeg","distanceMeters","radiusWidth","endMovePoint","getRealPositionsCallbackProperty","getWidth","DEFAULT_POLYLINE_OPTIONS","PolylinesEditorService","polylinesManager","polylineOptions","editPolyline","PolylinesManagerService","createEditablePolyline","editablePolyline","PolylinesEditorComponent","polylinesEditor","polylineLabels$","polylineLabelsLayer","HippodromeManagerService","hippodromes","createEditableHippodrome","editHippodromeLayer","hippodromeEditOptions","editableHippodrome","hippodrome","DEFAULT_HIPPODROME_OPTIONS","HippodromeEditorService","managerService","hippodromeManager","hippodromeOptions","isFirstPoint","editHippodrome","firstPosition","secondPosition","firstPointProp","secondPointProp","getCurrentWidth","HippodromeEditorComponent","hippodromesEditor","hippodromesManager","editHippodromes$","editHippodromesLayer","DraggableToMapService","mainSubject","setCoordinateConverter","drag","imageSrc","cancel","imgElement","src","visibility","createDragObservable","dragObservable","clientWidth","clientHeight","dragUpdates","pointerUp","observableFromEvent","moveObservable","initialScreenPosition","mapPosition","DraggableToMapDirective","el","iconDragService","draggableToMap","onMouseDown","HostListener","AcToolbarComponent","dragStyle","height.px","width.px","mouseDown$","mouseMove$_1","mouseUp$_1","drag$","subscription","DragIconComponent","AcToolbarButtonComponent","onClick","RangeAndBearingComponent","polylineEditor","lineEditOptions","labelsStyle","distanceLabelsStyle","bearingLabelsStyle","_d","_e","_f","bearingStringFn","distanceStringFn","rnb","totalDistance","previousPosition","bearing","toFixed","ZoomToRectangleService","mapsZoomElements","animationDurationInSeconds","resetKeyCode","borderStyle","autoDisableOnZoom","activate","mapZoomData","borderElement","mouse","endX","endY","startX","startY","onmousedown","onStart","rect","offsetX","clientX","offsetY","clientY","border","onmouseup","zoomApplied","zoomCameraToRectangle","onComplete","onmousemove","resetOnEscapePress","resetOnEscapePressFunc","animationDuration","cartesian1","cartesian2","cartographic1","cartographic2","AngularCesiumWidgetsModule"],"mappings":"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","sourcesContent":["/**\n * Fix for the constant entity shadowing.\n * PR in Cesium repo: https://github.com/AnalyticalGraphicsInc/cesium/pull/5736\n */\n\n// tslint:disable\nconst AssociativeArray = Cesium.AssociativeArray;\nconst Color = Cesium.Color;\nconst ColorGeometryInstanceAttribute = Cesium.ColorGeometryInstanceAttribute;\nconst defined = Cesium.defined;\nconst DistanceDisplayCondition = Cesium.DistanceDisplayCondition;\nconst DistanceDisplayConditionGeometryInstanceAttribute = Cesium.DistanceDisplayConditionGeometryInstanceAttribute;\nconst ShowGeometryInstanceAttribute = Cesium.ShowGeometryInstanceAttribute;\nconst Primitive = Cesium.Primitive;\nconst ShadowMode = Cesium.ShadowMode;\nconst BoundingSphereState = Cesium.BoundingSphereState;\nconst ColorMaterialProperty = Cesium.ColorMaterialProperty;\nconst MaterialProperty = Cesium.MaterialProperty;\nconst Property = Cesium.Property;\n\nvar colorScratch = new Color();\nvar distanceDisplayConditionScratch = new DistanceDisplayCondition();\nvar defaultDistanceDisplayCondition = new DistanceDisplayCondition();\n\nfunction Batch(primitives, translucent, appearanceType, depthFailAppearanceType, depthFailMaterialProperty, closed, shadows) {\n  this.translucent = translucent;\n  this.appearanceType = appearanceType;\n  this.depthFailAppearanceType = depthFailAppearanceType;\n  this.depthFailMaterialProperty = depthFailMaterialProperty;\n  this.depthFailMaterial = undefined;\n  this.closed = closed;\n  this.shadows = shadows;\n  this.primitives = primitives;\n  this.createPrimitive = false;\n  this.waitingOnCreate = false;\n  this.primitive = undefined;\n  this.oldPrimitive = undefined;\n  this.geometry = new AssociativeArray();\n  this.updaters = new AssociativeArray();\n  this.updatersWithAttributes = new AssociativeArray();\n  this.attributes = new AssociativeArray();\n  this.subscriptions = new AssociativeArray();\n  this.showsUpdated = new AssociativeArray();\n  this.itemsToRemove = [];\n  this.invalidated = false;\n  \n  var removeMaterialSubscription;\n  if (defined(depthFailMaterialProperty)) {\n    removeMaterialSubscription = depthFailMaterialProperty.definitionChanged.addEventListener(Batch.prototype.onMaterialChanged, this);\n  }\n  this.removeMaterialSubscription = removeMaterialSubscription;\n}\n\nBatch.prototype.onMaterialChanged = function () {\n  this.invalidated = true;\n};\n\nBatch.prototype.isMaterial = function (updater) {\n  var material = this.depthFailMaterialProperty;\n  var updaterMaterial = updater.depthFailMaterialProperty;\n  if (updaterMaterial === material) {\n    return true;\n  }\n  if (defined(material)) {\n    return material.equals(updaterMaterial);\n  }\n  return false;\n};\n\nBatch.prototype.add = function (updater, instance) {\n  var id = updater.id;\n  this.createPrimitive = true;\n  this.geometry.set(id, instance);\n  this.updaters.set(id, updater);\n  if (!updater.hasConstantFill || !updater.fillMaterialProperty.isConstant || !Property.isConstant(updater.distanceDisplayConditionProperty)) {\n    this.updatersWithAttributes.set(id, updater);\n  } else {\n    var that = this;\n    this.subscriptions.set(id, updater.entity.definitionChanged.addEventListener(function (entity, propertyName, newValue, oldValue) {\n      if (propertyName === 'isShowing') {\n        that.showsUpdated.set(updater.id, updater);\n      }\n    }));\n  }\n};\n\nBatch.prototype.remove = function (updater) {\n  var id = updater.id;\n  this.createPrimitive = this.geometry.remove(id) || this.createPrimitive;\n  if (this.updaters.remove(id)) {\n    this.updatersWithAttributes.remove(id);\n    var unsubscribe = this.subscriptions.get(id);\n    if (defined(unsubscribe)) {\n      unsubscribe();\n      this.subscriptions.remove(id);\n    }\n  }\n};\n\nBatch.prototype.update = function (time) {\n  var isUpdated = true;\n  var removedCount = 0;\n  var primitive = this.primitive;\n  var primitives = this.primitives;\n  var attributes;\n  var i;\n  \n  if (this.createPrimitive) {\n    var geometries = this.geometry.values;\n    var geometriesLength = geometries.length;\n    if (geometriesLength > 0) {\n      if (defined(primitive)) {\n        if (!defined(this.oldPrimitive)) {\n          this.oldPrimitive = primitive;\n        } else {\n          primitives.remove(primitive);\n        }\n      }\n      \n      for (i = 0; i < geometriesLength; i++) {\n        var geometryItem = geometries[i];\n        var originalAttributes = geometryItem.attributes;\n        attributes = this.attributes.get(geometryItem.id.id);\n        \n        if (defined(attributes)) {\n          if (defined(originalAttributes.show)) {\n            originalAttributes.show.value = attributes.show;\n          }\n          if (defined(originalAttributes.color)) {\n            originalAttributes.color.value = attributes.color;\n          }\n          if (defined(originalAttributes.depthFailColor)) {\n            originalAttributes.depthFailColor.value = attributes.depthFailColor;\n          }\n        }\n      }\n      \n      var depthFailAppearance;\n      if (defined(this.depthFailAppearanceType)) {\n        if (defined(this.depthFailMaterialProperty)) {\n          this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n        }\n        depthFailAppearance = new this.depthFailAppearanceType({\n          material: this.depthFailMaterial,\n          translucent: this.translucent,\n          closed: this.closed\n        });\n      }\n      \n      primitive = new Primitive({\n        show: false,\n        asynchronous: true,\n        geometryInstances: geometries,\n        appearance: new this.appearanceType({\n          flat: this.shadows === ShadowMode.DISABLED || this.shadows === ShadowMode.CAST_ONLY,\n          translucent: this.translucent,\n          closed: this.closed\n        }),\n        depthFailAppearance: depthFailAppearance,\n        shadows: this.shadows\n      });\n      primitives.add(primitive);\n      isUpdated = false;\n    } else {\n      if (defined(primitive)) {\n        primitives.remove(primitive);\n        primitive = undefined;\n      }\n      var oldPrimitive = this.oldPrimitive;\n      if (defined(oldPrimitive)) {\n        primitives.remove(oldPrimitive);\n        this.oldPrimitive = undefined;\n      }\n    }\n    \n    this.attributes.removeAll();\n    this.primitive = primitive;\n    this.createPrimitive = false;\n    this.waitingOnCreate = true;\n  } else if (defined(primitive) && primitive.ready) {\n    primitive.show = true;\n    if (defined(this.oldPrimitive)) {\n      primitives.remove(this.oldPrimitive);\n      this.oldPrimitive = undefined;\n    }\n    \n    if (defined(this.depthFailAppearanceType) && !(this.depthFailMaterialProperty instanceof ColorMaterialProperty)) {\n      this.depthFailMaterial = MaterialProperty.getValue(time, this.depthFailMaterialProperty, this.depthFailMaterial);\n      this.primitive.depthFailAppearance.material = this.depthFailMaterial;\n    }\n    \n    var updatersWithAttributes = this.updatersWithAttributes.values;\n    var length = updatersWithAttributes.length;\n    var waitingOnCreate = this.waitingOnCreate;\n    for (i = 0; i < length; i++) {\n      var updater = updatersWithAttributes[i];\n      var instance = this.geometry.get(updater.id);\n      \n      attributes = this.attributes.get(instance.id.id);\n      if (!defined(attributes)) {\n        attributes = primitive.getGeometryInstanceAttributes(instance.id);\n        this.attributes.set(instance.id.id, attributes);\n      }\n      \n      if (!updater.fillMaterialProperty.isConstant || waitingOnCreate) {\n        var colorProperty = updater.fillMaterialProperty.color;\n        var resultColor = Property.getValueOrDefault(colorProperty, time, Color.WHITE, colorScratch);\n        if (!Color.equals(attributes._lastColor, resultColor)) {\n          attributes._lastColor = Color.clone(resultColor, attributes._lastColor);\n          attributes.color = ColorGeometryInstanceAttribute.toValue(resultColor, attributes.color);\n          if ((this.translucent && attributes.color[3] === 255) || (!this.translucent && attributes.color[3] !== 255)) {\n            this.itemsToRemove[removedCount++] = updater;\n          }\n        }\n      }\n      \n      if (defined(this.depthFailAppearanceType) && updater.depthFailMaterialProperty instanceof ColorMaterialProperty && (!updater.depthFailMaterialProperty.isConstant || waitingOnCreate)) {\n        var depthFailColorProperty = updater.depthFailMaterialProperty.color;\n        var depthColor = Property.getValueOrDefault(depthFailColorProperty, time, Color.WHITE, colorScratch);\n        if (!Color.equals(attributes._lastDepthFailColor, depthColor)) {\n          attributes._lastDepthFailColor = Color.clone(depthColor, attributes._lastDepthFailColor);\n          attributes.depthFailColor = ColorGeometryInstanceAttribute.toValue(depthColor, attributes.depthFailColor);\n        }\n      }\n      \n      var show = updater.entity.isShowing && (updater.hasConstantFill || updater.isFilled(time));\n      var currentShow = attributes.show[0] === 1;\n      if (show !== currentShow) {\n        attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n      }\n      \n      var distanceDisplayConditionProperty = updater.distanceDisplayConditionProperty;\n      if (!Property.isConstant(distanceDisplayConditionProperty)) {\n        var distanceDisplayCondition = Property.getValueOrDefault(distanceDisplayConditionProperty, time, defaultDistanceDisplayCondition, distanceDisplayConditionScratch);\n        if (!DistanceDisplayCondition.equals(distanceDisplayCondition, attributes._lastDistanceDisplayCondition)) {\n          attributes._lastDistanceDisplayCondition = DistanceDisplayCondition.clone(distanceDisplayCondition, attributes._lastDistanceDisplayCondition);\n          attributes.distanceDisplayCondition = DistanceDisplayConditionGeometryInstanceAttribute.toValue(distanceDisplayCondition, attributes.distanceDisplayCondition);\n        }\n      }\n    }\n    \n    this.updateShows(primitive);\n    this.waitingOnCreate = false;\n  } else if (defined(primitive) && !primitive.ready) {\n    isUpdated = false;\n  }\n  this.itemsToRemove.length = removedCount;\n  return isUpdated;\n};\n\nBatch.prototype.updateShows = function (primitive) {\n  var showsUpdated = this.showsUpdated.values;\n  var length = showsUpdated.length;\n  for (var i = 0; i < length; i++) {\n    var updater = showsUpdated[i];\n    var instance = this.geometry.get(updater.id);\n    \n    var attributes = this.attributes.get(instance.id.id);\n    if (!defined(attributes)) {\n      attributes = primitive.getGeometryInstanceAttributes(instance.id);\n      this.attributes.set(instance.id.id, attributes);\n    }\n    \n    var show = updater.entity.isShowing;\n    var currentShow = attributes.show[0] === 1;\n    if (show !== currentShow) {\n      attributes.show = ShowGeometryInstanceAttribute.toValue(show, attributes.show);\n    }\n  }\n  this.showsUpdated.removeAll();\n};\n\nBatch.prototype.contains = function (updater) {\n  return this.updaters.contains(updater.id);\n};\n\nBatch.prototype.getBoundingSphere = function (updater, result) {\n  var primitive = this.primitive;\n  if (!primitive.ready) {\n    return BoundingSphereState.PENDING;\n  }\n  var attributes = primitive.getGeometryInstanceAttributes(updater.entity);\n  if (!defined(attributes) || !defined(attributes.boundingSphere) ||//\n    (defined(attributes.show) && attributes.show[0] === 0)) {\n    return BoundingSphereState.FAILED;\n  }\n  attributes.boundingSphere.clone(result);\n  return BoundingSphereState.DONE;\n};\n\nBatch.prototype.removeAllPrimitives = function () {\n  var primitives = this.primitives;\n  \n  var primitive = this.primitive;\n  if (defined(primitive)) {\n    primitives.remove(primitive);\n    this.primitive = undefined;\n    this.geometry.removeAll();\n    this.updaters.removeAll();\n  }\n  \n  var oldPrimitive = this.oldPrimitive;\n  if (defined(oldPrimitive)) {\n    primitives.remove(oldPrimitive);\n    this.oldPrimitive = undefined;\n  }\n};\n\nBatch.prototype.destroy = function () {\n  var primitive = this.primitive;\n  var primitives = this.primitives;\n  if (defined(primitive)) {\n    primitives.remove(primitive);\n  }\n  var oldPrimitive = this.oldPrimitive;\n  if (defined(oldPrimitive)) {\n    primitives.remove(oldPrimitive);\n  }\n  if (defined(this.removeMaterialSubscription)) {\n    this.removeMaterialSubscription();\n  }\n};\n\n\nlet wasFixed = false;\n\nexport function fixCesiumEntitiesShadows() {\n  if (wasFixed) {\n    return;\n  }\n  Cesium.StaticGeometryColorBatch.prototype.add = function (time: any, updater: any) {\n    var items;\n    var translucent;\n    var instance = updater.createFillGeometryInstance(time);\n    if (instance.attributes.color.value[3] === 255) {\n      items = this._solidItems;\n      translucent = false;\n    } else {\n      items = this._translucentItems;\n      translucent = true;\n    }\n    \n    var length = items.length;\n    for (var i = 0; i < length; i++) {\n      var item = items[i];\n      if (item.isMaterial(updater)) {\n        item.add(updater, instance);\n        return;\n      }\n      \n    }\n    \n    var batch: any = new Batch(this._primitives, translucent, this._appearanceType, this._depthFailAppearanceType, updater.depthFailMaterialProperty, this._closed, this._shadows);\n    batch.add(updater, instance);\n    items.push(batch);\n  };\n  wasFixed = true;\n}\n","import { Inject, Injectable, InjectionToken, Optional } from '@angular/core';\nimport { fixCesiumEntitiesShadows } from './StaticGeometryColorBatch';\n\nexport const ANGULAR_CESIUM_CONFIG = new InjectionToken('ANGULAR_CESIUM_CONFIG');\n\n@Injectable()\nexport class ConfigurationService {\n  constructor(@Optional() @Inject(ANGULAR_CESIUM_CONFIG) private config: any) {\n    const fixEntitiesShadows = config ? config.fixEntitiesShadows : true;\n    if (fixEntitiesShadows !== false) {\n      fixCesiumEntitiesShadows();\n    }\n  }\n}\n","/**\n * Cesium scene modes\n */\nexport enum SceneMode {\n  SCENE3D,\n  COLUMBUS_VIEW,\n  SCENE2D,\n  PERFORMANCE_SCENE2D\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../cesium/cesium.service';\nimport { SceneMode } from '../../models/scene-mode.enum';\n\n/**\n *  The service exposes the scene's camera and screenSpaceCameraController\n *  SceneMode.PERFORMANCE_SCENE2D -  is a 3D scene mode that acts like Cesium 2D mode,\n *  but is more efficient performance wise.\n */\n@Injectable()\nexport class CameraService {\n  static PERFORMANCE_2D_ALTITUDE = 25000000;\n\n  private viewer: any;\n  private scene: any;\n  private camera: any;\n  private screenSpaceCameraController: any;\n  private morphListenerCancelFn: any;\n  private lastRotate: boolean;\n  private lastTilt: boolean;\n  private lastLook: boolean;\n  private isSceneModePerformance2D = false;\n\n  constructor() {\n  }\n\n  init(cesiumService: CesiumService) {\n    this.viewer = cesiumService.getViewer();\n    this.scene = cesiumService.getScene();\n    this.screenSpaceCameraController = this.scene.screenSpaceCameraController;\n    this.camera = this.scene.camera;\n    this.lastRotate = this.screenSpaceCameraController.enableRotate;\n    this.lastTilt = this.screenSpaceCameraController.enableTilt;\n    this.lastLook = this.screenSpaceCameraController.enableLook;\n  }\n\n  _listenToSceneModeMorph(callback: Function) {\n    this.morphListenerCancelFn = this.scene.morphStart.addEventListener(\n      callback\n    );\n  }\n\n  _revertCameraProperties() {\n    this.isSceneModePerformance2D = false;\n    this.enableTilt(this.lastTilt);\n    this.enableRotate(this.lastRotate);\n    this.enableLook(this.lastLook);\n  }\n\n  /**\n   * Gets the scene's camera\n   */\n  getCamera() {\n    return this.camera;\n  }\n\n  /**\n   * Gets the scene's screenSpaceCameraController\n   */\n  getScreenSpaceCameraController() {\n    return this.screenSpaceCameraController;\n  }\n\n  /**\n   * Gets the minimum zoom value in meters\n   */\n  getMinimumZoom(): number {\n    return this.screenSpaceCameraController.minimumZoomDistance;\n  }\n\n  /**\n   * Sets the minimum zoom value in meters\n   * @param zoom amount\n   */\n  setMinimumZoom(amount: number): void {\n    this.screenSpaceCameraController.minimumZoomDistance = amount;\n  }\n\n  /**\n   * Gets the maximum zoom value in meters\n   */\n  getMaximumZoom(): number {\n    return this.screenSpaceCameraController.maximumZoomDistance;\n  }\n\n  /**\n   * Sets the maximum zoom value in meters\n   * @param zoom amount\n   */\n  setMaximumZoom(amount: number): void {\n    this.screenSpaceCameraController.maximumZoomDistance = amount;\n  }\n\n  /**\n   * Sets if the camera is able to tilt\n   */\n  enableTilt(tilt: boolean): void {\n    this.screenSpaceCameraController.enableTilt = tilt;\n  }\n\n  /**\n   * Sets if the camera is able to rotate\n   */\n  enableRotate(rotate: boolean): void {\n    this.screenSpaceCameraController.enableRotate = rotate;\n  }\n\n  /**\n   * Sets if the camera is able to free-look\n   */\n  enableLook(lock: boolean): void {\n    this.screenSpaceCameraController.enableLook = lock;\n  }\n\n  /**\n   * Sets if the camera is able to translate\n   */\n  enableTranslate(translate: boolean): void {\n    this.screenSpaceCameraController.enableTranslate = translate;\n  }\n\n  /**\n   * Sets if the camera is able to zoom\n   */\n  enableZoom(zoom: boolean): void {\n    this.screenSpaceCameraController.enableZoom = zoom;\n  }\n\n  /**\n   * Sets if the camera receives inputs\n   */\n  enableInputs(inputs: boolean): void {\n    this.screenSpaceCameraController.enableInputs = inputs;\n  }\n\n  /**\n   * Sets the map's SceneMode\n   * @param sceneMode - The SceneMode to morph the scene into.\n   * @param duration - The duration of scene morph animations, in seconds\n   */\n  setSceneMode(sceneMode: SceneMode, duration?: number) {\n    switch (sceneMode) {\n      case SceneMode.SCENE3D: {\n        if (this.isSceneModePerformance2D) {\n          this._revertCameraProperties();\n        }\n\n        this.scene.morphTo3D(duration);\n\n        break;\n      }\n      case SceneMode.COLUMBUS_VIEW: {\n        if (this.isSceneModePerformance2D) {\n          this._revertCameraProperties();\n        }\n\n        this.scene.morphToColumbusView(duration);\n\n        break;\n      }\n      case SceneMode.SCENE2D: {\n        if (this.isSceneModePerformance2D) {\n          this._revertCameraProperties();\n        }\n        this.scene.morphTo2D(duration);\n\n        break;\n      }\n      case SceneMode.PERFORMANCE_SCENE2D: {\n        this.isSceneModePerformance2D = true;\n        this.lastLook = this.screenSpaceCameraController.enableLook;\n        this.lastTilt = this.screenSpaceCameraController.enableTilt;\n        this.lastRotate = this.screenSpaceCameraController.enableRotate;\n        this.screenSpaceCameraController.enableTilt = false;\n        this.screenSpaceCameraController.enableRotate = false;\n        this.screenSpaceCameraController.enableLook = false;\n        if (this.morphListenerCancelFn) {\n          this.morphListenerCancelFn();\n        }\n        this.scene.morphToColumbusView(duration);\n        const morphCompleteEventListener = this.scene.morphComplete.addEventListener(\n          () => {\n            this.camera.setView({\n              destination: Cesium.Cartesian3.fromDegrees(\n                0.0,\n                0.0,\n                Math.min(\n                  CameraService.PERFORMANCE_2D_ALTITUDE,\n                  this.getMaximumZoom()\n                )\n              ),\n              orientation: {\n                pitch: Cesium.Math.toRadians(-90)\n              }\n            });\n            morphCompleteEventListener();\n            this._listenToSceneModeMorph(\n              this._revertCameraProperties.bind(this)\n            );\n          }\n        );\n\n        break;\n      }\n    }\n  }\n\n  /**\n   * Flies the camera to a destination\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Camera.html?classFilter=cam#flyTo\n   */\n  cameraFlyTo(options: any) {\n    return this.camera.flyTo(options);\n  }\n\n  /**\n   * Flies the camera to a target\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Viewer.html?classFilter=viewer#flyTo\n   * @returns Promise<boolean>\n   */\n  flyTo(target: any, options?: any) {\n    return this.viewer.flyTo(target, options);\n  }\n\n  /**\n   * Zooms amount along the camera's view vector.\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Camera.html#zoomIn\n   */\n  zoomIn(amount: number) {\n    return this.camera.zoomIn(amount || this.camera.defaultZoomAmount);\n  }\n\n  /**\n   * Zooms amount along the opposite direction of the camera's view vector.\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Camera.html#zoomOut\n   */\n  zoomOut(amount: number) {\n    return this.camera.zoomIn(amount || this.camera.defaultZoomAmount);\n  }\n\n  /**\n   * Zoom the camera to a target\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Viewer.html?classFilter=viewer#zoomTo\n   * @returns Promise<boolean>\n   */\n  zoomTo(target: any, offset?: any) {\n    return this.viewer.zoomTo(target, offset);\n  }\n\n  /**\n   * Flies the camera to a destination\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Camera.html?classFilter=camera#setView\n   * @param options viewer options\n   */\n  setView(options: any) {\n    this.camera.setView(options);\n  }\n\n  /**\n   * Set camera's rotation\n   */\n  setRotation(degreesInRadians: number) {\n    this.setView({orientation: {heading: degreesInRadians}});\n  }\n\n  /**\n   * Locks or unlocks camera rotation\n   */\n  lockRotation(lock: boolean) {\n    this.scene.screenSpaceCameraController.enableRotate = !lock;\n  }\n\n  /**\n   * Make the camera track a specific entity\n   * API: https://cesiumjs.org/Cesium/Build/Documentation/Viewer.html?classFilter=viewer#trackedEntity\n   * @param entity - entity to track\n   * @param options - track entity options\n   */\n  trackEntity(\n    entity?: any,\n    options?: { flyTo: boolean; flyToDuration?: number; altitude?: number }\n  ) {\n    const flyTo = (options && options.flyTo) || false;\n\n    this.viewer.trackedEntity = undefined;\n    return new Promise(resolve => {\n      if (flyTo) {\n        const flyToDuration = (options && options.flyToDuration) || 1;\n        const altitude = (options && options.altitude) || 10000;\n\n        // Calc entity flyTo position and wanted altitude\n        const entPosCar3 = entity.position.getValue(Cesium.JulianDate.now());\n        const entPosCart = Cesium.Cartographic.fromCartesian(entPosCar3);\n        const zoomAmount = altitude - entPosCart.height;\n        entPosCart.height = altitude;\n        const flyToPosition = Cesium.Cartesian3.fromRadians(\n          entPosCart.longitude,\n          entPosCart.latitude,\n          entPosCart.height\n        );\n\n        this.cameraFlyTo({\n          duration: flyToDuration,\n          destination: flyToPosition,\n          complete: () => {\n            this.viewer.trackedEntity = entity;\n            setTimeout(() => {\n              if (zoomAmount > 0) {\n                this.camera.zoomOut(zoomAmount);\n              } else {\n                this.camera.zoomIn(zoomAmount);\n              }\n            }, 0);\n            resolve();\n          }\n        });\n      } else {\n        this.viewer.trackedEntity = entity;\n        resolve();\n      }\n    });\n  }\n\n  untrackEntity() {\n    this.trackEntity();\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class ViewerFactory {\n  cesium: any;\n\n\n  constructor() {\n    this.cesium = Cesium;\n  }\n\n  /**\n   * Creates a viewer with default or custom options\n   * @param mapContainer - container to initialize the viewer on\n   * @param options - Options to create the viewer with - Optional\n   *\n   * @returns new viewer\n   */\n  createViewer(mapContainer: HTMLElement, options?: any) {\n    let viewer = null;\n    if (options) {\n      viewer = new this.cesium.Viewer(mapContainer, {\n        contextOptions: {\n          webgl: {preserveDrawingBuffer: true}\n        },\n        ...options\n      });\n    } else {\n      viewer = new this.cesium.Viewer(mapContainer,\n        {\n          // Poor internet connection - use default globe image, TODO: should be removed\n          imageryProvider: Cesium.createTileMapServiceImageryProvider({\n            url: Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')\n          }),\n          baseLayerPicker: false,\n          geocoder: false,\n          contextOptions: {\n            webgl: {preserveDrawingBuffer: true}\n          },\n        });\n    }\n\n    return viewer;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service for setting cesium viewer map options.\n * defaulty angular-cesium doesnt provide this service and viewer is created with default options.\n * In order set specific options you must set this service as provider in your component and\n * set the wanted options.\n * ```typescript\n * constructor(viewerConf :ViewerConfiguration ) {\n *   viewerConf.viewerOptions = { timeline: false };\n * }\n * ```\n * notice this configuration will be for all <ac-maps> in your component.\n */\n@Injectable()\nexport class ViewerConfiguration {\n  /**\n   * cesium viewer options According to [Viewer]{@link https://cesiumjs.org/Cesium/Build/Documentation/Viewer.html?classFilter=vie}\n   */\n  private _viewerOptions: object | object[];\n  private _viewerModifier: Function | Function[];\n  private nextViewerOptionsIndex = 0;\n  private nextViewerModifierIndex = 0;\n\n  get viewerOptions(): object | object[] {\n    return this._viewerOptions;\n  }\n\n  ;\n\n  getNextViewerOptions(): object | object[] {\n    if (this._viewerOptions instanceof Array) {\n      return this._viewerOptions[this.nextViewerOptionsIndex++];\n    } else {\n      return this._viewerOptions;\n    }\n  }\n\n  /**\n   * Can be used to set initial map viewer options.\n   * If there is more than one map you can give the function an array of options.\n   * The map initialized first will be set with the first option object in the options array and so on.\n   */\n  set viewerOptions(value: object | object[]) {\n    this._viewerOptions = value;\n  }\n\n  get viewerModifier(): Function | Function[] {\n    return this._viewerModifier;\n  }\n\n  getNextViewerModifier(): Function | Function[] {\n    if (this._viewerModifier instanceof Array) {\n      return this._viewerModifier[this.nextViewerModifierIndex++];\n    } else {\n      return this._viewerModifier;\n    }\n  }\n\n  /**\n   * Can be used to set map viewer options after the map has been initialized.\n   * If there is more than one map you can give the function an array of functions.\n   * The map initialized first will be set with the first option object in the options array and so on.\n   */\n  set viewerModifier(value: Function | Function[]) {\n    this._viewerModifier = value;\n  }\n}\n","import { Injectable, NgZone, Optional } from '@angular/core';\nimport { ViewerFactory } from '../viewer-factory/viewer-factory.service';\nimport { ViewerConfiguration } from '../viewer-configuration/viewer-configuration.service';\nimport { AcMapComponent } from '../../components/ac-map/ac-map.component';\n\n/**\n *  Service that initialize cesium viewer and expose cesium viewer and scene.\n */\n@Injectable()\nexport class CesiumService {\n  private cesiumViewer: any;\n  private map: AcMapComponent;\n\n  constructor(private ngZone: NgZone, private viewerFactory: ViewerFactory, @Optional() private viewerConfiguration: ViewerConfiguration) {\n  }\n\n  init(mapContainer: HTMLElement, map: AcMapComponent) {\n    this.map = map;\n    this.ngZone.runOutsideAngular(() => {\n      const options = this.viewerConfiguration ? this.viewerConfiguration.getNextViewerOptions() : undefined;\n      this.cesiumViewer = this.viewerFactory.createViewer(mapContainer, options);\n\n      const viewerModifier = this.viewerConfiguration && this.viewerConfiguration.getNextViewerModifier();\n      if (typeof viewerModifier === 'function') {\n        viewerModifier(this.cesiumViewer);\n      }\n    });\n  }\n\n  /**\n   * For more information see https://cesiumjs.org/Cesium/Build/Documentation/Viewer.html?classFilter=viewe\n   * @returns cesiumViewer\n   */\n  getViewer() {\n    return this.cesiumViewer;\n  }\n\n  /**\n   * For more information see https://cesiumjs.org/Cesium/Build/Documentation/Scene.html?classFilter=scene\n   * @returns cesium scene\n   */\n  getScene() {\n    return this.cesiumViewer.scene;\n  }\n\n  /**\n   * For more information see https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\n   * @returns cesium canvas\n   */\n  getCanvas(): HTMLCanvasElement {\n    return this.cesiumViewer.canvas as HTMLCanvasElement;\n  }\n\n  getMap(): AcMapComponent {\n    return this.map;\n  }\n}\n","/**\n * Event options for registration on map-event-manager.\n */\nexport enum CesiumEvent {\n  MOUSE_MOVE = Cesium.ScreenSpaceEventType.MOUSE_MOVE,\n  LEFT_CLICK = Cesium.ScreenSpaceEventType.LEFT_CLICK,\n  LEFT_DOUBLE_CLICK = Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,\n  LEFT_DOWN = Cesium.ScreenSpaceEventType.LEFT_DOWN,\n  LEFT_UP = Cesium.ScreenSpaceEventType.LEFT_UP,\n  MIDDLE_CLICK = Cesium.ScreenSpaceEventType.MIDDLE_CLICK,\n  MIDDLE_DOUBLE_CLICK = Cesium.ScreenSpaceEventType.MIDDLE_DOUBLE_CLICK,\n  MIDDLE_DOWN = Cesium.ScreenSpaceEventType.MIDDLE_DOWN,\n  MIDDLE_UP = Cesium.ScreenSpaceEventType.MIDDLE_UP,\n  PINCH_START = Cesium.ScreenSpaceEventType.PINCH_START,\n  PINCH_END = Cesium.ScreenSpaceEventType.PINCH_END,\n  PINCH_MOVE = Cesium.ScreenSpaceEventType.PINCH_MOVE,\n  RIGHT_CLICK = Cesium.ScreenSpaceEventType.RIGHT_CLICK,\n  RIGHT_DOUBLE_CLICK = Cesium.ScreenSpaceEventType.RIGHT_DOUBLE_CLICK,\n  RIGHT_DOWN = Cesium.ScreenSpaceEventType.RIGHT_DOWN,\n  RIGHT_UP = Cesium.ScreenSpaceEventType.RIGHT_UP,\n  WHEEL = Cesium.ScreenSpaceEventType.WHEEL,\n  LONG_LEFT_PRESS = 110,\n  LONG_RIGHT_PRESS,\n  LONG_MIDDLE_PRESS,\n  LEFT_CLICK_DRAG,\n  RIGHT_CLICK_DRAG,\n  MIDDLE_CLICK_DRAG,\n}\n","/**\n *  NO_PICK,    - will not pick entities\n *  PICK_FIRST  - first entity will be picked . use Cesium.scene.pick()\n *  PICK_ONE    - in case a few entities are picked plonter is resolved . use Cesium.scene.drillPick()\n *  PICK_ALL    - all entities are picked. use Cesium.scene.drillPick()\n */\nexport enum PickOptions {\n  NO_PICK,\n  PICK_FIRST,\n  PICK_ONE,\n  PICK_ALL\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { Cartesian3 } from '../../models/cartesian3';\nimport { ContextMenuOptions } from '../../models/context-menu-options';\nimport { MapEventsManagerService } from '../map-events-mananger/map-events-manager';\nimport { CesiumEvent } from '../map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../map-events-mananger/consts/pickOptions.enum';\nimport { DisposableObservable } from '../map-events-mananger/disposable-observable';\nimport { BasicContextMenu } from '../../models/basic-context-menu';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * The Service manages a singleton context menu over the map. It should be initialized with MapEventsManager.\n * The Service allows opening and closing of the context menu and passing data to the context menu inner component.\n */\n\n@Injectable()\nexport class ContextMenuService {\n  private _showContextMenu = false;\n  private _options: ContextMenuOptions;\n  private _position: Cartesian3;\n  private _content: BasicContextMenu;\n  private mapEventsManager: MapEventsManagerService;\n  private leftClickRegistration: DisposableObservable<any>;\n  private leftClickSubscription: Subscription;\n  private _contextMenuChangeNotifier = new EventEmitter();\n  private _onOpen = new EventEmitter();\n  private _onClose = new EventEmitter();\n  private _defaultContextMenuOptions: ContextMenuOptions = {\n    closeOnLeftCLick: true,\n    closeOnLeftClickPriority: 10,\n  };\n\n  get contextMenuChangeNotifier(): EventEmitter<any> {\n    return this._contextMenuChangeNotifier;\n  }\n\n  get showContextMenu(): boolean {\n    return this._showContextMenu;\n  }\n\n  get options(): ContextMenuOptions {\n    return this._options;\n  }\n\n  get position(): Cartesian3 {\n    return this._position;\n  }\n\n  get content(): BasicContextMenu {\n    return this._content;\n  }\n\n  get onOpen(): EventEmitter<any> {\n    return this._onOpen;\n  }\n\n  get onClose(): EventEmitter<any> {\n    return this._onClose;\n  }\n\n\n  init(mapEventsManager: MapEventsManagerService) {\n    this.mapEventsManager = mapEventsManager;\n  }\n\n  open(content: any, position: Cartesian3, options: ContextMenuOptions = {}) {\n    this.close();\n    this._content = content;\n    this._position = position;\n    this._options = Object.assign({}, this._defaultContextMenuOptions, options);\n    this._showContextMenu = true;\n    if (this.mapEventsManager && this._options.closeOnLeftCLick) {\n      this.leftClickRegistration = this.mapEventsManager.register({\n        event: CesiumEvent.LEFT_CLICK,\n        pick: PickOptions.NO_PICK,\n        priority: this._options.closeOnLeftClickPriority,\n      });\n      this.leftClickSubscription = this.leftClickRegistration.subscribe(() => {\n        this.leftClickSubscription.unsubscribe();\n        this.close();\n      });\n    }\n\n    this._contextMenuChangeNotifier.emit();\n    this._onOpen.emit();\n  }\n\n  close() {\n    this._content = undefined;\n    this._position = undefined;\n    this._options = undefined;\n    this._showContextMenu = false;\n    if (this.leftClickRegistration) {\n      this.leftClickRegistration.dispose();\n      this.leftClickRegistration = undefined;\n    }\n    if (this.leftClickSubscription) {\n      this.leftClickSubscription.unsubscribe();\n      this.leftClickSubscription = undefined;\n    }\n\n    this._contextMenuChangeNotifier.emit();\n    this._onClose.emit();\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { CesiumService } from '../cesium/cesium.service';\nimport * as geodesy from 'geodesy';\nimport { hemisphere, LatLon, LatLonEllipsoidal, Utm } from 'geodesy';\nimport { Cartesian3 } from '../../models/cartesian3';\n\nconst LatLonVectors = geodesy['LatLonVectors']; // doesnt exists on typings\n\nwindow['geodesy'] = geodesy;\n\n/**\n *  Given different types of coordinates, we provide you a service converting those types to the most common other types.\n *  We are using the geodesy implementation of UTM conversion. see: https://github.com/chrisveness/geodesy.\n *\n * @example\n * import { Component, OnInit } from '@angular/core';\n * import { CoordinateConverter } from 'angular2-cesium';\n *\n * @Component({\n * \t\tselector:'my-component',\n * \t\ttemplate:'<div>{{showCartographic}}</div>',\n * \t\tproviders:[CoordinateConverter]\n * })\n * export class MyComponent implements OnInit {\n * \t\tshowCartographic;\n *\n * \t\tconstructor(private coordinateConverter:CoordinateConverter){\n * \t\t}\n *\n * \t\tngOnInit(){\n * \t\t\tthis.showCartographic = this.coordinateConverter.degreesToCartographic(5, 5, 5);\n *  }\n * }\n *\n */\n@Injectable()\nexport class CoordinateConverter {\n  constructor(@Optional() private cesiumService?: CesiumService) {\n  }\n\n  screenToCartesian3(screenPos: { x: number, y: number }, addMapCanvasBoundsToPos?: boolean) {\n    if (!this.cesiumService) {\n      throw new Error('ANGULAR2-CESIUM - Cesium service should be provided in order' +\n        ' to do screen position calculations');\n    } else {\n      const screenPosition = { ...screenPos };\n      if (addMapCanvasBoundsToPos) {\n        const mapBounds = this.cesiumService.getViewer().canvas.getBoundingClientRect();\n        screenPosition.x += mapBounds.left;\n        screenPosition.y += mapBounds.top;\n      }\n\n      const camera = this.cesiumService.getViewer().camera;\n      return camera.pickEllipsoid(screenPosition);\n    }\n  }\n\n  screenToCartographic(screenPos: { x: number, y: number }, ellipsoid?: any) {\n    return this.cartesian3ToCartographic(this.screenToCartesian3(screenPos), ellipsoid);\n  }\n\n  cartesian3ToCartographic(cartesian: Cartesian3, ellipsoid?: any) {\n    return Cesium.Cartographic.fromCartesian(cartesian, ellipsoid);\n  }\n\n  degreesToCartographic(longitude: number, latitude: number, height?: number) {\n    return Cesium.Cartographic.fromDegrees(longitude, latitude, height);\n  }\n\n  radiansToCartographic(longitude: number, latitude: number, height?: number) {\n    return Cesium.Cartographic.fromRadians(longitude, latitude, height);\n  }\n\n  degreesToUTM(longitude: number, latitude: number) {\n    return new LatLonEllipsoidal(latitude, longitude).toUtm();\n  }\n\n  UTMToDegrees(zone: number, hemisphereType: hemisphere, easting: number, northing: number) {\n    return this.geodesyToCesiumObject(new Utm(zone, hemisphereType, easting, northing).toLatLonE());\n  }\n\n  private geodesyToCesiumObject(geodesyRadians: LatLon) {\n    return {\n      longitude: geodesyRadians.lon,\n      latitude: geodesyRadians.lat,\n      height: geodesyRadians['height'] ? geodesyRadians['height'] : 0\n    };\n  }\n\n  /**\n   * middle point between two points\n   * @param first  (latitude,longitude) in radians\n   * @param second (latitude,longitude) in radians\n   */\n  midPointToCartesian3(first: { latitude: number, longitude: number }, second: { latitude: number, longitude: number }) {\n    const toDeg = (rad: number) => Cesium.Math.toDegrees(rad);\n    const firstPoint = new LatLonVectors(toDeg(first.latitude), toDeg(first.longitude));\n    const secondPoint = new LatLonVectors(toDeg(second.latitude), toDeg(second.longitude));\n    const middlePoint: any = firstPoint.midpointTo(secondPoint);\n\n    return Cesium.Cartesian3.fromDegrees(middlePoint.lon, middlePoint.lat);\n  }\n\n  middlePointByScreen(position0: Cartesian3, position1: Cartesian3): Cartesian3 {\n    const scene = this.cesiumService.getScene();\n    const screenPosition1 = Cesium.SceneTransforms.wgs84ToWindowCoordinates(scene, position0);\n    const screenPosition2 = Cesium.SceneTransforms.wgs84ToWindowCoordinates(scene, position1);\n    const middleScreenPoint =\n      new Cesium.Cartesian2((screenPosition2.x + screenPosition1.x) / 2.0, (screenPosition2.y + screenPosition1.y) / 2.0);\n    return scene.pickPosition(middleScreenPoint);\n  }\n\n  /**\n   * initial bearing between two points\n   *\n   * * @return bearing in degrees\n   * @param first - {latitude,longitude} in radians\n   * @param second - {latitude,longitude} in radians\n   */\n  bearingTo(first: { latitude: number, longitude: number }, second: { latitude: number, longitude: number }) {\n    const toDeg = (rad: number) => Cesium.Math.toDegrees(rad);\n    const firstPoint = new LatLonVectors(toDeg(first.latitude), toDeg(first.longitude));\n    const secondPoint = new LatLonVectors(toDeg(second.latitude), toDeg(second.longitude));\n    const bearing = firstPoint.bearingTo(secondPoint);\n\n    return bearing;\n  }\n\n  /**\n   * initial bearing between two points\n   *\n   * @return bearing in degrees\n   */\n  bearingToCartesian(firstCartesian3: Cartesian3, secondCartesian3: Cartesian3) {\n    const firstCart = Cesium.Cartographic.fromCartesian(firstCartesian3);\n    const secondCart = Cesium.Cartographic.fromCartesian(secondCartesian3);\n\n    return this.bearingTo(firstCart, secondCart);\n  }\n}\n","/**\n *  Abstract drawer. All drawers extends this class.\n */\n\nexport abstract class BasicDrawerService {\n  protected _propsAssigner: Function;\n\n  constructor() {\n  }\n\n  abstract add(cesiumProps: any, ...args: any[]): any;\n\n  abstract update(primitive: any, cesiumProps: any, ...args: any[]): void;\n\n  abstract remove(primitive: any): void;\n\n  abstract removeAll(): void;\n\n  abstract setShow(showValue: boolean): void;\n\n  abstract init(options?: any): any;\n\n  setPropsAssigner(assigner: Function) {\n    this._propsAssigner = assigner;\n  }\n}\n","import { CesiumService } from '../../cesium/cesium.service';\nimport { BasicDrawerService } from '../basic-drawer/basic-drawer.service';\n\n/**\n *  General primitives drawer responsible of drawing Cesium primitives.\n *  Drawers the handle Cesium primitives extend it.\n */\nexport abstract class PrimitivesDrawerService extends BasicDrawerService {\n  private _show = true;\n  private _primitiveCollectionWrap: any;\n  protected _cesiumCollection: any;\n  protected _propsAssigner: Function;\n\n  constructor(private drawerType: any, private cesiumService: CesiumService) {\n    super();\n  }\n\n  init() {\n    this._cesiumCollection = new this.drawerType();\n    this._primitiveCollectionWrap = new Cesium.PrimitiveCollection({destroyPrimitives: false});\n    this._primitiveCollectionWrap.add(this._cesiumCollection);\n    this.cesiumService.getScene().primitives.add(this._primitiveCollectionWrap);\n  }\n\n  add(cesiumProps: any, ...args: any[]): any {\n    return this._cesiumCollection.add(cesiumProps);\n  }\n\n  update(entity: any, cesiumProps: any, ...args: any[]) {\n    if (this._propsAssigner) {\n      this._propsAssigner(entity, cesiumProps);\n    } else {\n      Object.assign(entity, cesiumProps);\n    }\n  }\n\n  remove(entity: any) {\n    this._cesiumCollection.remove(entity);\n  }\n\n  removeAll() {\n    this._cesiumCollection.removeAll();\n  }\n\n  setShow(showValue: boolean) {\n    this._show = showValue;\n    this._primitiveCollectionWrap.show = showValue;\n  }\n\n  getShow(): boolean {\n    return this._show;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../cesium/cesium.service';\nimport { Cartesian3 } from '../../models/cartesian3';\nimport { Vec3 } from '../../models/vec3';\n\n@Injectable()\nexport class GeoUtilsService {\n  static pointByLocationDistanceAndAzimuth(currentLocation: any, meterDistance: number, radianAzimuth: number, deprecated?) {\n    const distance = meterDistance / Cesium.Ellipsoid.WGS84.maximumRadius;\n    const cartographicLocation =\n      currentLocation instanceof Cesium.Cartesian3 ? Cesium.Cartographic.fromCartesian(currentLocation) : currentLocation;\n    const cartesianLocation =\n      currentLocation instanceof Cesium.Cartesian3\n        ? currentLocation\n        : Cesium.Cartesian3.fromRadians(currentLocation.longitude, currentLocation.latitude, currentLocation.height);\n\n    let resultPosition;\n    let resultDistance;\n    let counter = 0;\n    let distanceFactorRangeMax = 0.1;\n    let distanceFactorRangeMin = -0.1;\n    while (\n      counter === 0 ||\n      (counter < 16 && Math.max(resultDistance, meterDistance) / Math.min(resultDistance, meterDistance) > 1.000001)\n      ) {\n      const factor = distanceFactorRangeMin + (distanceFactorRangeMax - distanceFactorRangeMin) / 2;\n      resultPosition = GeoUtilsService._pointByLocationDistanceAndAzimuth(cartographicLocation, distance * (1 + factor), radianAzimuth);\n      resultDistance = this.distance(cartesianLocation, resultPosition);\n\n      if (resultDistance > meterDistance) {\n        distanceFactorRangeMax = distanceFactorRangeMin + (distanceFactorRangeMax - distanceFactorRangeMin) / 2;\n      } else {\n        distanceFactorRangeMin = distanceFactorRangeMin + (distanceFactorRangeMax - distanceFactorRangeMin) / 2;\n      }\n      counter++;\n    }\n\n    return resultPosition;\n  }\n\n  static _pointByLocationDistanceAndAzimuth(cartographicLocation: any, distance: number, radianAzimuth: number) {\n    const curLat = cartographicLocation.latitude;\n    const curLon = cartographicLocation.longitude;\n    const destinationLat = Math.asin(\n      Math.sin(curLat) * Math.cos(distance) + Math.cos(curLat) * Math.sin(distance) * Math.cos(radianAzimuth),\n    );\n\n    let destinationLon =\n      curLon +\n      Math.atan2(\n        Math.sin(radianAzimuth) * Math.sin(distance) * Math.cos(curLat),\n        Math.cos(distance) - Math.sin(curLat) * Math.sin(destinationLat),\n      );\n\n    destinationLon = ((destinationLon + 3 * Math.PI) % (2 * Math.PI)) - Math.PI;\n\n    return Cesium.Cartesian3.fromRadians(destinationLon, destinationLat);\n  }\n\n  static distance(pos0: Cartesian3, pos1: Cartesian3): number {\n    return Cesium.Cartesian3.distance(pos0, pos1);\n  }\n\n  static getPositionsDelta(position0: Cartesian3, position1: Cartesian3): Vec3 {\n    return {\n      x: position1.x - position0.x,\n      y: position1.y - position0.y,\n      z: position1.z - position0.z,\n    };\n  }\n\n  static addDeltaToPosition(position: Cartesian3, delta: Vec3, updateReference = false): Cartesian3 {\n    if (updateReference) {\n      position.x += delta.x;\n      position.y += delta.y;\n      position.z += delta.z;\n      const cartographic = Cesium.Cartographic.fromCartesian(position);\n      cartographic.height = 0;\n      const cartesian = Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, cartographic.height);\n      position.x = cartesian.x;\n      position.y = cartesian.y;\n      position.z = cartesian.z;\n      return position;\n    } else {\n      const cartesian = new Cesium.Cartesian3(position.x + delta.x, position.y + delta.y, position.z + delta.z);\n      const cartographic = Cesium.Cartographic.fromCartesian(cartesian);\n      cartographic.height = 0;\n      return Cesium.Cartesian3.fromRadians(cartographic.longitude, cartographic.latitude, cartographic.height);\n    }\n  }\n\n  static middleCartesian3Point(position0: Cartesian3, position1: Cartesian3) {\n    return new Cesium.Cartesian3(position1.x - position0.x / 2, position1.y - position0.y / 2, position1.z - position0.z / 2);\n  }\n\n  constructor(private cesiumService: CesiumService) {\n  }\n\n  screenPositionToCartesian3(screenPos: { x: number; y: number }) {\n    const camera = this.cesiumService.getViewer().camera;\n    return camera.pickEllipsoid(screenPos);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\nimport { GeoUtilsService } from '../../geo-utils/geo-utils.service';\n\n/**\n +  This drawer is responsible for drawing an arc over the Cesium map.\n +  This implementation uses simple PolylineGeometry and Primitive parameters.\n +  This doesn't allow us to change the position, color, etc.. of the arc but setShow only.\n */\n\n@Injectable()\nexport class ArcDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PolylineCollection, cesiumService);\n  }\n\n  _calculateArcPositions(cesiumProps: any) {\n    const quality = cesiumProps.quality || 18;\n    const delta = (cesiumProps.delta) / quality;\n    const pointsArray = [];\n    for (let i = 0; i < quality + 1; ++i) {\n      const point =\n        GeoUtilsService.pointByLocationDistanceAndAzimuth(cesiumProps.center, cesiumProps.radius, cesiumProps.angle + delta * i, true);\n      pointsArray.push(point);\n    }\n\n    return pointsArray;\n  }\n\n  _calculateTriangle(cesiumProps: any) {\n    return [\n      cesiumProps.center,\n      GeoUtilsService.pointByLocationDistanceAndAzimuth(cesiumProps.center, cesiumProps.radius, cesiumProps.angle, true)\n    ];\n  }\n\n  _calculateArc(cesiumProps: any) {\n    const arcPoints = this._calculateArcPositions(cesiumProps);\n    return cesiumProps.drawEdges ? arcPoints.concat(this._calculateTriangle(cesiumProps)) : arcPoints;\n  }\n\n  add(cesiumProps: any): any {\n    cesiumProps.positions = this._calculateArc(cesiumProps);\n    if (cesiumProps.color) {\n      const material = Cesium.Material.fromType('Color');\n      material.uniforms.color = cesiumProps.color;\n      cesiumProps.material = material;\n    }\n\n    return this._cesiumCollection.add(cesiumProps);\n  }\n\n  update(primitive: any, cesiumProps: any) {\n    if (!cesiumProps.constantColor && cesiumProps.color &&\n      !primitive.material.uniforms.color.equals(cesiumProps.color)) {\n      primitive.material.uniforms.color = cesiumProps.color;\n    }\n    primitive.width = cesiumProps.width !== undefined ? cesiumProps.width : primitive.width;\n    primitive.show = cesiumProps.show !== undefined ? cesiumProps.show : primitive.show;\n    primitive.distanceDisplayCondition = cesiumProps.distanceDisplayCondition !== undefined ?\n      cesiumProps.distanceDisplayCondition : primitive.distanceDisplayCondition;\n    primitive.positions = this._calculateArc(cesiumProps);\n\n    return primitive;\n  }\n}\n","export enum GraphicsType {\n  ellipse = Cesium.EllipseGraphics,\n  ellipsoid = Cesium.EllipsoidGraphics,\n  polygon = Cesium.PolygonGraphics,\n  polyline = Cesium.PolylineGraphics,\n  polylineVolume = Cesium.PolylineVolumeGraphics,\n  box = Cesium.BoxGraphics,\n  corridor = Cesium.CorridorGraphics,\n  cylinder = Cesium.CylinderGraphics,\n  label = Cesium.LabelGraphics,\n  billboard = Cesium.BillboardGraphics,\n  model = Cesium.ModelGraphics,\n  path = Cesium.PathGraphics,\n  point = Cesium.PointGraphics,\n  rectangle = Cesium.RectangleGraphics,\n  wall = Cesium.WallGraphics,\n}\n","export class OptimizedEntityCollection {\n  private _updateRate: number;\n  private _collectionSize: number;\n  private _isSuspended = false;\n  private _isHardSuspend = false;\n  private _suspensionTimeout: any;\n  private _onEventSuspensionCallback: { once: boolean, callback: Function };\n  private _onEventResumeCallback: { once: boolean, callback: Function };\n\n  constructor(private entityCollection: any, collectionSize = -1, updateRate = -1) {\n    this._updateRate = updateRate;\n    this._collectionSize = collectionSize;\n\n  }\n\n  setShow(show: boolean) {\n    this.entityCollection.show = show;\n  }\n\n  get isSuspended(): boolean {\n    return this._isSuspended;\n  }\n\n  get updateRate(): number {\n    return this._updateRate;\n  }\n\n  set updateRate(value: number) {\n    this._updateRate = value;\n  }\n\n  get collectionSize(): number {\n    return this._collectionSize;\n  }\n\n  set collectionSize(value: number) {\n    this._collectionSize = value;\n  }\n\n  collection() {\n    return this.entityCollection;\n  }\n\n  isFree(): boolean {\n    return this._collectionSize < 1 || this.entityCollection.values.length < this._collectionSize;\n  }\n\n  add(entity: any) {\n    this.suspend();\n    return this.entityCollection.add(entity);\n  }\n\n  remove(entity: any) {\n    this.suspend();\n    return this.entityCollection.remove(entity);\n  }\n\n  removeNoSuspend(entity: any) {\n    this.entityCollection.remove(entity);\n  }\n\n  removeAll() {\n    this.suspend();\n    this.entityCollection.removeAll();\n  }\n\n  onEventSuspension(callback: Function, once = false): Function {\n    this._onEventSuspensionCallback = {callback, once};\n    return () => {\n      this._onEventSuspensionCallback = undefined;\n    };\n  }\n\n  onEventResume(callback: Function, once = false): Function {\n    this._onEventResumeCallback = {callback, once};\n    if (!this._isSuspended) {\n      this.triggerEventResume();\n    }\n    return () => {\n      this._onEventResumeCallback = undefined;\n    };\n  }\n\n  triggerEventSuspension() {\n    if (this._onEventSuspensionCallback !== undefined) {\n      const callback = this._onEventSuspensionCallback.callback;\n      if (this._onEventSuspensionCallback.once) {\n        this._onEventSuspensionCallback = undefined;\n      }\n      callback();\n    }\n  }\n\n  triggerEventResume() {\n    if (this._onEventResumeCallback !== undefined) {\n      const callback = this._onEventResumeCallback.callback;\n      if (this._onEventResumeCallback.once) {\n        this._onEventResumeCallback = undefined;\n      }\n      callback();\n    }\n  }\n\n  public suspend() {\n    if (this._updateRate < 0) {\n      return;\n    }\n    if (this._isHardSuspend) {\n      return;\n    }\n    if (!this._isSuspended) {\n      this._isSuspended = true;\n      this.entityCollection.suspendEvents();\n      this.triggerEventSuspension();\n      this._suspensionTimeout = setTimeout(() => {\n        this.entityCollection.resumeEvents();\n        this.triggerEventResume();\n        this._isSuspended = false;\n        this._suspensionTimeout = undefined;\n      }, this._updateRate);\n    }\n  }\n\n  public hardSuspend() {\n    this.entityCollection.suspendEvents();\n    this._isHardSuspend = true;\n  }\n\n  public hardResume() {\n    this.entityCollection.resumeEvents();\n    this._isHardSuspend = false;\n  }\n\n}\n","import { BasicDrawerService } from '../basic-drawer/basic-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from './enums/graphics-type.enum';\nimport { EntitiesDrawerOptions } from '../../../models/entities-drawer-options';\nimport { OptimizedEntityCollection } from './optimized-entity-collection';\n\n/**\n *  General primitives drawer responsible of drawing Cesium primitives.\n *  Drawers the handle Cesium primitives extend it.\n */\n\nexport class EntitiesDrawerService extends BasicDrawerService {\n  private entityCollections = new Map<any, OptimizedEntityCollection>();\n  private graphicsTypeName: string;\n\n  constructor(\n    private cesiumService: CesiumService,\n    private graphicsType: GraphicsType,\n    private defaultOptions: EntitiesDrawerOptions = {\n      collectionMaxSize: -1,\n      collectionSuspensionTime: -1,\n      collectionsNumber: 1,\n    },\n  ) {\n    super();\n    this.graphicsTypeName = GraphicsType[this.graphicsType];\n\n    // Fix bad enum compilation\n    for (const i in GraphicsType) {\n      if (GraphicsType[i] as any === this.graphicsType) {\n        this.graphicsTypeName = i;\n      }\n    }\n  }\n\n  private getFreeEntitiesCollection(): OptimizedEntityCollection {\n    let freeEntityCollection = null;\n    this.entityCollections.forEach(entityCollection => {\n      if (entityCollection.isFree()) {\n        freeEntityCollection = entityCollection;\n      }\n    });\n\n    return freeEntityCollection;\n  }\n\n  init(options?: EntitiesDrawerOptions) {\n    const finalOptions = options || this.defaultOptions;\n    const dataSources = [];\n    for (let i = 0; i < finalOptions.collectionsNumber; i++) {\n      const dataSource = new Cesium.CustomDataSource(this.graphicsTypeName);\n      dataSources.push(dataSource);\n      this.cesiumService.getViewer().dataSources.add(dataSource);\n      this.entityCollections.set(\n        dataSource.entities,\n        new OptimizedEntityCollection(dataSource.entities, finalOptions.collectionMaxSize, finalOptions.collectionSuspensionTime),\n      );\n    }\n\n    return dataSources;\n  }\n\n  add(cesiumProps: any): any {\n    const optimizedEntityCollection = this.getFreeEntitiesCollection();\n    if (optimizedEntityCollection === null) {\n      throw new Error('No more free entity collections');\n    }\n\n    const graphicsClass = this.graphicsType as any;\n    const entityObject = {\n      position: cesiumProps.position !== undefined ? cesiumProps.position : undefined,\n      description: cesiumProps.description !== undefined ? cesiumProps.description : undefined,\n      orientation: cesiumProps.orientation !== undefined ? cesiumProps.orientation : undefined,\n      viewFrom: cesiumProps.viewFrom !== undefined ? cesiumProps.viewFrom : undefined,\n      [this.graphicsTypeName]: cesiumProps,\n    };\n\n    if (cesiumProps.name !== undefined) {\n      entityObject.name = cesiumProps.name;\n    }\n\n    return optimizedEntityCollection.add(entityObject);\n  }\n\n  update(entity: any, cesiumProps: any) {\n    this.suspendEntityCollection(entity);\n\n    if (entity.position instanceof Cesium.CallbackProperty) {\n      if (entity.position._isConstant) {\n        entity.position = cesiumProps.position;\n      }\n    }\n    entity.position = cesiumProps.position !== undefined ? cesiumProps.position : undefined;\n    entity.name = cesiumProps.name !== undefined ? cesiumProps.name : entity.name;\n    entity.description = cesiumProps.description !== undefined ? cesiumProps.description : entity.description;\n    entity.orientation = cesiumProps.orientation !== undefined ? cesiumProps.orientation : entity.orientation;\n    entity.viewFrom = cesiumProps.viewFrom !== undefined ? cesiumProps.viewFrom : entity.viewFrom;\n\n    if (this._propsAssigner) {\n      this._propsAssigner(entity[this.graphicsTypeName], cesiumProps);\n    } else {\n      Object.assign(entity[this.graphicsTypeName], cesiumProps);\n    }\n  }\n\n  remove(entity: any) {\n    const optimizedEntityCollection = this.entityCollections.get(entity.entityCollection);\n    optimizedEntityCollection.remove(entity);\n  }\n\n  removeAll() {\n    this.entityCollections.forEach(entityCollection => {\n      entityCollection.removeAll();\n    });\n  }\n\n  setShow(showValue: boolean) {\n    this.entityCollections.forEach(entityCollection => {\n      entityCollection.setShow(showValue);\n    });\n  }\n\n  private suspendEntityCollection(entity: any) {\n    const id = entity.entityCollection;\n    if (!this.entityCollections.has(id)) {\n      throw new Error('No EntityCollection for entity.entityCollection');\n    }\n\n    const entityCollection = this.entityCollections.get(id);\n    entityCollection.suspend();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing billboards.\n */\n@Injectable()\nexport class BillboardDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.billboard);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { BasicDrawerService } from '../basic-drawer/basic-drawer.service';\nimport { EntitiesDrawerOptions } from '../../../models/entities-drawer-options';\n\n/**\n *  This drawer is responsible for drawing czml dataSources.\n */\n@Injectable()\nexport class CzmlDrawerService extends BasicDrawerService {\n\n  czmlStream: any;\n\n  constructor(\n    private cesiumService: CesiumService,\n  ) {\n    super();\n  }\n\n\n  init(options?: EntitiesDrawerOptions) {\n    const dataSources = [];\n\n    this.czmlStream = new Cesium.CzmlDataSource('czml');\n\n    dataSources.push(this.czmlStream);\n\n    this.cesiumService.getViewer().dataSources.add(this.czmlStream);\n\n    return dataSources;\n  }\n\n  // returns the packet, provided by the stream\n  add(cesiumProps: any): any {\n\n    this.czmlStream.process(cesiumProps.czmlPacket);\n\n    return cesiumProps;\n  }\n\n  update(entity: any, cesiumProps: any) {\n    this.czmlStream.process(cesiumProps.czmlPacket);\n  }\n\n  remove(entity: any) {\n    this.czmlStream.entities.removeById(entity.acEntity.id);\n  }\n\n  removeAll() {\n    this.czmlStream.entities.removeAll();\n  }\n\n  setShow(showValue: boolean) {\n    this.czmlStream.entities.show = showValue;\n  }\n\n}\n\n\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing ellipses.\n */\n@Injectable()\nexport class EllipseDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.ellipse, {\n      collectionsNumber: 10,\n      collectionMaxSize: 450,\n      collectionSuspensionTime: 100\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing labels.\n */\n@Injectable()\nexport class LabelDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.label);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing points.\n */\n@Injectable()\nexport class PointDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.point);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing polygons.\n */\n@Injectable()\nexport class PolygonDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.polygon);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible of drawing polylines.\n */\n@Injectable()\nexport class PolylineDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.polyline);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\n\n/**\n *  This drawer is responsible of drawing polylines as primitives.\n *  This drawer is more efficient than PolylineDrawerService when drawing dynamic polylines.\n */\n@Injectable()\nexport class PolylinePrimitiveDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PolylineCollection, cesiumService);\n  }\n\n  add(cesiumProps: any) {\n    return this._cesiumCollection.add(this.withColorMaterial(cesiumProps));\n  }\n\n  update(cesiumObject: any, cesiumProps: any) {\n    if (cesiumProps.material instanceof Cesium.Color) {\n      if (cesiumObject.material && cesiumObject.material.uniforms &&\n        cesiumObject.material.uniforms.color instanceof Cesium.Color) {\n        this.withColorMaterial(cesiumProps);\n      } else if (!cesiumObject.material.uniforms.color.equals(cesiumProps.material)) {\n        cesiumObject.material.uniforms.color = cesiumProps.material;\n      }\n    }\n    super.update(cesiumObject, cesiumProps);\n  }\n\n  withColorMaterial(cesiumProps: any) {\n    if (cesiumProps.material instanceof Cesium.Color) {\n      const material = Cesium.Material.fromType('Color');\n      material.uniforms.color = cesiumProps.material;\n      cesiumProps.material = material;\n    }\n\n    return cesiumProps;\n  }\n}\n","export enum KeyboardAction {\n  CAMERA_FORWARD,\n  CAMERA_BACKWARD,\n  CAMERA_RIGHT,\n  CAMERA_LEFT,\n  CAMERA_UP,\n  CAMERA_DOWN,\n  CAMERA_LOOK_RIGHT,\n  CAMERA_LOOK_LEFT,\n  CAMERA_LOOK_UP,\n  CAMERA_LOOK_DOWN,\n  CAMERA_TWIST_RIGHT,\n  CAMERA_TWIST_LEFT,\n  CAMERA_ROTATE_RIGHT,\n  CAMERA_ROTATE_LEFT,\n  CAMERA_ROTATE_UP,\n  CAMERA_ROTATE_DOWN,\n  CAMERA_ZOOM_IN,\n  CAMERA_ZOOM_OUT,\n}\n","import { KeyboardAction } from '../../models/ac-keyboard-action.enum';\nimport { KeyboardControlActionFn } from './keyboard-control.service';\nimport { CesiumService } from '../cesium/cesium.service';\n\nconst CAMERA_MOVEMENT_DEFAULT_FACTOR = 100.0;\nconst CAMERA_LOOK_DEFAULT_FACTOR = 0.01;\nconst CAMERA_TWIST_DEFAULT_FACTOR = 0.01;\nconst CAMERA_ROTATE_DEFAULT_FACTOR = 0.01;\n\nexport const PREDEFINED_KEYBOARD_ACTIONS: { [key: number]: KeyboardControlActionFn } = {\n  /**\n   * Moves the camera forward, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_FORWARD]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveForward(moveRate);\n  },\n  /**\n   * Moves the camera backward, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_BACKWARD]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveBackward(moveRate);\n  },\n  /**\n   * Moves the camera up, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_UP]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveUp(moveRate);\n  },\n  /**\n   * Moves the camera down, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_DOWN]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveDown(moveRate);\n  },\n  /**\n   * Moves the camera right, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_RIGHT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveRight(moveRate);\n  },\n  /**\n   * Moves the camera left, accepts a numeric parameter named `moveRate` that controls\n   * the factor of movement, according to the camera height.\n   */\n  [KeyboardAction.CAMERA_LEFT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const scene = cesiumService.getScene();\n    const cameraHeight = scene.globe.ellipsoid.cartesianToCartographic(camera.position).height;\n    const moveRate = cameraHeight / (params.moveRate || CAMERA_MOVEMENT_DEFAULT_FACTOR);\n    camera.moveLeft(moveRate);\n  },\n  /**\n   * Changes the camera to look to the right, accepts a numeric parameter named `lookFactor` that controls\n   * the factor of looking, according to the camera current position.\n   */\n  [KeyboardAction.CAMERA_LOOK_RIGHT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const currentPosition = camera.positionCartographic;\n    const lookFactor = params.lookFactor || CAMERA_LOOK_DEFAULT_FACTOR;\n    camera.lookRight(currentPosition.latitude * lookFactor);\n  },\n  /**\n   * Changes the camera to look to the left, accepts a numeric parameter named `lookFactor` that controls\n   * the factor of looking, according to the camera current position.\n   */\n  [KeyboardAction.CAMERA_LOOK_LEFT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const currentPosition = camera.positionCartographic;\n    const lookFactor = params.lookFactor || CAMERA_LOOK_DEFAULT_FACTOR;\n    camera.lookLeft(currentPosition.latitude * lookFactor);\n  },\n  /**\n   * Changes the camera to look up, accepts a numeric parameter named `lookFactor` that controls\n   * the factor of looking, according to the camera current position.\n   */\n  [KeyboardAction.CAMERA_LOOK_UP]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const currentPosition = camera.positionCartographic;\n    const lookFactor = params.lookFactor || CAMERA_LOOK_DEFAULT_FACTOR;\n    camera.lookUp(currentPosition.longitude * (lookFactor * -1));\n  },\n  /**\n   * Changes the camera to look down, accepts a numeric parameter named `lookFactor` that controls\n   * the factor of looking, according to the camera current position.\n   */\n  [KeyboardAction.CAMERA_LOOK_DOWN]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const currentPosition = camera.positionCartographic;\n    const lookFactor = params.lookFactor || CAMERA_LOOK_DEFAULT_FACTOR;\n    camera.lookDown(currentPosition.longitude * (lookFactor * -1));\n  },\n  /**\n   * Twists the camera to the right, accepts a numeric parameter named `amount` that controls\n   * the twist amount\n   */\n  [KeyboardAction.CAMERA_TWIST_RIGHT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.amount || CAMERA_TWIST_DEFAULT_FACTOR;\n    camera.twistRight(lookFactor);\n  },\n  /**\n   * Twists the camera to the left, accepts a numeric parameter named `amount` that controls\n   * the twist amount\n   */\n  [KeyboardAction.CAMERA_TWIST_LEFT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.amount || CAMERA_TWIST_DEFAULT_FACTOR;\n    camera.twistLeft(lookFactor);\n  },\n  /**\n   * Rotates the camera to the right, accepts a numeric parameter named `angle` that controls\n   * the rotation angle\n   */\n  [KeyboardAction.CAMERA_ROTATE_RIGHT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.angle || CAMERA_ROTATE_DEFAULT_FACTOR;\n    camera.rotateRight(lookFactor);\n  },\n  /**\n   * Rotates the camera to the left, accepts a numeric parameter named `angle` that controls\n   * the rotation angle\n   */\n  [KeyboardAction.CAMERA_ROTATE_LEFT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.angle || CAMERA_ROTATE_DEFAULT_FACTOR;\n    camera.rotateLeft(lookFactor);\n  },\n  /**\n   * Rotates the camera upwards, accepts a numeric parameter named `angle` that controls\n   * the rotation angle\n   */\n  [KeyboardAction.CAMERA_ROTATE_UP]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.angle || CAMERA_ROTATE_DEFAULT_FACTOR;\n    camera.rotateUp(lookFactor);\n  },\n  /**\n   * Rotates the camera downwards, accepts a numeric parameter named `angle` that controls\n   * the rotation angle\n   */\n  [KeyboardAction.CAMERA_ROTATE_DOWN]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const lookFactor = params.angle || CAMERA_ROTATE_DEFAULT_FACTOR;\n    camera.rotateDown(lookFactor);\n  },\n  /**\n   * Zoom in into the current camera center position, accepts a numeric parameter named\n   * `amount` that controls the amount of zoom in meters.\n   */\n  [KeyboardAction.CAMERA_ZOOM_IN]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const amount = params.amount;\n    camera.zoomIn(amount);\n  },\n  /**\n   * Zoom out from the current camera center position, accepts a numeric parameter named\n   * `amount` that controls the amount of zoom in meters.\n   */\n  [KeyboardAction.CAMERA_ZOOM_OUT]: (cesiumService: CesiumService, params: any) => {\n    const camera = cesiumService.getViewer().camera;\n    const amount = params.amount;\n    camera.zoomOut(amount);\n  },\n};\n","import { isNumber } from 'util';\nimport { Inject, Injectable, NgZone } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { KeyboardAction } from '../../models/ac-keyboard-action.enum';\nimport { CesiumService } from '../cesium/cesium.service';\nimport { PREDEFINED_KEYBOARD_ACTIONS } from './predefined-actions';\n\nexport type KeyboardControlActionFn = (cesiumService: CesiumService, params: any, event: KeyboardEvent) => boolean | void;\nexport type KeyboardControlValidationFn = (cesiumService: CesiumService, params: any, event: KeyboardEvent) => boolean;\nexport type KeyboardControlDoneFn = (cesiumService: CesiumService, event: KeyboardEvent) => boolean;\n\nexport interface KeyboardControlParams {\n  action: KeyboardAction | KeyboardControlActionFn;\n  validation?: KeyboardControlValidationFn;\n  params?: { [paramName: string]: any };\n  done?: KeyboardControlDoneFn;\n}\n\nexport interface KeyboardControlDefinition {\n  [keyboardCharCode: string]: KeyboardControlParams;\n}\n\nenum KeyEventState {\n  IGNORED,\n  NOT_PRESSED,\n  PRESSED,\n}\n\ninterface ActiveDefinition {\n  keyboardEvent: KeyboardEvent;\n  state: KeyEventState;\n  action: KeyboardControlParams;\n}\n\n/**\n *  Service that manages keyboard keys and execute actions per request.\n *  Inject the keyboard control service into any layer, under your `ac-map` component,\n *  And defined you keyboard handlers using `setKeyboardControls`.\n *\n * <caption>Simple Example</caption>\n * ```typescript\n * Component({\n *   selector: 'keyboard-control-layer',\n *   template: '',\n * })\n * export class KeyboardControlLayerComponent implements OnInit, OnDestroy {\n *   constructor(private keyboardControlService: KeyboardControlService) {}\n *\n *   ngOnInit() {\n *     this.keyboardControlService.setKeyboardControls({\n *       W: { action: KeyboardAction.CAMERA_FORWARD },\n *       S: { action: KeyboardAction.CAMERA_BACKWARD },\n *       D: { action: KeyboardAction.CAMERA_RIGHT },\n *       A: { action: KeyboardAction.CAMERA_LEFT },\n *     });\n *    }\n *\n *   ngOnDestroy() {\n *     this.keyboardControlService.removeKeyboardControls();\n *   }\n * }\n * ```\n *\n * <caption>Advanced Example</caption>\n * ```typescript\n * Component({\n *   selector: 'keyboard-control-layer',\n *   template: '',\n * })\n * export class KeyboardControlLayerComponent implements OnInit, OnDestroy {\n *   constructor(private keyboardControlService: KeyboardControlService) {}\n *\n *   private myCustomValue = 10;\n *\n *   ngOnInit() {\n *     this.keyboardControlService.setKeyboardControls({\n *       W: {\n *          action: KeyboardAction.CAMERA_FORWARD,\n *          validate: (camera, scene, params, key) => {\n *            // Replace `checkCamera` you with your validation logic\n *            if (checkCamera(camera) || params.customParams === true) {\n *              return true;\n *            }\n *\n *            return false;\n *          },\n *          params: () => {\n *            return {\n *              myValue: this.myCustomValue,\n *            };\n *          },\n *        }\n *     });\n *    }\n *\n *   ngOnDestroy() {\n *     this.keyboardControlService.removeKeyboardControls();\n *   }\n * }\n * ```\n * <b>Predefined keyboard actions:</b>\n * + `KeyboardAction.CAMERA_FORWARD` - Moves the camera forward, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_BACKWARD` - Moves the camera backward, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_UP` - Moves the camera up, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_DOWN` - Moves the camera down, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_RIGHT` - Moves the camera right, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_LEFT` - Moves the camera left, accepts a numeric parameter named `moveRate` that controls\n * the factor of movement, according to the camera height.\n * + `KeyboardAction.CAMERA_LOOK_RIGHT` - Changes the camera to look to the right, accepts a numeric parameter named `lookFactor` that\n * controls the factor of looking, according to the camera current position.\n * + `KeyboardAction.CAMERA_LOOK_LEFT` - Changes the camera to look to the left, accepts a numeric parameter named `lookFactor` that\n * controls the factor of looking, according to the camera current position.\n * + `KeyboardAction.CAMERA_LOOK_UP` - Changes the camera to look up, accepts a numeric parameter named `lookFactor` that controls\n * the factor of looking, according to the camera current position.\n * + `KeyboardAction.CAMERA_LOOK_DOWN` - Changes the camera to look down, accepts a numeric parameter named `lookFactor` that controls\n * the factor of looking, according to the camera current position.\n * + `KeyboardAction.CAMERA_TWIST_RIGHT` - Twists the camera to the right, accepts a numeric parameter named `amount` that controls\n * the twist amount\n * + `KeyboardAction.CAMERA_TWIST_LEFT` - Twists the camera to the left, accepts a numeric parameter named `amount` that controls\n * the twist amount\n * + `KeyboardAction.CAMERA_ROTATE_RIGHT` - Rotates the camera to the right, accepts a numeric parameter named `angle` that controls\n * the rotation angle\n * + `KeyboardAction.CAMERA_ROTATE_LEFT` - Rotates the camera to the left, accepts a numeric parameter named `angle` that controls\n * the rotation angle\n * + `KeyboardAction.CAMERA_ROTATE_UP` - Rotates the camera upwards, accepts a numeric parameter named `angle` that controls\n * the rotation angle\n * + `KeyboardAction.CAMERA_ROTATE_DOWN` - Rotates the camera downwards, accepts a numeric parameter named `angle` that controls\n * the rotation angle\n * + `KeyboardAction.CAMERA_ZOOM_IN` - Zoom in into the current camera center position, accepts a numeric parameter named\n * `amount` that controls the amount of zoom in meters.\n * + `KeyboardAction.CAMERA_ZOOM_OUT` -  Zoom out from the current camera center position, accepts a numeric parameter named\n * `amount` that controls the amount of zoom in meters.\n */\n@Injectable()\nexport class KeyboardControlService {\n  private _currentDefinitions: KeyboardControlDefinition = null;\n  private _activeDefinitions: { [definitionKey: string]: ActiveDefinition } = {};\n  private _keyMappingFn: Function = this.defaultKeyMappingFn;\n\n  /**\n   * Creats the keyboard control service.\n   */\n  constructor(private ngZone: NgZone, private cesiumService: CesiumService, @Inject(DOCUMENT) private document: any) {\n  }\n\n  /**\n   * Initializes the keyboard control service.\n   */\n  init() {\n    const canvas = this.cesiumService.getCanvas();\n    canvas.addEventListener('click', () => {\n      canvas.focus();\n    });\n\n    this.handleKeydown = this.handleKeydown.bind(this);\n    this.handleKeyup = this.handleKeyup.bind(this);\n    this.handleTick = this.handleTick.bind(this);\n  }\n\n  /**\n   * Sets the current map keyboard control definitions.\n   * The definitions is a key mapping between a key string and a KeyboardControlDefinition:\n   * - `action` is a predefine action from `KeyboardAction` enum, or a custom method:\n   * `(camera, scene, params, key) => boolean | void` - returning false will cancel the current keydown.\n   * - `validation` is a method that validates if the event should occur or not (`camera, scene, params, key`)\n   * - `params` is an object (or function that returns object) that will be passed into the action executor.\n   * - `done` is a function that will be triggered when `keyup` is triggered.\n   * @param definitions Keyboard Control Definition\n   * @param keyMappingFn - Mapping function for custom keys\n   * @param outsideOfAngularZone - if key down events will run outside of angular zone.\n   */\n  setKeyboardControls(definitions: KeyboardControlDefinition,\n                      keyMappingFn?: (keyEvent: KeyboardEvent) => string,\n                      outsideOfAngularZone = false) {\n    if (!definitions) {\n      return this.removeKeyboardControls();\n    }\n\n    if (!this._currentDefinitions) {\n      this.registerEvents(outsideOfAngularZone);\n    }\n\n    this._currentDefinitions = definitions;\n    this._keyMappingFn = keyMappingFn || this.defaultKeyMappingFn;\n\n    Object.keys(this._currentDefinitions).forEach(key => {\n      this._activeDefinitions[key] = {\n        state: KeyEventState.NOT_PRESSED,\n        action: null,\n        keyboardEvent: null,\n      };\n    });\n  }\n\n  /**\n   * Removes the current set of keyboard control items, and unregister from map events.\n   */\n  removeKeyboardControls() {\n    this.unregisterEvents();\n    this._currentDefinitions = null;\n  }\n\n  /**\n   * Returns the current action that handles `char` key string, or `null` if not exists\n   */\n  private getAction(char: string): KeyboardControlParams {\n    return this._currentDefinitions[char] || null;\n  }\n\n  /**\n   * The default `defaultKeyMappingFn` that maps `KeyboardEvent` into a key string.\n   */\n  private defaultKeyMappingFn(keyEvent: KeyboardEvent): string {\n    return String.fromCharCode(keyEvent.keyCode);\n  }\n\n  /**\n   * document's `keydown` event handler\n   */\n  private handleKeydown(e: KeyboardEvent) {\n    const char = this._keyMappingFn(e);\n    const action = this.getAction(char);\n\n    if (action) {\n      const actionState = this._activeDefinitions[char];\n\n      if (actionState.state !== KeyEventState.IGNORED) {\n        let execute = true;\n\n        const params = this.getParams(action.params, e);\n\n        if (action.validation) {\n          execute = action.validation(this.cesiumService, params, e);\n        }\n\n        if (execute === true) {\n          this._activeDefinitions[char] = {\n            state: KeyEventState.PRESSED,\n            action,\n            keyboardEvent: e,\n          };\n        }\n      }\n    }\n  }\n\n  /**\n   * document's `keyup` event handler\n   */\n  private handleKeyup(e: KeyboardEvent) {\n    const char = this._keyMappingFn(e);\n    const action = this.getAction(char);\n\n    if (action) {\n      this._activeDefinitions[char] = {\n        state: KeyEventState.NOT_PRESSED,\n        action: null,\n        keyboardEvent: e,\n      };\n\n      if (action.done && typeof action.done === 'function') {\n        action.done(this.cesiumService, e);\n      }\n    }\n  }\n\n  /**\n   * `tick` event handler that triggered by Cesium render loop\n   */\n  private handleTick() {\n    const activeKeys = Object.keys(this._activeDefinitions);\n\n    activeKeys.forEach(key => {\n      const actionState = this._activeDefinitions[key];\n\n      if (actionState !== null && actionState.action !== null && actionState.state === KeyEventState.PRESSED) {\n        this.executeAction(actionState.action, key, actionState.keyboardEvent);\n      }\n    });\n  }\n\n  /**\n   *\n   * Params resolve function, returns object.\n   * In case of params function, executes it and returns it's return value.\n   *\n   */\n  private getParams(paramsDef: any, keyboardEvent: KeyboardEvent): { [paramName: string]: any } {\n    if (!paramsDef) {\n      return {};\n    }\n\n    if (typeof paramsDef === 'function') {\n      return paramsDef(this.cesiumService, keyboardEvent);\n    }\n\n    return paramsDef;\n  }\n\n  /**\n   *\n   * Executes a given `KeyboardControlParams` object.\n   *\n   */\n  private executeAction(execution: KeyboardControlParams, key: string, keyboardEvent: KeyboardEvent) {\n    if (!this._currentDefinitions) {\n      return;\n    }\n\n    const params = this.getParams(execution.params, keyboardEvent);\n\n    if (isNumber(execution.action)) {\n      const predefinedAction = PREDEFINED_KEYBOARD_ACTIONS[execution.action as number];\n\n      if (predefinedAction) {\n        predefinedAction(this.cesiumService, params, keyboardEvent);\n      }\n    } else if (typeof execution.action === 'function') {\n      const shouldCancelEvent = execution.action(this.cesiumService, params, keyboardEvent);\n\n      if (shouldCancelEvent === false) {\n        this._activeDefinitions[key] = {\n          state: KeyEventState.IGNORED,\n          action: null,\n          keyboardEvent: null,\n        };\n      }\n    }\n  }\n\n  /**\n   * Registers to keydown, keyup of `document`, and `tick` of Cesium.\n   */\n  private registerEvents(outsideOfAngularZone: boolean) {\n    const registerToEvents = () => {\n      this.document.addEventListener('keydown', this.handleKeydown);\n      this.document.addEventListener('keyup', this.handleKeyup);\n      this.cesiumService.getViewer().clock.onTick.addEventListener(this.handleTick);\n    };\n\n    if (outsideOfAngularZone) {\n      this.ngZone.runOutsideAngular(registerToEvents);\n    } else {\n      registerToEvents();\n    }\n  }\n\n  /**\n   * Unregisters to keydown, keyup of `document`, and `tick` of Cesium.\n   */\n  private unregisterEvents() {\n    this.document.removeEventListener('keydown', this.handleKeydown);\n    this.document.removeEventListener('keyup', this.handleKeyup);\n    this.cesiumService.getViewer().clock.onTick.removeEventListener(this.handleTick);\n  }\n}\n","import { Observable, Subscriber } from 'rxjs';\nimport { CesiumEvent } from '../consts/cesium-event.enum';\nimport { CesiumEventModifier } from '../consts/cesium-event-modifier.enum';\n\nexport class CesiumPureEventObserver {\n  public observer: Observable<any>;\n\n  constructor(protected event: CesiumEvent, protected modifier: CesiumEventModifier) {\n  }\n\n  init(eventsHandler: any): Observable<any> {\n    this.observer = Observable.create((observer: Subscriber<any>) => {\n        eventsHandler.setInputAction((movement: any) => {\n          if (movement.position) {\n            movement.startPosition = movement.position;\n            movement.endPosition = movement.position;\n          }\n          observer.next(movement);\n        }, this.event, this.modifier);\n      }\n    );\n    return this.observer;\n  }\n}\n","import { ConnectableObservable, of as observableOf } from 'rxjs';\n\nimport { delay, mergeMap, publish, takeUntil } from 'rxjs/operators';\nimport { CesiumPureEventObserver } from './cesium-pure-event-observer';\nimport { CesiumEvent } from '../consts/cesium-event.enum';\nimport { CesiumEventModifier } from '../consts/cesium-event-modifier.enum';\nimport { CesiumEventBuilder } from '../cesium-event-builder';\n\nexport class CesiumLongPressObserver extends CesiumPureEventObserver {\n  public static LONG_PRESS_EVENTS_DURATION = 250;\n\n  constructor(protected event: CesiumEvent,\n              protected modifier: CesiumEventModifier,\n              private eventFactory: CesiumEventBuilder) {\n    super(event, modifier);\n  }\n\n  init(): ConnectableObservable<any> {\n    let startEvent: CesiumEvent;\n    let stopEvent: CesiumEvent;\n\n    if (this.event === CesiumEvent.LONG_LEFT_PRESS) {\n      startEvent = CesiumEvent.LEFT_DOWN;\n      stopEvent = CesiumEvent.LEFT_UP;\n    } else if (this.event === CesiumEvent.LONG_RIGHT_PRESS) {\n      startEvent = CesiumEvent.RIGHT_DOWN;\n      stopEvent = CesiumEvent.RIGHT_UP;\n    } else if (this.event === CesiumEvent.LONG_MIDDLE_PRESS) {\n      startEvent = CesiumEvent.MIDDLE_DOWN;\n      stopEvent = CesiumEvent.MIDDLE_UP;\n    }\n\n    const startEventObservable = this.eventFactory.get(startEvent, this.modifier);\n    const stopEventObservable = this.eventFactory.get(stopEvent, this.modifier);\n\n    // publish for preventing side effect\n    const longPressObservable = publish()(startEventObservable.pipe(\n      mergeMap((e) => observableOf(e).pipe(\n        delay(CesiumLongPressObserver.LONG_PRESS_EVENTS_DURATION),\n        takeUntil(stopEventObservable))),\n    ));\n    return longPressObservable;\n  }\n}\n","import { publish } from 'rxjs/operators';\nimport { CesiumService } from '../cesium/cesium.service';\nimport { CesiumEvent } from './consts/cesium-event.enum';\nimport { CesiumEventModifier } from './consts/cesium-event-modifier.enum';\nimport { Injectable } from '@angular/core';\nimport { CesiumPureEventObserver } from './event-observers/cesium-pure-event-observer';\nimport { CesiumLongPressObserver } from './event-observers/cesium-long-press-observer';\nimport { ConnectableObservable } from 'rxjs';\n\n@Injectable()\nexport class CesiumEventBuilder {\n\n  constructor(private cesiumService: CesiumService) {\n  }\n\n  public static longPressEvents: Set<CesiumEvent> = new Set([\n    CesiumEvent.LONG_LEFT_PRESS,\n    CesiumEvent.LONG_RIGHT_PRESS,\n    CesiumEvent.LONG_MIDDLE_PRESS\n  ]);\n\n  private eventsHandler: any;\n  private cesiumEventsObservables = new Map<string, ConnectableObservable<any>>();\n\n  public static getEventFullName(event: CesiumEvent, modifier?: CesiumEventModifier): string {\n    if (modifier) {\n      return `${event}_${modifier}`;\n    } else {\n      return event.toString();\n    }\n  }\n\n  init() {\n    this.eventsHandler = this.cesiumService.getViewer().screenSpaceEventHandler;\n  }\n\n  get(event: CesiumEvent, modifier?: CesiumEventModifier): ConnectableObservable<any> {\n    const eventName = CesiumEventBuilder.getEventFullName(event, modifier);\n    if (this.cesiumEventsObservables.has(eventName)) {\n      return this.cesiumEventsObservables.get(eventName);\n    } else {\n      const eventObserver = this.createCesiumEventObservable(event, modifier);\n      this.cesiumEventsObservables.set(eventName, eventObserver);\n      return eventObserver;\n    }\n  }\n\n  private createCesiumEventObservable(event: CesiumEvent, modifier?: CesiumEventModifier): ConnectableObservable<any> {\n    let cesiumEventObservable: ConnectableObservable<any>;\n    if (CesiumEventBuilder.longPressEvents.has(event)) {\n      cesiumEventObservable = this.createSpecialCesiumEventObservable(event, modifier);\n    } else {\n      cesiumEventObservable = publish()(new CesiumPureEventObserver(event, modifier).init(this.eventsHandler));\n    }\n    cesiumEventObservable.connect();\n    return cesiumEventObservable;\n  }\n\n  private createSpecialCesiumEventObservable(event: CesiumEvent, modifier: CesiumEventModifier): ConnectableObservable<any> {\n    // could support more events if needed\n    return new CesiumLongPressObserver(event, modifier, this).init();\n  }\n}\n\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { AcEntity } from '../../models/ac-entity';\nimport { Subject } from 'rxjs';\nimport { EventResult, Movement } from '../map-events-mananger/map-events-manager';\n\n/**\n * Service for solving plonter.\n * Used by map-event-manager and plonter context component\n */\n@Injectable()\nexport class PlonterService {\n  private _plonterShown: boolean;\n  private _entitesToPlonter: AcEntity[] = [];\n  private _plonterObserver: Subject<EventResult>;\n  private _eventResult: EventResult;\n  private _plonterChangeNotifier: EventEmitter<any> = new EventEmitter();\n\n  constructor() {\n    this._plonterObserver = new Subject<EventResult>();\n  }\n\n  get plonterChangeNotifier(): EventEmitter<any> {\n    return this._plonterChangeNotifier;\n  }\n\n  get plonterShown(): boolean {\n    return this._plonterShown;\n  }\n\n  get entitesToPlonter(): AcEntity[] {\n    return this._entitesToPlonter;\n  }\n\n  get plonterClickPosition(): Movement {\n    return this._eventResult.movement;\n  }\n\n  plonterIt(eventResult: EventResult) {\n    this._eventResult = eventResult;\n    this._entitesToPlonter = eventResult.entities;\n    this._plonterShown = true;\n\n    this._plonterChangeNotifier.emit();\n    return this._plonterObserver;\n  }\n\n  resolvePlonter(entity: AcEntity) {\n    this._plonterShown = false;\n    this._eventResult.entities = [entity];\n\n    this._plonterChangeNotifier.emit();\n    this._plonterObserver.next(this._eventResult);\n  }\n}\n","export const UtilsService = {\n  unique: (array: any[]): any[] => {\n    return array.reduce((accumulator, currentValue) => {\n      if (accumulator.indexOf(currentValue) < 0) {\n        accumulator.push(currentValue);\n      }\n      return accumulator;\n    }, []);\n  }\n};\n\n","import { CesiumEvent } from '../consts/cesium-event.enum';\n\nexport class CesiumDragDropHelper {\n\n  public static dragEvents: Set<CesiumEvent> = new Set([\n    CesiumEvent.LEFT_CLICK_DRAG,\n    CesiumEvent.RIGHT_CLICK_DRAG,\n    CesiumEvent.MIDDLE_CLICK_DRAG\n  ]);\n\n\n  public static getDragEventTypes(dragEvent: CesiumEvent) {\n    let mouseDownEvent;\n    let mouseUpEvent;\n    if (dragEvent === CesiumEvent.LEFT_CLICK_DRAG) {\n      mouseDownEvent = CesiumEvent.LEFT_DOWN;\n      mouseUpEvent = CesiumEvent.LEFT_UP;\n    } else if (dragEvent === CesiumEvent.RIGHT_CLICK_DRAG) {\n      mouseDownEvent = CesiumEvent.RIGHT_DOWN;\n      mouseUpEvent = CesiumEvent.RIGHT_UP;\n    } else if (dragEvent === CesiumEvent.MIDDLE_CLICK_DRAG) {\n      mouseDownEvent = CesiumEvent.MIDDLE_DOWN;\n      mouseUpEvent = CesiumEvent.MIDDLE_UP;\n    }\n\n    return {mouseDownEvent, mouseUpEvent};\n  }\n}\n","import { merge, Observable, of as observableOf, Subject } from 'rxjs';\n\nimport { filter, map, mergeMap, switchMap, takeUntil, tap } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { CesiumService } from '../cesium/cesium.service';\nimport { CesiumEventBuilder } from './cesium-event-builder';\nimport { EventRegistrationInput } from './event-registration-input';\nimport { DisposableObservable } from './disposable-observable';\nimport { PickOptions } from './consts/pickOptions.enum';\nimport { CesiumEvent } from './consts/cesium-event.enum';\nimport { CesiumEventModifier } from './consts/cesium-event-modifier.enum';\nimport { PlonterService } from '../plonter/plonter.service';\nimport { UtilsService } from '../../utils/utils.service';\nimport { CesiumDragDropHelper } from './event-observers/cesium-drag-drop-helper';\n\nclass Registration {\n  constructor(public observable: Observable<EventResult>,\n              public  stopper: Subject<any>,\n              public  priority: number,\n              public  isPaused: boolean) {\n  }\n}\n\n/**\n * Returns screen position, drag boolean for drag events only\n */\nexport interface Movement {\n  startPosition: { x: number, y: number };\n  endPosition: { x: number, y: number };\n  drop?: boolean;\n}\n\nexport interface EventResult {\n  movement: Movement;\n  cesiumEntities: any[];\n  entities: any[];\n}\n\n/**\n * Manages all map events. Notice events will run outside of Angular zone.\n * Provided by `<ac-map/>` component there for could be injected at any component under `<ac-map/>` hierarchy\n * or from the `<ac-map/>` component reference `acMapComponent.getMapEventsManager()`\n *\n * __usage:__\n * ```\n * MapEventsManagerService.register({event, modifier, priority, entityType, pickOption}).subscribe()\n * ```\n * __param:__ {CesiumEvent} event\n * __param:__ {CesiumEventModifier} modifier\n * __param:__ priority - the bigger the number the bigger the priority. default : 0.\n * __param:__ entityType - entity type class that you are interested like (Track). the class must extends AcEntity\n * __param:__ pickOption - self explained\n */\n@Injectable()\nexport class MapEventsManagerService {\n\n  private scene: any;\n  private eventRegistrations = new Map<string, Registration[]>();\n\n  constructor(private cesiumService: CesiumService,\n              private eventBuilder: CesiumEventBuilder,\n              private plonterService: PlonterService) {\n  }\n\n  init() {\n    this.eventBuilder.init();\n    this.scene = this.cesiumService.getScene();\n  }\n\n  /**\n   * Register to map event\n   * @param input Event Registration Input\n   *\n   * @returns DisposableObservable<EventResult>\n   */\n  register(input: EventRegistrationInput): DisposableObservable<EventResult> {\n    if (this.scene === undefined) {\n      throw new Error('CesiumService has not been initialized yet - MapEventsManagerService must be injected  under ac-map');\n    }\n\n    input.pick = input.pick || PickOptions.NO_PICK;\n    input.priority = input.priority || 0;\n\n    if (input.entityType && input.pick === PickOptions.NO_PICK) {\n      throw new Error('MapEventsManagerService: can\\'t register an event ' +\n        'with entityType and PickOptions.NO_PICK - It doesn\\'t make sense ');\n    }\n\n    const eventName = CesiumEventBuilder.getEventFullName(input.event, input.modifier);\n\n    if (!this.eventRegistrations.has(eventName)) {\n      this.eventRegistrations.set(eventName, []);\n    }\n\n    const eventRegistration = this.createEventRegistration(\n      input.event,\n      input.modifier,\n      input.entityType,\n      input.pick,\n      input.priority,\n      input.pickFilter);\n    const registrationObservable: any = eventRegistration.observable;\n    registrationObservable.dispose = () => this.disposeObservable(eventRegistration, eventName);\n    this.eventRegistrations.get(eventName).push(eventRegistration);\n\n    this.sortRegistrationsByPriority(eventName);\n    return <DisposableObservable<EventResult>> registrationObservable;\n  }\n\n  private disposeObservable(eventRegistration: Registration, eventName: string) {\n    eventRegistration.stopper.next(1);\n    const registrations = this.eventRegistrations.get(eventName);\n    const index = registrations.indexOf(eventRegistration);\n    if (index !== -1) {\n      registrations.splice(index, 1);\n    }\n    this.sortRegistrationsByPriority(eventName);\n  }\n\n  private sortRegistrationsByPriority(eventName: string) {\n    const registrations = this.eventRegistrations.get(eventName);\n    registrations.sort((a, b) => b.priority - a.priority);\n    if (registrations.length === 0) {\n      return;\n    }\n\n    // Active registrations by priority\n    const currentPriority = registrations[0].priority;\n    registrations.forEach((registration) => {\n      registration.isPaused = registration.priority < currentPriority;\n    });\n\n  }\n\n  private createEventRegistration(event: CesiumEvent,\n                                  modifier: CesiumEventModifier,\n                                  entityType: any,\n                                  pickOption: PickOptions,\n                                  priority: number,\n                                  pickFilter?: (any) => boolean): Registration {\n    const cesiumEventObservable = this.eventBuilder.get(event, modifier);\n    const stopper = new Subject<any>();\n\n    const registration = new Registration(undefined, stopper, priority, false);\n    let observable: Observable<EventResult>;\n\n    if (!CesiumDragDropHelper.dragEvents.has(event)) {\n      observable = cesiumEventObservable.pipe(\n        filter(() => !registration.isPaused),\n        map((movement) => this.triggerPick(movement, pickOption)),\n        filter((result) => result.cesiumEntities !== null || entityType === undefined),\n        map((picksAndMovement) => this.addEntities(picksAndMovement, entityType, pickOption, pickFilter)),\n        filter((result) => result.entities !== null || (entityType === undefined && !pickFilter)),\n        switchMap((entitiesAndMovement) => this.plonter(entitiesAndMovement, pickOption)),\n        takeUntil(stopper), );\n    } else {\n      observable = this.createDragEvent(event, modifier, entityType, pickOption, priority, pickFilter).pipe(takeUntil(stopper));\n    }\n\n    registration.observable = observable;\n    return registration;\n  }\n\n  private createDragEvent(event: CesiumEvent,\n                          modifier: CesiumEventModifier,\n                          entityType: any,\n                          pickOption: PickOptions,\n                          priority: number,\n                          pickFilter?: (any) => boolean): Observable<EventResult> {\n    const { mouseDownEvent, mouseUpEvent } = CesiumDragDropHelper.getDragEventTypes(event);\n\n    const mouseUpObservable = this.eventBuilder.get(mouseUpEvent);\n    const mouseMoveObservable = this.eventBuilder.get(CesiumEvent.MOUSE_MOVE);\n\n    const mouseDownRegistration = this.createEventRegistration(mouseDownEvent, modifier, entityType, pickOption, priority, pickFilter);\n\n    const dropSubject = new Subject<EventResult>();\n    const dragObserver = mouseDownRegistration.observable.pipe(mergeMap(e => {\n      let lastMove: any = null;\n      const dragStartPositionX = e.movement.startPosition.x;\n      const dragStartPositionY = e.movement.startPosition.y;\n      return mouseMoveObservable.pipe(map((movement) => {\n        lastMove = {\n          movement: {\n            drop: false,\n            startPosition: {\n              x: dragStartPositionX,\n              y: dragStartPositionY,\n            },\n            endPosition: movement.endPosition,\n          },\n          entities: e.entities,\n          cesiumEntities: e.cesiumEntities\n        };\n        return lastMove;\n      }), takeUntil(mouseUpObservable), tap(undefined, undefined, () => {\n        // On complete\n        if (lastMove) {\n          const dropEvent = Object.assign({}, lastMove);\n          dropEvent.movement.drop = true;\n          dropSubject.next(dropEvent);\n        }\n      }), );\n    }));\n\n    return merge(dragObserver, dropSubject);\n\n  }\n\n  private triggerPick(movement: any, pickOptions: PickOptions) {\n    let picks: any = [];\n    switch (pickOptions) {\n      case PickOptions.PICK_ONE:\n      case PickOptions.PICK_ALL:\n        picks = this.scene.drillPick(movement.endPosition);\n        picks = picks.length === 0 ? null : picks;\n        break;\n      case PickOptions.PICK_FIRST:\n        const pick = this.scene.pick(movement.endPosition);\n        picks = pick === undefined ? null : [pick];\n        break;\n      case PickOptions.NO_PICK:\n        break;\n      default:\n        break;\n    }\n\n    // Picks can be cesium entity or cesium primitive\n    if (picks) {\n      picks = picks.map((pick: any) => pick.id && pick.id instanceof Cesium.Entity ? pick.id : pick.primitive);\n    }\n\n    return { movement: movement, cesiumEntities: picks };\n  }\n\n  private addEntities(picksAndMovement: any, entityType: any, pickOption: PickOptions, pickFilter?: (any) => boolean): EventResult {\n\n    if (picksAndMovement.cesiumEntities === null) {\n      picksAndMovement.entities = null;\n      return picksAndMovement;\n    }\n    let entities = [];\n    if (pickOption !== PickOptions.NO_PICK) {\n      if (entityType) {\n        entities = picksAndMovement.cesiumEntities.map((pick: any) => pick.acEntity).filter((acEntity: any) => {\n          return acEntity && acEntity instanceof entityType;\n        });\n      } else {\n        entities = picksAndMovement.cesiumEntities.map((pick: any) => pick.acEntity);\n      }\n\n      entities = UtilsService.unique(entities);\n      entities = (pickFilter && entities) ? entities.filter(pickFilter) : entities;\n      if (entities.length === 0) {\n        entities = null;\n      }\n    }\n\n    picksAndMovement.entities = entities;\n\n    return picksAndMovement;\n  }\n\n  private plonter(entitiesAndMovement: EventResult, pickOption: PickOptions): Observable<EventResult> {\n    if (pickOption === PickOptions.PICK_ONE && entitiesAndMovement.entities !== null && entitiesAndMovement.entities.length > 1) {\n      return this.plonterService.plonterIt(entitiesAndMovement);\n    } else {\n      return observableOf(entitiesAndMovement);\n    }\n  }\n}\n","import { CesiumService } from '../cesium/cesium.service';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class MapLayersService {\n\n  private layersDataSources: any[] = [];\n\n  constructor(private cesiumService: CesiumService) {\n\n  }\n\n  registerLayerDataSources(dataSources: any[], zIndex: number) {\n    dataSources.forEach(ds => {\n      ds.zIndex = zIndex;\n      this.layersDataSources.push(ds);\n    });\n  }\n\n  drawAllLayers() {\n    this.layersDataSources.sort((a, b) => a.zIndex - b.zIndex);\n\n    this.layersDataSources.forEach((dataSource) => {\n      this.cesiumService.getViewer().dataSources.add(dataSource);\n    });\n  }\n\n  updateAndRefresh(dataSources: any[], newZIndex: number) {\n    if (dataSources && dataSources.length) {\n      dataSources.forEach((ds) => {\n        const index = this.layersDataSources.indexOf(ds);\n        if (index !== -1) {\n          this.layersDataSources[index].zIndex = newZIndex;\n        }\n      });\n\n      this.cesiumService.getViewer().dataSources.removeAll();\n      this.drawAllLayers();\n    }\n  }\n\n  removeDataSources(dataSources: any[]) {\n    dataSources.forEach(ds => {\n      const index = this.layersDataSources.indexOf(ds);\n      if (index !== -1) {\n        this.layersDataSources.splice(index, 1);\n        this.cesiumService.getViewer().dataSources.remove(ds, true);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AcMapComponent } from '../../components/ac-map/ac-map.component';\n\n/**\n *  The service manages `ac-map` instances. `ac-map` register itself to this service.\n *  This allows retrieval of maps provided services outside of `ac-map` scope.\n */\n@Injectable()\nexport class MapsManagerService {\n  private defaultIdCounter = 0;\n  private _Maps = new Map<string, AcMapComponent>();\n  private firstMap: any;\n  private eventRemoveCallbacks: Function[] = [];\n\n  constructor() {\n  }\n\n  getMap(id?: string): AcMapComponent | undefined {\n    if (!id) {\n      return this.firstMap;\n    }\n    return this._Maps.get(id);\n  }\n\n  _registerMap(id: string, acMap: AcMapComponent): string {\n    if (!this.firstMap) {\n      this.firstMap = acMap;\n    }\n\n    const mapId = id ? id : this.generateDefaultId();\n    if (this._Maps.has(mapId)) {\n      throw new Error(`Map with id: ${mapId} already exist`);\n    }\n    this._Maps.set(mapId, acMap);\n    return mapId;\n  }\n\n  _removeMapById(id: string) {\n    if (this._Maps.has(id) && this._Maps.get(id) === this.firstMap) {\n      const iter = this._Maps.values();\n      iter.next(); // skip firstMap\n      this.firstMap = iter.next().value;\n    }\n    return this._Maps.delete(id);\n  }\n\n  private generateDefaultId(): string {\n    this.defaultIdCounter++;\n    return 'default-map-id-' + this.defaultIdCounter;\n  }\n\n  /**\n   * Binds multiple 2D map's cameras together.\n   * @param mapsConfiguration - binding options.\n   * mapId - the id of the maps to bind.\n   * sensitivity - the amount the camera position should change in order to sync other maps.\n   * bindZoom - should bind zoom level\n   */\n  sync2DMapsCameras(mapsConfiguration: { id: string; sensitivity?: number; bindZoom?: boolean }[]) {\n    const DEFAULT_SENSITIVITY = 0.01;\n    this.unsyncMapsCameras();\n    const maps: { map: AcMapComponent; options?: { sensitivity?: number; bindZoom?: boolean } }[] = mapsConfiguration.map(config => {\n      const map = this.getMap(config.id);\n      if (!map) {\n        throw new Error(`Couldn't find map with id: ${config.id}`);\n      }\n\n      return {map, options: {sensitivity: config.sensitivity, bindZoom: config.bindZoom}};\n    });\n\n    maps.forEach(masterMapConfig => {\n      const masterMap = masterMapConfig.map;\n      const options = masterMapConfig.options;\n      const masterCamera = masterMap.getCameraService().getCamera();\n      const masterCameraCartographic = masterCamera.positionCartographic;\n      masterCamera.percentageChanged = options.sensitivity || DEFAULT_SENSITIVITY;\n      const removeCallback = masterCamera.changed.addEventListener(() => {\n        maps.forEach(slaveMapConfig => {\n          const slaveMap = slaveMapConfig.map;\n          const slaveMapOptions = slaveMapConfig.options;\n          if (slaveMap === masterMap) {\n            return;\n          }\n\n          const slaveCamera = slaveMap.getCameraService().getCamera();\n          const slaveCameraCartographic = slaveCamera.positionCartographic;\n          const position = Cesium.Ellipsoid.WGS84.cartographicToCartesian({\n            longitude: masterCameraCartographic.longitude,\n            latitude: masterCameraCartographic.latitude,\n            height: slaveMapOptions.bindZoom ? masterCameraCartographic.height : slaveCameraCartographic.height,\n          });\n\n          if (slaveMap.getCesiumViewer().scene.mode !== Cesium.SceneMode.MORPHING) {\n            slaveCamera.setView({\n              destination: position,\n              orientation: {\n                heading: slaveCamera.heading,\n                pitch: slaveCamera.pitch,\n              },\n            });\n          }\n        });\n      });\n      this.eventRemoveCallbacks.push(removeCallback);\n    });\n  }\n\n  /**\n   * Unsyncs maps cameras\n   */\n  unsyncMapsCameras() {\n    this.eventRemoveCallbacks.forEach(removeCallback => removeCallback());\n    this.eventRemoveCallbacks = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../cesium/cesium.service';\n\n/**\n * Take screenshot of your cesium globe.\n *\n * usage:\n * ```typescript\n * // get base 64 data url\n * const dataUrl = screenshotService.getMapScreenshotDataUrl();\n *\n * // or download as png\n * screenshotService.downloadMapScreenshot('my-map.png');\n *\n * ```\n *\n */\n@Injectable()\nexport class ScreenshotService {\n  constructor(private cesiumService: CesiumService) {\n  }\n\n  getMapScreenshotDataUrlBase64() {\n    const canvas = this.cesiumService.getCanvas();\n    return canvas.toDataURL();\n  }\n\n\n  downloadMapScreenshot(filename = 'map.png') {\n    const dataUrl = this.getMapScreenshotDataUrlBase64();\n    this.downloadURI(dataUrl, filename);\n  }\n\n  private downloadURI(uri: string, name: string) {\n    const link = document.createElement('a');\n    link.download = name;\n    link.href = uri;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { AfterViewInit, Component, ElementRef, Inject, Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { ConfigurationService } from '../../cesium-enhancements/ConfigurationService';\nimport { SceneMode } from '../../models/scene-mode.enum';\nimport { CameraService } from '../../services/camera/camera.service';\nimport { CesiumService } from '../../services/cesium/cesium.service';\nimport { ContextMenuService } from '../../services/context-menu/context-menu.service';\nimport { CoordinateConverter } from '../../services/coordinate-converter/coordinate-converter.service';\nimport { ArcDrawerService } from '../../services/drawers/arc-drawer/arc-drawer.service';\nimport { BillboardDrawerService } from '../../services/drawers/billboard-drawer/billboard-drawer.service';\nimport { CzmlDrawerService } from '../../services/drawers/czml-drawer/czml-drawer.service';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\nimport { LabelDrawerService } from '../../services/drawers/label-drawer/label-drawer.service';\nimport { PointDrawerService } from '../../services/drawers/point-drawer/point-drawer.service';\nimport { PolygonDrawerService } from '../../services/drawers/polygon-drawer/polygon-drawer.service';\nimport { PolylineDrawerService } from '../../services/drawers/polyline-drawer/polyline-drawer.service';\nimport { PolylinePrimitiveDrawerService } from '../../services/drawers/polyline-primitive-drawer/polyline-primitive-drawer.service';\nimport { KeyboardControlService } from '../../services/keyboard-control/keyboard-control.service';\nimport { CesiumEventBuilder } from '../../services/map-events-mananger/cesium-event-builder';\nimport { MapEventsManagerService } from '../../services/map-events-mananger/map-events-manager';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\nimport { MapsManagerService } from '../../services/maps-manager/maps-manager.service';\nimport { PlonterService } from '../../services/plonter/plonter.service';\nimport { ScreenshotService } from '../../services/screenshot/screenshot.service';\n\n/**\n * This is a map implementation, creates the cesium map.\n * Every layer should be tag inside ac-map tag\n *\n * Accessing cesium viewer:\n * 1. acMapComponent.getCesiumViewer()\n * 2. Use MapManagerService.getMap().getCesiumViewer() or if more then one map: MapManagerService.getMap(mapId).getCesiumViewer()\n *\n *\n * @example\n * <ac-map>\n *     <ac-map-layer-provider></ac-map-layer-provider>\n *     <dynamic-ellipse-layer #layer></dynamic-ellipse-layer>\n * </ac-map>\n */\n@Component({\n  selector: 'ac-map',\n  template: `\n    <ac-default-plonter *ngIf=\"!disableDefaultPlonter\"></ac-default-plonter>\n    <ac-context-menu-wrapper></ac-context-menu-wrapper>\n    <ng-content></ng-content>\n  `,\n  providers: [\n    CesiumService,\n    BillboardDrawerService,\n    CesiumEventBuilder,\n    KeyboardControlService,\n    MapEventsManagerService,\n    PlonterService,\n    LabelDrawerService,\n    PolylineDrawerService,\n    PolylinePrimitiveDrawerService,\n    EllipseDrawerService,\n    PointDrawerService,\n    ArcDrawerService,\n    CzmlDrawerService,\n    PolygonDrawerService,\n    MapLayersService,\n    CameraService,\n    ScreenshotService,\n    ContextMenuService,\n    CoordinateConverter,\n  ],\n})\nexport class AcMapComponent implements OnChanges, OnInit, AfterViewInit, OnDestroy {\n  /**\n   * Disable default plonter context menu\n   */\n  @Input()\n  disableDefaultPlonter = false;\n\n  /**\n   * Set the id name of the map\n   * default: 'default-map-id-[index]'\n   */\n  @Input()\n  mapId: string;\n\n  /**\n   * flyTo options according to https://cesiumjs.org/Cesium/Build/Documentation/Camera.html?classFilter=cam#flyTo\n   */\n  @Input()\n  flyTo: any;\n\n  /**\n   * Sets the map's SceneMode\n   */\n  @Input()\n  sceneMode: SceneMode;\n\n  /**\n   * Optional - the container element's id in which the map's canvas will be appended to.\n   * If not supplied - the container element will be the parent element of ac-map;\n   */\n  @Input()\n  containerId: string;\n\n  private mapContainer: HTMLElement;\n\n  constructor(\n    private _cesiumService: CesiumService,\n    private _cameraService: CameraService,\n    private _elemRef: ElementRef,\n    @Inject(DOCUMENT) private document,\n    private mapsManagerService: MapsManagerService,\n    private billboardDrawerService: BillboardDrawerService,\n    private labelDrawerService: LabelDrawerService,\n    private ellipseDrawerService: EllipseDrawerService,\n    private polylineDrawerService: PolylineDrawerService,\n    private polygonDrawerService: PolygonDrawerService,\n    private arcDrawerService: ArcDrawerService,\n    private pointDrawerService: PointDrawerService,\n    private czmlDrawerService: CzmlDrawerService,\n    private mapEventsManager: MapEventsManagerService,\n    private keyboardControlService: KeyboardControlService,\n    private mapLayersService: MapLayersService,\n    private configurationService: ConfigurationService,\n    private screenshotService: ScreenshotService,\n    public contextMenuService: ContextMenuService,\n    private coordinateConverter: CoordinateConverter,\n  ) {\n    this.mapContainer = this.document.createElement('div');\n    this.mapContainer.style.width = '100%';\n    this.mapContainer.style.height = '100%';\n    this.mapContainer.className = 'map-container';\n    this._cesiumService.init(this.mapContainer, this);\n    this._cameraService.init(this._cesiumService);\n    this.mapEventsManager.init();\n    this.billboardDrawerService.init();\n    this.labelDrawerService.init();\n    this.ellipseDrawerService.init();\n    this.polylineDrawerService.init();\n    this.polygonDrawerService.init();\n    this.arcDrawerService.init();\n    this.pointDrawerService.init();\n    this.czmlDrawerService.init();\n    this.keyboardControlService.init();\n    this.contextMenuService.init(this.mapEventsManager);\n  }\n\n  ngOnInit() {\n    this.mapId = this.mapsManagerService._registerMap(this.mapId, this);\n    if (!this.containerId) {\n      this._elemRef.nativeElement.appendChild(this.mapContainer);\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['sceneMode']) {\n      this._cameraService.setSceneMode(changes['sceneMode'].currentValue);\n    }\n    if (changes['flyTo']) {\n      this._cameraService.cameraFlyTo(changes['flyTo'].currentValue);\n    }\n    if (changes['containerId'] && !changes['containerId'].firstChange) {\n      const element = this.document.getElementById(changes['containerId'].currentValue);\n      if (element) {\n        element.appendChild(this.mapContainer);\n      } else {\n        throw new Error(`No element found with id: ${changes['containerId'].currentValue}`);\n      }\n    }\n  }\n\n  ngAfterViewInit(): void {\n    this.mapLayersService.drawAllLayers();\n    if (this.containerId) {\n      setTimeout(() => {\n        const element = this.document.getElementById(this.containerId);\n        if (element) {\n          element.appendChild(this.mapContainer);\n        } else {\n          throw new Error(`No element found with id: ${this.containerId}`);\n        }\n      }, 0);\n    }\n  }\n\n  ngOnDestroy(): void {\n    const viewer = this.getCesiumViewer();\n    viewer.destroy();\n    this.mapContainer.remove();\n    this.mapsManagerService._removeMapById(this.mapId);\n  }\n\n  /**\n   * @returns ac-map's cesium service\n   */\n  getCesiumSerivce() {\n    return this._cesiumService;\n  }\n\n  /**\n   * @returns map's cesium viewer\n   */\n  getCesiumViewer() {\n    return this._cesiumService.getViewer();\n  }\n\n\n  getCameraService(): CameraService {\n    return this._cameraService;\n  }\n\n  getId() {\n    return this.mapId;\n  }\n\n\n  getMapContainer() {\n    return this.mapContainer;\n  }\n\n\n  getMapEventsManager(): MapEventsManagerService {\n    return this.mapEventsManager;\n  }\n\n  getContextMenuService(): ContextMenuService {\n    return this.contextMenuService;\n  }\n\n  getScreenshotService() {\n    return this.screenshotService;\n  }\n\n  getKeyboardControlService() {\n    return this.keyboardControlService;\n  }\n\n  getCoordinateConverter() {\n    return this.coordinateConverter;\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { IDescription } from '../../models/description';\nimport { LayerOptions } from '../../models/layer-options';\n\n@Injectable()\nexport class LayerService {\n  private _context: any;\n  private _options: LayerOptions;\n  private _show: boolean;\n  private _zIndex: number;\n  private _entityName: string;\n  private _cache = true;\n  private descriptions: IDescription[] = [];\n  private layerUpdate = new EventEmitter();\n\n  get cache(): boolean {\n    return this._cache;\n  }\n\n  set cache(value: boolean) {\n    this._cache = value;\n  }\n\n  get zIndex(): number {\n    return this._zIndex;\n  }\n\n  set zIndex(value: number) {\n    if (value !== this._zIndex) {\n      this.layerUpdate.emit();\n    }\n    this._zIndex = value;\n  }\n\n  get show(): boolean {\n    return this._show;\n  }\n\n  set show(value: boolean) {\n    if (value !== this._show) {\n      this.layerUpdate.emit();\n    }\n    this._show = value;\n  }\n\n  get options(): LayerOptions {\n    return this._options;\n  }\n\n  set options(value: LayerOptions) {\n    this._options = value;\n    this.layerUpdate.emit();\n  }\n\n  get context(): any {\n    return this._context;\n  }\n\n  set context(context) {\n    this._context = context;\n    this.layerUpdate.emit();\n  }\n\n  setEntityName(name: string) {\n    this._entityName = name;\n  }\n\n  getEntityName(): string {\n    return this._entityName;\n  }\n\n  registerDescription(descriptionComponent: IDescription) {\n    if (this.descriptions.indexOf(descriptionComponent) < 0) {\n      this.descriptions.push(descriptionComponent);\n    }\n  }\n\n  unregisterDescription(descriptionComponent: IDescription) {\n    const index = this.descriptions.indexOf(descriptionComponent);\n    if (index > -1) {\n      this.descriptions.splice(index, 1);\n    }\n  }\n\n  getDescriptions(): IDescription[] {\n    return this.descriptions;\n  }\n\n  layerUpdates(): EventEmitter<any> {\n    return this.layerUpdate;\n  }\n}\n","/**\n * Action to do on entity\n */\nexport enum ActionType {\n  ADD_UPDATE,\n  DELETE\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class ComputationCache {\n  private _cache = new Map<string, any>();\n\n  get(expression: string, insertFn: (() => any)): any {\n    if (this._cache.has(expression)) {\n      return this._cache.get(expression);\n    }\n\n    const value = insertFn();\n    this._cache.set(expression, value);\n    return value;\n  }\n\n  clear() {\n    this._cache.clear();\n  }\n}\n","export class Checker {\n  static throwIfAnyNotPresent(values: Object, propertyNames: string[]) {\n    propertyNames.forEach(propertyName => Checker.throwIfNotPresent(values, propertyName));\n  }\n\n  static throwIfNotPresent(value: any, name: string) {\n    if (!Checker.present(value[name])) {\n      throw new Error(`Error: ${name} was not given.`);\n    }\n  }\n\n  static present(value: any) {\n    return value !== undefined && value !== null;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../../cesium/cesium.service';\nimport { Checker } from '../../../../utils/checker';\nimport { EllipsePrimitive } from 'primitive-primitives';\nimport { PrimitivesDrawerService } from '../../primitives-drawer/primitives-drawer.service';\n\n\n/**\n *  This drawer is responsible for creating the dynamic version of the ellipse component.\n *  We are using the primitive-primitives implementation of an ellipse. see: https://github.com/gotenxds/Primitive-primitives\n *  This allows us to change the position of the ellipses without creating a new primitive object\n *  as Cesium does not allow updating an ellipse.\n */\n@Injectable()\nexport class DynamicEllipseDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PrimitiveCollection, cesiumService);\n  }\n\n  add(cesiumProps: any): any {\n    Checker.throwIfAnyNotPresent(cesiumProps, ['center', 'semiMajorAxis', 'semiMinorAxis']);\n\n    return super.add(new EllipsePrimitive(cesiumProps));\n  }\n\n  update(ellipse: any, cesiumProps: any): any {\n    ellipse.updateLocationData(cesiumProps);\n\n    return ellipse;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../../primitives-drawer/primitives-drawer.service';\n\n/**\n *  This drawer is responsible for creating the dynamic version of the polyline component.\n */\n@Injectable()\nexport class DynamicPolylineDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PolylineCollection, cesiumService);\n  }\n}\n","import { PrimitivesDrawerService } from '../../primitives-drawer/primitives-drawer.service';\nimport { CesiumService } from '../../../cesium/cesium.service';\n\n/**\n *\n * This drawer is deprecated.\n * General static primitives drawer responsible of drawing static Cesium primitives with material.\n */\nexport abstract class StaticPrimitiveDrawer extends PrimitivesDrawerService {\n  constructor(private geometryType: any, cesiumService: CesiumService) {\n    super(Cesium.PrimitiveCollection, cesiumService);\n  }\n\n  add(geometryProps: any, instanceProps: any, primitiveProps: any): any {\n    instanceProps.geometry = new this.geometryType(geometryProps);\n    primitiveProps.geometryInstances = new Cesium.GeometryInstance(instanceProps);\n    primitiveProps.asynchronous = false;\n    const primitive = new Cesium.Primitive(primitiveProps);\n    return super.add(primitive);\n  }\n\n  update(primitive: any, geometryProps: any, instanceProps: any, primitiveProps: any) {\n    instanceProps.geometry = new this.geometryType(geometryProps);\n    primitiveProps.geometryInstances = new Cesium.GeometryInstance(instanceProps);\n    this._cesiumCollection.remove(primitive);\n    return super.add(new Cesium.Primitive(primitiveProps));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../../cesium/cesium.service';\nimport { StaticPrimitiveDrawer } from '../static-primitive-drawer/static-primitive-drawer.service';\n\n/**\n *  This drawer is responsible for creating the static version of the circle component.\n */\n@Injectable()\nexport class StaticCircleDrawerService extends StaticPrimitiveDrawer {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.CircleGeometry, cesiumService);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../../cesium/cesium.service';\nimport { StaticPrimitiveDrawer } from '../static-primitive-drawer/static-primitive-drawer.service';\n\n/**\n *  This drawer is responsible for creating the static version of the polyline component.\n *  This also allows us to change the color of the polylines.\n */\n@Injectable()\nexport class StaticPolylineDrawerService extends StaticPrimitiveDrawer {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PolylineGeometry, cesiumService);\n  }\n\n  /**\n   * Update function can only change the primitive color.\n   */\n  update(primitive: any, geometryProps: any, instanceProps: any, primitiveProps: any) {\n    const color = instanceProps.attributes.color.value;\n\n    if (primitive.ready) {\n      primitive.getGeometryInstanceAttributes().color = color;\n    } else {\n      Cesium.when(primitive.readyPromise).then((readyPrimitive: any) => {\n        readyPrimitive.getGeometryInstanceAttributes().color.value = color;\n      });\n    }\n\n    return primitive;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { StaticPrimitiveDrawer } from '../static-primitive-drawer/static-primitive-drawer.service';\nimport { CesiumService } from '../../../cesium/cesium.service';\n\n/**\n + This drawer is responsible for drawing a polygon over the Cesium map.\n + This implementation uses simple PolygonGeometry and Primitive parameters.\n + This doesn't allow us to change the position, color, etc.. of the polygons. For that you may use the dynamic polygon component.\n */\n@Injectable()\nexport class StaticPolygonDrawerService extends StaticPrimitiveDrawer {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PolygonGeometry, cesiumService);\n  }\n}\n","import { CesiumService } from '../../../cesium/cesium.service';\nimport { Injectable } from '@angular/core';\nimport { StaticPrimitiveDrawer } from '../static-primitive-drawer/static-primitive-drawer.service';\n\n\n/**\n + *  This drawer is responsible for drawing an ellipse over the Cesium map.\n + *  This implementation uses simple EllipseGeometry and Primitive parameters.\n + *  This doesn't allow us to change the position, color, etc.. of the ellipses. For that you may use the dynamic ellipse component.\n + */\n@Injectable()\nexport class StaticEllipseDrawerService extends StaticPrimitiveDrawer {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.EllipseGeometry, cesiumService);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing models.\n */\n@Injectable()\nexport class ModelDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.model);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing box.\n */\n@Injectable()\nexport class BoxDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.box);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing corridors .\n */\n@Injectable()\nexport class CorridorDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.corridor);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing cylinders.\n */\n@Injectable()\nexport class CylinderDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.cylinder);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing ellipsoid.\n */\n@Injectable()\nexport class EllipsoidDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.ellipsoid);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing polylines.\n */\n@Injectable()\nexport class PolylineVolumeDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.polylineVolume);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing polygons.\n */\n@Injectable()\nexport class WallDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.wall);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EntitiesDrawerService } from '../entities-drawer/entities-drawer.service';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { GraphicsType } from '../entities-drawer/enums/graphics-type.enum';\n\n/**\n *  This drawer is responsible for drawing rectangle.\n */\n@Injectable()\nexport class RectangleDrawerService extends EntitiesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(cesiumService, GraphicsType.rectangle);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\n\n/**\n *  This drawer is responsible for drawing labels as primitives.\n *  This drawer is more efficient than LabelDrawerService when drawing dynamic labels.\n */\n@Injectable()\nexport class LabelPrimitiveDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.LabelCollection, cesiumService);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\n\n/**\n *  This drawer is responsible for drawing billboards as primitives.\n *  This drawer is more efficient than BillboardDrawerService when drawing dynamic billboards.\n */\n@Injectable()\nexport class BillboardPrimitiveDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.BillboardCollection, cesiumService);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\n\n/**\n *  This drawer is responsible of drawing points as primitives.\n *  This drawer is more efficient than PointDrawerService when drawing dynamic points.\n */\n@Injectable()\nexport class PointPrimitiveDrawerService extends PrimitivesDrawerService {\n  constructor(cesiumService: CesiumService) {\n    super(Cesium.PointPrimitiveCollection, cesiumService);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { CesiumService } from '../../cesium/cesium.service';\nimport { PrimitivesDrawerService } from '../primitives-drawer/primitives-drawer.service';\n\n@Injectable()\nexport class HtmlDrawerService extends PrimitivesDrawerService {\n  constructor(private _cesiumService: CesiumService) {\n    super(Cesium.HtmlCollection, _cesiumService);\n  }\n\n  add(cesiumProps: any): any {\n    cesiumProps.scene = this._cesiumService.getScene();\n    cesiumProps.mapContainer = this._cesiumService.getMap().getMapContainer();\n    return super.add(cesiumProps);\n  }\n}\n","import { from as observableFrom, merge as observableMerge, Observable, Subject } from 'rxjs';\n\nimport { takeUntil } from 'rxjs/operators';\n// tslint:disable\nimport { BillboardDrawerService } from '../../services/drawers/billboard-drawer/billboard-drawer.service';\nimport { AfterContentInit, ChangeDetectionStrategy, Component, Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { AcNotification } from '../../models/ac-notification';\nimport { ActionType } from '../../models/action-type.enum';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LabelDrawerService } from '../../services/drawers/label-drawer/label-drawer.service';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\nimport { PolylineDrawerService } from '../../services/drawers/polyline-drawer/polyline-drawer.service';\nimport { ArcDrawerService } from '../../services/drawers/arc-drawer/arc-drawer.service';\nimport { PointDrawerService } from '../../services/drawers/point-drawer/point-drawer.service';\nimport { AcEntity } from '../../models/ac-entity';\nimport { BasicDrawerService } from '../../services/drawers/basic-drawer/basic-drawer.service';\nimport { PolygonDrawerService } from '../../services/drawers/polygon-drawer/polygon-drawer.service';\nimport { LayerOptions } from '../../models/layer-options';\nimport { DynamicEllipseDrawerService } from '../../services/drawers/static-dynamic/ellipse-drawer/dynamic-ellipse-drawer.service';\nimport { DynamicPolylineDrawerService } from '../../services/drawers/static-dynamic/dynamic-polyline-drawer/dynamic-polyline-drawer.service';\nimport { StaticCircleDrawerService } from '../../services/drawers/static-dynamic/static-circle-drawer/static-circle-drawer.service';\nimport { StaticPolylineDrawerService } from '../../services/drawers/static-dynamic/static-polyline-drawer/static-polyline-drawer.service';\nimport { StaticPolygonDrawerService } from '../../services/drawers/static-dynamic/static-polygon-drawer/polygon-drawer.service';\nimport { StaticEllipseDrawerService } from '../../services/drawers/static-dynamic/ellipse-drawer/ellipse-drawer.service';\nimport { ModelDrawerService } from '../../services/drawers/model-drawer/model-drawer.service';\nimport { BoxDrawerService } from '../../services/drawers/box-dawer/box-drawer.service';\nimport { CorridorDrawerService } from '../../services/drawers/corridor-dawer/corridor-drawer.service';\nimport { CylinderDrawerService } from '../../services/drawers/cylinder-dawer/cylinder-drawer.service';\nimport { EllipsoidDrawerService } from '../../services/drawers/ellipoid-drawer/ellipsoid-drawer.service';\nimport { PolylineVolumeDrawerService } from '../../services/drawers/polyline-volume-dawer/polyline-volume-drawer.service';\nimport { WallDrawerService } from '../../services/drawers/wall-dawer/wall-drawer.service';\nimport { RectangleDrawerService } from '../../services/drawers/rectangle-dawer/rectangle-drawer.service';\nimport { PolylinePrimitiveDrawerService } from '../../services/drawers/polyline-primitive-drawer/polyline-primitive-drawer.service';\nimport { LabelPrimitiveDrawerService } from '../../services/drawers/label-primitive-drawer/label-primitive-drawer.service';\nimport { BillboardPrimitiveDrawerService } from '../../services/drawers/billboard-primitive-drawer/billboard-primitive-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\nimport { PointPrimitiveDrawerService } from '../../services/drawers/point-primitive-drawer/point-primitive-drawer.service';\nimport { HtmlDrawerService } from '../../services/drawers/html-drawer/html-drawer.service';\nimport { CzmlDrawerService } from '../../services/drawers/czml-drawer/czml-drawer.service';\n\n// tslint:enable\n/**\n *  This is a ac-layer implementation.\n *  The ac-layer element must be a child of ac-map element.\n *  + acFor `{string}` - get the tracked observable and entityName (see the example).\n *  + show `{boolean}` - show/hide layer's entities.\n *  + context `{any}` - get the context layer that will use the componnet (most of the time equal to \"this\").\n *  + options `{LayerOptions}` - sets the layer options for each drawer.\n *  + zIndex `{number}` - controls the zIndex (order) of the layer, layers with greater zIndex will be in front of layers with lower zIndex\n *    (Exception For `Billboard` and `Label`, should use `[eyeOffset]` prop instead)</br>\n *    zIndex won't work for pritimitve descs (like ac-primitive-polyline...)\n *\n *\n *  __Usage :__\n *  ```\n *  <ac-map>\n *    <ac-layer acFor=\"let track of tracks$\" [show]=\"show\" [context]=\"this\" [options]=\"options\" [zIndex]=\"1\">\n *      <ac-billboard-desc props=\"{\n *        image: track.image,\n *        position: track.position,\n *        scale: track.scale,\n *        color: track.color,\n *        name: track.name\n *      }\">\n *      </ac-billboard-desc>\n *        <ac-label-desc props=\"{\n *          position: track.position,\n *          pixelOffset : [-15,20] | pixelOffset,\n *          text: track.name,\n *          font: '15px sans-serif'\n *        }\">\n *      </ac-label-desc>\n *    </ac-layer>\n *  </ac-map>\n *  ```\n */\n@Component({\n  selector: 'ac-layer',\n  template: '<ng-content></ng-content>',\n  providers: [\n    LayerService,\n    ComputationCache,\n    BillboardDrawerService,\n    LabelDrawerService,\n    EllipseDrawerService,\n    PolylineDrawerService,\n    ArcDrawerService,\n    PointDrawerService,\n    PolygonDrawerService,\n    ModelDrawerService,\n    BoxDrawerService,\n    CorridorDrawerService,\n    CylinderDrawerService,\n    EllipsoidDrawerService,\n    PolylineVolumeDrawerService,\n    WallDrawerService,\n    RectangleDrawerService,\n    PolylinePrimitiveDrawerService,\n    LabelPrimitiveDrawerService,\n    BillboardPrimitiveDrawerService,\n    PointPrimitiveDrawerService,\n    HtmlDrawerService,\n    CzmlDrawerService,\n\n    DynamicEllipseDrawerService,\n    DynamicPolylineDrawerService,\n    StaticCircleDrawerService,\n    StaticPolylineDrawerService,\n    StaticPolygonDrawerService,\n    StaticEllipseDrawerService,\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AcLayerComponent implements OnInit, OnChanges, AfterContentInit, OnDestroy {\n  @Input()\n  show = true;\n  @Input()\n  acFor: string;\n  @Input()\n  context: any;\n  @Input()\n  store = false;\n  @Input()\n  options: LayerOptions;\n  @Input()\n  zIndex = 0;\n\n  private readonly acForRgx = /^let\\s+.+\\s+of\\s+.+$/;\n  private entityName: string;\n  private stopObservable = new Subject<any>();\n  private observable: Observable<AcNotification>;\n  private _drawerList: Map<string, BasicDrawerService>;\n  private _updateStream: Subject<AcNotification> = new Subject<AcNotification>();\n  private entitiesStore = new Map<string, any>();\n  private layerDrawerDataSources: any[] = [];\n\n  constructor(private layerService: LayerService,\n              private _computationCache: ComputationCache,\n              private mapLayersService: MapLayersService,\n              billboardDrawerService: BillboardDrawerService,\n              labelDrawerService: LabelDrawerService,\n              ellipseDrawerService: EllipseDrawerService,\n              polylineDrawerService: PolylineDrawerService,\n              polygonDrawerService: PolygonDrawerService,\n              arcDrawerService: ArcDrawerService,\n              pointDrawerService: PointDrawerService,\n              modelDrawerService: ModelDrawerService,\n              boxDrawerService: BoxDrawerService,\n              corridorDrawerService: CorridorDrawerService,\n              cylinderDrawerService: CylinderDrawerService,\n              ellipsoidDrawerSerice: EllipsoidDrawerService,\n              polylineVolumeDrawerService: PolylineVolumeDrawerService,\n              wallDrawerService: WallDrawerService,\n              rectangleDrawerService: RectangleDrawerService,\n              dynamicEllipseDrawerService: DynamicEllipseDrawerService,\n              dynamicPolylineDrawerService: DynamicPolylineDrawerService,\n              staticCircleDrawerService: StaticCircleDrawerService,\n              staticPolylineDrawerService: StaticPolylineDrawerService,\n              staticPolygonDrawerService: StaticPolygonDrawerService,\n              staticEllipseDrawerService: StaticEllipseDrawerService,\n              polylinePrimitiveDrawerService: PolylinePrimitiveDrawerService,\n              labelPrimitiveDrawerService: LabelPrimitiveDrawerService,\n              billboardPrimitiveDrawerService: BillboardPrimitiveDrawerService,\n              pointPrimitiveDrawerService: PointPrimitiveDrawerService,\n              htmlDrawerService: HtmlDrawerService,\n              czmlDrawerService: CzmlDrawerService\n  ) {\n    this._drawerList = new Map([\n      ['billboard', billboardDrawerService],\n      ['label', labelDrawerService],\n      ['ellipse', ellipseDrawerService],\n      ['polyline', polylineDrawerService],\n      ['polygon', polygonDrawerService as BasicDrawerService],\n      ['arc', arcDrawerService],\n      ['point', pointDrawerService],\n      ['model', modelDrawerService],\n      ['box', boxDrawerService],\n      ['corridor', corridorDrawerService],\n      ['cylinder', cylinderDrawerService],\n      ['ellipsoid', ellipsoidDrawerSerice],\n      ['polylineVolume', polylineVolumeDrawerService],\n      ['rectangle', rectangleDrawerService],\n      ['wall', wallDrawerService],\n      ['polylinePrimitive', polylinePrimitiveDrawerService],\n      ['labelPrimitive', labelPrimitiveDrawerService],\n      ['billboardPrimitive', billboardPrimitiveDrawerService],\n      ['pointPrimitive', pointPrimitiveDrawerService],\n      ['html', htmlDrawerService],\n      ['czml', czmlDrawerService],\n\n      ['dynamicEllipse', dynamicEllipseDrawerService],\n      ['dynamicPolyline', dynamicPolylineDrawerService],\n      ['staticCircle', staticCircleDrawerService],\n      ['staticPolyline', staticPolylineDrawerService],\n      ['staticPolygon', staticPolygonDrawerService],\n      ['staticEllipse', staticEllipseDrawerService],\n    ]);\n  }\n\n  init() {\n    this.initValidParams();\n\n    observableMerge(this._updateStream, this.observable).pipe<AcNotification>(takeUntil(this.stopObservable)).subscribe((notification) => {\n      this._computationCache.clear();\n\n      let contextEntity = notification.entity;\n      if (this.store) {\n        contextEntity = this.updateStore(notification);\n      }\n\n      this.context[this.entityName] = contextEntity;\n      this.layerService.getDescriptions().forEach((descriptionComponent) => {\n        switch (notification.actionType) {\n          case ActionType.ADD_UPDATE:\n            descriptionComponent.draw(this.context, notification.id, contextEntity);\n            break;\n          case ActionType.DELETE:\n            descriptionComponent.remove(notification.id);\n            break;\n          default:\n            console.error('[ac-layer] unknown AcNotification.actionType for notification: ' + notification);\n        }\n      });\n    });\n  }\n\n  private updateStore(notification: AcNotification): any {\n    if (notification.actionType === ActionType.DELETE) {\n      this.entitiesStore.delete(notification.id);\n      return undefined;\n    } else {\n      if (this.entitiesStore.has(notification.id)) {\n        const entity = this.entitiesStore.get(notification.id);\n        Object.assign(entity, notification.entity);\n        return entity;\n      } else {\n        this.entitiesStore.set(notification.id, notification.entity);\n        return notification.entity;\n      }\n    }\n  }\n\n  private initValidParams() {\n    if (!this.context) {\n      throw new Error('ac-layer: must initialize [context] ');\n    }\n\n    if (!this.acForRgx.test(this.acFor)) {\n      throw new Error(`ac-layer: Invalid [acFor] syntax. Expected: [acFor]=\"let item of observable\" .Instead received: ${this.acFor}`);\n    }\n    const acForArr = this.acFor.split(' ');\n    this.observable = this.context[acForArr[3]];\n    this.entityName = acForArr[1];\n    if (!this.isObservable(this.observable)) {\n      throw new Error('ac-layer: must initailize [acFor] with rx observable, instead received: ' + this.observable);\n    }\n\n    this.layerService.context = this.context;\n    this.layerService.setEntityName(this.entityName);\n  }\n\n  /** Test for a rxjs Observable */\n  private isObservable(obj: any): boolean {\n    /* check via duck-typing rather than instance of\n     * to allow passing between window contexts */\n    return obj && typeof obj.subscribe === 'function';\n  }\n\n  ngAfterContentInit(): void {\n    this.init();\n  }\n\n  ngOnInit(): void {\n    this.layerService.context = this.context;\n    this.layerService.options = this.options;\n    this.layerService.show = this.show;\n    this.layerService.zIndex = this.zIndex;\n    this._drawerList.forEach((drawer, drawerName) => {\n      const initOptions = this.options ? this.options[drawerName] : undefined;\n      const drawerDataSources = drawer.init(initOptions);\n      // only entities drawers create data sources\n      if (drawerDataSources) {\n        // this.mapLayersService.registerLayerDataSources(drawerDataSources, this.zIndex);\n        // TODO: Check if the following line causes Bad Performance\n        this.layerDrawerDataSources.push(...drawerDataSources);\n      }\n      drawer.setShow(this.show);\n    });\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes.show && !changes.show.firstChange) {\n      const showValue = changes['show'].currentValue;\n      this.layerService.show = showValue;\n      this._drawerList.forEach((drawer) => drawer.setShow(showValue));\n    }\n\n    if (changes.zIndex && !changes.zIndex.firstChange) {\n      const zIndexValue = changes['zIndex'].currentValue;\n      this.layerService.zIndex = zIndexValue;\n      this.mapLayersService.updateAndRefresh(this.layerDrawerDataSources, zIndexValue);\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.mapLayersService.removeDataSources(this.layerDrawerDataSources);\n    this.stopObservable.next(true);\n    this.removeAll();\n  }\n\n  getLayerService(): LayerService {\n    return this.layerService;\n  }\n\n  /**\n   * Returns an array of DataSources registered by a drawer of this layer\n   * @return Array of Cesium.DataSources\n   */\n  getLayerDrawerDataSources(): any[] {\n    return this.layerDrawerDataSources;\n  }\n\n  /**\n   * Returns an Array of DataSources of the drawer with the provided DataSource.name\n   * Example: getDataSourceOfDrawer('polyline') returns the dataSource of polyline drawer\n   * @return Array of Cesium.DataSources\n   */\n  getDrawerDataSourcesByName(name: string): any[] {\n    return this.layerDrawerDataSources.filter(d => d.name === name);\n  }\n\n  /**\n   * Returns the store.\n   */\n  getStore(): Map<string, any> {\n    return this.entitiesStore;\n  }\n\n  /**\n   * Remove all the entities from the layer.\n   */\n  removeAll(): void {\n    this.layerService.getDescriptions().forEach((description) => description.removeAll());\n    this.entitiesStore.clear();\n  }\n\n  /**\n   * remove entity from the layer\n   */\n  remove(entityId: string) {\n    this._updateStream.next({id: entityId, actionType: ActionType.DELETE});\n    this.entitiesStore.delete(entityId);\n  }\n\n  /**\n   * add/update entity to/from the layer\n   */\n  updateNotification(notification: AcNotification): void {\n    this._updateStream.next(notification);\n  }\n\n  /**\n   * add/update entity to/from the layer\n   */\n  update(entity: AcEntity, id: string): void {\n    this._updateStream.next({entity, id, actionType: ActionType.ADD_UPDATE});\n  }\n\n  refreshAll(collection: AcNotification[]): void {\n    // TODO make entity interface: collection of type entity not notification\n    observableFrom(collection).subscribe((entity) => this._updateStream.next(entity));\n  }\n}\n","import { Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { BasicDrawerService } from '../drawers/basic-drawer/basic-drawer.service';\nimport { MapLayersService } from '../map-layers/map-layers.service';\n\n/**\n *  Extend this class to create drawing on map components.\n */\nexport class EntityOnMapComponent implements OnInit, OnChanges, OnDestroy {\n  @Input()\n  props: any;\n\n  protected selfPrimitive: any;\n  protected selfPrimitiveIsDraw: boolean;\n  protected dataSources: any;\n\n  constructor(protected _drawer: BasicDrawerService, private mapLayers: MapLayersService) {\n  }\n\n  ngOnInit(): void {\n    this.selfPrimitiveIsDraw = false;\n    const dataSources = this._drawer.init();\n    if (dataSources) {\n      this.dataSources = dataSources;\n      // this.mapLayers.registerLayerDataSources(dataSources, 0);\n    }\n    this.drawOnMap();\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    const props = changes['props'];\n    if (props.currentValue !== props.previousValue) {\n      this.updateOnMap();\n    }\n  }\n\n  drawOnMap() {\n    this.selfPrimitiveIsDraw = true;\n    return this.selfPrimitive = this._drawer.add(this.props);\n  }\n\n  removeFromMap() {\n    this.selfPrimitiveIsDraw = false;\n    return this._drawer.remove(this.selfPrimitive);\n  }\n\n  updateOnMap() {\n    if (this.selfPrimitiveIsDraw) {\n      return this._drawer.update(this.selfPrimitive, this.props);\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.mapLayers.removeDataSources(this.dataSources);\n    this.removeFromMap();\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { BillboardDrawerService } from '../../services/drawers/billboard-drawer/billboard-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is a billboard implementation.\n *  The element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Entity and BillboardGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/BillboardGraphics.html\n *\n *  __Usage :__\n *  ```\n *    <ac-billboard [props]=\"{\n *      image: image,\n *      position: position,\n *      scale: scale,\n *      color: color,\n *      name: name\n *    }\">;\n *    </ac-billboard>\n *  ```\n */\n\n@Component({\n  selector: 'ac-billboard',\n  template: '',\n})\nexport class AcBillboardComponent extends EntityOnMapComponent {\n\n  constructor(billboardDrawer: BillboardDrawerService, mapLayers: MapLayersService) {\n    super(billboardDrawer, mapLayers);\n  }\n}\n","import { EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core';\nimport { LayerService } from '../layer-service/layer-service.service';\nimport { ComputationCache } from '../computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../cesium-properties/cesium-properties.service';\nimport { AcEntity } from '../../models/ac-entity';\nimport { BasicDrawerService } from '../drawers/basic-drawer/basic-drawer.service';\nimport { IDescription } from '../../models/description';\n\nexport interface OnDrawParams {\n  acEntity: AcEntity;\n  entityId: string;\n  cesiumEntity: any;\n}\n\n/**\n *  the ancestor class for creating components.\n *  extend this class to create desc component.\n */\nexport class BasicDesc implements OnInit, OnDestroy, IDescription {\n  @Input()\n  props: any;\n\n  @Output()\n  onDraw: EventEmitter<OnDrawParams> = new EventEmitter<OnDrawParams>();\n\n  @Output()\n  onRemove: EventEmitter<OnDrawParams> = new EventEmitter<OnDrawParams>();\n\n  protected _cesiumObjectsMap: Map<string, any> = new Map<string, any>();\n  private _propsEvaluateFn: Function;\n  private _propsAssignerFn: Function;\n\n  constructor(protected _drawer: BasicDrawerService,\n              protected _layerService: LayerService,\n              protected _computationCache: ComputationCache,\n              protected _cesiumProperties: CesiumProperties) {\n  }\n\n  protected _propsEvaluator(context: Object): any {\n    return this._propsEvaluateFn(this._computationCache, context);\n  }\n\n  protected _getPropsAssigner(): (cesiumObject: Object, desc: Object) => Object {\n    return (cesiumObject: Object, desc: Object) => this._propsAssignerFn(cesiumObject, desc);\n  }\n\n  getLayerService(): LayerService {\n    return this._layerService;\n  }\n\n  setLayerService(layerService: LayerService) {\n    this._layerService.unregisterDescription(this);\n    this._layerService = layerService;\n    this._layerService.registerDescription(this);\n    this._propsEvaluateFn = this._cesiumProperties.createEvaluator(this.props, this._layerService.cache, true);\n    this._propsAssignerFn = this._cesiumProperties.createAssigner(this.props);\n  }\n\n  ngOnInit(): void {\n    if (!this.props) {\n      console.error('ac-desc components error: [props] input is mandatory');\n    }\n\n    this._layerService.registerDescription(this);\n    this._propsEvaluateFn = this._cesiumProperties.createEvaluator(this.props, this._layerService.cache);\n    this._propsAssignerFn = this._cesiumProperties.createAssigner(this.props);\n  }\n\n  public getCesiumObjectsMap(): Map<string, any> {\n    return this._cesiumObjectsMap;\n  }\n\n  draw(context: any, id: string, entity: AcEntity): void {\n    const cesiumProps = this._propsEvaluator(context);\n\n    if (!this._cesiumObjectsMap.has(id)) {\n      const cesiumObject = this._drawer.add(cesiumProps);\n      this.onDraw.emit({\n        acEntity: entity,\n        cesiumEntity: cesiumObject,\n        entityId: id,\n      });\n      cesiumObject.acEntity = entity; // set the entity on the cesiumObject for later usage\n      this._cesiumObjectsMap.set(id, cesiumObject);\n    } else {\n      const cesiumObject = this._cesiumObjectsMap.get(id);\n      this.onDraw.emit({\n        acEntity: entity,\n        cesiumEntity: cesiumObject,\n        entityId: id,\n      });\n      cesiumObject.acEntity = entity; // set the entity on the cesiumObject for later usage\n      this._drawer.setPropsAssigner(this._getPropsAssigner());\n      this._drawer.update(cesiumObject, cesiumProps);\n    }\n  }\n\n  remove(id: string) {\n    const cesiumObject = this._cesiumObjectsMap.get(id);\n    if (cesiumObject) {\n      this.onRemove.emit({\n        acEntity: cesiumObject.acEntity,\n        cesiumEntity: cesiumObject,\n        entityId: id,\n      });\n      this._drawer.remove(cesiumObject);\n      this._cesiumObjectsMap.delete(id);\n    }\n  }\n\n  removeAll() {\n    this._cesiumObjectsMap.clear();\n    this._drawer.removeAll();\n  }\n\n  ngOnDestroy() {\n    this._layerService.unregisterDescription(this);\n    this.removeAll();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { JsonStringMapper } from 'json-string-mapper';\n\n@Injectable()\nexport class JsonMapper {\n  private _mapper: JsonStringMapper;\n\n  constructor() {\n    this._mapper = new JsonStringMapper();\n  }\n\n  map(expression: string): Map<string, string> {\n    return this._mapper.map(expression);\n  }\n}\n","/**\n * Service for effective assignment.\n */\nexport class SmartAssigner {\n\n  static create(props: string[] = [], allowUndefined: boolean = true): (obj1: Object, obj2: Object) => Object {\n    let fnBody = ``;\n\n    props.forEach(prop => {\n      if (!allowUndefined) {\n        // tslint:disable-next-line:max-line-length\n        fnBody += `if (!(obj1['${prop}'] instanceof Cesium.CallbackProperty) && obj2['${prop}'] !== undefined) { obj1['${prop}'] = obj2['${prop}']; } `;\n      } else {\n        fnBody += `if(!(obj1['${prop}'] instanceof Cesium.CallbackProperty))obj1['${prop}'] = obj2['${prop}']; `;\n      }\n    });\n\n    fnBody += `return obj1`;\n    const assignFn = new Function('obj1', 'obj2', fnBody);\n\n    return function smartAssigner(obj1: Object, obj2: Object) {\n      return assignFn(obj1, obj2);\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { JsonMapper } from '../json-mapper/json-mapper.service';\nimport { Parse } from 'angular2parse';\nimport { SmartAssigner } from '../smart-assigner/smart-assigner.service';\nimport { ComputationCache } from '../computation-cache/computation-cache.service';\n\n@Injectable()\nexport class CesiumProperties {\n  private _assignersCache = new Map<string, (oldVal: Object, newVal: Object) => Object>();\n  private _evaluatorsCache = new Map<string, (cache: ComputationCache, context: Object) => Object>();\n\n  constructor(private _parser: Parse,\n              private _jsonMapper: JsonMapper) {\n  }\n\n  _compile(expression: string, withCache = true): (cache: ComputationCache, context: Object) => Object {\n    const cesiumDesc = {};\n    const propsMap = new Map<string, { expression: string, get: Function }>();\n\n    const resultMap = this._jsonMapper.map(expression);\n\n    resultMap.forEach((resultExpression, prop) => propsMap.set(prop, {\n      expression: resultExpression,\n      get: this._parser.eval(resultExpression)\n    }));\n\n    propsMap.forEach((value, prop) => {\n      if (withCache) {\n        cesiumDesc[prop || 'undefined'] = `cache.get(\\`${value.expression}\\`, () => propsMap.get('${prop}').get(context))`;\n      } else {\n        cesiumDesc[prop || 'undefined'] = `propsMap.get('${prop}').get(context)`;\n      }\n    });\n\n    const fnBody = `return ${JSON.stringify(cesiumDesc).replace(/\"/g, '')};`;\n    const getFn = new Function('propsMap', 'cache', 'context', fnBody);\n\n    return function evaluateCesiumProps(cache: ComputationCache, context: Object): Object {\n      return getFn(propsMap, cache, context);\n    };\n  }\n\n  _build(expression: string): (oldVal: Object, newVal: Object) => Object {\n    const props = Array.from(this._jsonMapper.map(expression).keys());\n    const smartAssigner = SmartAssigner.create(props);\n\n    return function assignCesiumProps(oldVal: Object, newVal: Object) {\n      return smartAssigner(oldVal, newVal);\n    };\n  }\n\n  createEvaluator(expression: string, withCache = true, newEvaluator = false): (cache: ComputationCache, context: Object) => Object {\n    if (!newEvaluator && this._evaluatorsCache.has(expression)) {\n      return this._evaluatorsCache.get(expression);\n    }\n\n    const evaluatorFn = this._compile(expression, withCache);\n    this._evaluatorsCache.set(expression, evaluatorFn);\n\n    return evaluatorFn;\n  }\n\n  createAssigner(expression: string): (oldVal: Object, newVal: Object) => Object {\n    if (this._assignersCache.has(expression)) {\n      return this._assignersCache.get(expression);\n    }\n\n    const assignFn = this._build(expression);\n    this._assignersCache.set(expression, assignFn);\n\n    return assignFn;\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { BillboardDrawerService } from '../../services/drawers/billboard-drawer/billboard-drawer.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\n\n/**\n *  This is a billboard implementation.\n *  The element must be a child of ac-layer element.\n *  The properties of props are the same as the properties of Entity and BillboardGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/BillboardGraphics.html\n *\n *  __Usage :__\n *  ```\n *    <ac-billboard-desc props=\"{\n *      image: track.image,\n *      position: track.position,\n *      scale: track.scale,\n *      color: track.color,\n *      name: track.name\n *    }\">\n *    </ac-billboard-desc>\n *  ```\n */\n\n@Component({\n  selector: 'ac-billboard-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcBillboardDescComponent)}],\n})\nexport class AcBillboardDescComponent extends BasicDesc {\n\n  constructor(billboardDrawer: BillboardDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(billboardDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\n\n/**\n *  This is an ellipse implementation.\n *  The element must be a child of ac-layer element.\n *  _Set `height` prop for performance enhancement_\n *  The properties of props are the same as the properties of Entity and EllipseGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/EllipseGraphics.html\n *\n *  __Usage :__\n *  ```\n *    <ac-ellipse-desc props=\"{\n *      position: data.position,\n *      semiMajorAxis:250000.0,\n *      semiMinorAxis:400000.0,\n *      height: 0\n *    }\">\n *    </ac-ellipse-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-ellipse-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcEllipseDescComponent)}],\n})\nexport class AcEllipseDescComponent extends BasicDesc {\n  constructor(ellipseDrawer: EllipseDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(ellipseDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { PolylineDrawerService } from '../../services/drawers/polyline-drawer/polyline-drawer.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\n\n/**\n *  This is a polyline implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Entity and PolylineGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PolylineGraphics.html\n *\n *  __Usage:__\n *  ```\n *    <ac-polyline-desc props=\"{\n *      width : polyline.width,\n *      positions: polyline.positions,\n *      material: polyline.material\n *    }\">\n *    </ac-polyline-desc>\n * ```\n */\n@Component({\n  selector: 'ac-polyline-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcPolylineDescComponent)}],\n})\nexport class AcPolylineDescComponent extends BasicDesc {\n\n  constructor(dynamicPolylineDrawerService: PolylineDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(dynamicPolylineDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n/**\n * @example\n * <ac-label-desc props=\"{\n *            position: track.position,\n *            pixelOffset : [-15,20] | pixelOffset,\n *            text: track.name,\n *            font: '15px sans-serif'\n *    }\">\n * </ac-label-desc>\n */\n@Pipe({\n  name: 'pixelOffset'\n})\nexport class PixelOffsetPipe implements PipeTransform {\n\n  transform(value: any, args?: any): any {\n    return new Cesium.Cartesian2(value[0], value[1]);\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'radiansToDegrees'\n})\nexport class RadiansToDegreesPipe implements PipeTransform {\n\n  transform(value: any, args?: any): number {\n    return (360 - Math.round(180 * value / Math.PI)) % 360;\n  }\n\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { LabelDrawerService } from '../../services/drawers/label-drawer/label-drawer.service';\n\n/**\n *  This is a label implementation.\n *  The ac-label element must be a child of ac-layer element.\n *  The properties of props are the same as the properties of Entity and LabelGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/LabelGraphics.html\n *\n *  __Usage :__\n *  ```\n *    <ac-label-desc props=\"{\n *      position: track.position,\n *      pixelOffset : [-15,20] | pixelOffset,\n *      text: track.name,\n *      font: '15px sans-serif'\n *    }\">\n *    </ac-label-desc>\n *  ```\n */\n\n@Component({\n  selector: 'ac-label-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcLabelDescComponent)}],\n})\nexport class AcLabelDescComponent extends BasicDesc {\n\n  constructor(labelDrawer: LabelDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(labelDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  imports: [CommonModule],\n  providers: []\n})\nexport class UtilsModule {\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\n\n/**\n *  This is a circle implementation.\n *  The element must be a child of ac-layer element.\n *  semiMajorAxis ans semiMinorAxis are replaced with radius property.\n *  All other properties of props are the same as the properties of Entity and EllipseGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/EllipseGraphics.html\n *\n *__Usage :__\n *  ```\n *    <ac-circle-desc props=\"{\n *      position: data.position,\n *      radius: 5\n *      granularity:0.08 // Optional\n *    }\">\n *    </ac-circle-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-circle-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcCircleDescComponent)}],\n})\nexport class AcCircleDescComponent extends BasicDesc {\n  constructor(ellipseDrawer: EllipseDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(ellipseDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n  protected _propsEvaluator(context: Object): any {\n    const cesiumProps = super._propsEvaluator(context);\n\n    cesiumProps.semiMajorAxis = cesiumProps.radius;\n    cesiumProps.semiMinorAxis = cesiumProps.radius;\n    delete cesiumProps.radius;\n\n    return cesiumProps;\n  }\n\n  protected _getPropsAssigner(): (cesiumObject: Object, desc: Object) => Object {\n    return (cesiumObject: Object, desc: Object) => Object.assign(cesiumObject, desc);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { ArcDrawerService } from '../../services/drawers/arc-drawer/arc-drawer.service';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\n\n/**\n *  This is an implementation of an arc.\n *  The element must be a child of ac-layer element.\n *  An arc is not cesium natively implemented and therefore it's API doesn't appear anywhere\n *\n *  __Usage :__\n *  ```\n *    <ac-arc-desc props=\"{\n *          center: arc.center,\n *          angle: arc.angle,\n *          delta: arc.delta,\n *          radius: arc.radius,\n *          color : arc.color - The color should be Cesium.Color type\n *    }\">\n *    </ac-arc-desc>\n *    ```\n *\n *    description of the props :\n *    center - The arc is a section of an outline of a circle, This is the center of the circle\n *    angle - the initial angle of the arc in radians\n *    delta - the spreading of the arc,\n *    radius - the distance from the center to the arc\n *\n *    for example :\n *    angle - 0\n *    delta - \n *\n *    will draw an half circle\n */\n\n@Component({\n  selector: 'ac-arc-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcArcDescComponent)}],\n})\nexport class AcArcDescComponent extends BasicDesc {\n\n  constructor(arcDrawer: ArcDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(arcDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n}\n","/**\n * Angular Cesium parent entity, all entities should inherit from it.\n * ```typescript\n * entity= new AcEntity({\n *  \tid: 0,\n *  \tname: 'click me',\n *  \tposition: Cesium.Cartesian3.fromRadians(0.5, 0.5),\n * });\n * ```\n */\nexport class AcEntity {\n\n  /**\n   * Creates entity from a json\n   * @param json entity object\n   * @returns entity as AcEntity\n   */\n  static create(json?: any) {\n    if (json) {\n      return Object.assign(new AcEntity(), json);\n    }\n    return new AcEntity();\n  }\n\n  /**\n   * Creates entity from a json\n   * @param json (Optional) entity object\n   */\n  constructor(json?: any) {\n    Object.assign(this, json);\n  }\n}\n","import { ActionType } from './action-type.enum';\nimport { AcEntity } from './ac-entity';\n\n/**\n * Interface of  Angular2Cesium notification.\n * ac-layer receives an observer of AcNotifications\n */\nexport interface AcNotification {\n  id: string;\n  entity?: AcEntity;\n  actionType: ActionType;\n}\n\nexport class AcNotification {\n  id: string;\n  entity?: AcEntity;\n  actionType: ActionType;\n}\n","export enum MapLayerProviderOptions {\n  ArcGisMapServer = Cesium.ArcGisMapServerImageryProvider,\n  WebMapTileService = Cesium.WebMapTileServiceImageryProvider,\n  MapTileService = Cesium.createTileMapServiceImageryProvider,\n  WebMapService = Cesium.WebMapServiceImageryProvider,\n  SingleTileImagery = Cesium.SingleTileImageryProvider,\n  OpenStreetMap = Cesium.createOpenStreetMapImageryProvider,\n  BingMaps = Cesium.BingMapsImageryProvider,\n  GoogleEarthEnterpriseMaps = Cesium.GoogleEarthEnterpriseMapsProvider,\n  MapBox = Cesium.MapboxImageryProvider,\n  UrlTemplateImagery = Cesium.UrlTemplateImageryProvider,\n  OFFLINE = null,\n}\n\n","import { Component, Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { CesiumService } from '../../services/cesium/cesium.service';\nimport { Checker } from '../../utils/checker';\nimport { MapLayerProviderOptions } from '../../models';\n\n/**\n *  This component is used for adding a map provider service to the map (ac-map)\n *  options according to selected map provider MapLayerProviderOptions enum.\n *  additional setting can be done with cesium imageryLayer (exposed as class member)\n *  check out: https://cesiumjs.org/Cesium/Build/Documentation/ImageryLayer.html\n *  and: https://cesiumjs.org/Cesium/Build/Documentation/ImageryLayerCollection.html\n *\n *\n *  __Usage :__\n *  ```\n *    <ac-map-layer-provider [options]=\"optionsObject\" [provider]=\"myProvider\">\n *    </ac-map-layer-provider>\n *  ```\n */\n@Component({\n  selector: 'ac-map-layer-provider',\n  template: '',\n})\nexport class AcMapLayerProviderComponent implements OnInit, OnChanges, OnDestroy {\n\n  /**\n   * refer to cesium docs for details https://cesiumjs.org/Cesium/Build/Documentation/ImageryProvider.html\n   */\n  @Input()\n  options: { url?: string } = {};\n\n  /**\n   * the provider\n   */\n  @Input()\n  provider: any = MapLayerProviderOptions.OFFLINE;\n\n  /**\n   * index (optional) - The index to add the layer at. If omitted, the layer will added on top of all existing layers.\n   */\n  @Input()\n  index: Number;\n\n  /**\n   * show (optional) - Determines if the map layer is shown.\n   */\n  @Input()\n  show = true;\n\n  /**\n   * The alpha blending value of this layer: 0.0 to 1.0\n   */\n  @Input()\n  alpha = 1.0;\n\n  /**\n   * The brightness of this layer: 0.0 to 1.0\n   */\n  @Input()\n  brightness = 1.0;\n\n  /**\n   * The contrast of this layer: 0.0 to 1.0\n   */\n  @Input()\n  contrast = 1.0;\n\n  public imageryLayer: any;\n  public imageryLayersCollection: any;\n  public layerProvider: any;\n\n  constructor(private cesiumService: CesiumService) {\n    this.imageryLayersCollection = this.cesiumService.getScene().imageryLayers;\n  }\n\n  private createOfflineMapProvider() {\n    return Cesium.createTileMapServiceImageryProvider({\n      url: Cesium.buildModuleUrl('Assets/Textures/NaturalEarthII')\n    });\n  }\n\n  ngOnInit() {\n    if (!Checker.present(this.options.url) && this.provider !== MapLayerProviderOptions.OFFLINE) {\n      throw new Error('options must have a url');\n    }\n    switch (this.provider) {\n      case MapLayerProviderOptions.WebMapService:\n      case MapLayerProviderOptions.WebMapTileService:\n      case MapLayerProviderOptions.ArcGisMapServer:\n      case MapLayerProviderOptions.SingleTileImagery:\n      case MapLayerProviderOptions.BingMaps:\n      case MapLayerProviderOptions.GoogleEarthEnterpriseMaps:\n      case MapLayerProviderOptions.MapBox:\n      case MapLayerProviderOptions.UrlTemplateImagery:\n        this.layerProvider = new this.provider(this.options);\n        break;\n      case MapLayerProviderOptions.MapTileService:\n      case MapLayerProviderOptions.OpenStreetMap:\n        this.layerProvider = this.provider(this.options);\n        break;\n      case MapLayerProviderOptions.OFFLINE:\n        this.layerProvider = this.createOfflineMapProvider();\n        break;\n      default:\n        console.log('ac-map-layer-provider: [provider] wasn\\'t found. setting OFFLINE provider as default');\n        this.layerProvider = this.createOfflineMapProvider();\n        break;\n    }\n    if (this.show) {\n      this.imageryLayer = this.imageryLayersCollection.addImageryProvider(this.layerProvider, this.index);\n      this.imageryLayer.alpha = this.alpha;\n      this.imageryLayer.contrast = this.contrast;\n      this.imageryLayer.brightness = this.brightness;\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['show'] && !changes['show'].isFirstChange()) {\n      const showValue = changes['show'].currentValue;\n      if (showValue) {\n        if (this.imageryLayer) {\n          this.imageryLayersCollection.add(this.imageryLayer, this.index);\n        } else {\n          this.imageryLayer = this.imageryLayersCollection.addImageryProvider(this.layerProvider, this.index);\n          this.imageryLayer.alpha = this.alpha;\n          this.imageryLayer.contrast = this.contrast;\n          this.imageryLayer.brightness = this.brightness;\n        }\n      } else if (this.imageryLayer) {\n        this.imageryLayersCollection.remove(this.imageryLayer, false);\n      }\n    }\n\n    if (changes['alpha'] && !changes['alpha'].isFirstChange() && this.imageryLayer) {\n      this.imageryLayer.alpha = this.alpha;\n    }\n    if (changes['contrast'] && !changes['contrast'].isFirstChange() && this.imageryLayer) {\n      this.imageryLayer.contrast = this.contrast;\n    }\n    if (changes['brightness'] && !changes['brightness'].isFirstChange() && this.imageryLayer) {\n      this.imageryLayer.brightness = this.brightness;\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.imageryLayer) {\n      this.imageryLayersCollection.remove(this.imageryLayer, true);\n    }\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { PointDrawerService } from '../../services/drawers/point-drawer/point-drawer.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\n\n/**\n *  This is a point implementation.\n *  The ac-label element must be a child of ac-layer element.\n *  The properties of props are the same as the properties of Entity and PointGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PointGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-point-desc props=\"{\n *     pixelSize : point.pixelSize, //optional\n *     position : point.positions,\n *     color : point.color  //optional\n *   }\">\n *   </ac-point-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-point-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcPointDescComponent)}],\n})\nexport class AcPointDescComponent extends BasicDesc {\n\n  constructor(pointDrawerService: PointDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(pointDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { LabelDrawerService } from '../../services/drawers/label-drawer/label-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is a label implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Entity and LabelGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/LabelGraphics.html\n *\n *  __Usage:__\n *  ```\n *  <ac-label [props]=\"{\n *    position: position,\n *    text: 'labelText',\n *    font: '30px sans-serif',\n *    fillColor : aquamarine\n *  }\">\n *  </ac-label>;\n *  ```\n */\n\n@Component({\n  selector: 'ac-label',\n  template: '',\n})\nexport class AcLabelComponent extends EntityOnMapComponent {\n\n  constructor(labelDrawer: LabelDrawerService, mapLayers: MapLayersService) {\n    super(labelDrawer, mapLayers);\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\nimport { PolylineDrawerService } from '../../services/drawers/polyline-drawer/polyline-drawer.service';\n\n/**\n *  This is a polyline implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Polyline Primitive:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Polyline.html\n *\n *  __Usage:__\n *  ```\n *  <ac-polyline [props]=\"{\n *    position: position,\n *    text: 'labelText',\n *    font: '30px sans-serif'\n *    color: Cesium.Color.GREEN\n *  }\">;\n *  </ac-polyline>\n *  ```\n */\n\n@Component({\n  selector: 'ac-polyline',\n  template: '',\n})\nexport class AcPolylineComponent extends EntityOnMapComponent {\n\n  constructor(polylineDrawer: PolylineDrawerService, mapLayers: MapLayersService) {\n    super(polylineDrawer, mapLayers);\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is an ellipse implementation.\n *  The element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Entity and EllipseGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/EllipseGraphics.html\n *\n *  __Usage:__\n *  ```\n *  <ac-ellipse [props]=\"{\n *    position: position,\n *    semiMajorAxis:40000.0,\n *    semiMinorAxis:25000.0,\n *    rotation : 0.785398\n *  }\">\n *  </ac-ellipse>\n *  ```\n */\n\n@Component({\n  selector: 'ac-ellipse',\n  template: '',\n})\nexport class AcEllipseComponent extends EntityOnMapComponent {\n\n  constructor(ellipseDrawer: EllipseDrawerService, mapLayers: MapLayersService) {\n    super(ellipseDrawer, mapLayers);\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { PointDrawerService } from '../../services/drawers/point-drawer/point-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is a point implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Entity and PointGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PointGraphics.html\n *\n *  __Usage:__\n *  ```\n *  <ac-point [props]=\"{\n *    position: position,\n *    width: 3\n *  }\">\n *  </ac-point>\n *  ```\n */\n\n@Component({\n  selector: 'ac-point',\n  template: '',\n})\nexport class AcPointComponent extends EntityOnMapComponent {\n\n  constructor(pointDrawer: PointDrawerService, mapLayers: MapLayersService) {\n    super(pointDrawer, mapLayers);\n  }\n}\n","import { Component, DoCheck, ElementRef, Input, OnDestroy, OnInit, Renderer2 } from '@angular/core';\nimport { CesiumService } from '../../services/cesium/cesium.service';\n\n/**\n *  This is an html implementation.\n *  The ac-html element must be a child of ac-map element.\n *  __Usage:__\n *  ```\n *  <ac-html [props]=\"{position: position, show: true}\">;\n *    <p>html element</p>\n *  </ac-html>\n *  ```\n */\n\n@Component({\n  selector: 'ac-html',\n  template: `<ng-content></ng-content>`,\n  styles: [`:host {\n                position: absolute;\n                z-index: 100;\n\t\t\t\t}`]\n})\nexport class AcHtmlComponent implements DoCheck, OnDestroy, OnInit {\n\n\n  @Input() props: any;\n  private isDraw = false;\n  preRenderEventListener: () => void;\n\n  constructor(private cesiumService: CesiumService, private elementRef: ElementRef, private renderer: Renderer2) {\n  }\n\n  setScreenPosition(screenPosition: any) {\n    if (screenPosition) {\n      this.renderer.setStyle(this.elementRef.nativeElement, 'top', `${screenPosition.y}px`);\n      this.renderer.setStyle(this.elementRef.nativeElement, 'left', `${screenPosition.x}px`);\n    }\n  }\n\n  ngOnInit(): void {\n    this.cesiumService.getMap().getMapContainer().appendChild(this.elementRef.nativeElement);\n    if (this.props.show === false) {\n      this.hideElement();\n    }\n  }\n\n  remove() {\n    if (this.isDraw) {\n      this.isDraw = false;\n      this.cesiumService.getScene().preRender.removeEventListener(this.preRenderEventListener);\n      this.hideElement();\n    }\n  }\n\n  hideElement() {\n    this.renderer.setStyle(this.elementRef.nativeElement, 'display', `none`);\n  }\n\n  add() {\n    if (!this.isDraw) {\n      this.isDraw = true;\n      this.preRenderEventListener = () => {\n        const screenPosition = Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.cesiumService.getScene(),\n          this.props.position);\n        this.setScreenPosition(screenPosition);\n      };\n      this.renderer.setStyle(this.elementRef.nativeElement, 'display', `block`);\n      this.cesiumService.getScene().preRender.addEventListener(this.preRenderEventListener);\n    }\n  }\n\n  ngDoCheck() {\n    if (this.props.show === undefined || this.props.show) {\n      this.add();\n    } else {\n      this.remove();\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.remove();\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { EllipseDrawerService } from '../../services/drawers/ellipse-drawer/ellipse-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is a circle implementation.\n *  The element must be a child of ac-map element.\n *  semiMajorAxis ans semiMinorAxis are replaced with radius property.\n *  All other properties of props are the same as the properties of Entity and EllipseGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/EllipseGraphics.html\n *\n *  __Usage:__\n *  ```\n *  <ac-circle [props]=\"{\n *    position: position,\n *    radius:40000.0,\n *    granularity:0.03,\n *  }\">\n *  </ac-circle>\n *  ```\n */\n\n@Component({\n  selector: 'ac-circle',\n  template: '',\n})\nexport class AcCircleComponent extends EntityOnMapComponent {\n\n  constructor(ellipseDrawerService: EllipseDrawerService, mapLayers: MapLayersService) {\n    super(ellipseDrawerService, mapLayers);\n  }\n\n  private updateEllipseProps() {\n    this.props.semiMajorAxis = this.props.radius;\n    this.props.semiMinorAxis = this.props.radius;\n    this.props.rotation = 0.0;\n  }\n\n  drawOnMap() {\n    this.updateEllipseProps();\n    super.drawOnMap();\n  }\n\n  updateOnMap() {\n    this.updateEllipseProps();\n    super.updateOnMap();\n  }\n}\n","import { Component, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { ArcDrawerService } from '../../services/drawers/arc-drawer/arc-drawer.service';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is an implementation of an arc.\n *  The element must be a child of ac-map element.\n *  An arc is not natively implemented in cesium.\n *\n *  __Usage :__\n *  ```\n *    <ac-arc-desc geometryProps=\"{\n *          center: arc.center,\n *          angle: arc.angle,\n *          delta: arc.delta,\n *          radius: arc.radius\n *       }\"\n *       instanceProps=\"{\n *          attributes: arc.attributes\n *       }\"\n *       primitiveProps=\"{\n *          appearance: arc.appearance\n *       }\">\n *    </ac-arc-desc>\n *    ```\n */\n\n@Component({\n  selector: 'ac-arc',\n  template: '',\n})\nexport class AcArcComponent extends EntityOnMapComponent implements OnChanges {\n\n  @Input()\n  geometryProps: any;\n  @Input()\n  instanceProps: any;\n  @Input()\n  primitiveProps: any;\n\n  constructor(arcDrawer: ArcDrawerService, mapLayers: MapLayersService) {\n    super(arcDrawer, mapLayers);\n  }\n\n  updateOnMap() {\n    if (this.selfPrimitiveIsDraw) {\n      this.removeFromMap();\n      this.drawOnMap();\n    }\n  }\n\n  drawOnMap() {\n    this.selfPrimitiveIsDraw = true;\n    return this.selfPrimitive = this._drawer.add(this.geometryProps, this.instanceProps, this.primitiveProps);\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    const geometryProps = changes['geometryProps'];\n    const instanceProps = changes['instanceProps'];\n    const primitiveProps = changes['primitiveProps'];\n    if (geometryProps.currentValue !== geometryProps.previousValue ||\n      instanceProps.currentValue !== instanceProps.previousValue ||\n      primitiveProps.currentValue !== primitiveProps.previousValue) {\n      this.updateOnMap();\n    }\n  }\n}\n","import { Component, forwardRef, OnInit } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { PolygonDrawerService } from '../../services/drawers/polygon-drawer/polygon-drawer.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\n\n/**\n *  This is a polygon implementation.\n *  The properties of props are the same as the properties of Entity and PolygonGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PolygonGraphics.html\n *\n *  __Usage:__\n *  ```\n *    <ac-polygon-desc props=\"{\n *      hierarchy: polygon.hierarchy,\n *      material: polygon.material,\n *      height: polygon.height\n *    }\">\n *    </ac-polygon-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-polygon-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcPolygonDescComponent)}],\n})\nexport class AcPolygonDescComponent extends BasicDesc implements OnInit {\n\n  constructor(polygonDrawer: PolygonDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(polygonDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { PlonterService } from '../../services/plonter/plonter.service';\nimport { CoordinateConverter } from '../../services/coordinate-converter/coordinate-converter.service';\n\n@Component(\n  {\n    selector: 'ac-default-plonter',\n    template: `\n      <ac-html *ngIf=\"plonterService.plonterShown\" [props]=\"{\n        position: plonterPosition\n      }\">\n        <div class=\"plonter-context-menu\">\n          <div *ngFor=\"let entity of plonterService.entitesToPlonter\">\n            <div class=\"plonter-item\" (click)=\"chooseEntity(entity)\">{{ entity?.name || entity?.id }}\n            </div>\n          </div>\n        </div>\n      </ac-html>\n    `,\n    styles: [`\n        .plonter-context-menu {\n            background-color: rgba(250, 250, 250, 0.8);\n            box-shadow: 1px 1px 5px 0px rgba(0, 0, 0, 0.15);\n        }\n\n        .plonter-item {\n            cursor: pointer;\n            padding: 2px 15px;\n            text-align: start;\n        }\n\n        .plonter-item:hover {\n            background-color: rgba(0, 0, 0, 0.15);\n        }\n\n    `],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    providers: [CoordinateConverter],\n  }\n)\nexport class AcDefaultPlonterComponent implements OnInit {\n\n  constructor(public plonterService: PlonterService,\n              private cd: ChangeDetectorRef,\n              private geoConverter: CoordinateConverter) {\n  }\n\n  ngOnInit() {\n    this.plonterService.plonterChangeNotifier.subscribe(() => this.cd.detectChanges());\n  }\n\n  get plonterPosition() {\n    if (this.plonterService.plonterShown) {\n      const screenPos = this.plonterService.plonterClickPosition.endPosition;\n      return this.geoConverter.screenToCartesian3(screenPos);\n    }\n  }\n\n  chooseEntity(entity: any) {\n    this.plonterService.resolvePlonter(entity);\n  }\n}\n","import { Component } from '@angular/core';\nimport { PolygonDrawerService } from '../../services/drawers/polygon-drawer/polygon-drawer.service';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\n\n/**\n *  This is a polygon implementation.\n *  The ac-label element must be a child of ac-map element.\n *  _Set `height` prop for performance enhancement_\n *  The properties of props are the same as the properties of Entity and PolygonGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PolygonGraphics.html\n *\n *  __Usage:__\n *  ```\n *    <ac-polygon props=\"{\n *      hierarchy: polygon.hierarchy,\n *      material: polygon.material,\n *      height: polygon.height\n *    }\">\n *    </ac-polygon>\n *  ```\n */\n@Component({\n  selector: 'ac-polygon',\n  template: '',\n})\nexport class AcPolygonComponent extends EntityOnMapComponent {\n  constructor(polygonDrawer: PolygonDrawerService, mapLayers: MapLayersService) {\n    super(polygonDrawer, mapLayers);\n  }\n}\n","import { Input, OnInit } from '@angular/core';\nimport { BasicDesc } from '../basic-desc/basic-desc.service';\nimport { LayerService } from '../layer-service/layer-service.service';\nimport { ComputationCache } from '../computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../cesium-properties/cesium-properties.service';\nimport { StaticPrimitiveDrawer } from '../drawers/static-dynamic/static-primitive-drawer/static-primitive-drawer.service';\nimport { AcEntity } from '../../models/ac-entity';\n\nexport class BasicStaticPrimitiveDesc extends BasicDesc implements OnInit {\n  @Input()\n  geometryProps: any;\n  @Input()\n  instanceProps: any;\n  @Input()\n  primitiveProps: any;\n\n  private _geometryPropsEvaluator: Function;\n  private _instancePropsEvaluator: Function;\n  private _primitivePropsEvaluator: Function;\n\n  constructor(protected _staticPrimitiveDrawer: StaticPrimitiveDrawer, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(_staticPrimitiveDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n  ngOnInit(): void {\n    this._layerService.registerDescription(this);\n\n    this._geometryPropsEvaluator = this._cesiumProperties.createEvaluator(this.geometryProps);\n    this._instancePropsEvaluator = this._cesiumProperties.createEvaluator(this.instanceProps);\n    this._primitivePropsEvaluator = this._cesiumProperties.createEvaluator(this.primitiveProps);\n  }\n\n  draw(context: any, id: string, entity: AcEntity): any {\n    const geometryProps = this._geometryPropsEvaluator(this._computationCache, context);\n    const instanceProps = this._instancePropsEvaluator(this._computationCache, context);\n    const primitiveProps = this._primitivePropsEvaluator(this._computationCache, context);\n\n    if (!this._cesiumObjectsMap.has(id)) {\n      const primitive = this._staticPrimitiveDrawer.add(geometryProps, instanceProps, primitiveProps);\n      primitive.acEntity = entity; // set the entity on the primitive for later usage\n      this._cesiumObjectsMap.set(id, primitive);\n    } else {\n      const primitive = this._cesiumObjectsMap.get(id);\n      this._staticPrimitiveDrawer.update(primitive, geometryProps, instanceProps, primitiveProps);\n    }\n  }\n}\n","import { Component } from '@angular/core';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { BasicStaticPrimitiveDesc } from '../../../services/basic-primitive-desc/basic-static-primitive-desc.service';\nimport { StaticEllipseDrawerService } from '../../../services/drawers/static-dynamic/ellipse-drawer/ellipse-drawer.service';\n\n/**\n *\n * @deprecated use ac-ellipse-desc instead\n *\n *  This is a static (position, color, etc.. are not updated) implementation of an ellipse.\n *  __usage:__\n *  ```\n *  &lt;ac-static-ellipse-desc-desc\n *      geometryProps=\"{\n *          center: ellipse.geometry.center,\n *          semiMajorAxis: ellipse.geometry.semiMajorAxis,\n *          semiMinorAxis: ellipse.geometry.semiMinorAxis,\n *          height: ellipse.geometry.height,\n *          rotation: ellipse.geometry.rotation\n *      }\"\n *      instanceProps=\"{\n *          attributes: ellipse.attributes //Optional\n *      }\"\n *      primitiveProps=\"{\n *          appearance: ellipse.appearance //Optional\n *      }\"&gt;\n *  &lt;/ac-static-ellipse-desc-desc&gt;\n *  ```\n */\n@Component({\n  selector: 'ac-static-ellipse-desc',\n  template: ''\n})\nexport class AcStaticEllipseDescComponent extends BasicStaticPrimitiveDesc {\n  constructor(ellipseDrawer: StaticEllipseDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(ellipseDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { BasicDesc } from '../../../services/basic-desc/basic-desc.service';\nimport { DynamicEllipseDrawerService } from '../../../services/drawers/static-dynamic/ellipse-drawer/dynamic-ellipse-drawer.service';\n\n/**\n *\n *\n *  This is a dynamic(position is updatable) implementation of an ellipse.\n *\n *  __Usage :__\n *  ```\n *    &lt;ac-dynamic-ellipse-desc props=\"{\n *      center: data.position,\n *      semiMajorAxis:250000.0,\n *      semiMinorAxis:400000.0,\n *      rotation : 0.785398,\n *      width:3, // Optional\n *      granularity:0.08 // Optional\n *      }\"&gt;\n *    \">\n *    &lt;/ac-dynamic-ellipse-desc&gt;\n *  ```\n *  __param:__ {Cesium.Cartesian3} center\n *  __param:__ {number} semiMajorAxis\n *  __param:__ {number} semiMinorAxis\n *  __param:__ {number} rotation\n *   __param__: {number} [1] width\n *   __param__: {number} [0.003] granularity\n */\n@Component({\n  selector: 'ac-dynamic-ellipse-desc',\n  template: '',\n})\nexport class AcDynamicEllipseDescComponent extends BasicDesc {\n  constructor(ellipseDrawer: DynamicEllipseDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(ellipseDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","// tslint:disable\nimport { Component } from '@angular/core';\nimport { BasicDesc } from '../../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { DynamicPolylineDrawerService } from '../../../services/drawers/static-dynamic/dynamic-polyline-drawer/dynamic-polyline-drawer.service';\n\n// tslint:enable\n/**\n * @deprecated use ac-polylinc-desc instead\n *\n *  This is a dynamic(position is updatable) implementation of an polyline.\n *  The ac-dynamic-polyline-desc element must be a child of ac-layer element.\n *  __Usage:__\n *  ```\n *    &lt;ac-dynamic-polyline-desc props=\"{width : polyline.width, //optional\n *                                      positions: polyline.positions,\n *                                      material: polyline.material //optional\n *                                      }\"\n *    &gt;\n *    &lt;/ac-dynamic-polyline-desc&gt;\n * ```\n */\n@Component({\n  selector: 'ac-dynamic-polyline-desc',\n  template: ''\n})\nexport class AcDynamicPolylineDescComponent extends BasicDesc {\n\n  constructor(dynamicPolylineDrawerService: DynamicPolylineDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(dynamicPolylineDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","// tslint:disable\nimport { Component } from '@angular/core';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { BasicStaticPrimitiveDesc } from '../../../services/basic-primitive-desc/basic-static-primitive-desc.service';\nimport { StaticPolygonDrawerService } from '../../../services/drawers/static-dynamic/static-polygon-drawer/polygon-drawer.service';\n\n// tslint:enable\n/**\n * @deprecated use ac-ploygon-desc instead\n *\n *  This is a static (position, color, etc.. are not updated) implementation of a polygon.\n *  __Usage:__\n *  ```\n *    &lt;ac-static-polygon-desc\n *          geometryProps=\"{\n *                     polygonHierarchy: polygon.geometry.polygonHierarchy,\n *                     height: polygon.geometry.height,\n *                     granularity: polygon.geometry.granularity\n *                 }\"\n *          instanceProps=\"{\n *                     attributes: polygon.attributes\n *                 }\"\n *          primitiveProps=\"{\n *                     appearance: polygon.appearance\n *                 }\"\n *    &gt;&lt;/ac-static-polygon-desc&gt;\n *    ```\n */\n@Component({\n  selector: 'ac-static-polygon-desc',\n  template: '',\n})\nexport class AcStaticPolygonDescComponent extends BasicStaticPrimitiveDesc {\n  constructor(polygonDrawer: StaticPolygonDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(polygonDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { BasicStaticPrimitiveDesc } from '../../../services/basic-primitive-desc/basic-static-primitive-desc.service';\nimport { StaticCircleDrawerService } from '../../../services/drawers/static-dynamic/static-circle-drawer/static-circle-drawer.service';\n\n/**\n * @deprecated use ac-circle-desc\n *\n *  This is a static (position, color, etc.. are not updated) implementation of an circle.\n *  __usage:__\n *  ```\n *    &lt;ac-static-circle-desc\n *      geometryProps=\"{\n *          center: circle.geometry.center,\n *          radius: circle.geometry.radius,\n *      }\"\n *      instanceProps=\"{\n *          attributes: circle.attributes //Optional\n *      }\"\n *      primitiveProps=\"{\n *          appearance: circle.appearance //Optional\n *      }\"&gt;\n *    &lt;/ac-static-circle-desc&gt;\n *    ```\n */\n@Component({\n  selector: 'ac-static-circle',\n  template: ''\n})\nexport class AcStaticCircleDescComponent extends BasicStaticPrimitiveDesc {\n  constructor(staticCircleDrawer: StaticCircleDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(staticCircleDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { BasicDesc } from '../../../services/basic-desc/basic-desc.service';\nimport { DynamicEllipseDrawerService } from '../../../services/drawers/static-dynamic/ellipse-drawer/dynamic-ellipse-drawer.service';\n\n/**\n * @deprecated use ac-circle-desc instead\n *\n *  This is a dynamic(position is updatable) implementation of an circle.\n __Usage :__\n *  ```\n *    &lt;ac-dynamic-circle-desc props=\"{\n *      center: data.position,\n *      radius: 5\n *      rotation : 0.785398,\n *      width:3, // Optional\n *      granularity:0.08 // Optional\n *      }\"&gt;\n *    &lt;/ac-dynamic-circle-desc&gt;\n *  ```\n *\n *  __param__: {Cesium.Cartesian3} center\n *   __param__: {number} rotation\n *   __param__: {number} radius in meters\n *   __param__: {number} [1] width\n *   __param__: {number} [0.003] granularity\n */\n@Component({\n  selector: 'ac-dynamic-circle-desc',\n  template: ''\n})\nexport class AcDynamicCircleDescComponent extends BasicDesc {\n  constructor(ellipseDrawer: DynamicEllipseDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(ellipseDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n  protected _propsEvaluator(context: Object): any {\n    const cesiumProps = super._propsEvaluator(context);\n\n    cesiumProps.semiMajorAxis = cesiumProps.radius;\n    cesiumProps.semiMinorAxis = cesiumProps.radius;\n\n    return cesiumProps;\n  }\n}\n","// tslint:disable\nimport { Component } from '@angular/core';\nimport { StaticPolylineDrawerService } from '../../../services/drawers/static-dynamic/static-polyline-drawer/static-polyline-drawer.service';\nimport { LayerService } from '../../../services/layer-service/layer-service.service';\nimport { CesiumProperties } from '../../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../../services/computation-cache/computation-cache.service';\nimport { BasicStaticPrimitiveDesc } from '../../../services/basic-primitive-desc/basic-static-primitive-desc.service';\n\n// tslint:enable\n\n/**\n * @deprecated use ac-ployline-desc instead\n *\n *  This is a static implementation of an polyline.\n *  __usage:__\n *  ```\n *    &ltac-static-polyline-desc\n *            geometryProps=\"{\n *            \twidth: poly.geometry.width,\n *            \tpositions: poly.geometry.positions\n *            }\"\n *            instanceProps=\"{\n *              attributes: {\n *                  Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom())\n *              }\n *            }\"\n *            primitiveProps=\"{\n *              appearance: new Cesium.PolylineColorAppearance()\n *    }\"&gt&lt/ac-static-polyline-desc&gt\n *  ```\n */\n@Component({\n  selector: 'ac-static-polyline-desc',\n  template: ''\n})\nexport class AcStaticPolylineDescComponent extends BasicStaticPrimitiveDesc {\n  constructor(polylineDrawerService: StaticPolylineDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(polylineDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef, OnInit } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ModelDrawerService } from '../../services/drawers/model-drawer/model-drawer.service';\n\n/**\n *  This is a model implementation.\n *  The ac-model element must be a child of ac-layer element.\n *  The properties of props are the same as the properties of Entity and ModelGraphics:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/ModelGraphics.html\n *\n *  __Usage:__\n *  ```\n *    <ac-model-desc props=\"{\n *       position : Cesium.Cartesian3.fromDegrees(-123.0744619, 44.0503706),\n *       uri : '../../SampleData/models/CesiumGround/Cesium_Ground.gltf'\n *   }\n *    }\">\n *    </ac-model-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-model-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcModelDescComponent)}],\n})\nexport class AcModelDescComponent extends BasicDesc implements OnInit {\n\n  constructor(modelDrawer: ModelDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(modelDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { CesiumService } from '../../services/cesium/cesium.service';\nimport { Checker } from '../../utils/checker';\n\n/**\n *  This component is used for adding a 3d tileset layer to the map (ac-map).\n *  options according to `Cesium3DTileset` definition.\n *  check out: https://cesiumjs.org/Cesium/Build/Documentation/Cesium3DTileset.html\n *\n *\n *  __Usage :__\n *  ```\n *    <ac-3d-tile-layer [options]=\"optionsObject\">\n *    </ac-3d-tile-layer>\n *  ```\n */\n@Component({\n  selector: 'ac-3d-tile-layer',\n  template: '',\n})\nexport class AcTileset3dComponent implements OnInit, OnChanges, OnDestroy {\n  /**\n   * refer to cesium docs for details https://cesiumjs.org/Cesium/Build/Documentation/Cesium3DTileset.html\n   */\n  @Input()\n  options: { url?: string } = {};\n\n  /**\n   * index (optional) - The index to add the layer at. If omitted, the layer will added on top of all existing layers.\n   */\n  @Input()\n  index: Number;\n\n  /**\n   * show (optional) - Determines if the map layer is shown.\n   */\n  @Input()\n  show = true;\n\n  /**\n   * show (optional) - Sets 3Dtiles style.\n   */\n  @Input()\n  style: any;\n\n  public tilesetInstance: any = null;\n  private _3dtilesCollection: any;\n\n  constructor(private cesiumService: CesiumService) {\n  }\n\n  ngOnInit() {\n    if (!Checker.present(this.options.url)) {\n      throw new Error('Options must have a url');\n    }\n\n    this._3dtilesCollection = new Cesium.PrimitiveCollection();\n    this.cesiumService.getScene().primitives.add(this._3dtilesCollection);\n\n    if (this.show) {\n      this.tilesetInstance = this._3dtilesCollection.add(new Cesium.Cesium3DTileset(this.options), this.index);\n      if (this.style) {\n        this.tilesetInstance.style = new Cesium.Cesium3DTileStyle(this.style);\n      }\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['show'] && !changes['show'].isFirstChange()) {\n      const showValue = changes['show'].currentValue;\n\n      if (showValue) {\n        if (this.tilesetInstance) {\n          this._3dtilesCollection.add(this.tilesetInstance, this.index);\n        } else {\n          this.tilesetInstance = this._3dtilesCollection.add(new Cesium.Cesium3DTileset(this.options), this.index);\n          if (this.style) {\n            this.tilesetInstance.style = new Cesium.Cesium3DTileStyle(this.style);\n          }\n        }\n      } else if (this.tilesetInstance) {\n        this._3dtilesCollection.remove(this.tilesetInstance, false);\n      }\n    }\n    if (changes['style'] && !changes['style'].isFirstChange()) {\n      const styleValue = changes['style'].currentValue;\n      if (this.tilesetInstance) {\n        this.tilesetInstance.style = new Cesium.Cesium3DTileStyle(this.style);\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.tilesetInstance) {\n      this._3dtilesCollection.remove(this.tilesetInstance, false);\n    }\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { BoxDrawerService } from '../../services/drawers/box-dawer/box-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-box-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity (like `position`)\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/BoxGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-box-desc props=\"{\n *     show : point.show, //optional\n *     position : point.positions,\n *     material : point.color  //optional\n *   }\">\n *   </ac-box-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-box-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcBoxDescComponent)}],\n})\nexport class AcBoxDescComponent extends BasicDesc {\n\n  constructor(drawerService: BoxDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { CylinderDrawerService } from '../../services/drawers/cylinder-dawer/cylinder-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-box-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity (like `position`)\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/CylinderGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-cylinder-desc props=\"{\n *     show : cylinder.show, //optional\n *     position : cylinder.position,\n *     material : cylinder.color  //optional\n *   }\">\n *   </ac-cylinder-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-cylinder-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcCylinderDescComponent)}],\n})\nexport class AcCylinderDescComponent extends BasicDesc {\n\n  constructor(drawerService: CylinderDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { CorridorDrawerService } from '../../services/drawers/corridor-dawer/corridor-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-box-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/CorridorGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-corridor-desc props=\"{\n *     show : point.show, //optional\n *     positions : point.positions,\n *     material : point.color  //optional\n *   }\">\n *   </ac-corridor-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-corridor-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcCorridorDescComponent)}],\n})\nexport class AcCorridorDescComponent extends BasicDesc {\n\n  constructor(drawerService: CorridorDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { EllipsoidDrawerService } from '../../services/drawers/ellipoid-drawer/ellipsoid-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-box-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/EllipsoidGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-ellipsoid-desc props=\"{\n *     show : ellipsoid.show, //optional\n *     radii : ellipsoid.radii,\n *     material : ellipsoid.color  //optional\n *   }\">\n *   </ac-ellipsoid-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-ellipsoid-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcEllipsoidDescComponent)}],\n})\nexport class AcEllipsoidDescComponent extends BasicDesc {\n\n  constructor(drawerService: EllipsoidDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { PolylineVolumeDrawerService } from '../../services/drawers/polyline-volume-dawer/polyline-volume-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/PolylineVolumeGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-polyline-volume-desc props=\"{\n *     show : line.show, //optional\n *     positions : line.positions,\n *     material : line.color  //optional\n *   }\">\n *   </ac-polyline-volume-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-polyline-volume-desc',\n  template: ''\n})\nexport class AcPolylineVolumeDescComponent extends BasicDesc {\n\n  constructor(drawerService: PolylineVolumeDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { WallDrawerService } from '../../services/drawers/wall-dawer/wall-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-box-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/WallGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-wall-desc props=\"{\n *     show : wall.show, //optional\n *     positions : wall.positions,\n *     material : wall.color  //optional\n *   }\">\n *   </ac-wall-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-wall-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcWallDescComponent)}],\n})\nexport class AcWallDescComponent extends BasicDesc {\n\n  constructor(drawerService: WallDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { RectangleDrawerService } from '../../services/drawers/rectangle-dawer/rectangle-drawer.service';\n\n/**\n *  This is a point implementation.\n *  The ac-rectangle-desc element must be a child of ac-layer element.\n *  The properties of props are the same as the properties PointGraphics and the general properties\n *  of Entity\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Entity.html\n *  + https://cesiumjs.org/Cesium/Build/Documentation/RectangleGraphics.html\n *\n *  __Usage:__\n *  ```\n *   <ac-rectangle-desc props=\"{\n *     show : rectangle.show, //optional\n *     coordinates : rectangle.positions,\n *     material : rectangle.color  //optional\n *   }\">\n *   </ac-rectangle-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-rectangle-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcRectangleDescComponent)}],\n})\nexport class AcRectangleDescComponent extends BasicDesc {\n\n  constructor(drawerService: RectangleDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(drawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { BillboardPrimitiveDrawerService } from '../../services/drawers/billboard-primitive-drawer/billboard-primitive-drawer.service';\n\n/**\n *  This is a billboard primitive implementation.\n *  The element must be a child of ac-layer element.\n *  The properties of props are:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Billboard.html\n *\n *  __Usage :__\n *  ```\n *    <ac-billboard-primitive-desc props=\"{\n *      image: track.image,\n *      position: track.position,\n *      scale: track.scale,\n *      color: track.color,\n *      name: track.name\n *    }\">\n *    </ac-billboard-primitive-desc>\n *  ```\n */\n\n@Component({\n  selector: 'ac-billboard-primitive-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcBillboardPrimitiveDescComponent)}],\n})\nexport class AcBillboardPrimitiveDescComponent extends BasicDesc {\n\n  constructor(billboardPrimitiveDrawer: BillboardPrimitiveDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(billboardPrimitiveDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { LabelPrimitiveDrawerService } from '../../services/drawers/label-primitive-drawer/label-primitive-drawer.service';\n\n/**\n *  This is a label primitive implementation.\n *  The ac-label element must be a child of ac-layer element.\n *  The properties of props are:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Label.html\n *\n *  __Usage :__\n *  ```\n *    <ac-label-primitive-desc props=\"{\n *      position: track.position,\n *      pixelOffset : [-15,20] | pixelOffset,\n *      text: track.name,\n *      font: '15px sans-serif'\n *    }\">\n *    </ac-label-primitive-desc>\n *  ```\n */\n\n@Component({\n  selector: 'ac-label-primitive-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcLabelPrimitiveDescComponent)}],\n})\nexport class AcLabelPrimitiveDescComponent extends BasicDesc {\n\n  constructor(labelPrimitiveDrawer: LabelPrimitiveDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(labelPrimitiveDrawer, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { PolylinePrimitiveDrawerService } from '../../services/drawers/polyline-primitive-drawer/polyline-primitive-drawer.service';\n\n/**\n *  This is a polyline primitive implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Polyline Primitive:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Polyline.html\n *\n *  __Usage:__\n *  ```\n *    <ac-polyline-primitive-desc props=\"{\n *      width : polyline.width,\n *      positions: polyline.positions,\n *      material: polyline.material\n *    }\">\n *    </ac-polyline-primitive-desc>\n * ```\n */\n@Component({\n  selector: 'ac-polyline-primitive-desc',\n  template: '',\n  providers: [{provide: BasicDesc, useExisting: forwardRef(() => AcPolylinePrimitiveDescComponent)}],\n})\nexport class AcPolylinePrimitiveDescComponent extends BasicDesc {\n\n  constructor(polylinePrimitiveDrawerService: PolylinePrimitiveDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(polylinePrimitiveDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { HtmlCollection } from '../collections';\nimport { Cartesian2 } from '../../angular-cesium/models/cartesian2';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\n\nexport class HtmlPrimitive {\n\n  private _scene: any;\n  private _show: boolean;\n  private _position: Cartesian3;\n  private _lastPosition: Cartesian2;\n  private _pixelOffset: Cartesian2;\n  private _element: HTMLElement;\n  private _collection: HtmlCollection;\n  private _mapContainer;\n\n  constructor(options: any, collection: HtmlCollection = null) {\n    if (typeof options !== 'object') {\n      throw new Error('HtmlPrimitive ERROR: invalid html options!');\n    }\n\n    this.scene = options.scene;\n    this._mapContainer = options.mapContainer;\n    this.show = options.show || true;\n    this.position = options.position;\n    this.pixelOffset = options.pixelOffset;\n    this.element = options.element;\n    this.collection = collection;\n  }\n\n  set scene(scene: any) {\n    this._scene = scene;\n  }\n\n  set show(show: boolean) {\n    this._show = show;\n\n    if (Cesium.defined(this.element)) {\n      if (show) {\n        this._element.style.display = 'block';\n      } else {\n        this._element.style.display = 'none';\n      }\n    }\n  }\n\n  get show(): boolean {\n    return this._show;\n  }\n\n  set position(position: Cartesian3) {\n    this._position = position;\n  }\n\n  get position(): Cartesian3 {\n    return this._position;\n  }\n\n  set pixelOffset(pixelOffset: Cartesian2) {\n    this._pixelOffset = pixelOffset;\n  }\n\n  get pixelOffset(): Cartesian2 {\n    return this._pixelOffset;\n  }\n\n  set element(element: HTMLElement) {\n    this._element = element;\n\n    if (Cesium.defined(element)) {\n      this._mapContainer.appendChild(element);\n      this._element.style.position = 'absolute';\n      this._element.style.zIndex = Number.MAX_VALUE.toString();\n    }\n  }\n\n  get element(): HTMLElement {\n    return this._element;\n  }\n\n  set collection(collection: HtmlCollection) {\n    this._collection = collection;\n  }\n\n  get collection() {\n    return this._collection;\n  }\n\n  update() {\n    if (!Cesium.defined(this._show) || !Cesium.defined(this._element)) {\n      return;\n    }\n\n    let screenPosition = Cesium.SceneTransforms.wgs84ToWindowCoordinates(this._scene, this._position);\n\n    if (!Cesium.defined(screenPosition)) {\n      screenPosition = new Cesium.Cartesian2((-1000), (-1000));\n    } else if (Cesium.defined(this._pixelOffset) && Cesium.defined(this._pixelOffset.x) && Cesium.defined(this._pixelOffset.y)) {\n      screenPosition.y += this._pixelOffset.y;\n      screenPosition.x += this._pixelOffset.x;\n    }\n\n    if (this._lastPosition && this._lastPosition.equals(screenPosition)) {\n      return;\n    }\n\n    this._element.style.top = `${screenPosition.y}px`;\n    this._element.style.left = `${screenPosition.x}px`;\n    this._lastPosition = screenPosition;\n  }\n}\n","import { HtmlPrimitive } from '../primitives';\n\nexport class HtmlCollection {\n  private _collection: HtmlPrimitive[] = [];\n\n  get length() {\n    return this._collection.length;\n  }\n\n  get(index: number) {\n    return this._collection[index];\n  }\n\n  add(options: any): HtmlPrimitive {\n    const html = new HtmlPrimitive(options, this);\n    this._collection.push(html);\n\n    return html;\n  }\n\n  remove(html: HtmlPrimitive): boolean {\n    const index = this._collection.indexOf(html);\n\n    if (index === (-1)) {\n      return false;\n    }\n\n    this._collection.splice(index, 1);\n    return true;\n  }\n\n  update() {\n    for (let i = 0, len = this._collection.length; i < len; i++) {\n      this._collection[i].update();\n    }\n  }\n\n  removeAll() {\n    while (this._collection.length > 0) {\n      this._collection.pop();\n    }\n  }\n\n  contains(html: HtmlPrimitive): boolean {\n    return Cesium.defined(html) && html.collection === this;\n  }\n}\n","import { HtmlPrimitive } from './primitives';\nimport { HtmlCollection } from './collections';\n\nexport class CesiumExtender {\n  static extend() {\n    Cesium.HtmlPrimitive = HtmlPrimitive;\n    Cesium.HtmlCollection = HtmlCollection;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class AcHtmlManager {\n  private _entities: Map<any, any>;\n\n  constructor() {\n    this._entities = new Map<any, any>();\n  }\n\n  has(id: string): boolean {\n    return this._entities.has(id);\n  }\n\n  get(id: string): { entity: any, primitive: any } {\n    return this._entities.get(id);\n  }\n\n  addOrUpdate(id: any, info: { entity: any, primitive: any }) {\n    this._entities.set(id, info);\n  }\n\n  remove(id: string) {\n    this._entities.delete(id);\n  }\n\n  forEach(callback: any) {\n    this._entities.forEach(callback);\n  }\n}\n","import { ChangeDetectorRef, Directive, OnInit, TemplateRef, ViewContainerRef } from '@angular/core';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { AcHtmlManager } from '../../services/ac-html-manager/ac-html-manager.service';\n\nexport class AcHtmlContext {\n  constructor(\n    public id: any,\n    public context: any\n  ) {\n  }\n}\n\n@Directive({\n  selector: '[acHtml]',\n})\nexport class AcHtmlDirective implements OnInit {\n\n  private _views = new Map<any, { viewRef: any, context: any }>();\n\n  constructor(\n    private _templateRef: TemplateRef<AcHtmlContext>,\n    private _viewContainerRef: ViewContainerRef,\n    private _changeDetector: ChangeDetectorRef,\n    private _layerService: LayerService,\n    private _acHtmlManager: AcHtmlManager\n  ) {\n  }\n\n  ngOnInit() {\n\n  }\n\n  private _handleView(id: any, primitive: any, entity: any) {\n    if (!this._views.has(id) && primitive.show) {\n      const context = new AcHtmlContext(id, {$implicit: entity});\n      const viewRef = this._viewContainerRef.createEmbeddedView(this._templateRef, context);\n      this._views.set(id, {viewRef, context});\n      this._changeDetector.detectChanges();\n    } else if (this._views.has(id) && !primitive.show) {\n      this.remove(id, primitive);\n    } else if (this._views.has(id) && primitive.show) {\n      this._changeDetector.detectChanges();\n    }\n  }\n\n  addOrUpdate(id: any, primitive: any) {\n    const context = this._layerService.context;\n    const entity = context[this._layerService.getEntityName()];\n\n    if (this._views.has(id)) {\n      this._views.get(id).context.context.$implicit = entity;\n    }\n\n    this._acHtmlManager.addOrUpdate(id, {entity, primitive});\n    this._handleView(id, primitive, entity);\n  }\n\n  remove(id: any, primitive: any) {\n    if (!this._views.has(id)) {\n      return;\n    }\n\n    const {viewRef} = this._views.get(id);\n    this._viewContainerRef.remove(this._viewContainerRef.indexOf(viewRef));\n    this._views.delete(id);\n    this._acHtmlManager.remove(id);\n    primitive.element = null;\n  }\n}\n","import { Component, ContentChild, OnInit, TemplateRef, ViewChild } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { HtmlDrawerService } from '../../services/drawers/html-drawer/html-drawer.service';\nimport { AcHtmlDirective } from '../../directives/ac-html/ac-html.directive';\nimport { AcHtmlManager } from '../../services/ac-html-manager/ac-html-manager.service';\n\n/**\n *  This is an html implementation.\n *  The ac-html element must be a child of ac-layer element.\n *  <br>\n *  [props] accepts position(Cartesian3) and show(boolean).\n *\n *  __Usage:__\n *  ```\n *  <ac-layer acFor=\"let html of htmls$\" [context]=\"this\">\n <ac-html-desc props=\"{position: html.position, show: html.show}\">\n <ng-template let-html>\n <div>\n <h1>This is ac-html {{html.name}}</h1>\n <button (click)=\"changeText(html, 'Test')\">change text</button>\n </div>\n </ng-template>\n </ac-html-desc>\n *  <ac-html [props]=\"{position: position, show: true}\">;\n *    <p>html element</p>\n *  </ac-html>\n *  ```\n */\n@Component({\n  selector: 'ac-html-desc',\n  providers: [AcHtmlManager],\n  template: `\n      <div *acHtml=\"let acHtmlEntityId = id; let acHtmlContext = context\">\n          <div [acHtmlContainer]=\"acHtmlEntityId\">\n              <ng-template [ngTemplateOutlet]=\"acHtmlTemplate\"\n                           [ngTemplateOutletContext]=\"acHtmlContext\"></ng-template>\n          </div>\n      </div>`\n})\nexport class AcHtmlDescComponent extends BasicDesc implements OnInit {\n\n  @ViewChild(AcHtmlDirective) acHtmlCreator: AcHtmlDirective;\n  @ContentChild(TemplateRef) acHtmlTemplate: TemplateRef<any>;\n\n  constructor(htmlDrawer: HtmlDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(htmlDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    if (!this.acHtmlCreator) {\n      throw new Error(`AcHtml desc ERROR: ac html directive not found.`);\n    }\n\n    if (!this.acHtmlTemplate) {\n      throw new Error(`AcHtml desc ERROR: html template not found.`);\n    }\n  }\n\n  draw(context: any, id: any): any {\n    const cesiumProps = this._propsEvaluator(context);\n    if (!this._cesiumObjectsMap.has(id)) {\n      const primitive = this._drawer.add(cesiumProps);\n      this._cesiumObjectsMap.set(id, primitive);\n      this.acHtmlCreator.addOrUpdate(id, primitive);\n    } else {\n      const primitive = this._cesiumObjectsMap.get(id);\n      this._drawer.update(primitive, cesiumProps);\n      this.acHtmlCreator.addOrUpdate(id, primitive);\n    }\n  }\n\n  remove(id: string): void {\n    const primitive = this._cesiumObjectsMap.get(id);\n    this._drawer.remove(primitive);\n    this._cesiumObjectsMap.delete(id);\n    this.acHtmlCreator.remove(id, primitive);\n  }\n\n  removeAll(): void {\n    this._cesiumObjectsMap.forEach(((primitive, id) => {\n      this.acHtmlCreator.remove(id, primitive);\n    }));\n    this._cesiumObjectsMap.clear();\n    this._drawer.removeAll();\n  }\n}\n","import { Directive, ElementRef, Input, OnInit } from '@angular/core';\nimport { AcHtmlManager } from '../../services/ac-html-manager/ac-html-manager.service';\n\n@Directive({\n  selector: '[acHtmlContainer]'\n})\nexport class AcHtmlContainerDirective implements OnInit {\n\n  private _id: any;\n\n  constructor(\n    private _element: ElementRef,\n    private _acHtmlManager: AcHtmlManager\n  ) {\n  }\n\n  @Input()\n  set acHtmlContainer(id: string) {\n    this._id = id;\n  }\n\n  ngOnInit() {\n    if (this._id === undefined) {\n      throw new Error(`AcHtml container ERROR: entity id not defined`);\n    }\n\n    const entity = this._acHtmlManager.get(this._id);\n    entity.primitive.element = this._element.nativeElement;\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  OnDestroy,\n  OnInit,\n  ViewChild,\n  ViewContainerRef\n} from '@angular/core';\nimport { ContextMenuService } from '../../services/context-menu/context-menu.service';\nimport { Subscription } from 'rxjs';\nimport { BasicContextMenu } from '../../models/basic-context-menu';\n\n/**\n * This component is used to inject the component that is passed to the ContextMenuService when opening a context menu.\n * It shouldn't be used directly.\n *\n * usage:\n * ```typescript\n * // We want to open the context menu on mouse right click.\n * // Register to mouse right click with the MapEventsManager\n * this.mapEventsManager.register({ event: CesiumEvent.RIGHT_CLICK, pick: PickOptions.NO_PICK })\n *    .subscribe(event => {\n *       const position = this.coordinateConverter.screenToCartesian3(event.movement.endPosition, true);\n *       if (!position) {\n *         return;\n *       }\n *       // Open the context menu on the position that was clicked and pass some data to ContextMenuComponent.\n *       this.contextMenuService.open(\n *         ContextMenuComponent,\n *         position,\n *         { data: { items: ['New Track', 'Change Map', 'Context Menu', 'Do Something'] } }\n *       )\n *    });\n *\n * ```\n */\n\n@Component({\n  selector: 'ac-context-menu-wrapper',\n  template: `\n    <ac-html *ngIf=\"contextMenuService.showContextMenu\" [props]=\"{position: contextMenuService.position}\">\n      <div #contextMenuContainer></div>\n    </ac-html>\n  `,\n  styles: [],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AcContextMenuWrapperComponent implements OnInit, OnDestroy {\n\n  private contextMenuChangeSubscription: Subscription;\n  private contextMenuOpenSubscription: Subscription;\n\n  @ViewChild('contextMenuContainer', {read: ViewContainerRef}) viewContainerRef: ViewContainerRef;\n\n  constructor(public contextMenuService: ContextMenuService,\n              private cd: ChangeDetectorRef,\n              private componentFactoryResolver: ComponentFactoryResolver) {\n  }\n\n  ngOnInit() {\n    this.contextMenuChangeSubscription =\n      this.contextMenuService.contextMenuChangeNotifier.subscribe(() => this.cd.detectChanges());\n    this.contextMenuOpenSubscription =\n      this.contextMenuService.onOpen.subscribe(() => {\n        const componentFactory = this.componentFactoryResolver.resolveComponentFactory(this.contextMenuService.content as any);\n        this.viewContainerRef.clear();\n        const componentRef = this.viewContainerRef.createComponent(componentFactory);\n        (componentRef.instance as BasicContextMenu).data = this.contextMenuService.options.data;\n        this.cd.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    if (this.contextMenuChangeSubscription) {\n      this.contextMenuChangeSubscription.unsubscribe();\n    }\n\n    if (this.contextMenuOpenSubscription) {\n      this.contextMenuOpenSubscription.unsubscribe();\n    }\n  }\n}\n","import {\n  AfterContentInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ContentChildren,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  SimpleChanges,\n  ViewChild\n} from '@angular/core';\nimport { AcNotification } from '../../models/ac-notification';\nimport { Subject, Subscription } from 'rxjs';\nimport { IDescription } from '../../models/description';\nimport * as _get from 'lodash.get';\nimport { AcLayerComponent } from '../ac-layer/ac-layer.component';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\n\n/**\n *  This is component represents an array under `ac-layer`.\n *  The element must be a child of ac-layer element.\n *  + acFor `{string}` - get the tracked array and entityName (see the example).\n *  + idGetter `{Function}` - a function that gets the id for a given element in the array -should be defined for maximum performance.\n *  + show `{boolean}` - show/hide array's entities.\n *\n *  __Usage :__\n *  ```\n *<ac-layer acFor=\"let track of tracks$\" [show]=\"show\" [context]=\"this\" [store]=\"true\">\n *  <ac-array-desc acFor=\"let arrayItem of track.array\" [idGetter]=\"trackArrayIdGetter\">\n *    <ac-array-desc acFor=\"let innerArrayItem of arrayItem.innerArray\" [idGetter]=\"trackArrayIdGetter\">\n *      <ac-point-desc props=\"{\n *        position: innerArrayItem.pos,\n *        pixelSize: 10,\n *        color: getTrackColor(track),\n *        outlineColor: Cesium.Color.BLUE,\n *        outlineWidth: 1\n *      }\">\n *      </ac-point-desc>\n *    </ac-array-desc>\n *  </ac-array-desc>\n *</ac-layer>\n *  ```\n */\n\n@Component({\n  selector: 'ac-array-desc',\n  template: `\n    <ac-layer #layer [acFor]=\"getAcForString()\"\n              [context]=\"layerService.context\"\n              [options]=\"layerService.options\"\n              [show]=\"layerService.show && show\"\n              [zIndex]=\"layerService.zIndex\">\n      <ng-content #content></ng-content>\n    </ac-layer>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AcArrayDescComponent implements OnChanges, OnInit, AfterContentInit, OnDestroy, IDescription {\n\n  @Input() acFor: string;\n\n  @Input() idGetter: (item: any, index: number) => string;\n\n  @Input() show = true;\n  @ViewChild('layer') private layer: AcLayerComponent;\n  @ContentChildren(BasicDesc, {descendants: false}) private basicDescs: any;\n  @ContentChildren(AcArrayDescComponent, {descendants: false}) private arrayDescs: any;\n  private entitiesMap = new Map<string, string[]>();\n  private layerServiceSubscription: Subscription;\n  private id = 0;\n  private readonly acForRgx = /^let\\s+.+\\s+of\\s+.+$/;\n  entityName: string;\n  arrayPath: string;\n  arrayObservable$ = new Subject<AcNotification>();\n\n  constructor(public layerService: LayerService, private cd: ChangeDetectorRef) {\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes['acFor'].firstChange) {\n      const acForString = changes['acFor'].currentValue;\n      if (!this.acForRgx.test(acForString)) {\n        throw new Error(`ac-layer: Invalid [acFor] syntax. Expected: [acFor]=\"let item of observable\" .Instead received: ${acForString}`);\n      }\n      const acForArr = changes['acFor'].currentValue.split(' ');\n      this.arrayPath = acForArr[3];\n      this.entityName = acForArr[1];\n    }\n  }\n\n  ngOnInit(): void {\n    this.layer.getLayerService().cache = false;\n    this.layerServiceSubscription = this.layerService.layerUpdates().subscribe(() => {\n      this.cd.detectChanges();\n    });\n  }\n\n  ngAfterContentInit(): void {\n    this.layerService.context['arrayObservable$'] = this.arrayObservable$;\n    this.layerService.registerDescription(this);\n    this.basicDescs._results.forEach((component: BasicDesc) => {\n      component.setLayerService(this.layer.getLayerService());\n    });\n    this.arrayDescs._results.splice(0, 1);\n    this.arrayDescs._results.forEach((component: AcArrayDescComponent) => {\n      this.layerService.unregisterDescription(component);\n      this.layer.getLayerService().registerDescription(component);\n      component.layerService = this.layer.getLayerService();\n      component.setLayerService(this.layer.getLayerService());\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.layerServiceSubscription) {\n      this.layerServiceSubscription.unsubscribe();\n    }\n  }\n\n  setLayerService(layerService: LayerService) {\n    this.layerService = layerService;\n  }\n\n  draw(context: any, id: string, contextEntity: any) {\n    const get = _get;\n    const entitiesArray: any[] = get(context, this.arrayPath);\n    if (!entitiesArray) {\n      return;\n    }\n    const previousEntitiesIdArray = this.entitiesMap.get(id);\n    const entitiesIdArray: any[] = [];\n    this.entitiesMap.set(id, entitiesIdArray);\n\n    entitiesArray.forEach((item, index) => {\n      this.layerService.context[this.entityName] = item;\n      const arrayItemId = this.generateCombinedId(id, item, index);\n      entitiesIdArray.push(arrayItemId);\n      this.layer.update(contextEntity, arrayItemId);\n    });\n\n    if (previousEntitiesIdArray) {\n      const entitiesToRemove = this.idGetter ?\n        previousEntitiesIdArray.filter((entityId) => entitiesIdArray.indexOf(entityId) < 0) :\n        previousEntitiesIdArray;\n      if (entitiesToRemove) {\n        entitiesToRemove.forEach((entityId) => this.layer.remove(entityId));\n      }\n    }\n  }\n\n  remove(id: string) {\n    const entitiesIdArray = this.entitiesMap.get(id);\n    if (entitiesIdArray) {\n      entitiesIdArray.forEach((entityId) => this.layer.remove(entityId));\n    }\n    this.entitiesMap.delete(id);\n  }\n\n  removeAll() {\n    this.layer.removeAll();\n    this.entitiesMap.clear();\n  }\n\n  getAcForString() {\n    return `let ${this.entityName + '___temp'} of arrayObservable$`;\n  }\n\n  private generateCombinedId(entityId: string, arrayItem: any, index: number): string {\n    let arrayItemId;\n    if (this.idGetter) {\n      arrayItemId = this.idGetter(arrayItem, index);\n    } else {\n      arrayItemId = (this.id++) % Number.MAX_SAFE_INTEGER;\n    }\n    return entityId + arrayItemId;\n  }\n}\n","import { Component } from '@angular/core';\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\nimport { PointPrimitiveDrawerService } from '../../services/drawers/point-primitive-drawer/point-primitive-drawer.service';\n\n/**\n *  This is a label primitive implementation.\n *  The ac-label element must be a child of ac-layer element.\n *  The properties of props are:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Point.html\n *\n *  __Usage :__\n *  ```\n *    <ac-point-primitive-desc props=\"{\n *      position: track.position,\n *      color: Cesium.Color.RED\n *    }\">\n *    </ac-point-primitive-desc>\n *  ```\n */\n\n@Component({\n  selector: 'ac-point-primitive-desc',\n  template: '',\n})\nexport class AcPointPrimitiveDescComponent extends BasicDesc {\n\n  constructor(pointPrimitiveDrawerService: PointPrimitiveDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(pointPrimitiveDrawerService, layerService, computationCache, cesiumProperties);\n  }\n}\n","import { Component } from '@angular/core';\nimport { EntityOnMapComponent } from '../../services/entity-on-map/entity-on-map.component';\nimport { MapLayersService } from '../../services/map-layers/map-layers.service';\nimport { PolylinePrimitiveDrawerService } from '../../services/drawers/polyline-primitive-drawer/polyline-primitive-drawer.service';\n\n/**\n *  This is a polyline implementation.\n *  The ac-label element must be a child of ac-map element.\n *  The properties of props are the same as the properties of Polyline Primitive:\n *  + https://cesiumjs.org/Cesium/Build/Documentation/Polyline.html\n *\n *  __Usage:__\n *  ```\n *  <ac-polyline [props]=\"{\n *    position: position,\n *    text: 'labelText',\n *    font: '30px sans-serif'\n *    color: Cesium.Color.GREEN\n *  }\">;\n *  </ac-polyline>\n *  ```\n */\n\n@Component({\n  selector: 'ac-primitive-polyline',\n  template: '',\n})\nexport class AcPrimitivePolylineComponent extends EntityOnMapComponent {\n\n  constructor(polylineDrawer: PolylinePrimitiveDrawerService, mapLayers: MapLayersService) {\n    super(polylineDrawer, mapLayers);\n  }\n}\n","import { PixelOffsetPipe } from './pixel-offset/pixel-offset.pipe';\nimport { RadiansToDegreesPipe } from './radians-to-degrees/radians-to-degrees.pipe';\n\n// For angular parse usage\nexport default [\n  {pipeName: 'pixelOffset', pipeInstance: new PixelOffsetPipe()},\n  {pipeName: 'radiansToDegrees', pipeInstance: new RadiansToDegreesPipe()},\n];\n","import { Component, OnInit } from '@angular/core';\n\nimport { BasicDesc } from '../../services/basic-desc/basic-desc.service';\nimport { CesiumProperties } from '../../services/cesium-properties/cesium-properties.service';\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\nimport { CzmlDrawerService } from '../../services/drawers/czml-drawer/czml-drawer.service';\nimport { LayerService } from '../../services/layer-service/layer-service.service';\n\n/**\n *  This is a czml implementation.\n *  The ac-czml-desc element must be a child of ac-layer element.\n *\n *  See CZML Guide for the structure of props.czmlPacket:\n *  + https://github.com/AnalyticalGraphicsInc/czml-writer/wiki/CZML-Structure\n *\n *  Attention: the first czmlPacket in the stream needs to be a document\n *  with an id and a name attribute. See this example\n *  + https://cesiumjs.org/Cesium/Apps/Sandcastle/index.html?src=CZML%20Point%20-%20Time%20Dynamic.html&label=CZML\n *\n *  To see a working example, use the demo app and\n *  + uncomment <czml-layer></czml-layer> in demo-map.component.html\n *  + set the properties 'timeline', 'animation' and 'shouldAnimate' true in viewerOptions of demo-map.component.ts\n *\n *\n *  __Usage:__\n *  ```\n *    <ac-czml-desc props=\"{\n *      czmlPacket: czmlPacket\n *    }\">\n *    </ac-czml-desc>\n *  ```\n */\n@Component({\n  selector: 'ac-czml-desc',\n  template: '',\n})\nexport class AcCzmlDescComponent extends BasicDesc implements OnInit {\n  constructor(czmlDrawer: CzmlDrawerService, layerService: LayerService,\n              computationCache: ComputationCache, cesiumProperties: CesiumProperties) {\n    super(czmlDrawer, layerService, computationCache, cesiumProperties);\n  }\n\n\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { AcMapComponent } from './components/ac-map/ac-map.component';\nimport { AcLayerComponent } from './components/ac-layer/ac-layer.component';\nimport { AcBillboardComponent } from './components/ac-billboard/ac-billboard.component';\nimport { AcBillboardDescComponent } from './components/ac-billborad-desc/ac-billborad-desc.component';\nimport { AcEllipseDescComponent } from './components/ac-ellipse-desc/ac-ellipse-desc.component';\nimport { AcPolylineDescComponent } from './components/ac-polyline-desc/ac-polyline-desc.component';\nimport { Angular2ParseModule, PIPES_CONFIG } from 'angular2parse';\nimport { PixelOffsetPipe } from './pipes/pixel-offset/pixel-offset.pipe';\nimport { RadiansToDegreesPipe } from './pipes/radians-to-degrees/radians-to-degrees.pipe';\nimport { JsonMapper } from './services/json-mapper/json-mapper.service';\nimport { CesiumProperties } from './services/cesium-properties/cesium-properties.service';\nimport { AcLabelDescComponent } from './components/ac-label-desc/ac-label-desc.component';\nimport { UtilsModule } from './utils/utils.module';\nimport { ViewerFactory } from './services/viewer-factory/viewer-factory.service';\nimport { GeoUtilsService } from './services/geo-utils/geo-utils.service';\nimport { AcCircleDescComponent } from './components/ac-circle-desc/ac-circle-desc.component';\nimport { AcArcDescComponent } from './components/ac-arc-desc/ac-arc-desc.component';\nimport { AcMapLayerProviderComponent } from './components/ac-map-layer-provider/ac-map-layer-provider.component';\nimport { AcPointDescComponent } from './components/ac-point-desc/ac-point-desc.component';\nimport { AcLabelComponent } from './components/ac-label/ac-label.component';\nimport { AcPolylineComponent } from './components/ac-polyline/ac-polyline.component';\nimport { AcEllipseComponent } from './components/ac-ellipse/ac-ellipse.component';\nimport { AcPointComponent } from './components/ac-point/ac-point.component';\nimport { AcHtmlComponent } from './components/ac-html/ac-html.component';\nimport { AcCircleComponent } from './components/ac-circle/ac-circle.component';\nimport { AcArcComponent } from './components/ac-arc/ac-arc.component';\nimport { AcPolygonDescComponent } from './components/ac-polygon-desc/ac-polygon-desc.component';\nimport { AcDefaultPlonterComponent } from './components/ac-default-plonter/ac-default-plonter.component';\nimport { AcPolygonComponent } from './components/ac-polygon/ac-polygon.component';\nimport { MapsManagerService } from './services/maps-manager/maps-manager.service';\nimport { AcStaticEllipseDescComponent } from './components/static-dynamic/ac-static-ellipse-desc/ac-static-ellipse-desc.component';\nimport { AcDynamicEllipseDescComponent } from './components/static-dynamic/ac-dynamic-ellipse-desc/ac-dynamic-ellipse-desc.component';\nimport { AcDynamicPolylineDescComponent } from './components/static-dynamic/ac-dynamic-polyline-desc/ac-dynamic-polyline-desc.component';\nimport { AcStaticPolygonDescComponent } from './components/static-dynamic/ac-static-polygon-desc/ac-static-polygon-desc.component';\nimport { AcStaticCircleDescComponent } from './components/static-dynamic/ac-static-circle-desc/ac-static-circle-desc.component';\nimport { AcDynamicCircleDescComponent } from './components/static-dynamic/ac-dynamic-circle-desc/ac-dynamic-circle-desc.component';\nimport { AcStaticPolylineDescComponent } from './components/static-dynamic/ac-static-polyline-desc/ac-static-polyline-desc.component';\nimport { AcModelDescComponent } from './components/ac-model-desc/ac-model-desc.component';\nimport { AcTileset3dComponent } from './components/ac-3d-tileset/ac-tileset-3d.component';\nimport { AcBoxDescComponent } from './components/ac-box-desc/ac-box-desc.component';\nimport { AcCylinderDescComponent } from './components/ac-cylinder-desc/ac-cylinder-desc.component';\nimport { AcCorridorDescComponent } from './components/ac-corridor-desc/ac-corridor-desc.component';\nimport { AcEllipsoidDescComponent } from './components/ac-ellipsoid-desc/ac-ellipsoid-desc.component';\nimport { AcPolylineVolumeDescComponent } from './components/ac-polyline-volume-desc/ac-polyline-volume-desc.component';\nimport { AcWallDescComponent } from './components/ac-wall-desc/ac-wall-desc.component';\nimport { AcRectangleDescComponent } from './components/ac-rectangle-desc/ac-rectangle-desc.component';\nimport { AcBillboardPrimitiveDescComponent } from './components/ac-billboard-primitive-desc/ac-billboard-primitive-desc.component';\nimport { AcLabelPrimitiveDescComponent } from './components/ac-label-primitive-desc/ac-label-primitive-desc.component';\nimport { AcPolylinePrimitiveDescComponent } from './components/ac-polyline-primitive-desc/ac-polyline-primitive-desc.component';\nimport { ModuleConfiguration } from './models/module-options';\nimport { ANGULAR_CESIUM_CONFIG, ConfigurationService } from './cesium-enhancements/ConfigurationService';\nimport { CesiumExtender } from '../cesium-extender/extender';\nimport { AcHtmlDescComponent } from './components/ac-html-desc/ac-html-desc.component';\nimport { AcHtmlDirective } from './directives/ac-html/ac-html.directive';\nimport { AcHtmlContainerDirective } from './directives/ac-html-container/ac-html-container.directive';\nimport { AcContextMenuWrapperComponent } from './components/ac-context-menu-wrapper/ac-context-menu-wrapper.component';\nimport { AcArrayDescComponent } from './components/ac-array-desc/ac-array-desc.component';\nimport { AcPointPrimitiveDescComponent } from './components/ac-point-primitive-desc/ac-point-primitive-desc.component';\nimport { AcPrimitivePolylineComponent } from './components/ac-primitive-polyline/ac-primitive-polyline.component';\nimport PARSE_PIPES_CONFIG_MAP from './pipes/pipe-config-map';\n\nimport { AcCzmlDescComponent } from './components/ac-czml-desc/ac-czml-desc.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    Angular2ParseModule,\n    UtilsModule,\n  ],\n  declarations: [\n    AcMapComponent,\n    AcLayerComponent,\n    AcBillboardComponent,\n    AcBillboardDescComponent,\n    AcBillboardPrimitiveDescComponent,\n    AcLabelDescComponent,\n    AcLabelPrimitiveDescComponent,\n    AcEllipseDescComponent,\n    AcPolylineDescComponent,\n    AcPolylinePrimitiveDescComponent,\n    PixelOffsetPipe,\n    RadiansToDegreesPipe,\n    AcCircleDescComponent,\n    AcArcDescComponent,\n    AcMapLayerProviderComponent,\n    AcPointDescComponent,\n    AcLabelComponent,\n    AcPolylineComponent,\n    AcPrimitivePolylineComponent,\n    AcEllipseComponent,\n    AcPointComponent,\n    AcBillboardComponent,\n    AcHtmlComponent,\n    AcCircleComponent,\n    AcArcComponent,\n    AcPolygonDescComponent,\n    AcPolygonComponent,\n    AcDefaultPlonterComponent,\n    AcModelDescComponent,\n    AcTileset3dComponent,\n    AcBoxDescComponent,\n    AcCylinderDescComponent,\n    AcCorridorDescComponent,\n    AcEllipsoidDescComponent,\n    AcPolylineVolumeDescComponent,\n    AcWallDescComponent,\n    AcRectangleDescComponent,\n    AcContextMenuWrapperComponent,\n    AcPointPrimitiveDescComponent,\n    AcHtmlDescComponent,\n    AcHtmlDirective,\n    AcHtmlContainerDirective,\n    AcArrayDescComponent,\n    AcCzmlDescComponent,\n\n    AcStaticEllipseDescComponent,\n    AcDynamicEllipseDescComponent,\n    AcDynamicPolylineDescComponent,\n    AcStaticPolylineDescComponent,\n    AcDynamicCircleDescComponent,\n    AcStaticCircleDescComponent,\n    AcStaticPolygonDescComponent,\n  ],\n  exports: [\n    AcMapComponent,\n    AcBillboardComponent,\n    AcBillboardDescComponent,\n    AcBillboardPrimitiveDescComponent,\n    AcLabelDescComponent,\n    AcLabelPrimitiveDescComponent,\n    AcEllipseDescComponent,\n    AcPolylineDescComponent,\n    AcPolylinePrimitiveDescComponent,\n    AcLayerComponent,\n    AcCircleDescComponent,\n    AcArcDescComponent,\n    AcMapLayerProviderComponent,\n    AcPointDescComponent,\n    AcLabelComponent,\n    AcPolylineComponent,\n    AcPrimitivePolylineComponent,\n    AcEllipseComponent,\n    AcPointComponent,\n    AcBillboardComponent,\n    AcHtmlComponent,\n    AcCircleComponent,\n    AcArcComponent,\n    AcPolygonDescComponent,\n    AcPolygonComponent,\n    AcDefaultPlonterComponent,\n    AcModelDescComponent,\n    AcTileset3dComponent,\n    AcBoxDescComponent,\n    AcCylinderDescComponent,\n    AcCorridorDescComponent,\n    AcEllipsoidDescComponent,\n    AcPolylineVolumeDescComponent,\n    AcWallDescComponent,\n    AcRectangleDescComponent,\n    AcContextMenuWrapperComponent,\n    AcPointPrimitiveDescComponent,\n    AcHtmlDescComponent,\n    AcArrayDescComponent,\n    AcCzmlDescComponent,\n\n    AcStaticEllipseDescComponent,\n    AcDynamicEllipseDescComponent,\n    AcDynamicPolylineDescComponent,\n    AcStaticPolylineDescComponent,\n    AcDynamicCircleDescComponent,\n    AcStaticCircleDescComponent,\n    AcStaticPolygonDescComponent,\n  ],\n  providers: [JsonMapper, CesiumProperties, GeoUtilsService, ViewerFactory, MapsManagerService, ConfigurationService],\n})\nexport class AngularCesiumModule {\n  static forRoot(config?: ModuleConfiguration): ModuleWithProviders {\n    return {\n      ngModule: AngularCesiumModule,\n      providers: [\n        {provide: ANGULAR_CESIUM_CONFIG, useValue: config},\n        {provide: PIPES_CONFIG, multi: true, useValue: config && config.customPipes || []},\n        {provide: PIPES_CONFIG, multi: true, useValue: PARSE_PIPES_CONFIG_MAP},\n      ],\n    };\n  }\n\n  constructor() {\n    CesiumExtender.extend();\n  }\n}\n","import { Observable } from 'rxjs';\n\nexport class DisposableObservable<T> extends Observable<T> {\n  dispose: Function;\n}\n","/**\n * EventModifier options for registration on map-event-manager.\n */\nexport enum CesiumEventModifier {\n  ALT = Cesium.KeyboardEventModifier.ALT,\n  CTRL = Cesium.KeyboardEventModifier.CTRL,\n  SHIFT = Cesium.KeyboardEventModifier.SHIFT,\n}\n","import { filter, map } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { AcEntity } from '../../models/ac-entity';\nimport { CesiumEvent } from '../map-events-mananger/consts/cesium-event.enum';\nimport { MapEventsManagerService } from '../map-events-mananger/map-events-manager';\nimport { PickOptions } from '../map-events-mananger/consts/pickOptions.enum';\nimport { CesiumEventModifier } from '../map-events-mananger/consts/cesium-event-modifier.enum';\nimport { MapsManagerService } from '../maps-manager/maps-manager.service';\n\n\nexport interface SelectionOptions {\n  event?: CesiumEvent;\n  modifier?: CesiumEventModifier;\n  entityType?: any;\n}\n\n/**\n * Manages entity selection service for any given mouse event and modifier\n * the service will manage the list of selected items.\n * check out the example\n * you must provide the service yourself\n *\n *  __Usage :__\n * ```\n * // provide the service in some component\n * @Component({\n * //...\n *  providers: [SelectionManagerService]\n * }\n *\n * // Usage example:\n * // init selection\n * const selectedIndicator = ture; // optional default true, if true a boolean \"selected\" property will be added to the selected entity\n * selectionManagerService.initSelection({ event: CesiumEvent.LEFT_CLICK,\n * \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodifier: CesiumEventModifier.CTRL\n * \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},selectedIndicator);\n * // Get selected\n * const selected = selectionManagerService.selected();\n *\n * // Or as observer\n * const selected$ = selectionManagerService.selected$();\n *\n * ```\n *\n */\n@Injectable()\nexport class SelectionManagerService {\n  selectedEntitiesItems$: BehaviorSubject<AcEntity[]> = new BehaviorSubject<AcEntity[]>([]);\n  selectedEntitySubject$: Subject<AcEntity> = new Subject<AcEntity>();\n  private mapEventsManagerService: MapEventsManagerService;\n\n  constructor(private mapsManager: MapsManagerService) {\n  }\n\n  selectedEntities$(): Observable<AcEntity[]> {\n    return this.selectedEntitiesItems$.asObservable();\n  }\n\n  selectedEntities(): AcEntity[] {\n    return this.selectedEntitiesItems$.getValue();\n  }\n\n  selectedEntity$() {\n    return this.selectedEntitySubject$;\n  }\n\n  toggleSelection(entity: AcEntity, addSelectedIndicator: boolean) {\n    const current = this.selectedEntities();\n    if (current.indexOf(entity) === -1) {\n      this.addToSelected(entity, addSelectedIndicator);\n    } else {\n      this.removeSelected(entity, addSelectedIndicator);\n    }\n  }\n\n  private addToSelected(entity: AcEntity, addSelectedIndicator: boolean) {\n    if (addSelectedIndicator) {\n      entity['selected'] = true;\n    }\n\n    const current = this.selectedEntities();\n    this.selectedEntitySubject$.next(entity);\n    this.selectedEntitiesItems$.next([...current, entity]);\n  }\n\n  private removeSelected(entity: AcEntity, addSelectedIndicator: boolean) {\n    if (addSelectedIndicator) {\n      entity['selected'] = false;\n    }\n\n    const current = this.selectedEntities();\n    const entityIndex = current.indexOf(entity);\n    if (entityIndex !== -1) {\n      current.splice(entityIndex, 1);\n      this.selectedEntitiesItems$.next(current);\n      this.selectedEntitySubject$.next(entity);\n    }\n  }\n\n  initSelection(selectionOptions?: SelectionOptions, addSelectedIndicator = true, eventPriority?: number, mapId?: string) {\n    const mapComponent = this.mapsManager.getMap(mapId);\n    if (!mapComponent) {\n      return;\n    }\n\n    this.mapEventsManagerService = mapComponent.getMapEventsManager();\n\n    if (!selectionOptions) {\n      Object.assign(selectionOptions, {event: CesiumEvent.LEFT_CLICK});\n    }\n\n    const eventSubscription = this.mapEventsManagerService.register({\n      event: selectionOptions.event,\n      pick: PickOptions.PICK_ONE,\n      modifier: selectionOptions.modifier,\n      entityType: selectionOptions.entityType,\n      priority: eventPriority,\n    });\n\n    eventSubscription.pipe(\n      map(result => result.entities),\n      filter(entities => entities && entities.length > 0))\n      .subscribe(entities => {\n        const entity = entities[0];\n        this.toggleSelection(entity, addSelectedIndicator);\n      });\n  }\n}\n","import { Cartesian2 } from '../angular-cesium/models/cartesian2';\nimport { Cartesian3 } from '../angular-cesium/models/cartesian3';\nimport { GeoUtilsService } from '../angular-cesium/services/geo-utils/geo-utils.service';\nimport * as h337 from 'heatmap.js/build/heatmap.js';\nimport { Injectable } from '@angular/core';\n\n// Consider moving to a different package.\n\nif (!h337) {\n  throw new Error('must install heatmap.js. please do npm -i heatmap.js ');\n}\n\n\nexport interface Rectangle {\n  west: number;\n  south: number;\n  east: number;\n  north: number;\n}\n\n\n/**\n *  x: lon\n *  y: lat\n *  value: point value\n */\nexport interface HeatPointDataPoint {\n  x: number;\n  y: number;\n  value: number;\n}\n\n/**\n *   min:  the minimum allowed value for the data values\n *  max:  the maximum allowed value for the data values\n *  heatPointsData: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value)\n */\nexport interface HeatmapDataSet {\n  min?: number;\n  max?: number;\n  heatPointsData: HeatPointDataPoint[];\n}\n\n/**\n * a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)\n */\nexport interface HeatMapOptions {\n  [propName: string]: any;\n\n  gradient?: any;\n  radius?: number;\n  opacity?: number;\n  maxOpacity?: number;\n  minOpacity?: number;\n  blur?: any;\n}\n\n/**\n * Create heatmap material (Cesium.ImageMaterialProperty with heatmap as the image)\n * works with http://www.patrick-wied.at/static/heatmapjs. must do npm -i heatmap.js\n * usage:\n * ```\n *\n const mCreator = new CesiumHeatMapMaterialCreator();\n const containingRect = CesiumHeatMapMaterialCreator.calcCircleContainingRect(this.circleCenter, this.circleRadius);\n const userHeatmapOptions = {\n\t\t\tradius : 2000,\n\t\t\tminOpacity : 0,\n\t\t\tmaxOpacity : 0.9,\n\t\t} as any;\n\n this.circleHeatMapMaterial = mCreator.create(containingRect, {\n\t\t\theatPointsData : [\n\t\t\t\t{\n\t\t\t\t\tx : -100.0,\n\t\t\t\t\ty : 24.0,\n\t\t\t\t\tvalue : 95\n\t\t\t\t}\n\t\t\t],\n\t\t\tmin : 0,\n\t\t\tmax : 100,\n\t\t}, userHeatmapOptions);\n * ```\n *\n * inspired by https://github.com/danwild/CesiumHeatmap\n */\n@Injectable()\nexport class CesiumHeatMapMaterialCreator {\n\n\n  private static containerCanvasCounter = 0;\n\n  heatmapOptionsDefaults = {\n    minCanvasSize: 700,           // minimum size (in pixels) for the heatmap canvas\n    maxCanvasSize: 2000,          // maximum size (in pixels) for the heatmap canvas\n    radiusFactor: 60,             // data point size factor used if no radius is given\n    // (the greater of height and width divided by this number yields the used radius)\n    spacingFactor: 1,           // extra space around the borders (point radius multiplied by this number yields the spacing)\n    maxOpacity: 0.8,              // the maximum opacity used if not given in the heatmap options object\n    minOpacity: 0.1,              // the minimum opacity used if not given in the heatmap options object\n    blur: 0.85,                   // the blur used if not given in the heatmap options object\n    gradient: {                   // the gradient used if not given in the heatmap options object\n      '.3': 'blue',\n      '.65': 'yellow',\n      '.8': 'orange',\n      '.95': 'red'\n    },\n  };\n\n  WMP = new Cesium.WebMercatorProjection();\n  _spacing: number;\n  width: number;\n  height: number;\n  _mbounds: any;\n  bounds: any;\n  _factor: number;\n  _rectangle: Rectangle;\n  heatmap: any;\n  _xoffset: any;\n  _yoffset: any;\n\n  /**\n   *\n   * @param center - Cartesian3\n   * @param radius - Meters\n   */\n  static calcCircleContainingRect(center: Cartesian3, radius: number) {\n    return CesiumHeatMapMaterialCreator.calcEllipseContainingRect(center, radius, radius);\n  }\n\n  /**\n   *\n   * @param center - Cartesian3\n   * @param semiMinorAxis - meters\n   * @param semiMajorAxis - meters\n   */\n  static calcEllipseContainingRect(center: Cartesian3, semiMajorAxis: number, semiMinorAxis: number) {\n    const top = GeoUtilsService.pointByLocationDistanceAndAzimuth(\n      center,\n      semiMinorAxis,\n      0,\n      true\n    );\n    const right = GeoUtilsService.pointByLocationDistanceAndAzimuth(\n      center,\n      semiMajorAxis,\n      Math.PI / 2,\n      true\n    );\n    const bottom = GeoUtilsService.pointByLocationDistanceAndAzimuth(\n      center,\n      semiMajorAxis,\n      Math.PI,\n      true\n    );\n    const left = GeoUtilsService.pointByLocationDistanceAndAzimuth(\n      center,\n      semiMajorAxis,\n      Math.PI * 1.5,\n      true\n    );\n\n    const ellipsePoints = [top, right, bottom, left];\n    return Cesium.Rectangle.fromCartesianArray(ellipsePoints);\n  }\n\n  /**\n   *\n   * @param points Cartesian3\n   */\n  static calculateContainingRectFromPoints(points: Cartesian3[]) {\n    return Cesium.Rectangle.fromCartesianArray(points);\n  }\n\n\n  /**  Set an array of heatmap locations\n   *\n   *  min:  the minimum allowed value for the data values\n   *  max:  the maximum allowed value for the data values\n   *  data: an array of data points in heatmap coordinates and values like {x, y, value}\n   */\n  setData(min: any, max: any, data: any) {\n    if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {\n      this.heatmap.setData({\n        min: min,\n        max: max,\n        data: data\n      });\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**  Set an array of WGS84 locations\n   *\n   *  min:  the minimum allowed value for the data values\n   *  max:  the maximum allowed value for the data values\n   *  data: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value }\n   */\n  private setWGS84Data(min: any, max: any, data: any) {\n    if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {\n      const convdata = [];\n\n      for (let i = 0; i < data.length; i++) {\n        const gp = data[i];\n\n        const hp = this.wgs84PointToHeatmapPoint(gp);\n        if (gp.value || gp.value === 0) {\n          hp.value = gp.value;\n        }\n\n        convdata.push(hp);\n      }\n\n      return this.setData(min, max, convdata);\n    }\n\n    return false;\n  }\n\n  /**  Convert a mercator location to the corresponding heatmap location\n   *\n   *  p: a WGS84 location like {x: lon, y:lat}\n   */\n  private mercatorPointToHeatmapPoint(p: Cartesian2) {\n    const pn: any = {};\n\n    pn.x = Math.round((p.x - this._xoffset) / this._factor + this._spacing);\n    pn.y = Math.round((p.y - this._yoffset) / this._factor + this._spacing);\n    pn.y = this.height - pn.y;\n\n    return pn;\n  }\n\n  /**  Convert a WGS84 location to the corresponding heatmap location\n   *\n   *  p: a WGS84 location like {x:lon, y:lat}\n   */\n  private wgs84PointToHeatmapPoint = function (p: Cartesian2) {\n    return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(p));\n  };\n\n\n  private createContainer(height: number, width: number) {\n    const id = 'heatmap' + CesiumHeatMapMaterialCreator.containerCanvasCounter++;\n    const container = document.createElement('div');\n    container.setAttribute('id', id);\n    container.setAttribute('style', 'width: ' + width + 'px; height: ' + height + 'px; margin: 0px; display: none;');\n    document.body.appendChild(container);\n    return {container, id};\n  }\n\n  /**  Convert a WGS84 location into a mercator location\n   *\n   *  p: the WGS84 location like {x: lon, y: lat}\n   */\n  private wgs84ToMercator(p: Cartesian2) {\n    const mp = this.WMP.project(Cesium.Cartographic.fromDegrees(p.x, p.y));\n    return {\n      x: mp.x,\n      y: mp.y\n    };\n  }\n\n  private rad2deg = function (r: number) {\n    const d = r / (Math.PI / 180.0);\n    return d;\n  };\n\n  /**  Convert a WGS84 bounding box into a mercator bounding box*\n   *  bb: the WGS84 bounding box like {north, east, south, west}\n   */\n  private wgs84ToMercatorBB(bb: any) {\n    // TODO validate rad or deg\n    const sw = this.WMP.project(Cesium.Cartographic.fromRadians(bb.west, bb.south));\n    const ne = this.WMP.project(Cesium.Cartographic.fromRadians(bb.east, bb.north));\n    return {\n      north: ne.y,\n      east: ne.x,\n      south: sw.y,\n      west: sw.x\n    };\n  }\n\n  /**  Convert a mercator bounding box into a WGS84 bounding box\n   *\n   *  bb: the mercator bounding box like {north, east, south, west}\n   */\n  private mercatorToWgs84BB(bb: any) {\n    const sw = this.WMP.unproject(new Cesium.Cartesian3(bb.west, bb.south));\n    const ne = this.WMP.unproject(new Cesium.Cartesian3(bb.east, bb.north));\n    return {\n      north: this.rad2deg(ne.latitude),\n      east: this.rad2deg(ne.longitude),\n      south: this.rad2deg(sw.latitude),\n      west: this.rad2deg(sw.longitude)\n    };\n  }\n\n  private setWidthAndHeight(mbb: any) {\n    this.width = ((mbb.east > 0 && mbb.west < 0) ? mbb.east + Math.abs(mbb.west) : Math.abs(mbb.east - mbb.west));\n    this.height = ((mbb.north > 0 && mbb.south < 0) ? mbb.north + Math.abs(mbb.south) : Math.abs(mbb.north - mbb.south));\n    this._factor = 1;\n\n    if (this.width > this.height && this.width > this.heatmapOptionsDefaults.maxCanvasSize) {\n      this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;\n\n      if (this.height / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {\n        this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;\n      }\n    } else if (this.height > this.width && this.height > this.heatmapOptionsDefaults.maxCanvasSize) {\n      this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;\n\n      if (this.width / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {\n        this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;\n      }\n    } else if (this.width < this.height && this.width < this.heatmapOptionsDefaults.minCanvasSize) {\n      this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;\n\n      if (this.height / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {\n        this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;\n      }\n    } else if (this.height < this.width && this.height < this.heatmapOptionsDefaults.minCanvasSize) {\n      this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;\n\n      if (this.width / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {\n        this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;\n      }\n    }\n\n    this.width = this.width / this._factor;\n    this.height = this.height / this._factor;\n  }\n\n  /**\n   * containingBoundingRect: Cesium.Rectangle like {north, east, south, west}\n   * min:  the minimum allowed value for the data values\n   * max:  the maximum allowed value for the data values\n   * datapoint: {x,y,value}\n   * heatmapOptions: a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)\n   *\n   */\n  public create(containingBoundingRect: Rectangle, heatmapDataSet: HeatmapDataSet, heatmapOptions: HeatMapOptions) {\n    const userBB = containingBoundingRect;\n    const {heatPointsData, min = 0, max = 100} = heatmapDataSet;\n    const finalHeatmapOptions = Object.assign({}, this.heatmapOptionsDefaults, heatmapOptions);\n\n    this._mbounds = this.wgs84ToMercatorBB(userBB);\n    this.setWidthAndHeight(this._mbounds);\n\n    finalHeatmapOptions.radius = Math.round((heatmapOptions.radius) ?\n      heatmapOptions.radius : ((this.width > this.height) ?\n        this.width / this.heatmapOptionsDefaults.radiusFactor :\n        this.height / this.heatmapOptionsDefaults.radiusFactor));\n    this._spacing = finalHeatmapOptions.radius * this.heatmapOptionsDefaults.spacingFactor;\n    this._xoffset = this._mbounds.west;\n    this._yoffset = this._mbounds.south;\n\n    this.width = Math.round(this.width + this._spacing * 2);\n    this.height = Math.round(this.height + this._spacing * 2);\n\n    this._mbounds.west -= this._spacing * this._factor;\n    this._mbounds.east += this._spacing * this._factor;\n    this._mbounds.south -= this._spacing * this._factor;\n    this._mbounds.north += this._spacing * this._factor;\n\n    this.bounds = this.mercatorToWgs84BB(this._mbounds);\n    this._rectangle = Cesium.Rectangle.fromDegrees(this.bounds.west, this.bounds.south, this.bounds.east, this.bounds.north);\n\n    const {container, id} = this.createContainer(this.height, this.width);\n    Object.assign(finalHeatmapOptions, {container});\n\n    this.heatmap = h337.create(finalHeatmapOptions);\n\n\n    this.setWGS84Data(0, 100, heatPointsData);\n    const heatMapCanvas = this.heatmap._renderer.canvas;\n    const heatMapMaterial = new Cesium.ImageMaterialProperty({\n      image: heatMapCanvas,\n      transparent: true,\n    });\n    this.setClear(heatMapMaterial, id);\n\n    return heatMapMaterial;\n  }\n\n  private setClear(heatMapMaterial: any, id: string) {\n    heatMapMaterial.clear = () => {\n      const elem = document.getElementById(id);\n      return elem.parentNode.removeChild(elem);\n    };\n  }\n}\n\n","export enum EditModes {\n  CREATE,\n  EDIT,\n  CREATE_OR_EDIT\n}\n","export enum EditActions {\n  INIT,\n  MOUSE_MOVE,\n  ADD_POINT,\n  ADD_LAST_POINT,\n  CHANGE_TO_EDIT,\n  REMOVE_POINT,\n  DRAG_POINT,\n  DRAG_POINT_FINISH,\n  DRAG_SHAPE,\n  DRAG_SHAPE_FINISH,\n  DONE,\n  DISABLE,\n  ENABLE,\n  DISPOSE,\n  SET_EDIT_LABELS_RENDER_CALLBACK,\n  UPDATE_EDIT_LABELS,\n  SET_MANUALLY,\n  TRANSFORM,\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { PointProps } from './polyline-edit-options';\n\nexport class EditPoint extends AcEntity {\n  static counter = 0;\n  private id: string;\n  private editedEntityId: string;\n  private position: Cartesian3;\n  private _virtualEditPoint: boolean;\n  private pointProps: PointProps;\n  private _show = true;\n\n  constructor(entityId: string, position: Cartesian3, pointProps?: PointProps, virtualPoint = false) {\n    super();\n    this.editedEntityId = entityId;\n    this.position = position;\n    this.id = this.generateId();\n    this.pointProps = pointProps;\n    this._virtualEditPoint = virtualPoint;\n  }\n\n  get show() {\n    return this._show;\n  }\n\n  set show(value) {\n    this._show = value;\n  }\n\n  get props(): PointProps {\n    return this.pointProps;\n  }\n\n  set props(value: PointProps) {\n    this.pointProps = value;\n  }\n\n  isVirtualEditPoint(): boolean {\n    return this._virtualEditPoint;\n  }\n\n  setVirtualEditPoint(value: boolean) {\n    this._virtualEditPoint = value;\n  }\n\n  getEditedEntityId(): string {\n    return this.editedEntityId;\n  }\n\n  getPosition(): Cartesian3 {\n    return this.position;\n  }\n\n  setPosition(position: Cartesian3) {\n    this.position.x = position.x;\n    this.position.y = position.y;\n    this.position.z = position.z;\n  }\n\n  getId(): string {\n    return this.id;\n  }\n\n  private generateId(): string {\n    return 'edit-point-' + EditPoint.counter++;\n  }\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { PolylineProps } from './polyline-edit-options';\n\nexport class EditPolyline extends AcEntity {\n  static counter = 0;\n  private editedEntityId: string;\n  private id: string;\n  private positions: Cartesian3[];\n  private _polylineProps: PolylineProps;\n\n  constructor(entityId: string, startPosition: Cartesian3, endPosition: Cartesian3, polylineProps?: PolylineProps) {\n    super();\n    this.editedEntityId = entityId;\n    this.id = this.generateId();\n    this.positions = [startPosition, endPosition];\n    this._polylineProps = polylineProps;\n  }\n\n  get props(): PolylineProps {\n    return this._polylineProps;\n  }\n\n  set props(value: PolylineProps) {\n    this._polylineProps = value;\n  }\n\n  getEditedEntityId(): string {\n    return this.editedEntityId;\n  }\n\n  getPositions(): any[] {\n    return this.positions;\n  }\n\n  validatePositions(): boolean {\n    return this.positions[0] !== undefined && this.positions[1] !== undefined;\n  }\n\n  getStartPosition() {\n    return this.positions[0];\n  }\n\n  getEndPosition() {\n    return this.positions[1];\n  }\n\n  setStartPosition(position: Cartesian3) {\n    this.positions[0] = position;\n  }\n\n  setEndPosition(position: Cartesian3) {\n    this.positions[1] = position;\n  }\n\n  getId(): string {\n    return this.id;\n  }\n\n  private generateId(): string {\n    return 'edit-polyline-' + EditPolyline.counter++;\n  }\n}\n","import { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { Cartesian2 } from '../../angular-cesium/models/cartesian2';\n\nexport interface LabelStyle {\n  show?: boolean;\n  font?: string;\n  style?: any;\n  fillColor?: any;\n  outlineColor?: any;\n  backgroundColor?: any;\n  backgroundPadding?: any;\n  showBackground?: boolean;\n  scale?: number;\n  distanceDisplayCondition?: any;\n  heightReference?: any;\n  horizontalOrigin?: any;\n  eyeOffset?: Cartesian3;\n  position?: Cartesian3;\n  pixelOffset?: Cartesian2;\n  pixelOffsetScaleByDistance?: any;\n  outlineWidth?: any;\n  scaleByDistance?: any;\n  translucencyByDistance?: any;\n  verticalOrigin?: any;\n}\n\nexport interface LabelProps {\n  text: string;\n  show?: boolean;\n  font?: string;\n  style?: any;\n  fillColor?: any;\n  outlineColor?: any;\n  backgroundColor?: any;\n  backgroundPadding?: any;\n  showBackground?: boolean;\n  scale?: number;\n  distanceDisplayCondition?: any;\n  heightReference?: any;\n  horizontalOrigin?: any;\n  eyeOffset?: Cartesian3;\n  position?: Cartesian3;\n  pixelOffset?: Cartesian2;\n  pixelOffsetScaleByDistance?: any;\n  outlineWidth?: any;\n  scaleByDistance?: any;\n  translucencyByDistance?: any;\n  verticalOrigin?: any;\n}\n\nexport const defaultLabelProps: LabelProps = {\n  backgroundColor: new Cesium.Color(0.165, 0.165, 0.165, 0.7),\n  backgroundPadding: new Cesium.Cartesian2(7, 5),\n  distanceDisplayCondition: undefined,\n  eyeOffset: new Cesium.Cartesian3(0, 0, -999),\n  fillColor: Cesium.Color.WHITE,\n  font: '30px sans-serif',\n  heightReference: Cesium.HeightReference.NONE,\n  horizontalOrigin: Cesium.HorizontalOrigin.LEFT,\n  outlineColor: Cesium.Color.BLACK,\n  outlineWidth: 1.0,\n  pixelOffset: Cesium.Cartesian2.ZERO,\n  pixelOffsetScaleByDistance: undefined,\n  scale: 1.0,\n  scaleByDistance: undefined,\n  show: true,\n  showBackground: false,\n  style: Cesium.LabelStyle.FILL,\n  text: '',\n  translucencyByDistance: undefined,\n  verticalOrigin: Cesium.VerticalOrigin.BASELINE,\n};\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { EditPoint } from './edit-point';\nimport { EditPolyline } from './edit-polyline';\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { PolygonEditOptions, PolygonProps } from './polygon-edit-options';\nimport { PointProps, PolylineProps } from './polyline-edit-options';\nimport { defaultLabelProps, LabelProps } from './label-props';\n\nexport class EditablePolygon extends AcEntity {\n  private positions: EditPoint[] = [];\n  private polylines: EditPolyline[] = [];\n  private movingPoint: EditPoint;\n  private doneCreation = false;\n  private _enableEdit = true;\n  private _polygonProps: PolygonProps;\n  private _defaultPointProps: PointProps;\n  private _defaultPolylineProps: PolylineProps;\n  private lastDraggedToPosition: Cartesian3;\n  private _labels: LabelProps[] = [];\n\n  constructor(private id: string,\n              private polygonsLayer: AcLayerComponent,\n              private pointsLayer: AcLayerComponent,\n              private polylinesLayer: AcLayerComponent,\n              private coordinateConverter: CoordinateConverter,\n              polygonOptions: PolygonEditOptions,\n              positions?: Cartesian3[]) {\n    super();\n    this.polygonProps = polygonOptions.polygonProps;\n    this.defaultPointProps = polygonOptions.pointProps;\n    this.defaultPolylineProps = polygonOptions.polylineProps;\n    if (positions && positions.length >= 3) {\n      this.createFromExisting(positions);\n    }\n  }\n\n  get labels(): LabelProps[] {\n    return this._labels;\n  }\n\n  set labels(labels: LabelProps[]) {\n    if (!labels) {\n      return;\n    }\n    const positions = this.getRealPositions();\n    this._labels = labels.map((label, index) => {\n      if (!label.position) {\n        label.position = positions[index];\n      }\n\n      return Object.assign({}, defaultLabelProps, label);\n    });\n  }\n\n  get defaultPolylineProps(): PolylineProps {\n    return this._defaultPolylineProps;\n  }\n\n  set defaultPolylineProps(value: PolylineProps) {\n    this._defaultPolylineProps = value;\n  }\n\n  get defaultPointProps(): PointProps {\n    return this._defaultPointProps;\n  }\n\n  get polygonProps(): PolygonProps {\n    return this._polygonProps;\n  }\n\n  set polygonProps(value: PolygonProps) {\n    this._polygonProps = value;\n  }\n\n  set defaultPointProps(value: PointProps) {\n    this._defaultPointProps = value;\n  }\n\n  get enableEdit() {\n    return this._enableEdit;\n  }\n\n  set enableEdit(value: boolean) {\n    this._enableEdit = value;\n    this.positions.forEach(point => {\n      point.show = value;\n      this.updatePointsLayer(false, point);\n    });\n  }\n\n  private createFromExisting(positions: Cartesian3[]) {\n    positions.forEach((position) => {\n      this.addPointFromExisting(position);\n    });\n    this.addAllVirtualEditPoints();\n    this.updatePolygonsLayer();\n    this.doneCreation = true;\n  }\n\n  setPointsManually(points: { position: Cartesian3, pointProps: PointProps }[] | Cartesian3[], polygonProps?: PolygonProps) {\n    if (!this.doneCreation) {\n      throw new Error('Update manually only in edit mode, after polygon is created');\n    }\n\n    this.positions.forEach(p => this.pointsLayer.remove(p.getId()));\n    const newPoints: EditPoint[] = [];\n    for (let i = 0; i < points.length; i++) {\n      const pointOrCartesian: any = points[i];\n      let newPoint = null;\n      if (pointOrCartesian.pointProps) {\n        newPoint = new EditPoint(this.id, pointOrCartesian.position, pointOrCartesian.pointProps);\n      } else {\n        newPoint = new EditPoint(this.id, pointOrCartesian, this.defaultPointProps);\n      }\n      newPoints.push(newPoint);\n    }\n    this.positions = newPoints;\n    this.polygonProps = polygonProps ? polygonProps : this.polygonProps;\n    this.updatePointsLayer(true, ...this.positions);\n    this.addAllVirtualEditPoints();\n    this.updatePolygonsLayer();\n  }\n\n  private addAllVirtualEditPoints() {\n    const currentPoints = [...this.positions];\n    currentPoints.forEach((pos, index) => {\n      const currentPoint = pos;\n      const nextIndex = (index + 1) % (currentPoints.length);\n      const nextPoint = currentPoints[nextIndex];\n      const midPoint = this.setMiddleVirtualPoint(currentPoint, nextPoint);\n      this.updatePointsLayer(false, midPoint);\n    });\n  }\n\n  private setMiddleVirtualPoint(firstP: EditPoint, secondP: EditPoint): EditPoint {\n    const currentCart = Cesium.Cartographic.fromCartesian(firstP.getPosition());\n    const nextCart = Cesium.Cartographic.fromCartesian(secondP.getPosition());\n    const midPointCartesian3 = this.coordinateConverter.midPointToCartesian3(currentCart, nextCart);\n    const midPoint = new EditPoint(this.id, midPointCartesian3, this.defaultPointProps);\n    midPoint.setVirtualEditPoint(true);\n\n    const firstIndex = this.positions.indexOf(firstP);\n    this.positions.splice(firstIndex + 1, 0, midPoint);\n    return midPoint;\n  }\n\n  private updateMiddleVirtualPoint(virtualEditPoint: EditPoint, prevPoint: EditPoint, nextPoint: EditPoint) {\n    const prevPointCart = Cesium.Cartographic.fromCartesian(prevPoint.getPosition());\n    const nextPointCart = Cesium.Cartographic.fromCartesian(nextPoint.getPosition());\n    virtualEditPoint.setPosition(this.coordinateConverter.midPointToCartesian3(prevPointCart, nextPointCart));\n  }\n\n  changeVirtualPointToRealPoint(point: EditPoint) {\n    point.setVirtualEditPoint(false); // virtual point becomes a real point\n    const pointsCount = this.positions.length;\n    const pointIndex = this.positions.indexOf(point);\n    const nextIndex = (pointIndex + 1) % (pointsCount);\n    const preIndex = ((pointIndex - 1) + pointsCount) % pointsCount;\n\n    const nextPoint = this.positions[nextIndex];\n    const prePoint = this.positions[preIndex];\n\n    const firstMidPoint = this.setMiddleVirtualPoint(prePoint, point);\n    const secMidPoint = this.setMiddleVirtualPoint(point, nextPoint);\n    this.updatePointsLayer(true, firstMidPoint, secMidPoint, point);\n    this.updatePolygonsLayer();\n\n  }\n\n  private renderPolylines() {\n    this.polylines.forEach(polyline => this.polylinesLayer.remove(polyline.getId()));\n    this.polylines = [];\n    const realPoints = this.positions.filter(pos => !pos.isVirtualEditPoint());\n    realPoints.forEach((point, index) => {\n      const nextIndex = (index + 1) % (realPoints.length);\n      const nextPoint = realPoints[nextIndex];\n      const polyline = new EditPolyline(this.id, point.getPosition(), nextPoint.getPosition(), this.defaultPolylineProps);\n      this.polylines.push(polyline);\n      this.polylinesLayer.update(polyline, polyline.getId());\n    });\n  }\n\n  addPointFromExisting(position: Cartesian3) {\n    const newPoint = new EditPoint(this.id, position, this.defaultPointProps);\n    this.positions.push(newPoint);\n    this.updatePointsLayer(true, newPoint);\n  }\n\n\n  addPoint(position: Cartesian3) {\n    if (this.doneCreation) {\n      return;\n    }\n    const isFirstPoint = !this.positions.length;\n    if (isFirstPoint) {\n      const firstPoint = new EditPoint(this.id, position, this.defaultPointProps);\n      this.positions.push(firstPoint);\n      this.updatePointsLayer(true, firstPoint);\n    }\n\n    this.movingPoint = new EditPoint(this.id, position.clone(), this.defaultPointProps);\n    this.positions.push(this.movingPoint);\n\n    this.updatePointsLayer(true, this.movingPoint);\n    this.updatePolygonsLayer();\n  }\n\n  movePoint(toPosition: Cartesian3, editPoint: EditPoint) {\n    editPoint.setPosition(toPosition);\n    this.updatePolygonsLayer();\n    if (this.doneCreation) {\n      if (editPoint.isVirtualEditPoint()) {\n        this.changeVirtualPointToRealPoint(editPoint);\n      }\n      const pointsCount = this.positions.length;\n      const pointIndex = this.positions.indexOf(editPoint);\n      const nextVirtualPoint = this.positions[(pointIndex + 1) % (pointsCount)];\n      const nextRealPoint = this.positions[(pointIndex + 2) % (pointsCount)];\n      const prevVirtualPoint = this.positions[((pointIndex - 1) + pointsCount) % pointsCount];\n      const prevRealPoint = this.positions[((pointIndex - 2) + pointsCount) % pointsCount];\n      this.updateMiddleVirtualPoint(nextVirtualPoint, editPoint, nextRealPoint);\n      this.updateMiddleVirtualPoint(prevVirtualPoint, editPoint, prevRealPoint);\n      this.updatePointsLayer(false, nextVirtualPoint);\n      this.updatePointsLayer(false, prevVirtualPoint);\n    }\n    this.updatePointsLayer(true, editPoint);\n  }\n\n  moveTempMovingPoint(toPosition: Cartesian3) {\n    if (this.movingPoint) {\n      this.movePoint(toPosition, this.movingPoint);\n    }\n  }\n\n  movePolygon(startMovingPosition: Cartesian3, draggedToPosition: Cartesian3) {\n    if (!this.doneCreation) {\n      return;\n    }\n    if (!this.lastDraggedToPosition) {\n      this.lastDraggedToPosition = startMovingPosition;\n    }\n\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, draggedToPosition);\n    this.positions.forEach(point => {\n      GeoUtilsService.addDeltaToPosition(point.getPosition(), delta, true);\n    });\n    this.updatePointsLayer();\n    this.lastDraggedToPosition = draggedToPosition;\n    this.positions.forEach(point => this.updatePointsLayer(true, point));\n  }\n\n  endMovePolygon() {\n    this.lastDraggedToPosition = undefined;\n  }\n\n  removePoint(pointToRemove: EditPoint) {\n    this.removePosition(pointToRemove);\n    this.positions\n      .filter(p => p.isVirtualEditPoint())\n      .forEach(p => this.removePosition(p));\n    this.addAllVirtualEditPoints();\n\n    this.renderPolylines();\n    if (this.getPointsCount() >= 3) {\n      this.polygonsLayer.update(this, this.id);\n    }\n  }\n\n  addLastPoint(position: Cartesian3) {\n    this.doneCreation = true;\n    this.removePosition(this.movingPoint); // remove movingPoint\n    this.movingPoint = null;\n    this.updatePolygonsLayer();\n\n    this.addAllVirtualEditPoints();\n  }\n\n  getRealPositions(): Cartesian3[] {\n    return this.getRealPoints().map(position => position.getPosition());\n  }\n\n  getRealPoints(): EditPoint[] {\n    return this.positions.filter(position => !position.isVirtualEditPoint() && position !== this.movingPoint);\n  }\n\n  getPositionsHierarchy(): Cartesian3[] {\n    return this.positions.filter(position => !position.isVirtualEditPoint()).map(position => position.getPosition());\n  }\n\n  getPositionsHierarchyCallbackProperty(): Cartesian3[] {\n    return new Cesium.CallbackProperty(this.getPositionsHierarchy.bind(this), false);\n  }\n\n  private removePosition(point: EditPoint) {\n    const index = this.positions.findIndex((p) => p === point);\n    if (index < 0) {\n      return;\n    }\n    this.positions.splice(index, 1);\n    this.pointsLayer.remove(point.getId());\n  }\n\n  private updatePolygonsLayer() {\n    if (this.getPointsCount() >= 3) {\n      this.polygonsLayer.update(this, this.id);\n    }\n  }\n\n  private updatePointsLayer(renderPolylines = true, ...points: EditPoint[]) {\n    if (renderPolylines) {\n      this.renderPolylines();\n    }\n    points.forEach(p => this.pointsLayer.update(p, p.getId()));\n  }\n\n  dispose() {\n    this.polygonsLayer.remove(this.id);\n\n    this.positions.forEach(editPoint => {\n      this.pointsLayer.remove(editPoint.getId());\n    });\n    this.polylines.forEach(line => this.polylinesLayer.remove(line.getId()));\n    if (this.movingPoint) {\n      this.pointsLayer.remove(this.movingPoint.getId());\n      this.movingPoint = undefined;\n    }\n    this.positions.length = 0;\n  }\n\n  getPointsCount(): number {\n    return this.positions.length;\n  }\n\n  getId() {\n    return this.id;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EditablePolygon } from '../../../models/editable-polygon';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { PolygonEditOptions } from '../../../models/polygon-edit-options';\nimport { AcLayerComponent } from '../../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\n\n@Injectable()\nexport class PolygonsManagerService {\n  polygons: Map<string, EditablePolygon> = new Map<string, EditablePolygon>();\n\n  createEditablePolygon(id: string, editPolygonsLayer: AcLayerComponent, editPointsLayer: AcLayerComponent,\n                        editPolylinesLayer: AcLayerComponent, coordinateConverter: CoordinateConverter,\n                        polygonOptions?: PolygonEditOptions, positions?: Cartesian3[]) {\n    const editablePolygon = new EditablePolygon(\n      id,\n      editPolygonsLayer,\n      editPointsLayer,\n      editPolylinesLayer,\n      coordinateConverter,\n      polygonOptions,\n      positions);\n    this.polygons.set(id, editablePolygon\n    );\n  }\n\n  dispose(id: string) {\n    this.polygons.get(id).dispose();\n    this.polygons.delete(id);\n  }\n\n  get(id: string): EditablePolygon {\n    return this.polygons.get(id);\n  }\n\n  clear() {\n    this.polygons.forEach(polygon => polygon.dispose());\n    this.polygons.clear();\n  }\n}\n","export function generateKey(length = 12): string {\n  let id = '';\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  for (let i = 0; i < length; i++) {\n    id += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return id;\n}\n","import { publish, tap } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { MapEventsManagerService } from '../../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { CesiumEvent } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../../../../angular-cesium/services/map-events-mananger/consts/pickOptions.enum';\nimport { PolygonEditUpdate } from '../../../models/polygon-edit-update';\nimport { EditModes } from '../../../models/edit-mode.enum';\nimport { EditActions } from '../../../models/edit-actions.enum';\nimport { DisposableObservable } from '../../../../angular-cesium/services/map-events-mananger/disposable-observable';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { EditPoint } from '../../../models/edit-point';\nimport { CameraService } from '../../../../angular-cesium/services/camera/camera.service';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { PolygonsManagerService } from './polygons-manager.service';\nimport { PolygonEditorObservable } from '../../../models/polygon-editor-observable';\nimport { EditablePolygon } from '../../../models/editable-polygon';\nimport { PolygonEditOptions, PolygonProps } from '../../../models/polygon-edit-options';\nimport { PointProps } from '../../../models/polyline-edit-options';\nimport { LabelProps } from '../../../models/label-props';\nimport { generateKey } from '../../utils';\n\nexport const DEFAULT_POLYGON_OPTIONS: PolygonEditOptions = {\n  addPointEvent: CesiumEvent.LEFT_CLICK,\n  addLastPointEvent: CesiumEvent.LEFT_DOUBLE_CLICK,\n  removePointEvent: CesiumEvent.RIGHT_CLICK,\n  dragPointEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  dragShapeEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  allowDrag: true,\n  pointProps: {\n    color: Cesium.Color.WHITE.withAlpha(0.9),\n    outlineColor: Cesium.Color.BLACK,\n    outlineWidth: 1,\n    pixelSize: 15,\n    virtualPointPixelSize: 8,\n    show: true,\n    showVirtual: true,\n  },\n  polygonProps: {\n    material: new Cesium.Color(0.1, 0.5, 0.2, 0.4),\n  },\n  polylineProps: {\n    material: () => Cesium.Color.BLACK,\n    width: 1,\n  },\n};\n\n/**\n * Service for creating editable polygons\n *\n * You must provide `PolygonsEditorService` yourself.\n * PolygonsEditorService works together with `<polygons-editor>` component. Therefor you need to create `<polygons-editor>`\n * for each `PolygonsEditorService`, And of course somewhere under `<ac-map>`/\n *\n * + `create` for starting a creation of the shape over the map. Returns a extension of `PolygonEditorObservable`.\n * + `edit` for editing shape over the map starting from a given positions. Returns an extension of `PolygonEditorObservable`.\n * + To stop editing call `dsipose()` from the `PolygonEditorObservable` you get back from `create()` \\ `edit()`.\n *\n * **Labels over editted shapes**\n * Angular Cesium allows you to draw labels over a shape that is being edited with one of the editors.\n * To add label drawing logic to your editor use the function `setLabelsRenderFn()` that is defined on the\n * `PolygonEditorObservable` that is returned from calling `create()` \\ `edit()` of one of the editor services.\n * `setLabelsRenderFn()` - receives a callback that is called every time the shape is redrawn\n * (except when the shape is being dragged). The callback is called with the last shape state and with an array of the current labels.\n * The callback should return type `LabelProps[]`.\n * You can also use `updateLabels()` to pass an array of labels of type `LabelProps[]` to be drawn.\n *\n * usage:\n * ```typescript\n *  // Start creating polygon\n *  const editing$ = polygonsEditorService.create();\n *  this.editing$.subscribe(editResult => {\n *\t\t\t\tconsole.log(editResult.positions);\n *\t\t});\n *\n *  // Or edit polygon from existing polygon positions\n *  const editing$ = this.polygonsEditorService.edit(initialPos);\n *\n * ```\n */\n@Injectable()\nexport class PolygonsEditorService {\n  private mapEventsManager: MapEventsManagerService;\n  private updateSubject = new Subject<PolygonEditUpdate>();\n  private updatePublisher = publish<PolygonEditUpdate>()(this.updateSubject); // TODO maybe not needed\n  private coordinateConverter: CoordinateConverter;\n  private cameraService: CameraService;\n  private polygonsManager: PolygonsManagerService;\n  private observablesMap = new Map<string, DisposableObservable<any>[]>();\n\n  init(mapEventsManager: MapEventsManagerService,\n       coordinateConverter: CoordinateConverter,\n       cameraService: CameraService,\n       polygonsManager: PolygonsManagerService) {\n    this.mapEventsManager = mapEventsManager;\n    this.coordinateConverter = coordinateConverter;\n    this.cameraService = cameraService;\n    this.polygonsManager = polygonsManager;\n    this.updatePublisher.connect();\n  }\n\n  onUpdate(): Observable<PolygonEditUpdate> {\n    return this.updatePublisher;\n  }\n\n  create(options = DEFAULT_POLYGON_OPTIONS, priority = 100): PolygonEditorObservable {\n    const positions: Cartesian3[] = [];\n    const id = generateKey();\n    const polygonOptions = this.setOptions(options);\n\n    const clientEditSubject = new BehaviorSubject<PolygonEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.CREATE\n    });\n    let finishedCreate = false;\n\n    this.updateSubject.next({\n      id,\n      positions,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.INIT,\n      polygonOptions: polygonOptions,\n    });\n\n    const mouseMoveRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.MOUSE_MOVE,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n    const addPointRegistration = this.mapEventsManager.register({\n      event: polygonOptions.addPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n    const addLastPointRegistration = this.mapEventsManager.register({\n      event: polygonOptions.addLastPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n\n    this.observablesMap.set(id, [mouseMoveRegistration, addPointRegistration, addLastPointRegistration]);\n    const editorObservable = this.createEditorObservable(clientEditSubject, id);\n\n    mouseMoveRegistration.subscribe(({movement: {endPosition}}) => {\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n\n      if (position) {\n        this.updateSubject.next({\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.CREATE,\n          updatedPosition: position,\n          editAction: EditActions.MOUSE_MOVE,\n        });\n      }\n    });\n\n    addPointRegistration.subscribe(({movement: {endPosition}}) => {\n      if (finishedCreate) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n      const allPositions = this.getPositions(id);\n      if (allPositions.find((cartesian) => cartesian.equals(position))) {\n        return;\n      }\n\n      const updateValue = {\n        id,\n        positions: allPositions,\n        editMode: EditModes.CREATE,\n        updatedPosition: position,\n        editAction: EditActions.ADD_POINT,\n      };\n      this.updateSubject.next(updateValue);\n      clientEditSubject.next({\n        ...updateValue,\n        positions: this.getPositions(id),\n        points: this.getPoints(id),\n      });\n\n      if (polygonOptions.maximumNumberOfPoints && allPositions.length + 1 === polygonOptions.maximumNumberOfPoints) {\n        finishedCreate = this.switchToEditMode(\n          id,\n          position,\n          clientEditSubject,\n          positions,\n          priority,\n          polygonOptions,\n          editorObservable,\n          finishedCreate);\n      }\n    });\n\n\n    addLastPointRegistration.subscribe(({movement: {endPosition}}) => {\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n      // position already added by addPointRegistration\n      finishedCreate = this.switchToEditMode(\n        id,\n        position,\n        clientEditSubject,\n        positions,\n        priority,\n        polygonOptions,\n        editorObservable,\n        finishedCreate);\n    });\n\n    return editorObservable;\n  }\n\n  private switchToEditMode(id,\n                           position,\n                           clientEditSubject,\n                           positions: Cartesian3[],\n                           priority,\n                           polygonOptions,\n                           editorObservable,\n                           finishedCreate: boolean) {\n    const updateValue = {\n      id,\n      positions: this.getPositions(id),\n      editMode: EditModes.CREATE,\n      updatedPosition: position,\n      editAction: EditActions.ADD_LAST_POINT,\n    };\n    this.updateSubject.next(updateValue);\n    clientEditSubject.next({\n      ...updateValue,\n      positions: this.getPositions(id),\n      points: this.getPoints(id),\n    });\n\n    const changeMode = {\n      id,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.CHANGE_TO_EDIT,\n    };\n    this.updateSubject.next(changeMode);\n    clientEditSubject.next(changeMode);\n    if (this.observablesMap.has(id)) {\n      this.observablesMap.get(id).forEach(registration => registration.dispose());\n    }\n    this.observablesMap.delete(id);\n    this.editPolygon(id, positions, priority, clientEditSubject, polygonOptions, editorObservable);\n    finishedCreate = true;\n    return finishedCreate;\n  }\n\n  edit(positions: Cartesian3[], options = DEFAULT_POLYGON_OPTIONS, priority = 100): PolygonEditorObservable {\n    if (positions.length < 3) {\n      throw new Error('Polygons editor error edit(): polygon should have at least 3 positions');\n    }\n    const id = generateKey();\n    const polygonOptions = this.setOptions(options);\n    const editSubject = new BehaviorSubject<PolygonEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.EDIT\n    });\n    const update = {\n      id,\n      positions: positions,\n      editMode: EditModes.EDIT,\n      editAction: EditActions.INIT,\n      polygonOptions: polygonOptions,\n    };\n    this.updateSubject.next(update);\n    editSubject.next({\n      ...update,\n      positions: this.getPositions(id),\n      points: this.getPoints(id),\n    });\n    return this.editPolygon(\n      id,\n      positions,\n      priority,\n      editSubject,\n      polygonOptions\n    );\n  }\n\n  private editPolygon(id: string,\n                      positions: Cartesian3[],\n                      priority: number,\n                      editSubject: Subject<PolygonEditUpdate>,\n                      options: PolygonEditOptions,\n                      editObservable?: PolygonEditorObservable): PolygonEditorObservable {\n\n    const pointDragRegistration = this.mapEventsManager.register({\n      event: options.dragPointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    let shapeDragRegistration;\n    if (options.allowDrag) {\n      shapeDragRegistration = this.mapEventsManager.register({\n        event: options.dragShapeEvent,\n        entityType: EditablePolygon,\n        pick: PickOptions.PICK_FIRST,\n        priority,\n        pickFilter: entity => id === entity.id,\n      });\n    }\n    const pointRemoveRegistration = this.mapEventsManager.register({\n      event: options.removePointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    pointDragRegistration.pipe(\n      tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n      .subscribe(({movement: {endPosition, drop}, entities}) => {\n        const position = this.coordinateConverter.screenToCartesian3(endPosition);\n        if (!position) {\n          return;\n        }\n        const point: EditPoint = entities[0];\n\n        const update = {\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.EDIT,\n          updatedPosition: position,\n          updatedPoint: point,\n          editAction: drop ? EditActions.DRAG_POINT_FINISH : EditActions.DRAG_POINT,\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n          positions: this.getPositions(id),\n          points: this.getPoints(id),\n        });\n      });\n\n    if (shapeDragRegistration) {\n      shapeDragRegistration\n        .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n        .subscribe(({movement: {startPosition, endPosition, drop}, entities}) => {\n          const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n          const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n          if (!endDragPosition) {\n            return;\n          }\n\n          const update = {\n            id,\n            positions: this.getPositions(id),\n            editMode: EditModes.EDIT,\n            updatedPosition: endDragPosition,\n            draggedPosition: startDragPosition,\n            editAction: drop ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_SHAPE,\n          };\n          this.updateSubject.next(update);\n          editSubject.next({\n            ...update,\n            positions: this.getPositions(id),\n            points: this.getPoints(id),\n          });\n        });\n    }\n\n    pointRemoveRegistration.subscribe(({entities}) => {\n      const point: EditPoint = entities[0];\n      const allPositions = [...this.getPositions(id)];\n      if (allPositions.length < 4) {\n        return;\n      }\n      const index = allPositions.findIndex(position => point.getPosition().equals(position as Cartesian3));\n      if (index < 0) {\n        return;\n      }\n\n      const update = {\n        id,\n        positions: allPositions,\n        editMode: EditModes.EDIT,\n        updatedPoint: point,\n        editAction: EditActions.REMOVE_POINT,\n      };\n      this.updateSubject.next(update);\n      editSubject.next({\n        ...update,\n        positions: this.getPositions(id),\n        points: this.getPoints(id),\n      });\n    });\n\n    const observables = [pointDragRegistration, pointRemoveRegistration];\n    if (shapeDragRegistration) {\n      observables.push(shapeDragRegistration);\n    }\n\n    this.observablesMap.set(id, observables);\n    return editObservable || this.createEditorObservable(editSubject, id);\n  }\n\n  private setOptions(options: PolygonEditOptions) {\n    if (options.maximumNumberOfPoints && options.maximumNumberOfPoints < 3) {\n      console.warn('Warn: PolygonEditor invalid option.' +\n        ' maximumNumberOfPoints smaller then 3, maximumNumberOfPoints changed to 3');\n      options.maximumNumberOfPoints = 3;\n    }\n\n    const defaultClone = JSON.parse(JSON.stringify(DEFAULT_POLYGON_OPTIONS));\n    const polygonOptions = Object.assign(defaultClone, options);\n    polygonOptions.pointProps = Object.assign({}, DEFAULT_POLYGON_OPTIONS.pointProps, options.pointProps);\n    polygonOptions.polygonProps = Object.assign({}, DEFAULT_POLYGON_OPTIONS.polygonProps, options.polygonProps);\n    polygonOptions.polylineProps = Object.assign({}, DEFAULT_POLYGON_OPTIONS.polylineProps, options.polylineProps);\n    return polygonOptions;\n  }\n\n\n  private createEditorObservable(observableToExtend: any, id: string): PolygonEditorObservable {\n    observableToExtend.dispose = () => {\n      const observables = this.observablesMap.get(id);\n      if (observables) {\n        observables.forEach(obs => obs.dispose());\n      }\n      this.observablesMap.delete(id);\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.DISPOSE,\n      });\n    };\n    observableToExtend.enable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.ENABLE,\n      });\n    };\n    observableToExtend.disable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.DISABLE,\n      });\n    };\n    observableToExtend.setManually = (points: {\n      position: Cartesian3, pointProps: PointProps\n    }[] | Cartesian3[], polygonProps?: PolygonProps) => {\n      const polygon = this.polygonsManager.get(id);\n      polygon.setPointsManually(points, polygonProps);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_MANUALLY,\n      });\n    };\n\n    observableToExtend.setLabelsRenderFn = (callback: any) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_EDIT_LABELS_RENDER_CALLBACK,\n        labelsRenderFn: callback,\n      });\n    };\n\n    observableToExtend.updateLabels = (labels: LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.UPDATE_EDIT_LABELS,\n        updateLabels: labels,\n      });\n    };\n\n    observableToExtend.getCurrentPoints = () => this.getPoints(id);\n\n    observableToExtend.getEditValue = () => observableToExtend.getValue();\n\n    observableToExtend.getLabels = (): LabelProps[] => this.polygonsManager.get(id).labels;\n\n    return observableToExtend as PolygonEditorObservable;\n  }\n\n  private getPositions(id: string) {\n    const polygon = this.polygonsManager.get(id);\n    return polygon.getRealPositions();\n  }\n\n  private getPoints(id: string) {\n    const polygon = this.polygonsManager.get(id);\n    return polygon.getRealPoints();\n  }\n}\n","import { ChangeDetectionStrategy, Component, OnDestroy, ViewChild } from '@angular/core';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { PolygonEditUpdate } from '../../models/polygon-edit-update';\nimport { AcNotification } from '../../../angular-cesium/models/ac-notification';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { AcLayerComponent } from '../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapEventsManagerService } from '../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { Subject } from 'rxjs';\nimport { CameraService } from '../../../angular-cesium/services/camera/camera.service';\nimport { EditPoint } from '../../models/edit-point';\nimport { PolygonsManagerService } from '../../services/entity-editors/polygons-editor/polygons-manager.service';\nimport { PolygonsEditorService } from '../../services/entity-editors/polygons-editor/polygons-editor.service';\nimport { LabelProps } from '../../models/label-props';\nimport { EditablePolygon } from '../../models/editable-polygon';\n\n@Component({\n  selector: 'polygons-editor',\n  template: /*html*/ `\n    <ac-layer #editPolylinesLayer acFor=\"let polyline of editPolylines$\" [context]=\"this\">\n      <ac-polyline-primitive-desc\n        props=\"{\n        positions: polyline.getPositions(),\n        width: polyline.props.width,\n        material: polyline.props.material()\n    }\"\n      >\n      </ac-polyline-primitive-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor=\"let point of editPoints$\" [context]=\"this\">\n      <ac-point-desc\n        props=\"{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }\"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editPolygonsLayer acFor=\"let polygon of editPolygons$\" [context]=\"this\">\n      <ac-polygon-desc\n        props=\"{\n        hierarchy: polygon.getPositionsHierarchyCallbackProperty(),\n        material: polygon.polygonProps.material\n    }\"\n      >\n      </ac-polygon-desc>\n      <!-- <ac-static-polygon-desc -->\n      <!-- geometryProps=\"{ -->\n      <!-- polygonHierarchy: polygon.getHierarchy(), -->\n      <!-- height: 1 -->\n      <!-- }\" -->\n      <!-- instanceProps=\"{ -->\n      <!-- attributes: attributes -->\n      <!-- }\" -->\n      <!-- primitiveProps=\"{ -->\n      <!-- appearance: appearance -->\n      <!-- }\"> -->\n      <!-- </ac-static-polygon-desc -->\n      <ac-array-desc acFor=\"let label of polygon.labels\" [idGetter]=\"getLabelId\">\n        <ac-label-primitive-desc\n          props=\"{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }\"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  `,\n  providers: [CoordinateConverter, PolygonsManagerService],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PolygonsEditorComponent implements OnDestroy {\n  private editLabelsRenderFn: (update: PolygonEditUpdate, labels: LabelProps[]) => LabelProps[];\n  public Cesium = Cesium;\n  public editPoints$ = new Subject<AcNotification>();\n  public editPolylines$ = new Subject<AcNotification>();\n  public editPolygons$ = new Subject<AcNotification>();\n\n  public appearance = new Cesium.PerInstanceColorAppearance({flat: true});\n  public attributes = {color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(0.2, 0.2, 0.5, 0.5))};\n  public polygonColor = new Cesium.Color(0.1, 0.5, 0.2, 0.4);\n  public lineColor = new Cesium.Color(0, 0, 0, 0.6);\n\n  @ViewChild('editPolygonsLayer') private editPolygonsLayer: AcLayerComponent;\n  @ViewChild('editPointsLayer') private editPointsLayer: AcLayerComponent;\n  @ViewChild('editPolylinesLayer') private editPolylinesLayer: AcLayerComponent;\n\n  constructor(\n    private polygonsEditor: PolygonsEditorService,\n    private coordinateConverter: CoordinateConverter,\n    private mapEventsManager: MapEventsManagerService,\n    private cameraService: CameraService,\n    private polygonsManager: PolygonsManagerService,\n  ) {\n    this.polygonsEditor.init(this.mapEventsManager, this.coordinateConverter, this.cameraService, polygonsManager);\n    this.startListeningToEditorUpdates();\n  }\n\n  private startListeningToEditorUpdates() {\n    this.polygonsEditor.onUpdate().subscribe((update: PolygonEditUpdate) => {\n      if (update.editMode === EditModes.CREATE || update.editMode === EditModes.CREATE_OR_EDIT) {\n        this.handleCreateUpdates(update);\n      } else if (update.editMode === EditModes.EDIT) {\n        this.handleEditUpdates(update);\n      }\n    });\n  }\n\n  getLabelId(element: any, index: number): string {\n    return index.toString();\n  }\n\n  renderEditLabels(polygon: EditablePolygon, update: PolygonEditUpdate, labels?: LabelProps[]) {\n    update.positions = polygon.getRealPositions();\n    update.points = polygon.getRealPoints();\n\n    if (labels) {\n      polygon.labels = labels;\n      this.editPolygonsLayer.update(polygon, polygon.getId());\n      return;\n    }\n\n    if (!this.editLabelsRenderFn) {\n      return;\n    }\n\n    polygon.labels = this.editLabelsRenderFn(update, polygon.labels);\n    this.editPolygonsLayer.update(polygon, polygon.getId());\n  }\n\n  removeEditLabels(polygon: EditablePolygon) {\n    polygon.labels = [];\n    this.editPolygonsLayer.update(polygon, polygon.getId());\n  }\n\n  handleCreateUpdates(update: PolygonEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.polygonsManager.createEditablePolygon(\n          update.id,\n          this.editPolygonsLayer,\n          this.editPointsLayer,\n          this.editPolylinesLayer,\n          this.coordinateConverter,\n          update.polygonOptions,\n        );\n        break;\n      }\n      case EditActions.MOUSE_MOVE: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (update.updatedPosition) {\n          polygon.moveTempMovingPoint(update.updatedPosition);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.ADD_POINT: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (update.updatedPosition) {\n          polygon.addPoint(update.updatedPosition);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.ADD_LAST_POINT: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (update.updatedPosition) {\n          polygon.addLastPoint(update.updatedPosition);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.DISPOSE: {\n        const polygon = this.polygonsManager.get(update.id);\n        polygon.dispose();\n        this.removeEditLabels(polygon);\n        this.editLabelsRenderFn = undefined;\n        break;\n      }\n      case EditActions.SET_EDIT_LABELS_RENDER_CALLBACK: {\n        const polygon = this.polygonsManager.get(update.id);\n        this.editLabelsRenderFn = update.labelsRenderFn;\n        this.renderEditLabels(polygon, update);\n        break;\n      }\n      case EditActions.UPDATE_EDIT_LABELS: {\n        const polygon = this.polygonsManager.get(update.id);\n        this.renderEditLabels(polygon, update, update.updateLabels);\n        break;\n      }\n      case EditActions.SET_MANUALLY: {\n        const polygon = this.polygonsManager.get(update.id);\n        this.renderEditLabels(polygon, update, update.updateLabels);\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  handleEditUpdates(update: PolygonEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.polygonsManager.createEditablePolygon(\n          update.id,\n          this.editPolygonsLayer,\n          this.editPointsLayer,\n          this.editPolylinesLayer,\n          this.coordinateConverter,\n          update.polygonOptions,\n          update.positions,\n        );\n        break;\n      }\n      case EditActions.DRAG_POINT: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon && polygon.enableEdit) {\n          polygon.movePoint(update.updatedPosition, update.updatedPoint);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_POINT_FINISH: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon && polygon.enableEdit && update.updatedPoint.isVirtualEditPoint()) {\n          polygon.changeVirtualPointToRealPoint(update.updatedPoint);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.REMOVE_POINT: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon && polygon.enableEdit) {\n          polygon.removePoint(update.updatedPoint);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.DISABLE: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon) {\n          polygon.enableEdit = false;\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon && polygon.enableEdit) {\n          polygon.movePolygon(update.draggedPosition, update.updatedPosition);\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n\n      case EditActions.DRAG_SHAPE_FINISH: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon && polygon.enableEdit) {\n          polygon.endMovePolygon();\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      case EditActions.ENABLE: {\n        const polygon = this.polygonsManager.get(update.id);\n        if (polygon) {\n          polygon.enableEdit = true;\n          this.renderEditLabels(polygon, update);\n        }\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.polygonsManager.clear();\n  }\n\n  getPointSize(point: EditPoint) {\n    return point.isVirtualEditPoint() ? point.props.virtualPointPixelSize : point.props.pixelSize;\n  }\n\n  getPointShow(point: EditPoint) {\n    return point.show && (point.isVirtualEditPoint() ? point.props.showVirtual : point.props.show);\n  }\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { PolylineProps } from './polyline-edit-options';\n\nexport class EditArc extends AcEntity {\n  static counter = 0;\n  private id: string;\n  private editedEntityId: string;\n  private _center: Cartesian3;\n  private _radius: number;\n  private _delta: number;\n  private _angle: number;\n\n  constructor(entityId: string, center: Cartesian3, radius: number, delta: number, angle: number, private _arcProps: PolylineProps) {\n    super();\n    this.id = this.generateId();\n    this.editedEntityId = entityId;\n    this._center = center;\n    this._radius = radius;\n    this._delta = delta;\n    this._angle = angle;\n  }\n\n  get props() {\n    return this._arcProps;\n  }\n\n  set props(props: PolylineProps) {\n    this._arcProps = props;\n  }\n\n  get angle(): number {\n    return this._angle;\n  }\n\n  set angle(value: number) {\n    this._angle = value;\n  }\n\n  get delta(): number {\n    return this._delta;\n  }\n\n  set delta(value: number) {\n    this._delta = value;\n  }\n\n  get radius(): number {\n    return this._radius;\n  }\n\n  set radius(value: number) {\n    this._radius = value;\n  }\n\n  get center(): Cartesian3 {\n    return this._center;\n  }\n\n  set center(value: Cartesian3) {\n    this._center = value;\n  }\n\n  updateCenter(center: Cartesian3) {\n    this._center.x = center.x;\n    this._center.y = center.y;\n    this._center.z = center.z;\n  }\n\n  getId(): string {\n    return this.id;\n  }\n\n  private generateId(): string {\n    return 'edit-arc-' + EditArc.counter++;\n  }\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { EditPoint } from './edit-point';\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { EditArc } from './edit-arc';\nimport { CircleEditOptions } from './circle-edit-options';\nimport { PointProps, PolylineProps } from './polyline-edit-options';\nimport { defaultLabelProps, LabelProps } from './label-props';\nimport { EllipseProps } from './ellipse-edit-options';\n\nexport class EditableCircle extends AcEntity {\n  private _center: EditPoint;\n  private _radiusPoint: EditPoint;\n  private _outlineArc: EditArc;\n  private doneCreation = false;\n  private _enableEdit = true;\n  private lastDraggedToPosition: any;\n  private _circleProps: EllipseProps;\n  private _pointProps: PointProps;\n  private _polylineProps: PolylineProps;\n  private _labels: LabelProps[] = [];\n\n  constructor(\n    private id: string,\n    private circlesLayer: AcLayerComponent,\n    private pointsLayer: AcLayerComponent,\n    private arcsLayer: AcLayerComponent,\n    private options: CircleEditOptions,\n  ) {\n    super();\n    this._circleProps = options.circleProps;\n    this._pointProps = options.pointProps;\n    this._polylineProps = options.polylineProps;\n  }\n\n  get labels(): LabelProps[] {\n    return this._labels;\n  }\n\n  set labels(labels: LabelProps[]) {\n    if (!labels || !this._center || !this._radiusPoint) {\n      return;\n    }\n    this._labels = labels.map((label, index) => {\n      if (!label.position) {\n        if (index !== labels.length - 1) {\n          label.position = this._center.getPosition();\n        } else {\n          label.position = this._radiusPoint.getPosition();\n        }\n      }\n\n      return Object.assign({}, defaultLabelProps, label);\n    });\n  }\n\n  get polylineProps(): PolylineProps {\n    return this._polylineProps;\n  }\n\n  set polylineProps(value: PolylineProps) {\n    this._polylineProps = value;\n  }\n\n  get pointProps(): PointProps {\n    return this._pointProps;\n  }\n\n  set pointProps(value: PointProps) {\n    this._pointProps = value;\n  }\n\n  get circleProps(): EllipseProps {\n    return this._circleProps;\n  }\n\n  set circleProps(value: EllipseProps) {\n    this._circleProps = value;\n  }\n\n  get center(): EditPoint {\n    return this._center;\n  }\n\n  get radiusPoint(): EditPoint {\n    return this._radiusPoint;\n  }\n\n  get enableEdit() {\n    return this._enableEdit;\n  }\n\n  set enableEdit(value: boolean) {\n    this._enableEdit = value;\n    this._center.show = value;\n    this._radiusPoint.show = value;\n    this.updatePointsLayer();\n  }\n\n  setManually(\n    center: Cartesian3,\n    radiusPoint: Cartesian3,\n    centerPointProp = this.pointProps,\n    radiusPointProp = this.pointProps,\n    circleProp = this.circleProps,\n  ) {\n    if (!this._center) {\n      this._center = new EditPoint(this.id, center, centerPointProp);\n    } else {\n      this._center.setPosition(center);\n    }\n\n    if (!this._radiusPoint) {\n      this._radiusPoint = new EditPoint(this.id, radiusPoint, radiusPointProp);\n    } else {\n      this._radiusPoint.setPosition(radiusPoint);\n    }\n\n    if (!this._outlineArc) {\n      this.createOutlineArc();\n    } else {\n      this._outlineArc.radius = this.getRadius();\n    }\n\n    this.circleProps = circleProp;\n    this.doneCreation = true;\n    this.updateArcsLayer();\n    this.updatePointsLayer();\n    this.updateCirclesLayer();\n  }\n\n  addPoint(position: Cartesian3) {\n    if (this.doneCreation) {\n      return;\n    }\n\n    if (!this._center) {\n      this._center = new EditPoint(this.id, position, this.pointProps);\n      this._radiusPoint = new EditPoint(this.id, position.clone(), this.pointProps);\n      if (!this._outlineArc) {\n        this.createOutlineArc();\n      }\n    }\n\n    this.updateArcsLayer();\n    this.updatePointsLayer();\n    this.updateCirclesLayer();\n  }\n\n  addLastPoint(position: Cartesian3) {\n    if (this.doneCreation || !this._center || !this._radiusPoint) {\n      return;\n    }\n\n    this._radiusPoint.setPosition(position);\n    this.doneCreation = true;\n\n    this.updatePointsLayer();\n    this.updateCirclesLayer();\n  }\n\n  movePoint(toPosition: Cartesian3) {\n    if (!this._center || !this._radiusPoint) {\n      return;\n    }\n\n    this._radiusPoint.setPosition(toPosition);\n    this._outlineArc.radius = this.getRadius();\n\n    this.updateArcsLayer();\n    this.updatePointsLayer();\n    this.updateCirclesLayer();\n  }\n\n  moveCircle(dragStartPosition: Cartesian3, dragEndPosition: Cartesian3) {\n    if (!this.doneCreation) {\n      return;\n    }\n    if (!this.lastDraggedToPosition) {\n      this.lastDraggedToPosition = dragStartPosition;\n    }\n\n    const radius = this.getRadius();\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, dragEndPosition);\n    GeoUtilsService.addDeltaToPosition(this.getCenter(), delta, true);\n    this.radiusPoint.setPosition(GeoUtilsService.pointByLocationDistanceAndAzimuth(this.getCenter(), radius, Math.PI / 2, true));\n    this._outlineArc.radius = this.getRadius();\n    this.updateArcsLayer();\n    this.updatePointsLayer();\n    this.updateCirclesLayer();\n    this.lastDraggedToPosition = dragEndPosition;\n  }\n\n  endMovePolygon() {\n    this.lastDraggedToPosition = undefined;\n  }\n\n  getRadius(): number {\n    if (!this._center || !this._radiusPoint) {\n      return 0;\n    }\n    return GeoUtilsService.distance(this._center.getPosition(), this._radiusPoint.getPosition());\n  }\n\n  getRadiusCallbackProperty() {\n    return new Cesium.CallbackProperty(this.getRadius.bind(this), false);\n  }\n\n  getCenter(): Cartesian3 {\n    return this._center ? this._center.getPosition() : undefined;\n  }\n\n  getCenterCallbackProperty() {\n    return new Cesium.CallbackProperty(this.getCenter.bind(this), false);\n  }\n\n  getRadiusPoint(): Cartesian3 {\n    return this._radiusPoint ? this._radiusPoint.getPosition() : undefined;\n  }\n\n  dispose() {\n    if (this._center) {\n      this.pointsLayer.remove(this._center.getId());\n    }\n\n    if (this._radiusPoint) {\n      this.pointsLayer.remove(this._radiusPoint.getId());\n    }\n\n    if (this._outlineArc) {\n      this.arcsLayer.remove(this._outlineArc.getId());\n    }\n\n    this.circlesLayer.remove(this.id);\n  }\n\n  getId() {\n    return this.id;\n  }\n\n  private updateCirclesLayer() {\n    this.circlesLayer.update(this, this.id);\n  }\n\n  private updatePointsLayer() {\n    if (this._center) {\n      this.pointsLayer.update(this._center, this._center.getId());\n    }\n    if (this._radiusPoint) {\n      this.pointsLayer.update(this._radiusPoint, this._radiusPoint.getId());\n    }\n  }\n\n  private updateArcsLayer() {\n    if (!this._outlineArc) {\n      return;\n    }\n    this.arcsLayer.update(this._outlineArc, this._outlineArc.getId());\n  }\n\n  private createOutlineArc() {\n    if (!this._center || !this._radiusPoint) {\n      return;\n    }\n    this._outlineArc = new EditArc(this.id, this.getCenter(), this.getRadius(), Math.PI * 2, 0, this.polylineProps);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EditableCircle } from '../../../models/editable-circle';\nimport { AcLayerComponent } from '../../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CircleEditOptions } from '../../../models/circle-edit-options';\n\n@Injectable()\nexport class CirclesManagerService {\n  private circles = new Map<string, EditableCircle>();\n\n  createEditableCircle(id: string,\n                       editCirclesLayer: AcLayerComponent,\n                       editPointsLayer: AcLayerComponent,\n                       editArcsLayer: AcLayerComponent,\n                       circleOptions: CircleEditOptions): EditableCircle {\n    const editableCircle = new EditableCircle(id, editCirclesLayer, editPointsLayer, editArcsLayer, circleOptions);\n    this.circles.set(id, editableCircle);\n    return editableCircle;\n  }\n\n  dispose(id: string) {\n    this.circles.get(id).dispose();\n    this.circles.delete(id);\n  }\n\n  get(id: string): EditableCircle {\n    return this.circles.get(id);\n  }\n\n  clear() {\n    this.circles.forEach(circle => circle.dispose());\n    this.circles.clear();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { publish, tap } from 'rxjs/operators';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { CameraService } from '../../../../angular-cesium/services/camera/camera.service';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { GeoUtilsService } from '../../../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { CesiumEvent } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../../../../angular-cesium/services/map-events-mananger/consts/pickOptions.enum';\nimport { DisposableObservable } from '../../../../angular-cesium/services/map-events-mananger/disposable-observable';\nimport { MapEventsManagerService } from '../../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { BasicEditUpdate } from '../../../models/basic-edit-update';\nimport { CircleEditOptions } from '../../../models/circle-edit-options';\nimport { CircleEditUpdate } from '../../../models/circle-edit-update';\nimport { CircleEditorObservable } from '../../../models/circle-editor-observable';\nimport { EditActions } from '../../../models/edit-actions.enum';\nimport { EditModes } from '../../../models/edit-mode.enum';\nimport { EditPoint } from '../../../models/edit-point';\nimport { EditableCircle } from '../../../models/editable-circle';\nimport { EllipseProps } from '../../../models/ellipse-edit-options';\nimport { LabelProps } from '../../../models/label-props';\nimport { PointProps } from '../../../models/polyline-edit-options';\nimport { generateKey } from '../../utils';\nimport { CirclesManagerService } from './circles-manager.service';\n\nexport const DEFAULT_CIRCLE_OPTIONS: CircleEditOptions = {\n  addPointEvent: CesiumEvent.LEFT_CLICK,\n  dragPointEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  dragShapeEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  allowDrag: true,\n  circleProps: {\n    material: Cesium.Color.GREEN.withAlpha(0.5),\n    outline: false,\n    outlineWidth: 1,\n    outlineColor: Cesium.Color.BLACK,\n  },\n  pointProps: {\n    color: Cesium.Color.WHITE.withAlpha(0.9),\n    outlineColor: Cesium.Color.BLACK,\n    outlineWidth: 1,\n    pixelSize: 15,\n    virtualPointPixelSize: 8,\n    show: true,\n    showVirtual: true,\n  },\n  polylineProps: {\n    width: 1,\n    material: () => Cesium.Color.BLACK,\n  },\n};\n\n/**\n * Service for creating editable circles\n *\n * You must provide `CircleEditorService` yourself.\n * PolygonsEditorService works together with `<circle-editor>` component. Therefor you need to create `<circle-editor>`\n * for each `CircleEditorService`, And of course somewhere under `<ac-map>`/\n *\n * + `create` for starting a creation of the shape over the map. Returns a extension of `CircleEditorObservable`.\n * + `edit` for editing shape over the map starting from a given positions. Returns an extension of `CircleEditorObservable`.\n * + To stop editing call `dsipose()` from the `CircleEditorObservable` you get back from `create()` \\ `edit()`.\n *\n * **Labels over editted shapes**\n * Angular Cesium allows you to draw labels over a shape that is being edited with one of the editors.\n * To add label drawing logic to your editor use the function `setLabelsRenderFn()` that is defined on the\n * `CircleEditorObservable` that is returned from calling `create()` \\ `edit()` of one of the editor services.\n * `setLabelsRenderFn()` - receives a callback that is called every time the shape is redrawn\n * (except when the shape is being dragged). The callback is called with the last shape state and with an array of the current labels.\n * The callback should return type `LabelProps[]`.\n * You can also use `updateLabels()` to pass an array of labels of type `LabelProps[]` to be drawn.\n *\n * usage:\n * ```typescript\n *  // Start creating circle\n *  const editing$ = circlesEditorService.create();\n *  this.editing$.subscribe(editResult => {\n *\t\t\t\tconsole.log(editResult.positions);\n *\t\t});\n *\n *  // Or edit circle from existing center point and radius\n *  const editing$ = this.circlesEditorService.edit(center, radius);\n *\n * ```\n */\n@Injectable()\nexport class CirclesEditorService {\n  private mapEventsManager: MapEventsManagerService;\n  private updateSubject = new Subject<CircleEditUpdate>();\n  private updatePublisher = publish<CircleEditUpdate>()(this.updateSubject); // TODO maybe not needed\n  private coordinateConverter: CoordinateConverter;\n  private cameraService: CameraService;\n  private circlesManager: CirclesManagerService;\n  private observablesMap = new Map<string, DisposableObservable<any>[]>();\n\n  init(\n    mapEventsManager: MapEventsManagerService,\n    coordinateConverter: CoordinateConverter,\n    cameraService: CameraService,\n    circlesManager: CirclesManagerService,\n  ) {\n    this.mapEventsManager = mapEventsManager;\n    this.coordinateConverter = coordinateConverter;\n    this.cameraService = cameraService;\n    this.circlesManager = circlesManager;\n    this.updatePublisher.connect();\n  }\n\n  onUpdate(): Observable<CircleEditUpdate> {\n    return this.updatePublisher;\n  }\n\n  create(options = DEFAULT_CIRCLE_OPTIONS, priority = 100): CircleEditorObservable {\n    let center: any;\n    const id = generateKey();\n    const circleOptions = this.setOptions(options);\n    const clientEditSubject = new BehaviorSubject<CircleEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.CREATE,\n    });\n    let finishedCreate = false;\n\n    this.updateSubject.next({\n      id,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.INIT,\n      circleOptions,\n    });\n\n    const mouseMoveRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.MOUSE_MOVE,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n    const addPointRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.LEFT_CLICK,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n\n    this.observablesMap.set(id, [mouseMoveRegistration, addPointRegistration]);\n    const editorObservable = this.createEditorObservable(clientEditSubject, id);\n\n    addPointRegistration.subscribe(({movement: {endPosition}}) => {\n      if (finishedCreate) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n\n      if (!center) {\n        const update = {\n          id,\n          center: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.ADD_POINT,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n          ...this.getCircleProperties(id),\n        });\n        center = position;\n      } else {\n        const update = {\n          id,\n          center,\n          radiusPoint: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.ADD_LAST_POINT,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n          ...this.getCircleProperties(id),\n        });\n\n        const changeMode = {\n          id,\n          center,\n          radiusPoint: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.CHANGE_TO_EDIT,\n        };\n\n        this.updateSubject.next(changeMode);\n        clientEditSubject.next({\n          ...update,\n          ...this.getCircleProperties(id),\n        });\n        if (this.observablesMap.has(id)) {\n          this.observablesMap.get(id).forEach(registration => registration.dispose());\n        }\n        this.observablesMap.delete(id);\n        this.editCircle(id, priority, clientEditSubject, circleOptions, editorObservable);\n        finishedCreate = true;\n      }\n    });\n\n    mouseMoveRegistration.subscribe(({movement: {endPosition}}) => {\n      if (!center) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n\n      if (position) {\n        const update = {\n          id,\n          center,\n          radiusPoint: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.MOUSE_MOVE,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n          ...this.getCircleProperties(id),\n        });\n      }\n    });\n\n    return editorObservable;\n  }\n\n  edit(center: Cartesian3, radius: number, options = DEFAULT_CIRCLE_OPTIONS, priority = 100): CircleEditorObservable {\n    const id = generateKey();\n    const circleOptions = this.setOptions(options);\n    const editSubject = new BehaviorSubject<CircleEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.EDIT,\n    });\n\n    const radiusPoint: Cartesian3 = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, radius, Math.PI / 2, true);\n\n    const update = {\n      id,\n      center,\n      radiusPoint,\n      editMode: EditModes.EDIT,\n      editAction: EditActions.INIT,\n      circleOptions,\n    };\n    this.updateSubject.next(update);\n    editSubject.next({\n      ...update,\n      ...this.getCircleProperties(id),\n    });\n\n    return this.editCircle(id, priority, editSubject, circleOptions);\n  }\n\n  private editCircle(\n    id: string,\n    priority: number,\n    editSubject: Subject<CircleEditUpdate>,\n    options: CircleEditOptions,\n    editObservable?: CircleEditorObservable,\n  ): CircleEditorObservable {\n    const pointDragRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.LEFT_CLICK_DRAG,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    let shapeDragRegistration;\n    if (options.allowDrag) {\n      shapeDragRegistration = this.mapEventsManager.register({\n        event: CesiumEvent.LEFT_CLICK_DRAG,\n        entityType: EditableCircle,\n        pick: PickOptions.PICK_FIRST,\n        priority: priority,\n        pickFilter: entity => id === entity.id,\n      });\n    }\n\n    pointDragRegistration\n      .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n      .subscribe(({movement: {endPosition, startPosition, drop}, entities}) => {\n        const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n        const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n        if (!endDragPosition) {\n          return;\n        }\n\n        const point: EditPoint = entities[0];\n        const pointIsCenter = point === this.getCenterPoint(id);\n        let editAction;\n        if (drop) {\n          editAction = pointIsCenter ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_POINT_FINISH;\n        } else {\n          editAction = pointIsCenter ? EditActions.DRAG_SHAPE : EditActions.DRAG_POINT;\n        }\n\n        if (!options.allowDrag && (editAction === EditActions.DRAG_SHAPE || editAction === EditActions.DRAG_SHAPE_FINISH)) {\n          this.cameraService.enableInputs(true);\n          return;\n        }\n\n        const update = {\n          id,\n          center: this.getCenterPosition(id),\n          radiusPoint: this.getRadiusPosition(id),\n          startDragPosition,\n          endDragPosition,\n          editMode: EditModes.EDIT,\n          editAction,\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n          ...this.getCircleProperties(id),\n        });\n      });\n\n    if (shapeDragRegistration) {\n      shapeDragRegistration\n        .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n        .subscribe(({movement: {startPosition, endPosition, drop}}) => {\n          const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n          const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n          if (!endDragPosition || !startDragPosition) {\n            return;\n          }\n\n          const update = {\n            id,\n            center: this.getCenterPosition(id),\n            radiusPoint: this.getRadiusPosition(id),\n            startDragPosition,\n            endDragPosition,\n            editMode: EditModes.EDIT,\n            editAction: drop ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_SHAPE,\n          };\n          this.updateSubject.next(update);\n          editSubject.next({\n            ...update,\n            ...this.getCircleProperties(id),\n          });\n        });\n    }\n\n    const observables = [pointDragRegistration];\n    if (shapeDragRegistration) {\n      observables.push(shapeDragRegistration);\n    }\n\n    this.observablesMap.set(id, observables);\n    return editObservable || this.createEditorObservable(editSubject, id);\n  }\n\n  private createEditorObservable(observableToExtend: any, id: string): CircleEditorObservable {\n    observableToExtend.dispose = () => {\n      const observables = this.observablesMap.get(id);\n      if (observables) {\n        observables.forEach(obs => obs.dispose());\n      }\n      this.observablesMap.delete(id);\n      this.updateSubject.next({\n        id,\n        center: this.getCenterPosition(id),\n        radiusPoint: this.getRadiusPosition(id),\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.DISPOSE,\n      });\n    };\n\n    observableToExtend.enable = () => {\n      this.updateSubject.next({\n        id,\n        center: this.getCenterPosition(id),\n        radiusPoint: this.getRadiusPosition(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.ENABLE,\n      });\n    };\n\n    observableToExtend.disable = () => {\n      this.updateSubject.next({\n        id,\n        center: this.getCenterPosition(id),\n        radiusPoint: this.getRadiusPosition(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.DISABLE,\n      });\n    };\n\n    observableToExtend.setManually = (\n      center: Cartesian3,\n      radius: number,\n      centerPointProp?: PointProps,\n      radiusPointProp?: PointProps,\n      circleProp?: EllipseProps,\n    ) => {\n      const radiusPoint = GeoUtilsService.pointByLocationDistanceAndAzimuth(center, radius, Math.PI / 2, true);\n      const circle = this.circlesManager.get(id);\n      circle.setManually(center, radiusPoint, centerPointProp, radiusPointProp, circleProp);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_MANUALLY,\n      });\n    };\n\n    observableToExtend.setLabelsRenderFn = (callback: (update: BasicEditUpdate<any>, labels: LabelProps[]) => LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_EDIT_LABELS_RENDER_CALLBACK,\n        labelsRenderFn: callback,\n      });\n    };\n\n    observableToExtend.updateLabels = (labels: LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.UPDATE_EDIT_LABELS,\n        updateLabels: labels,\n      });\n    };\n\n    observableToExtend.getEditValue = () => observableToExtend.getValue();\n\n    observableToExtend.getLabels = (): LabelProps[] => this.circlesManager.get(id).labels;\n    observableToExtend.getCenter = (): Cartesian3 => this.getCenterPosition(id);\n    observableToExtend.getRadius = (): number => this.getRadius(id);\n\n    return observableToExtend as CircleEditorObservable;\n  }\n\n  private setOptions(options: CircleEditOptions): CircleEditOptions {\n    const defaultClone = JSON.parse(JSON.stringify(DEFAULT_CIRCLE_OPTIONS));\n    const circleOptions = Object.assign(defaultClone, options);\n    circleOptions.pointProps = Object.assign({}, DEFAULT_CIRCLE_OPTIONS.pointProps, options.pointProps);\n    circleOptions.circleProps = Object.assign({}, DEFAULT_CIRCLE_OPTIONS.circleProps, options.circleProps);\n    circleOptions.polylineProps = Object.assign({}, DEFAULT_CIRCLE_OPTIONS.polylineProps, options.polylineProps);\n    return circleOptions;\n  }\n\n  private getCenterPosition(id: string): Cartesian3 {\n    return this.circlesManager.get(id).getCenter();\n  }\n\n  private getCenterPoint(id: string): EditPoint {\n    return this.circlesManager.get(id).center;\n  }\n\n  private getRadiusPosition(id: string): Cartesian3 {\n    return this.circlesManager.get(id).getRadiusPoint();\n  }\n\n  private getRadius(id: string): number {\n    return this.circlesManager.get(id).getRadius();\n  }\n\n  private getCircleProperties(id: string) {\n    const circle = this.circlesManager.get(id);\n    return {\n      center: circle.getCenter(),\n      radiusPoint: circle.getRadiusPoint(),\n      radius: circle.getRadius(),\n    };\n  }\n}\n","import { ChangeDetectionStrategy, Component, OnDestroy, ViewChild } from '@angular/core';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { AcNotification } from '../../../angular-cesium/models/ac-notification';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { AcLayerComponent } from '../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapEventsManagerService } from '../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { Subject } from 'rxjs';\nimport { CameraService } from '../../../angular-cesium/services/camera/camera.service';\nimport { EditPoint } from '../../models/edit-point';\nimport { CirclesManagerService } from '../../services/entity-editors/circles-editor/circles-manager.service';\nimport { CirclesEditorService } from '../../services/entity-editors/circles-editor/circles-editor.service';\nimport { CircleEditUpdate } from '../../models/circle-edit-update';\nimport { LabelProps } from '../../models/label-props';\nimport { EditableCircle } from '../../models/editable-circle';\n\n@Component({\n  selector: 'circles-editor',\n  template: /*html*/ `\n    <ac-layer #editArcsLayer acFor=\"let arc of editArcs$\" [context]=\"this\">\n      <ac-arc-desc\n        props=\"{\n        angle: arc.angle,\n        delta: arc.delta,\n        center: arc.center,\n        radius: arc.radius,\n        quality: 30,\n        color: arc.props.material()\n    }\"\n      >\n      </ac-arc-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor=\"let point of editPoints$\" [context]=\"this\">\n      <ac-point-desc\n        props=\"{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }\"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editCirclesLayer acFor=\"let circle of editCircles$\" [context]=\"this\" [zIndex]=\"0\">\n      <ac-ellipse-desc\n        props=\"{\n        position: circle.getCenterCallbackProperty(),\n        semiMajorAxis: circle.getRadiusCallbackProperty(),\n        semiMinorAxis: circle.getRadiusCallbackProperty(),\n        material: circle.circleProps.material,\n        outline: circle.circleProps.outline,\n        height: 0\n    }\"\n      >\n      </ac-ellipse-desc>\n\n      <ac-array-desc acFor=\"let label of circle.labels\" [idGetter]=\"getLabelId\">\n        <ac-label-primitive-desc\n          props=\"{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }\"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  `,\n  providers: [CoordinateConverter, CirclesManagerService],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CirclesEditorComponent implements OnDestroy {\n  private editLabelsRenderFn: (update: CircleEditUpdate, labels: LabelProps[]) => LabelProps[];\n  public Cesium = Cesium;\n  public editPoints$ = new Subject<AcNotification>();\n  public editCircles$ = new Subject<AcNotification>();\n  public editArcs$ = new Subject<AcNotification>();\n\n  @ViewChild('editCirclesLayer') private editCirclesLayer: AcLayerComponent;\n  @ViewChild('editArcsLayer') private editArcsLayer: AcLayerComponent;\n  @ViewChild('editPointsLayer') private editPointsLayer: AcLayerComponent;\n\n  constructor(\n    private circlesEditor: CirclesEditorService,\n    private coordinateConverter: CoordinateConverter,\n    private mapEventsManager: MapEventsManagerService,\n    private cameraService: CameraService,\n    private circlesManager: CirclesManagerService,\n  ) {\n    this.circlesEditor.init(this.mapEventsManager, this.coordinateConverter, this.cameraService, this.circlesManager);\n    this.startListeningToEditorUpdates();\n  }\n\n  private startListeningToEditorUpdates() {\n    this.circlesEditor.onUpdate().subscribe(update => {\n      if (update.editMode === EditModes.CREATE || update.editMode === EditModes.CREATE_OR_EDIT) {\n        this.handleCreateUpdates(update);\n      } else if (update.editMode === EditModes.EDIT) {\n        this.handleEditUpdates(update);\n      }\n    });\n  }\n\n  getLabelId(element: any, index: number): string {\n    return index.toString();\n  }\n\n  renderEditLabels(circle: EditableCircle, update: CircleEditUpdate, labels?: LabelProps[]) {\n    update.center = circle.getCenter();\n    update.radiusPoint = circle.getRadiusPoint();\n    update.radius = circle.getRadius();\n\n    if (labels) {\n      circle.labels = labels;\n      this.editCirclesLayer.update(circle, circle.getId());\n      return;\n    }\n\n    if (!this.editLabelsRenderFn) {\n      return;\n    }\n\n    circle.labels = this.editLabelsRenderFn(update, circle.labels);\n    this.editCirclesLayer.update(circle, circle.getId());\n  }\n\n  removeEditLabels(circle: EditableCircle) {\n    circle.labels = [];\n    this.editCirclesLayer.update(circle, circle.getId());\n  }\n\n  handleCreateUpdates(update: CircleEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.circlesManager.createEditableCircle(\n          update.id,\n          this.editCirclesLayer,\n          this.editPointsLayer,\n          this.editArcsLayer,\n          update.circleOptions,\n        );\n        break;\n      }\n      case EditActions.MOUSE_MOVE: {\n        const circle = this.circlesManager.get(update.id);\n        if (update.radiusPoint) {\n          circle.movePoint(update.radiusPoint);\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.ADD_POINT: {\n        const circle = this.circlesManager.get(update.id);\n        if (update.center) {\n          circle.addPoint(update.center);\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.ADD_LAST_POINT: {\n        const circle = this.circlesManager.get(update.id);\n        if (update.radiusPoint) {\n          circle.addLastPoint(update.radiusPoint);\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.DISPOSE: {\n        const circle = this.circlesManager.get(update.id);\n        this.removeEditLabels(circle);\n        this.circlesManager.dispose(update.id);\n        break;\n      }\n      case EditActions.SET_EDIT_LABELS_RENDER_CALLBACK: {\n        const circle = this.circlesManager.get(update.id);\n        this.editLabelsRenderFn = update.labelsRenderFn;\n        this.renderEditLabels(circle, update);\n        break;\n      }\n      case EditActions.UPDATE_EDIT_LABELS: {\n        const circle = this.circlesManager.get(update.id);\n        this.renderEditLabels(circle, update, update.updateLabels);\n        break;\n      }\n      case EditActions.SET_MANUALLY: {\n        const circle = this.circlesManager.get(update.id);\n        this.renderEditLabels(circle, update, update.updateLabels);\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  handleEditUpdates(update: CircleEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        const circle = this.circlesManager.createEditableCircle(\n          update.id,\n          this.editCirclesLayer,\n          this.editPointsLayer,\n          this.editArcsLayer,\n          update.circleOptions,\n        );\n        circle.setManually(update.center, update.radiusPoint);\n        break;\n      }\n      case EditActions.DRAG_POINT_FINISH:\n      case EditActions.DRAG_POINT: {\n        const circle = this.circlesManager.get(update.id);\n        if (circle && circle.enableEdit) {\n          circle.movePoint(update.endDragPosition);\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE: {\n        const circle = this.circlesManager.get(update.id);\n        if (circle && circle.enableEdit) {\n          circle.moveCircle(update.startDragPosition, update.endDragPosition);\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE_FINISH: {\n        const circle = this.circlesManager.get(update.id);\n        if (circle && circle.enableEdit) {\n          circle.endMovePolygon();\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.DISABLE: {\n        const circle = this.circlesManager.get(update.id);\n        if (circle) {\n          circle.enableEdit = false;\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      case EditActions.ENABLE: {\n        const circle = this.circlesManager.get(update.id);\n        if (circle) {\n          circle.enableEdit = true;\n          this.renderEditLabels(circle, update);\n        }\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.circlesManager.clear();\n  }\n\n  getPointSize(point: EditPoint) {\n    return point.isVirtualEditPoint() ? point.props.virtualPointPixelSize : point.props.pixelSize;\n  }\n\n  getPointShow(point: EditPoint) {\n    return point.show && (point.isVirtualEditPoint() ? point.props.showVirtual : point.props.show);\n  }\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { EditPoint } from './edit-point';\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { EllipseEditOptions, EllipseProps } from './ellipse-edit-options';\nimport { PointProps, PolylineProps } from './polyline-edit-options';\nimport { defaultLabelProps, LabelProps } from './label-props';\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\n\nexport class EditableEllipse extends AcEntity {\n  private _center: EditPoint;\n  private _majorRadiusPoint: EditPoint;\n  private _majorRadius: number;\n  private _minorRadius: number;\n  private _rotation = 0;\n  private doneCreation = false;\n  private _enableEdit = true;\n  private _minorRadiusPoints: EditPoint[] = [];\n  private lastDraggedToPosition: any;\n  private _ellipseProps: EllipseProps;\n  private _pointProps: PointProps;\n  private _polylineProps: PolylineProps;\n  private _labels: LabelProps[] = [];\n\n  constructor(\n    private id: string,\n    private ellipsesLayer: AcLayerComponent,\n    private pointsLayer: AcLayerComponent,\n    private coordinateConverter: CoordinateConverter,\n    private options: EllipseEditOptions,\n  ) {\n    super();\n    this._ellipseProps = options.ellipseProps;\n    this._pointProps = options.pointProps;\n  }\n\n  get labels(): LabelProps[] {\n    return this._labels;\n  }\n\n  set labels(labels: LabelProps[]) {\n    if (!labels || !this._center) {\n      return;\n    }\n    this._labels = labels.map((label, index) => {\n      if (!label.position) {\n        if (index === 0) {\n          label.position = this._center.getPosition();\n        } else if (index === 1) {\n          label.position = this._majorRadiusPoint\n            ? Cesium.Cartesian3.midpoint(this.getCenter(), this._majorRadiusPoint.getPosition(), new Cesium.Cartesian3())\n            : new Cesium.Cartesian3();\n        } else if (index === 2) {\n          label.position =\n            this._minorRadiusPoints.length > 0 && this._minorRadius\n              ? Cesium.Cartesian3.midpoint(this.getCenter(), this.getMinorRadiusPointPosition(), new Cesium.Cartesian3())\n              : new Cesium.Cartesian3();\n        }\n      }\n\n      return Object.assign({}, defaultLabelProps, label);\n    });\n  }\n\n  get polylineProps(): PolylineProps {\n    return this._polylineProps;\n  }\n\n  set polylineProps(value: PolylineProps) {\n    this._polylineProps = value;\n  }\n\n  get pointProps(): PointProps {\n    return this._pointProps;\n  }\n\n  set pointProps(value: PointProps) {\n    this._pointProps = value;\n  }\n\n  get ellipseProps(): EllipseProps {\n    return this._ellipseProps;\n  }\n\n  set ellipseProps(value: EllipseProps) {\n    this._ellipseProps = value;\n  }\n\n  get center(): EditPoint {\n    return this._center;\n  }\n\n  get majorRadiusPoint(): EditPoint {\n    return this._majorRadiusPoint;\n  }\n\n  getMajorRadiusPointPosition() {\n    if (!this._majorRadiusPoint) {\n      return undefined;\n    }\n\n    return this._majorRadiusPoint.getPosition();\n  }\n\n  getMinorRadiusPointPosition(): Cartesian3 {\n    if (this._minorRadiusPoints.length < 1) {\n      return undefined;\n    }\n\n    return this._minorRadiusPoints[0].getPosition();\n  }\n\n  get enableEdit() {\n    return this._enableEdit;\n  }\n\n  set enableEdit(value: boolean) {\n    this._enableEdit = value;\n    this._center.show = value;\n    this._majorRadiusPoint.show = value;\n    this.updatePointsLayer();\n  }\n\n  setManually(\n    center: Cartesian3,\n    majorRadius: number,\n    rotation = Math.PI / 2,\n    minorRadius?: number,\n    centerPointProp = this.pointProps,\n    radiusPointProp = this.pointProps,\n    ellipseProp = this.ellipseProps,\n  ) {\n    if (majorRadius < minorRadius) {\n      throw new Error('Major radius muse be equal or greater than minor radius');\n    }\n    this._rotation = rotation;\n    this._majorRadius = majorRadius;\n    if (!this._center) {\n      this._center = new EditPoint(this.id, center, centerPointProp);\n    } else {\n      this._center.setPosition(center);\n    }\n\n    const majorRadiusPosition = GeoUtilsService.pointByLocationDistanceAndAzimuth(this.center.getPosition(), majorRadius, rotation);\n\n    if (!this._majorRadiusPoint) {\n      this._majorRadiusPoint = new EditPoint(this.id, majorRadiusPosition, radiusPointProp);\n    } else {\n      this._majorRadiusPoint.setPosition(majorRadiusPosition);\n    }\n\n    if (minorRadius) {\n      this._minorRadius = minorRadius;\n    }\n\n    this.ellipseProps = ellipseProp;\n    this.doneCreation = true;\n    this.updateMinorRadiusEditPoints();\n    this.updatePointsLayer();\n    this.updateEllipsesLayer();\n  }\n\n  addPoint(position: Cartesian3) {\n    if (this.doneCreation) {\n      return;\n    }\n\n    if (!this._center) {\n      this._center = new EditPoint(this.id, position, this.pointProps);\n      this._majorRadiusPoint = new EditPoint(this.id, position.clone(), this.pointProps);\n      this._majorRadius = 0;\n    }\n\n    this.updateRotation();\n    this.updateMinorRadiusEditPoints();\n    this.updatePointsLayer();\n    this.updateEllipsesLayer();\n  }\n\n  transformToEllipse() {\n    if (this._minorRadius) {\n      return;\n    }\n\n    this._minorRadius = this.getMajorRadius();\n    this.updateMinorRadiusEditPoints();\n    this.updatePointsLayer();\n    this.updateEllipsesLayer();\n  }\n\n  addLastPoint(position: Cartesian3) {\n    if (this.doneCreation || !this._center || !this._majorRadiusPoint) {\n      return;\n    }\n\n    const newRadius = GeoUtilsService.distance(this._center.getPosition(), position);\n    this._majorRadiusPoint.setPosition(position);\n    this._majorRadius = newRadius;\n    this.doneCreation = true;\n\n    if (!this.options.circleToEllipseTransformation) {\n      this._minorRadius = this._majorRadius;\n    }\n\n    this.updateRotation();\n    this.updateMinorRadiusEditPoints();\n    this.updatePointsLayer();\n    this.updateEllipsesLayer();\n  }\n\n  movePoint(toPosition: Cartesian3, editPoint: EditPoint) {\n    if (!this._center || !this._majorRadiusPoint) {\n      return;\n    }\n\n    const newRadius = GeoUtilsService.distance(this._center.getPosition(), toPosition);\n    if (this.majorRadiusPoint === editPoint) {\n      if (newRadius < this._minorRadius) {\n        this._majorRadius = this._minorRadius;\n        this._majorRadiusPoint.setPosition(\n          GeoUtilsService.pointByLocationDistanceAndAzimuth(this.getCenter(), this._minorRadius, this._rotation),\n        );\n      } else {\n        this.majorRadiusPoint.setPosition(toPosition);\n        this._majorRadius = newRadius;\n      }\n    } else {\n      if (newRadius > this._majorRadius) {\n        this._minorRadius = this._majorRadius;\n      } else {\n        this._minorRadius = newRadius;\n      }\n    }\n\n    this.updateRotation();\n    this.updateMinorRadiusEditPoints();\n    this.updatePointsLayer();\n    this.updateEllipsesLayer();\n  }\n\n  moveEllipse(dragStartPosition: Cartesian3, dragEndPosition: Cartesian3) {\n    if (!this.doneCreation) {\n      return;\n    }\n    if (!this.lastDraggedToPosition) {\n      this.lastDraggedToPosition = dragStartPosition;\n    }\n\n    const majorRadius = this.getMajorRadius();\n    const rotation = this.getRotation();\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, dragEndPosition);\n    GeoUtilsService.addDeltaToPosition(this.getCenter(), delta, true);\n    this.majorRadiusPoint.setPosition(GeoUtilsService.pointByLocationDistanceAndAzimuth(this.getCenter(), majorRadius, rotation));\n    this.updatePointsLayer();\n    this.updateMinorRadiusEditPoints();\n    this.updateEllipsesLayer();\n    this.lastDraggedToPosition = dragEndPosition;\n  }\n\n  endMoveEllipse() {\n    this.lastDraggedToPosition = undefined;\n  }\n\n  private updateMinorRadiusEditPoints() {\n    if (this._minorRadius === undefined) {\n      return;\n    }\n    if (this._minorRadiusPoints.length === 0) {\n      this._minorRadiusPoints.push(new EditPoint(this.id, new Cesium.Cartesian3(), this.pointProps, true));\n      this._minorRadiusPoints.push(new EditPoint(this.id, new Cesium.Cartesian3(), this.pointProps, true));\n    }\n\n    this._minorRadiusPoints[0].setPosition(\n      GeoUtilsService.pointByLocationDistanceAndAzimuth(this._center.getPosition(), this._minorRadius, this.getRotation() - Math.PI / 2),\n    );\n\n    this._minorRadiusPoints[1].setPosition(\n      GeoUtilsService.pointByLocationDistanceAndAzimuth(this._center.getPosition(), this._minorRadius, this.getRotation() + Math.PI / 2),\n    );\n  }\n\n  getMajorRadius(): number {\n    return this._majorRadius || 0;\n  }\n\n  getMinorRadius() {\n    if (this._minorRadius === undefined) {\n      return this.getMajorRadius();\n    } else {\n      return this._minorRadius;\n    }\n  }\n\n  getRotation(): number {\n    return this._rotation || 0;\n  }\n\n  updateRotation(): number {\n    if (!this._majorRadiusPoint) {\n      return 0;\n    }\n\n    const azimuthInDegrees = this.coordinateConverter.bearingToCartesian(this.getCenter(), this._majorRadiusPoint.getPosition());\n    this._rotation = Cesium.Math.toRadians(azimuthInDegrees);\n    return this._rotation;\n  }\n\n  getRotationCallbackProperty() {\n    return new Cesium.CallbackProperty(() => Math.PI / 2 - this.getRotation(), false);\n  }\n\n  getMinorRadiusCallbackProperty() {\n    return new Cesium.CallbackProperty(() => this.getMinorRadius(), false);\n  }\n\n  getMajorRadiusCallbackProperty() {\n    return new Cesium.CallbackProperty(() => this.getMajorRadius(), false);\n  }\n\n  getCenter(): Cartesian3 {\n    return this._center ? this._center.getPosition() : undefined;\n  }\n\n  getCenterCallbackProperty() {\n    return new Cesium.CallbackProperty(() => this.getCenter(), false);\n  }\n\n  dispose() {\n    if (this._center) {\n      this.pointsLayer.remove(this._center.getId());\n    }\n\n    if (this._majorRadiusPoint) {\n      this.pointsLayer.remove(this._majorRadiusPoint.getId());\n    }\n\n    if (this._minorRadiusPoints) {\n      this._minorRadiusPoints.forEach(point => this.pointsLayer.remove(point.getId()));\n    }\n\n    this.ellipsesLayer.remove(this.id);\n  }\n\n  getId() {\n    return this.id;\n  }\n\n  private updateEllipsesLayer() {\n    this.ellipsesLayer.update(this, this.id);\n  }\n\n  private updatePointsLayer() {\n    if (this._center) {\n      this.pointsLayer.update(this._center, this._center.getId());\n    }\n    if (this._majorRadiusPoint) {\n      this.pointsLayer.update(this._majorRadiusPoint, this._majorRadiusPoint.getId());\n    }\n    if (this._minorRadiusPoints.length > 0) {\n      this.pointsLayer.update(this._minorRadiusPoints[0], this._minorRadiusPoints[0].getId());\n      this.pointsLayer.update(this._minorRadiusPoints[1], this._minorRadiusPoints[1].getId());\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { EditableEllipse } from '../../../models/editable-ellipse';\nimport { AcLayerComponent } from '../../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { EllipseEditOptions } from '../../../models/ellipse-edit-options';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\n\n@Injectable()\nexport class EllipsesManagerService {\n  private ellipses = new Map<string, EditableEllipse>();\n\n  createEditableEllipse(id: string,\n                        editEllipsesLayer: AcLayerComponent,\n                        editPointsLayer: AcLayerComponent,\n                        coordinateConverter: CoordinateConverter,\n                        ellipseOptions: EllipseEditOptions): EditableEllipse {\n    const editableEllipse = new EditableEllipse(id, editEllipsesLayer, editPointsLayer, coordinateConverter, ellipseOptions);\n    this.ellipses.set(id, editableEllipse);\n    return editableEllipse;\n  }\n\n  dispose(id: string) {\n    this.ellipses.get(id).dispose();\n    this.ellipses.delete(id);\n  }\n\n  get(id: string): EditableEllipse {\n    return this.ellipses.get(id);\n  }\n\n  clear() {\n    this.ellipses.forEach(ellipse => ellipse.dispose());\n    this.ellipses.clear();\n  }\n}\n","import { publish, tap } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { MapEventsManagerService } from '../../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { CesiumEvent } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../../../../angular-cesium/services/map-events-mananger/consts/pickOptions.enum';\nimport { EditModes } from '../../../models/edit-mode.enum';\nimport { EditActions } from '../../../models/edit-actions.enum';\nimport { DisposableObservable } from '../../../../angular-cesium/services/map-events-mananger/disposable-observable';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { EditPoint } from '../../../models/edit-point';\nimport { CameraService } from '../../../../angular-cesium/services/camera/camera.service';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { EllipseEditUpdate } from '../../../models/ellipse-edit-update';\nimport { EllipsesManagerService } from './ellipses-manager.service';\nimport { EllipseEditorObservable } from '../../../models/ellipse-editor-observable';\nimport { EllipseEditOptions, EllipseProps } from '../../../models/ellipse-edit-options';\nimport { EditableEllipse } from '../../../models/editable-ellipse';\nimport { PointProps } from '../../../models/polyline-edit-options';\nimport { LabelProps } from '../../../models/label-props';\nimport { BasicEditUpdate } from '../../../models/basic-edit-update';\nimport { generateKey } from '../../utils';\nimport { CesiumEventModifier } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event-modifier.enum';\n\nexport const DEFAULT_ELLIPSE_OPTIONS: EllipseEditOptions = {\n  addPointEvent: CesiumEvent.LEFT_CLICK,\n  dragPointEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  dragShapeEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  circleToEllipseTransformEvent: CesiumEvent.LEFT_CLICK,\n  circleToEllipseTransformEventModifier: CesiumEventModifier.ALT,\n  allowDrag: true,\n  ellipseProps: {\n    material: Cesium.Color.GREEN.withAlpha(0.5),\n    outline: true,\n    outlineWidth: 1,\n    outlineColor: Cesium.Color.BLACK,\n  },\n  pointProps: {\n    color: Cesium.Color.WHITE.withAlpha(0.9),\n    outlineColor: Cesium.Color.BLACK,\n    outlineWidth: 1,\n    pixelSize: 15,\n    virtualPointPixelSize: 8,\n    show: true,\n    showVirtual: true,\n  },\n  polylineProps: {\n    width: 1,\n    material: () => Cesium.Color.BLACK,\n  },\n  circleToEllipseTransformation: false,\n};\n\n/**\n * Service for creating editable ellipses\n *\n * You must provide `EllipsesEditorService` yourself.\n * EllipsesEditorService works together with `<ellipse-editor>` component. Therefor you need to create `<ellipse-editor>`\n * for each `EllipsesEditorService`, And of course somewhere under `<ac-map>`/\n *\n * + `create` for starting a creation of the shape over the map. Returns a extension of `EllipseEditorObservable`.\n * + `edit` for editing shape over the map starting from a given positions. Returns an extension of `EllipseEditorObservable`.\n * + To stop editing call `dispose()` from the `EllipseEditorObservable` you get back from `create()` \\ `edit()`.\n *\n * **Labels over edited shapes**\n * Angular Cesium allows you to draw labels over a shape that is being edited with one of the editors.\n * To add label drawing logic to your editor use the function `setLabelsRenderFn()` that is defined on the\n * `EllipseEditorObservable` that is returned from calling `create()` \\ `edit()` of one of the editor services.\n * `setLabelsRenderFn()` - receives a callback that is called every time the shape is redrawn\n * (except when the shape is being dragged). The callback is called with the last shape state and with an array of the current labels.\n * The callback should return type `LabelProps[]`.\n * You can also use `updateLabels()` to pass an array of labels of type `LabelProps[]` to be drawn.\n *\n * usage:\n * ```typescript\n *  // Start creating ellipse\n *  const editing$ = ellipsesEditorService.create();\n *  this.editing$.subscribe(editResult => {\n *\t\t\t\tconsole.log(editResult.positions);\n *\t\t});\n *\n *  // Or edit ellipse from existing center point, two radiuses and rotation\n *  const editing$ = this.ellipsesEditorService.edit(center, majorRadius, rotation, minorRadius);\n *\n * ```\n */\n@Injectable()\nexport class EllipsesEditorService {\n  private mapEventsManager: MapEventsManagerService;\n  private updateSubject = new Subject<EllipseEditUpdate>();\n  private updatePublisher = publish<EllipseEditUpdate>()(this.updateSubject); // TODO maybe not needed\n  private coordinateConverter: CoordinateConverter;\n  private cameraService: CameraService;\n  private ellipsesManager: EllipsesManagerService;\n  private observablesMap = new Map<string, DisposableObservable<any>[]>();\n\n  init(\n    mapEventsManager: MapEventsManagerService,\n    coordinateConverter: CoordinateConverter,\n    cameraService: CameraService,\n    ellipsesManager: EllipsesManagerService,\n  ) {\n    this.mapEventsManager = mapEventsManager;\n    this.coordinateConverter = coordinateConverter;\n    this.cameraService = cameraService;\n    this.ellipsesManager = ellipsesManager;\n    this.updatePublisher.connect();\n  }\n\n  onUpdate(): Observable<EllipseEditUpdate> {\n    return this.updatePublisher;\n  }\n\n  create(options = DEFAULT_ELLIPSE_OPTIONS, priority = 100): EllipseEditorObservable {\n    let center: any;\n    const id = generateKey();\n    const ellipseOptions = this.setOptions(options);\n    const clientEditSubject = new BehaviorSubject<EllipseEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.CREATE,\n    });\n    let finishedCreate = false;\n\n    this.updateSubject.next({\n      id,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.INIT,\n      ellipseOptions,\n    });\n\n    const mouseMoveRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.MOUSE_MOVE,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n    const addPointRegistration = this.mapEventsManager.register({\n      event: ellipseOptions.addPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority,\n    });\n\n    this.observablesMap.set(id, [mouseMoveRegistration, addPointRegistration]);\n    const editorObservable = this.createEditorObservable(clientEditSubject, id);\n\n    addPointRegistration.subscribe(({movement: {endPosition}}) => {\n      if (finishedCreate) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n\n      if (!center) {\n        const update: EllipseEditUpdate = {\n          id,\n          center: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.ADD_POINT,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n        });\n        center = position;\n      } else {\n        const update: EllipseEditUpdate = {\n          id,\n          center,\n          updatedPosition: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.ADD_LAST_POINT,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n        });\n\n        const changeMode: EllipseEditUpdate = {\n          id,\n          center,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.CHANGE_TO_EDIT,\n        };\n\n        this.updateSubject.next(changeMode);\n        clientEditSubject.next({\n          ...update,\n        });\n        if (this.observablesMap.has(id)) {\n          this.observablesMap.get(id).forEach(registration => registration.dispose());\n        }\n        this.observablesMap.delete(id);\n        this.editEllipse(id, priority, clientEditSubject, ellipseOptions, editorObservable);\n        finishedCreate = true;\n      }\n    });\n\n    mouseMoveRegistration.subscribe(({movement: {endPosition}}) => {\n      if (!center) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n\n      if (position) {\n        const update: EllipseEditUpdate = {\n          id,\n          center,\n          updatedPosition: position,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.MOUSE_MOVE,\n        };\n        this.updateSubject.next(update);\n        clientEditSubject.next({\n          ...update,\n        });\n      }\n    });\n\n    return editorObservable;\n  }\n\n  edit(\n    center: Cartesian3,\n    majorRadius: number,\n    rotation = Math.PI / 2,\n    minorRadius?: number,\n    options = DEFAULT_ELLIPSE_OPTIONS,\n    priority = 100,\n  ): EllipseEditorObservable {\n    const id = generateKey();\n    const ellipseOptions = this.setOptions(options);\n    const editSubject = new BehaviorSubject<EllipseEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.EDIT,\n    });\n\n    const update: EllipseEditUpdate = {\n      id,\n      center,\n      majorRadius,\n      rotation,\n      minorRadius,\n      editMode: EditModes.EDIT,\n      editAction: EditActions.INIT,\n      ellipseOptions,\n    };\n    this.updateSubject.next(update);\n    editSubject.next({\n      ...update,\n    });\n\n    return this.editEllipse(id, priority, editSubject, ellipseOptions);\n  }\n\n  private editEllipse(\n    id: string,\n    priority: number,\n    editSubject: Subject<EllipseEditUpdate>,\n    options: EllipseEditOptions,\n    editObservable?: EllipseEditorObservable,\n  ): EllipseEditorObservable {\n    const pointDragRegistration = this.mapEventsManager.register({\n      event: options.dragPointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    let addSecondRadiusRegistration;\n    if (options.circleToEllipseTransformation) {\n      addSecondRadiusRegistration = this.mapEventsManager.register({\n        event: options.circleToEllipseTransformEvent,\n        modifier: options.circleToEllipseTransformEventModifier,\n        entityType: EditableEllipse,\n        pick: PickOptions.PICK_FIRST,\n        priority,\n        pickFilter: entity => id === entity.id,\n      });\n    }\n\n    let shapeDragRegistration;\n    if (options.allowDrag) {\n      shapeDragRegistration = this.mapEventsManager.register({\n        event: options.dragShapeEvent,\n        entityType: EditableEllipse,\n        pick: PickOptions.PICK_FIRST,\n        priority: priority,\n        pickFilter: entity => id === entity.id,\n      });\n    }\n\n    pointDragRegistration\n      .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n      .subscribe(({movement: {endPosition, startPosition, drop}, entities}) => {\n        const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n        const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n        if (!endDragPosition) {\n          return;\n        }\n\n        const point: EditPoint = entities[0];\n        const pointIsCenter = point === this.getCenterPoint(id);\n        let editAction;\n        if (drop) {\n          editAction = pointIsCenter ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_POINT_FINISH;\n        } else {\n          editAction = pointIsCenter ? EditActions.DRAG_SHAPE : EditActions.DRAG_POINT;\n        }\n\n        if (!options.allowDrag && (editAction === EditActions.DRAG_SHAPE || editAction === EditActions.DRAG_SHAPE_FINISH)) {\n          this.cameraService.enableInputs(true);\n          return;\n        }\n\n        const update: EllipseEditUpdate = {\n          id,\n          updatedPoint: point,\n          startDragPosition,\n          endDragPosition,\n          editMode: EditModes.EDIT,\n          editAction,\n          ...this.getEllipseProperties(id),\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n        });\n      });\n\n    if (addSecondRadiusRegistration) {\n      addSecondRadiusRegistration.subscribe(({movement: {endPosition, startPosition, drop}, entities}) => {\n        const update: EllipseEditUpdate = {\n          id,\n          editMode: EditModes.EDIT,\n          editAction: EditActions.TRANSFORM,\n          ...this.getEllipseProperties(id),\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n        });\n      });\n    }\n\n    if (shapeDragRegistration) {\n      shapeDragRegistration\n        .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n        .subscribe(({movement: {startPosition, endPosition, drop}}) => {\n          const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n          const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n          if (!endDragPosition || !startDragPosition) {\n            return;\n          }\n\n          const update: EllipseEditUpdate = {\n            id,\n            startDragPosition,\n            endDragPosition,\n            editMode: EditModes.EDIT,\n            editAction: drop ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_SHAPE,\n            ...this.getEllipseProperties(id),\n          };\n          this.updateSubject.next(update);\n          editSubject.next({\n            ...update,\n          });\n        });\n    }\n\n    const observables = [pointDragRegistration, addSecondRadiusRegistration];\n    if (shapeDragRegistration) {\n      observables.push(shapeDragRegistration);\n    }\n    if (addSecondRadiusRegistration) {\n      observables.push(addSecondRadiusRegistration);\n    }\n\n    this.observablesMap.set(id, observables);\n    return editObservable || this.createEditorObservable(editSubject, id);\n  }\n\n  private createEditorObservable(observableToExtend: any, id: string): EllipseEditorObservable {\n    observableToExtend.dispose = () => {\n      const observables = this.observablesMap.get(id);\n      if (observables) {\n        observables.forEach(obs => obs.dispose());\n      }\n      this.observablesMap.delete(id);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.DISPOSE,\n        ...this.getEllipseProperties(id),\n      } as EllipseEditUpdate);\n    };\n\n    observableToExtend.enable = () => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.EDIT,\n        editAction: EditActions.ENABLE,\n        ...this.getEllipseProperties(id),\n      } as EllipseEditUpdate);\n    };\n\n    observableToExtend.disable = () => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.EDIT,\n        editAction: EditActions.DISABLE,\n        ...this.getEllipseProperties(id),\n      } as EllipseEditUpdate);\n    };\n\n    observableToExtend.setManually = (\n      center: Cartesian3,\n      majorRadius: number,\n      rotation?: number,\n      minorRadius?: number,\n      centerPointProp?: PointProps,\n      radiusPointProp?: PointProps,\n      ellipseProp?: EllipseProps,\n    ) => {\n      const ellipse = this.ellipsesManager.get(id);\n      ellipse.setManually(center, majorRadius, rotation, minorRadius, centerPointProp, radiusPointProp, ellipseProp);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_MANUALLY,\n      });\n    };\n\n    observableToExtend.setLabelsRenderFn = (callback: (update: BasicEditUpdate<any>, labels: LabelProps[]) => LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_EDIT_LABELS_RENDER_CALLBACK,\n        labelsRenderFn: callback,\n      } as EllipseEditUpdate);\n    };\n\n    observableToExtend.updateLabels = (labels: LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.UPDATE_EDIT_LABELS,\n        updateLabels: labels,\n      } as EllipseEditUpdate);\n    };\n\n    observableToExtend.getEditValue = () => observableToExtend.getValue();\n\n    observableToExtend.getLabels = (): LabelProps[] => this.ellipsesManager.get(id).labels;\n    observableToExtend.getCenter = (): Cartesian3 => this.getCenterPosition(id);\n    observableToExtend.getMajorRadius = (): number => this.getMajorRadius(id);\n    observableToExtend.getMinorRadius = (): number => this.getMinorRadius(id);\n\n    return observableToExtend as EllipseEditorObservable;\n  }\n\n  private setOptions(options: EllipseEditOptions): EllipseEditOptions {\n    const defaultClone = JSON.parse(JSON.stringify(DEFAULT_ELLIPSE_OPTIONS));\n    const ellipseOptions = Object.assign(defaultClone, options);\n    ellipseOptions.pointProps = Object.assign({}, DEFAULT_ELLIPSE_OPTIONS.pointProps, options.pointProps);\n    ellipseOptions.ellipseProps = Object.assign({}, DEFAULT_ELLIPSE_OPTIONS.ellipseProps, options.ellipseProps);\n    ellipseOptions.polylineProps = Object.assign({}, DEFAULT_ELLIPSE_OPTIONS.polylineProps, options.polylineProps);\n    return ellipseOptions;\n  }\n\n  private getCenterPosition(id: string): Cartesian3 {\n    return this.ellipsesManager.get(id).getCenter();\n  }\n\n  private getCenterPoint(id: string): EditPoint {\n    return this.ellipsesManager.get(id).center;\n  }\n\n  private getMajorRadius(id: string): number {\n    return this.ellipsesManager.get(id).getMajorRadius();\n  }\n\n  private getMinorRadius(id: string): number {\n    return this.ellipsesManager.get(id).getMinorRadius();\n  }\n\n  private getEllipseProperties(id: string) {\n    const ellipse = this.ellipsesManager.get(id);\n    return {\n      center: ellipse.getCenter(),\n      rotation: ellipse.getRotation(),\n      minorRadius: ellipse.getMinorRadius(),\n      majorRadius: ellipse.getMajorRadius(),\n      minorRadiusPointPosition: ellipse.getMinorRadiusPointPosition(),\n      majorRadiusPointPosition: ellipse.getMajorRadiusPointPosition(),\n    };\n  }\n}\n","import { ChangeDetectionStrategy, Component, OnDestroy, ViewChild } from '@angular/core';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { AcNotification } from '../../../angular-cesium/models/ac-notification';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { AcLayerComponent } from '../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapEventsManagerService } from '../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { Subject } from 'rxjs';\nimport { CameraService } from '../../../angular-cesium/services/camera/camera.service';\nimport { EditPoint } from '../../models/edit-point';\nimport { EllipsesManagerService } from '../../services/entity-editors/ellipses-editor/ellipses-manager.service';\nimport { EllipsesEditorService } from '../../services/entity-editors/ellipses-editor/ellipses-editor.service';\nimport { EllipseEditUpdate } from '../../models/ellipse-edit-update';\nimport { LabelProps } from '../../models/label-props';\nimport { EditableEllipse } from '../../models/editable-ellipse';\n\n@Component({\n  selector: 'ellipses-editor',\n  template: /*html*/ `\n    <ac-layer #editPointsLayer acFor=\"let point of editPoints$\" [context]=\"this\">\n      <ac-point-desc\n        props=\"{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }\"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #editEllipsesLayer acFor=\"let ellipse of editEllipses$\" [context]=\"this\" [zIndex]=\"0\">\n      <ac-ellipse-desc\n        props=\"{\n        position: ellipse.getCenterCallbackProperty(),\n        semiMajorAxis: ellipse.getMajorRadiusCallbackProperty(),\n        semiMinorAxis: ellipse.getMinorRadiusCallbackProperty(),\n        rotation: ellipse.getRotationCallbackProperty(),\n        material: ellipse.ellipseProps.material,\n        outline: ellipse.ellipseProps.outline,\n        outlineWidth: ellipse.ellipseProps.outlineWidth,\n        outlineColor: ellipse.ellipseProps.outlineColor,\n        height: 0\n    }\"\n      >\n      </ac-ellipse-desc>\n\n      <ac-array-desc acFor=\"let label of ellipse.labels\" [idGetter]=\"getLabelId\">\n        <ac-label-primitive-desc\n          props=\"{\n            position: label.position,\n            text: label.text,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }\"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  `,\n  providers: [CoordinateConverter, EllipsesManagerService],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class EllipsesEditorComponent implements OnDestroy {\n  private editLabelsRenderFn: (update: EllipseEditUpdate, labels: LabelProps[]) => LabelProps[];\n  public Cesium = Cesium;\n  public editPoints$ = new Subject<AcNotification>();\n  public editEllipses$ = new Subject<AcNotification>();\n\n  @ViewChild('editEllipsesLayer') private editEllipsesLayer: AcLayerComponent;\n  @ViewChild('editPointsLayer') private editPointsLayer: AcLayerComponent;\n\n  constructor(\n    private ellipsesEditor: EllipsesEditorService,\n    private coordinateConverter: CoordinateConverter,\n    private mapEventsManager: MapEventsManagerService,\n    private cameraService: CameraService,\n    private ellipsesManager: EllipsesManagerService,\n  ) {\n    this.ellipsesEditor.init(this.mapEventsManager, this.coordinateConverter, this.cameraService, this.ellipsesManager);\n    this.startListeningToEditorUpdates();\n  }\n\n  private startListeningToEditorUpdates() {\n    this.ellipsesEditor.onUpdate().subscribe(update => {\n      if (update.editMode === EditModes.CREATE || update.editMode === EditModes.CREATE_OR_EDIT) {\n        this.handleCreateUpdates(update);\n      } else if (update.editMode === EditModes.EDIT) {\n        this.handleEditUpdates(update);\n      }\n    });\n  }\n\n  getLabelId(element: any, index: number): string {\n    return index.toString();\n  }\n\n  renderEditLabels(ellipse: EditableEllipse, update: EllipseEditUpdate, labels?: LabelProps[]) {\n    update.center = ellipse.getCenter();\n    update.majorRadius = ellipse.getMajorRadius();\n    update.minorRadius = ellipse.getMinorRadius();\n    update.rotation = ellipse.getRotation();\n\n    if (labels) {\n      ellipse.labels = labels;\n      this.editEllipsesLayer.update(ellipse, ellipse.getId());\n      return;\n    }\n\n    if (!this.editLabelsRenderFn) {\n      return;\n    }\n\n    ellipse.labels = this.editLabelsRenderFn(update, ellipse.labels);\n    this.editEllipsesLayer.update(ellipse, ellipse.getId());\n  }\n\n  removeEditLabels(ellipse: EditableEllipse) {\n    ellipse.labels = [];\n    this.editEllipsesLayer.update(ellipse, ellipse.getId());\n  }\n\n  handleCreateUpdates(update: EllipseEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.ellipsesManager.createEditableEllipse(\n          update.id,\n          this.editEllipsesLayer,\n          this.editPointsLayer,\n          this.coordinateConverter,\n          update.ellipseOptions,\n        );\n        break;\n      }\n      case EditActions.MOUSE_MOVE: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (update.updatedPosition) {\n          ellipse.movePoint(update.updatedPosition, ellipse.majorRadiusPoint);\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.ADD_POINT: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (update.center) {\n          ellipse.addPoint(update.center);\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.ADD_LAST_POINT: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (update.updatedPosition) {\n          ellipse.addLastPoint(update.updatedPosition);\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.DISPOSE: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        this.removeEditLabels(ellipse);\n        this.ellipsesManager.dispose(update.id);\n        break;\n      }\n      case EditActions.SET_EDIT_LABELS_RENDER_CALLBACK: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        this.editLabelsRenderFn = update.labelsRenderFn;\n        this.renderEditLabels(ellipse, update);\n        break;\n      }\n      case EditActions.UPDATE_EDIT_LABELS: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        this.renderEditLabels(ellipse, update, update.updateLabels);\n        break;\n      }\n      case EditActions.SET_MANUALLY: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        this.renderEditLabels(ellipse, update, update.updateLabels);\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  handleEditUpdates(update: EllipseEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        const ellipse = this.ellipsesManager.createEditableEllipse(\n          update.id,\n          this.editEllipsesLayer,\n          this.editPointsLayer,\n          this.coordinateConverter,\n          update.ellipseOptions,\n        );\n        ellipse.setManually(\n          update.center,\n          update.majorRadius,\n          update.rotation,\n          update.minorRadius,\n          (update.ellipseOptions && update.ellipseOptions.pointProps) || undefined,\n          (update.ellipseOptions && update.ellipseOptions.pointProps) || undefined,\n          (update.ellipseOptions && update.ellipseOptions.ellipseProps) || undefined,\n        );\n        this.renderEditLabels(ellipse, update);\n        break;\n      }\n      case EditActions.DRAG_POINT_FINISH:\n      case EditActions.DRAG_POINT: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse && ellipse.enableEdit) {\n          ellipse.movePoint(update.endDragPosition, update.updatedPoint);\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse && ellipse.enableEdit) {\n          ellipse.moveEllipse(update.startDragPosition, update.endDragPosition);\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE_FINISH: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse && ellipse.enableEdit) {\n          ellipse.endMoveEllipse();\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.TRANSFORM: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse && ellipse.enableEdit) {\n          ellipse.transformToEllipse();\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.DISABLE: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse) {\n          ellipse.enableEdit = false;\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      case EditActions.ENABLE: {\n        const ellipse = this.ellipsesManager.get(update.id);\n        if (ellipse) {\n          ellipse.enableEdit = true;\n          this.renderEditLabels(ellipse, update);\n        }\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.ellipsesManager.clear();\n  }\n\n  getPointSize(point: EditPoint) {\n    return point.isVirtualEditPoint() ? point.props.virtualPointPixelSize : point.props.pixelSize;\n  }\n\n  getPointShow(point: EditPoint) {\n    return point.show && (point.isVirtualEditPoint() ? point.props.showVirtual : point.props.show);\n  }\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { EditPoint } from './edit-point';\nimport { EditPolyline } from './edit-polyline';\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { PointProps, PolylineEditOptions, PolylineProps } from './polyline-edit-options';\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { defaultLabelProps, LabelProps } from './label-props';\n\nexport class EditablePolyline extends AcEntity {\n  private positions: EditPoint[] = [];\n\n  private polylines: EditPolyline[] = [];\n  private movingPoint: EditPoint;\n  private doneCreation = false;\n  private _enableEdit = true;\n  private _pointProps: PointProps;\n  private polylineProps: PolylineProps;\n  private lastDraggedToPosition: any;\n  private _labels: LabelProps[] = [];\n\n  constructor(private id: string,\n              private pointsLayer: AcLayerComponent,\n              private polylinesLayer: AcLayerComponent,\n              private coordinateConverter: CoordinateConverter,\n              private editOptions: PolylineEditOptions,\n              positions?: Cartesian3[]) {\n    super();\n    this._pointProps = editOptions.pointProps;\n    this.props = editOptions.polylineProps;\n    if (positions && positions.length >= 2) {\n      this.createFromExisting(positions);\n    }\n  }\n\n  get labels(): LabelProps[] {\n    return this._labels;\n  }\n\n  set labels(labels: LabelProps[]) {\n    if (!labels) {\n      return;\n    }\n    const positions = this.getRealPositions();\n    this._labels = labels.map((label, index) => {\n      if (!label.position) {\n        label.position = positions[index];\n      }\n\n      return Object.assign({}, defaultLabelProps, label);\n    });\n  }\n\n  get props(): PolylineProps {\n    return this.polylineProps;\n  }\n\n  set props(value: PolylineProps) {\n    this.polylineProps = value;\n  }\n\n  get pointProps(): PointProps {\n    return this._pointProps;\n  }\n\n  set pointProps(value: PointProps) {\n    this._pointProps = value;\n  }\n\n  get enableEdit() {\n    return this._enableEdit;\n  }\n\n  set enableEdit(value: boolean) {\n    this._enableEdit = value;\n    this.positions.forEach(point => {\n      point.show = value;\n      this.updatePointsLayer(false, point);\n    });\n  }\n\n  private createFromExisting(positions: Cartesian3[]) {\n    positions.forEach((position) => {\n      this.addPointFromExisting(position);\n    });\n    this.addAllVirtualEditPoints();\n    this.doneCreation = true;\n  }\n\n  setManually(points: {\n    position: Cartesian3,\n    pointProp?: PointProps\n  }[] | Cartesian3[], polylineProps?: PolylineProps) {\n    if (!this.doneCreation) {\n      throw new Error('Update manually only in edit mode, after polyline is created');\n    }\n    this.positions.forEach(p => this.pointsLayer.remove(p.getId()));\n\n    const newPoints: EditPoint[] = [];\n    for (let i = 0; i < points.length; i++) {\n      const pointOrCartesian: any = points[i];\n      let newPoint = null;\n      if (pointOrCartesian.pointProps) {\n        newPoint = new EditPoint(this.id, pointOrCartesian.position, pointOrCartesian.pointProps);\n      } else {\n        newPoint = new EditPoint(this.id, pointOrCartesian, this._pointProps);\n      }\n      newPoints.push(newPoint);\n    }\n    this.positions = newPoints;\n    this.polylineProps = polylineProps ? polylineProps : this.polylineProps;\n\n    this.updatePointsLayer(true, ...this.positions);\n    this.addAllVirtualEditPoints();\n  }\n\n  private addAllVirtualEditPoints() {\n    const currentPoints = [...this.positions];\n    currentPoints.forEach((pos, index) => {\n      if (index !== currentPoints.length - 1) {\n        const currentPoint = pos;\n        const nextIndex = (index + 1) % (currentPoints.length);\n        const nextPoint = currentPoints[nextIndex];\n\n        const midPoint = this.setMiddleVirtualPoint(currentPoint, nextPoint);\n\n        this.updatePointsLayer(false, midPoint);\n      }\n    });\n  }\n\n  private setMiddleVirtualPoint(firstP: EditPoint, secondP: EditPoint): EditPoint {\n    const currentCart = Cesium.Cartographic.fromCartesian(firstP.getPosition());\n    const nextCart = Cesium.Cartographic.fromCartesian(secondP.getPosition());\n    const midPointCartesian3 = this.coordinateConverter.midPointToCartesian3(currentCart, nextCart);\n    const midPoint = new EditPoint(this.id, midPointCartesian3, this._pointProps);\n    midPoint.setVirtualEditPoint(true);\n\n    const firstIndex = this.positions.indexOf(firstP);\n    this.positions.splice(firstIndex + 1, 0, midPoint);\n    return midPoint;\n  }\n\n  private updateMiddleVirtualPoint(virtualEditPoint: EditPoint, prevPoint: EditPoint, nextPoint: EditPoint) {\n    const prevPointCart = Cesium.Cartographic.fromCartesian(prevPoint.getPosition());\n    const nextPointCart = Cesium.Cartographic.fromCartesian(nextPoint.getPosition());\n    virtualEditPoint.setPosition(this.coordinateConverter.midPointToCartesian3(prevPointCart, nextPointCart));\n  }\n\n  changeVirtualPointToRealPoint(point: EditPoint) {\n    point.setVirtualEditPoint(false); // actual point becomes a real point\n    const pointsCount = this.positions.length;\n    const pointIndex = this.positions.indexOf(point);\n    const nextIndex = (pointIndex + 1) % (pointsCount);\n    const preIndex = ((pointIndex - 1) + pointsCount) % pointsCount;\n\n    const nextPoint = this.positions[nextIndex];\n    const prePoint = this.positions[preIndex];\n\n    const firstMidPoint = this.setMiddleVirtualPoint(prePoint, point);\n    const secMidPoint = this.setMiddleVirtualPoint(point, nextPoint);\n    this.updatePointsLayer(false, firstMidPoint, secMidPoint, point);\n\n  }\n\n  private renderPolylines() {\n    this.polylines.forEach(polyline => this.polylinesLayer.remove(polyline.getId()));\n    this.polylines = [];\n    const realPoints = this.positions.filter(point => !point.isVirtualEditPoint());\n    realPoints.forEach((point, index) => {\n      if (index !== realPoints.length - 1) {\n        const nextIndex = (index + 1);\n        const nextPoint = realPoints[nextIndex];\n        const polyline = new EditPolyline(this.id, point.getPosition(), nextPoint.getPosition(), this.polylineProps);\n        this.polylines.push(polyline);\n        this.polylinesLayer.update(polyline, polyline.getId());\n      }\n    });\n  }\n\n  addPointFromExisting(position: Cartesian3) {\n    const newPoint = new EditPoint(this.id, position, this._pointProps);\n    this.positions.push(newPoint);\n    this.updatePointsLayer(true, newPoint);\n  }\n\n\n  addPoint(position: Cartesian3) {\n    if (this.doneCreation) {\n      return;\n    }\n    const isFirstPoint = !this.positions.length;\n    if (isFirstPoint) {\n      const firstPoint = new EditPoint(this.id, position, this._pointProps);\n      this.positions.push(firstPoint);\n      this.updatePointsLayer(true, firstPoint);\n    }\n\n    this.movingPoint = new EditPoint(this.id, position.clone(), this._pointProps);\n    this.positions.push(this.movingPoint);\n\n    this.updatePointsLayer(true, this.movingPoint);\n  }\n\n  movePoint(toPosition: Cartesian3, editPoint: EditPoint) {\n    editPoint.setPosition(toPosition);\n    if (this.doneCreation) {\n      if (editPoint.isVirtualEditPoint()) {\n        this.changeVirtualPointToRealPoint(editPoint);\n      }\n      const pointsCount = this.positions.length;\n      const pointIndex = this.positions.indexOf(editPoint);\n\n      if (pointIndex < this.positions.length - 1) {\n        const nextVirtualPoint = this.positions[(pointIndex + 1) % (pointsCount)];\n        const nextRealPoint = this.positions[(pointIndex + 2) % (pointsCount)];\n        this.updateMiddleVirtualPoint(nextVirtualPoint, editPoint, nextRealPoint);\n        this.updatePointsLayer(false, nextVirtualPoint);\n      }\n      if (pointIndex > 0) {\n        const prevVirtualPoint = this.positions[((pointIndex - 1) + pointsCount) % pointsCount];\n        const prevRealPoint = this.positions[((pointIndex - 2) + pointsCount) % pointsCount];\n        this.updateMiddleVirtualPoint(prevVirtualPoint, editPoint, prevRealPoint);\n        this.updatePointsLayer(false, prevVirtualPoint);\n      }\n    }\n    this.updatePointsLayer(true, editPoint);\n  }\n\n  moveTempMovingPoint(toPosition: Cartesian3) {\n    if (this.movingPoint) {\n      this.movePoint(toPosition, this.movingPoint);\n    }\n  }\n\n  moveShape(startMovingPosition: Cartesian3, draggedToPosition: Cartesian3) {\n    if (!this.doneCreation) {\n      return;\n    }\n    if (!this.lastDraggedToPosition) {\n      this.lastDraggedToPosition = startMovingPosition;\n    }\n\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, draggedToPosition);\n    this.positions.forEach(point => {\n      GeoUtilsService.addDeltaToPosition(point.getPosition(), delta, true);\n    });\n    this.updatePointsLayer(true, ...this.positions);\n    this.lastDraggedToPosition = draggedToPosition;\n  }\n\n  endMoveShape() {\n    this.lastDraggedToPosition = undefined;\n    this.updatePointsLayer(true, ...this.positions);\n  }\n\n  removePoint(pointToRemove: EditPoint) {\n    this.removePosition(pointToRemove);\n    this.positions\n      .filter(p => p.isVirtualEditPoint())\n      .forEach(p => this.removePosition(p));\n    this.addAllVirtualEditPoints();\n\n    this.renderPolylines();\n  }\n\n  addLastPoint(position: Cartesian3) {\n    this.doneCreation = true;\n    this.removePosition(this.movingPoint); // remove movingPoint\n    this.movingPoint = null;\n\n    this.addAllVirtualEditPoints();\n  }\n\n  getRealPositions(): Cartesian3[] {\n    return this.getRealPoints()\n      .map(position => position.getPosition());\n  }\n\n  getRealPoints(): EditPoint[] {\n    return this.positions\n      .filter(position => !position.isVirtualEditPoint() && position !== this.movingPoint);\n  }\n\n  getPositions(): Cartesian3[] {\n    return this.positions.map(position => position.getPosition());\n  }\n\n  private removePosition(point: EditPoint) {\n    const index = this.positions.findIndex((p) => p === point);\n    if (index < 0) {\n      return;\n    }\n    this.positions.splice(index, 1);\n    this.pointsLayer.remove(point.getId());\n  }\n\n  private updatePointsLayer(renderPolylines = true, ...point: EditPoint[]) {\n    if (renderPolylines) {\n      this.renderPolylines();\n    }\n    point.forEach(p => this.pointsLayer.update(p, p.getId()));\n  }\n\n  update() {\n    this.updatePointsLayer();\n  }\n\n  dispose() {\n    this.positions.forEach(editPoint => {\n      this.pointsLayer.remove(editPoint.getId());\n    });\n    this.polylines.forEach(line => this.polylinesLayer.remove(line.getId()));\n    if (this.movingPoint) {\n      this.pointsLayer.remove(this.movingPoint.getId());\n      this.movingPoint = undefined;\n    }\n    this.positions.length = 0;\n  }\n\n  getPointsCount(): number {\n    return this.positions.length;\n  }\n\n  getId() {\n    return this.id;\n  }\n}\n","import { Observable } from 'rxjs';\nimport { LabelProps } from './label-props';\n\nexport class EditorObservable<T> extends Observable<T> {\n  dispose: Function;\n  enable: Function;\n  disable: Function;\n  getLabels: () => LabelProps[];\n  getEditValue: () => T;\n  setLabelsRenderFn: (func: (update: T, labels: LabelProps[]) => LabelProps[]) => void;\n  updateLabels: (labels: LabelProps[]) => void;\n}\n","import { EditPoint } from './edit-point';\nimport { EditorObservable } from './editor-observable';\nimport { PolylineEditUpdate } from './polyline-edit-update';\nimport { PointProps, PolylineProps } from './polyline-edit-options';\nimport { Cartesian3 } from '../../angular-cesium';\n\nexport class PolylineEditorObservable extends EditorObservable<PolylineEditUpdate> {\n  setManually: (points: { position: Cartesian3, pointProp?: PointProps }[] | Cartesian3[], polylineProps?: PolylineProps) => void;\n  getCurrentPoints: () => EditPoint[];\n}\n","import { EditPoint } from './edit-point';\nimport { EditorObservable } from './editor-observable';\nimport { PolygonEditUpdate } from './polygon-edit-update';\nimport { PointProps } from './polyline-edit-options';\nimport { PolygonProps } from './polygon-edit-options';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\n\n\nexport class PolygonEditorObservable extends EditorObservable<PolygonEditUpdate> {\n  setManually: (points: { position: Cartesian3, pointProp?: PointProps }[] | Cartesian3[],\n                polygonProps?: PolygonProps) => void;\n  getCurrentPoints: () => EditPoint[];\n}\n","import { EditorObservable } from './editor-observable';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { CircleEditUpdate } from './circle-edit-update';\nimport { PointProps } from './polyline-edit-options';\nimport { EllipseProps } from './ellipse-edit-options';\n\nexport class CircleEditorObservable extends EditorObservable<CircleEditUpdate> {\n  setManually: (center: Cartesian3, radius: number, centerPointProp?: PointProps,\n                radiusPointProp?: PointProps, circleProp?: EllipseProps) => void;\n  getCenter: () => Cartesian3;\n  getRadius: () => number; // meters\n}\n","import { EditorObservable } from './editor-observable';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { EllipseEditUpdate } from './ellipse-edit-update';\nimport { PointProps } from './polyline-edit-options';\nimport { EllipseProps } from './ellipse-edit-options';\n\nexport class EllipseEditorObservable extends EditorObservable<EllipseEditUpdate> {\n  setManually: (\n    center: Cartesian3,\n    majorRadius: number,\n    rotation?: number,\n    minorRadius?: number,\n    centerPointProp?: PointProps,\n    radiusPointProp?: PointProps,\n    ellipseProp?: EllipseProps,\n  ) => void;\n  getCenter: () => Cartesian3;\n  getMinorRadius: () => number; // meters\n  getMajorRadius: () => number; // meters\n}\n","import { EditPoint } from './edit-point';\nimport { EditorObservable } from './editor-observable';\nimport { PolygonEditUpdate } from './polygon-edit-update';\nimport { PointProps } from './polyline-edit-options';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\n\nexport class HippodromeEditorObservable extends EditorObservable<PolygonEditUpdate> {\n  setManually: (firstPosition: Cartesian3,\n                secondPosition: Cartesian3,\n                widthMeters?: number,\n                firstPointProp?: PointProps,\n                secondPointProp?: PointProps) => void;\n  getCurrentPoints: () => EditPoint[];\n  getCurrentWidth: () => number; // meters\n}\n","import { AcEntity } from '../../angular-cesium/models/ac-entity';\nimport { EditPoint } from './edit-point';\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { PointProps } from './polyline-edit-options';\nimport { HippodromeEditOptions, HippodromeProps } from './hippodrome-edit-options';\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\nimport { defaultLabelProps, LabelProps } from './label-props';\n\nexport class EditableHippodrome extends AcEntity {\n  private positions: EditPoint[] = [];\n  private movingPoint: EditPoint;\n  private done = false;\n  private _enableEdit = true;\n  private _defaultPointProps: PointProps;\n  private _hippodromeProps: HippodromeProps;\n  private lastDraggedToPosition: Cartesian3;\n  private _labels: LabelProps[] = [];\n\n  constructor(\n    private id: string,\n    private pointsLayer: AcLayerComponent,\n    private hippodromeLayer: AcLayerComponent,\n    private coordinateConverter: CoordinateConverter,\n    editOptions: HippodromeEditOptions,\n    positions?: Cartesian3[],\n  ) {\n    super();\n    this.defaultPointProps = editOptions.pointProps;\n    this.hippodromeProps = editOptions.hippodromeProps;\n    if (positions && positions.length === 2) {\n      this.createFromExisting(positions);\n    } else if (positions) {\n      throw new Error('Hippodrome consist of 2 points but provided ' + positions.length);\n    }\n  }\n\n  get labels(): LabelProps[] {\n    return this._labels;\n  }\n\n  set labels(labels: LabelProps[]) {\n    if (!labels) {\n      return;\n    }\n    const positions = this.getRealPositions();\n    this._labels = labels.map((label, index) => {\n      if (!label.position) {\n        label.position = positions[index];\n      }\n\n      return Object.assign({}, defaultLabelProps, label);\n    });\n  }\n\n  get hippodromeProps(): HippodromeProps {\n    return this._hippodromeProps;\n  }\n\n  set hippodromeProps(value: HippodromeProps) {\n    this._hippodromeProps = value;\n  }\n\n  get defaultPointProps(): PointProps {\n    return this._defaultPointProps;\n  }\n\n  set defaultPointProps(value: PointProps) {\n    this._defaultPointProps = value;\n  }\n\n  get enableEdit() {\n    return this._enableEdit;\n  }\n\n  set enableEdit(value: boolean) {\n    this._enableEdit = value;\n    this.positions.forEach(point => {\n      point.show = value;\n      this.updatePointsLayer(point);\n    });\n  }\n\n  private createFromExisting(positions: Cartesian3[]) {\n    positions.forEach(position => {\n      this.addPointFromExisting(position);\n    });\n    this.createHeightEditPoints();\n    this.updateHippdromeLayer();\n    this.updatePointsLayer(...this.positions);\n    this.done = true;\n  }\n\n  setPointsManually(points: EditPoint[], widthMeters?: number) {\n    if (!this.done) {\n      throw new Error('Update manually only in edit mode, after polyline is created');\n    }\n    this.hippodromeProps.width = widthMeters ? widthMeters : this.hippodromeProps.width;\n    this.positions.forEach(p => this.pointsLayer.remove(p.getId()));\n    this.positions = points;\n    this.createHeightEditPoints();\n    this.updatePointsLayer(...points);\n    this.updateHippdromeLayer();\n  }\n\n  addPointFromExisting(position: Cartesian3) {\n    const newPoint = new EditPoint(this.id, position, this.defaultPointProps);\n    this.positions.push(newPoint);\n    this.updatePointsLayer(newPoint);\n  }\n\n  addPoint(position: Cartesian3) {\n    if (this.done) {\n      return;\n    }\n    const isFirstPoint = !this.positions.length;\n    if (isFirstPoint) {\n      const firstPoint = new EditPoint(this.id, position, this.defaultPointProps);\n      this.positions.push(firstPoint);\n      this.movingPoint = new EditPoint(this.id, position.clone(), this.defaultPointProps);\n      this.positions.push(this.movingPoint);\n      this.updatePointsLayer(firstPoint);\n    } else {\n      this.createHeightEditPoints();\n\n      this.updatePointsLayer(...this.positions);\n      this.updateHippdromeLayer();\n      this.done = true;\n      this.movingPoint = null;\n    }\n  }\n\n  private createHeightEditPoints() {\n    this.positions.filter(p => p.isVirtualEditPoint()).forEach(p => this.removePosition(p));\n\n    const firstP = this.getRealPoints()[0];\n    const secP = this.getRealPoints()[1];\n\n    const midPointCartesian3 = Cesium.Cartesian3.lerp(firstP.getPosition(), secP.getPosition(), 0.5, new Cesium.Cartesian3());\n    const bearingDeg = this.coordinateConverter.bearingToCartesian(firstP.getPosition(), secP.getPosition());\n\n    const upAzimuth = Cesium.Math.toRadians(bearingDeg) - Math.PI / 2;\n    this.createMiddleEditablePoint(midPointCartesian3, upAzimuth);\n    const downAzimuth = Cesium.Math.toRadians(bearingDeg) + Math.PI / 2;\n    this.createMiddleEditablePoint(midPointCartesian3, downAzimuth);\n  }\n\n  private createMiddleEditablePoint(midPointCartesian3: any, azimuth: number) {\n    const upEditCartesian3 = GeoUtilsService.pointByLocationDistanceAndAzimuth(\n      midPointCartesian3,\n      this.hippodromeProps.width / 2,\n      azimuth,\n      true,\n    );\n    const midPoint = new EditPoint(this.id, upEditCartesian3, this.defaultPointProps);\n    midPoint.setVirtualEditPoint(true);\n    this.positions.push(midPoint);\n  }\n\n  movePoint(toPosition: Cartesian3, editPoint: EditPoint) {\n    if (!editPoint.isVirtualEditPoint()) {\n      editPoint.setPosition(toPosition);\n      this.createHeightEditPoints();\n      this.updatePointsLayer(...this.positions);\n      this.updateHippdromeLayer();\n    } else {\n      this.changeWidthByNewPoint(toPosition);\n    }\n  }\n\n  private changeWidthByNewPoint(toPosition: Cartesian3) {\n    const firstP = this.getRealPoints()[0];\n    const secP = this.getRealPoints()[1];\n    const midPointCartesian3 = Cesium.Cartesian3.lerp(firstP.getPosition(), secP.getPosition(), 0.5, new Cesium.Cartesian3());\n\n    const bearingDeg = this.coordinateConverter.bearingToCartesian(midPointCartesian3, toPosition);\n    let normalizedBearingDeb = bearingDeg;\n    if (bearingDeg > 270) {\n      normalizedBearingDeb = bearingDeg - 270;\n    } else if (bearingDeg > 180) {\n      normalizedBearingDeb = bearingDeg - 180;\n    }\n    let bearingDegHippodromeDots = this.coordinateConverter.bearingToCartesian(firstP.getPosition(), secP.getPosition());\n    if (bearingDegHippodromeDots > 180) {\n      bearingDegHippodromeDots = this.coordinateConverter.bearingToCartesian(secP.getPosition(), firstP.getPosition());\n    }\n    let fixedBearingDeg =\n      bearingDegHippodromeDots > normalizedBearingDeb\n        ? bearingDegHippodromeDots - normalizedBearingDeb\n        : normalizedBearingDeb - bearingDegHippodromeDots;\n\n    if (bearingDeg > 270) {\n      fixedBearingDeg = bearingDeg - bearingDegHippodromeDots;\n    }\n\n    const distanceMeters = Math.abs(GeoUtilsService.distance(midPointCartesian3, toPosition));\n    const radiusWidth = Math.sin(Cesium.Math.toRadians(fixedBearingDeg)) * distanceMeters;\n\n    this.hippodromeProps.width = Math.abs(radiusWidth) * 2;\n    this.createHeightEditPoints();\n    this.updatePointsLayer(...this.positions);\n    this.updateHippdromeLayer();\n  }\n\n  moveShape(startMovingPosition: Cartesian3, draggedToPosition: Cartesian3) {\n    if (!this.lastDraggedToPosition) {\n      this.lastDraggedToPosition = startMovingPosition;\n    }\n\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, draggedToPosition);\n    this.getRealPoints().forEach(point => {\n      GeoUtilsService.addDeltaToPosition(point.getPosition(), delta, true);\n    });\n    this.createHeightEditPoints();\n    this.updatePointsLayer(...this.positions);\n    this.updateHippdromeLayer();\n    this.lastDraggedToPosition = draggedToPosition;\n  }\n\n  endMoveShape() {\n    this.lastDraggedToPosition = undefined;\n    this.createHeightEditPoints();\n    this.positions.forEach(point => this.updatePointsLayer(point));\n    this.updateHippdromeLayer();\n  }\n\n  endMovePoint() {\n    this.createHeightEditPoints();\n    this.updatePointsLayer(...this.positions);\n  }\n\n  moveTempMovingPoint(toPosition: Cartesian3) {\n    if (this.movingPoint) {\n      this.movePoint(toPosition, this.movingPoint);\n    }\n  }\n\n  removePoint(pointToRemove: EditPoint) {\n    this.removePosition(pointToRemove);\n    this.positions.filter(p => p.isVirtualEditPoint()).forEach(p => this.removePosition(p));\n  }\n\n  addLastPoint(position: Cartesian3) {\n    this.done = true;\n    this.removePosition(this.movingPoint); // remove movingPoint\n    this.movingPoint = null;\n  }\n\n  getRealPositions(): Cartesian3[] {\n    return this.getRealPoints().map(position => position.getPosition());\n  }\n\n  getRealPositionsCallbackProperty() {\n    return new Cesium.CallbackProperty(this.getRealPositions.bind(this), false);\n  }\n\n  getRealPoints(): EditPoint[] {\n    return this.positions.filter(position => !position.isVirtualEditPoint());\n  }\n\n  getWidth(): number {\n    return this.hippodromeProps.width;\n  }\n\n  getPositions(): Cartesian3[] {\n    return this.positions.map(position => position.getPosition());\n  }\n\n  private removePosition(point: EditPoint) {\n    const index = this.positions.findIndex(p => p === point);\n    if (index < 0) {\n      return;\n    }\n    this.positions.splice(index, 1);\n    this.pointsLayer.remove(point.getId());\n  }\n\n  private updatePointsLayer(...point: EditPoint[]) {\n    point.forEach(p => this.pointsLayer.update(p, p.getId()));\n  }\n\n  private updateHippdromeLayer() {\n    this.hippodromeLayer.update(this, this.id);\n  }\n\n  dispose() {\n    this.hippodromeLayer.remove(this.id);\n\n    this.positions.forEach(editPoint => {\n      this.pointsLayer.remove(editPoint.getId());\n    });\n    if (this.movingPoint) {\n      this.pointsLayer.remove(this.movingPoint.getId());\n      this.movingPoint = undefined;\n    }\n    this.positions.length = 0;\n  }\n\n  getPointsCount(): number {\n    return this.positions.length;\n  }\n\n  getId() {\n    return this.id;\n  }\n}\n","import { publish, tap } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { MapEventsManagerService } from '../../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { CesiumEvent } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../../../../angular-cesium/services/map-events-mananger/consts/pickOptions.enum';\nimport { EditModes } from '../../../models/edit-mode.enum';\nimport { EditActions } from '../../../models/edit-actions.enum';\nimport { DisposableObservable } from '../../../../angular-cesium/services/map-events-mananger/disposable-observable';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { EditPoint } from '../../../models/edit-point';\nimport { CameraService } from '../../../../angular-cesium/services/camera/camera.service';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { PolylinesManagerService } from './polylines-manager.service';\nimport { PointProps, PolylineEditOptions, PolylineProps } from '../../../models/polyline-edit-options';\nimport { PolylineEditUpdate } from '../../../models/polyline-edit-update';\nimport { PolylineEditorObservable } from '../../../models/polyline-editor-observable';\nimport { EditPolyline } from '../../../models';\nimport { LabelProps } from '../../../models/label-props';\nimport { generateKey } from '../../utils';\n\nexport const DEFAULT_POLYLINE_OPTIONS: PolylineEditOptions = {\n  addPointEvent: CesiumEvent.LEFT_CLICK,\n  addLastPointEvent: CesiumEvent.LEFT_DOUBLE_CLICK,\n  removePointEvent: CesiumEvent.RIGHT_CLICK,\n  dragPointEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  dragShapeEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  allowDrag: true,\n  pointProps: {\n    color: Cesium.Color.WHITE.withAlpha(0.9),\n    outlineColor: Cesium.Color.BLACK,\n    outlineWidth: 1,\n    pixelSize: 15,\n    virtualPointPixelSize: 8,\n    show: true,\n    showVirtual: true,\n  },\n  polylineProps: {\n    material: () => Cesium.Color.BLACK,\n    width: 3,\n  },\n};\n\n/**\n * Service for creating editable polylines\n *\n *  * You must provide `PolylineEditorService` yourself.\n * PolygonsEditorService works together with `<polylines-editor>` component. Therefor you need to create `<polylines-editor>`\n * for each `PolylineEditorService`, And of course somewhere under `<ac-map>`/\n *\n * + `create` for starting a creation of the shape over the map. Returns a extension of `PolylineEditorObservable`.\n * + `edit` for editing shape over the map starting from a given positions. Returns an extension of `PolylineEditorObservable`.\n * + To stop editing call `dsipose()` from the `PolylineEditorObservable` you get back from `create()` \\ `edit()`.\n *\n * **Labels over editted shapes**\n * Angular Cesium allows you to draw labels over a shape that is being edited with one of the editors.\n * To add label drawing logic to your editor use the function `setLabelsRenderFn()` that is defined on the\n * `PolylineEditorObservable` that is returned from calling `create()` \\ `edit()` of one of the editor services.\n * `setLabelsRenderFn()` - receives a callback that is called every time the shape is redrawn\n * (except when the shape is being dragged). The callback is called with the last shape state and with an array of the current labels.\n * The callback should return type `LabelProps[]`.\n * You can also use `updateLabels()` to pass an array of labels of type `LabelProps[]` to be drawn.\n *\n * usage:\n * ```typescript\n *  // Start creating polyline\n *  const editing$ = polylinesEditorService.create();\n *  this.editing$.subscribe(editResult => {\n *\t\t\t\tconsole.log(editResult.positions);\n *\t\t});\n *\n *  // Or edit polyline from existing polyline cartesian3 positions\n *  const editing$ = this.polylinesEditor.edit(initialPos);\n *\n * ```\n */\n@Injectable()\nexport class PolylinesEditorService {\n  private mapEventsManager: MapEventsManagerService;\n  private updateSubject = new Subject<PolylineEditUpdate>();\n  private updatePublisher = publish<PolylineEditUpdate>()(this.updateSubject); // TODO maybe not needed\n  private coordinateConverter: CoordinateConverter;\n  private cameraService: CameraService;\n  private polylinesManager: PolylinesManagerService;\n  private observablesMap = new Map<string, DisposableObservable<any>[]>();\n\n  init(mapEventsManager: MapEventsManagerService,\n       coordinateConverter: CoordinateConverter,\n       cameraService: CameraService,\n       polylinesManager: PolylinesManagerService) {\n    this.mapEventsManager = mapEventsManager;\n    this.coordinateConverter = coordinateConverter;\n    this.cameraService = cameraService;\n    this.polylinesManager = polylinesManager;\n    this.updatePublisher.connect();\n  }\n\n  onUpdate(): Observable<PolylineEditUpdate> {\n    return this.updatePublisher;\n  }\n\n  create(options = DEFAULT_POLYLINE_OPTIONS, eventPriority = 100): PolylineEditorObservable {\n    const positions: Cartesian3[] = [];\n    const id = generateKey();\n    const polylineOptions = this.setOptions(options);\n\n    const clientEditSubject = new BehaviorSubject<PolylineEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.CREATE\n    });\n    let finishedCreate = false;\n\n    this.updateSubject.next({\n      id,\n      positions,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.INIT,\n      polylineOptions: polylineOptions,\n    });\n\n    const mouseMoveRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.MOUSE_MOVE,\n      pick: PickOptions.NO_PICK,\n      priority: eventPriority,\n    });\n    const addPointRegistration = this.mapEventsManager.register({\n      event: polylineOptions.addPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority: eventPriority,\n    });\n    const addLastPointRegistration = this.mapEventsManager.register({\n      event: polylineOptions.addLastPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority: eventPriority,\n    });\n\n    this.observablesMap.set(id, [mouseMoveRegistration, addPointRegistration, addLastPointRegistration]);\n    const editorObservable = this.createEditorObservable(clientEditSubject, id);\n\n    mouseMoveRegistration.subscribe(({movement: {endPosition}}) => {\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (position) {\n        this.updateSubject.next({\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.CREATE,\n          updatedPosition: position,\n          editAction: EditActions.MOUSE_MOVE,\n        });\n      }\n    });\n\n    addPointRegistration.subscribe(({movement: {endPosition}}) => {\n      if (finishedCreate) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n      const allPositions = this.getPositions(id);\n      if (allPositions.find((cartesian) => cartesian.equals(position))) {\n        return;\n      }\n      const updateValue = {\n        id,\n        positions: allPositions,\n        editMode: EditModes.CREATE,\n        updatedPosition: position,\n        editAction: EditActions.ADD_POINT,\n      };\n      this.updateSubject.next(updateValue);\n      clientEditSubject.next({\n        ...updateValue,\n        positions: this.getPositions(id),\n        points: this.getPoints(id),\n      });\n      if (polylineOptions.maximumNumberOfPoints && allPositions.length + 1 === polylineOptions.maximumNumberOfPoints) {\n        finishedCreate = this.switchToEditMode(\n          id,\n          position,\n          clientEditSubject,\n          positions,\n          eventPriority,\n          polylineOptions,\n          editorObservable,\n          finishedCreate);\n      }\n    });\n\n    addLastPointRegistration.subscribe(({movement: {endPosition}}) => {\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n      // position already added by addPointRegistration\n      finishedCreate = this.switchToEditMode(\n        id,\n        position,\n        clientEditSubject,\n        positions,\n        eventPriority,\n        polylineOptions,\n        editorObservable,\n        finishedCreate);\n    });\n\n    return editorObservable;\n  }\n\n  private switchToEditMode(id,\n                           position,\n                           clientEditSubject,\n                           positions: Cartesian3[],\n                           eventPriority,\n                           polylineOptions,\n                           editorObservable,\n                           finishedCreate: boolean) {\n    const update = {\n      id,\n      positions: this.getPositions(id),\n      editMode: EditModes.CREATE,\n      updatedPosition: position,\n      editAction: EditActions.ADD_LAST_POINT,\n    };\n    this.updateSubject.next(update);\n    clientEditSubject.next({\n      ...update,\n      positions: this.getPositions(id),\n      points: this.getPoints(id),\n    });\n\n    const changeMode = {\n      id,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.CHANGE_TO_EDIT,\n    };\n    this.updateSubject.next(changeMode);\n    clientEditSubject.next(changeMode);\n    if (this.observablesMap.has(id)) {\n      this.observablesMap.get(id).forEach(registration => registration.dispose());\n    }\n    this.observablesMap.delete(id);\n    this.editPolyline(id, positions, eventPriority, clientEditSubject, polylineOptions, editorObservable);\n    finishedCreate = true;\n    return finishedCreate;\n  }\n\n  edit(positions: Cartesian3[], options = DEFAULT_POLYLINE_OPTIONS, priority = 100): PolylineEditorObservable {\n    if (positions.length < 2) {\n      throw new Error('Polylines editor error edit(): polyline should have at least 2 positions');\n    }\n    const id = generateKey();\n    const polylineOptions = this.setOptions(options);\n    const editSubject = new BehaviorSubject<PolylineEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.EDIT\n    });\n    const update = {\n      id,\n      positions: positions,\n      editMode: EditModes.EDIT,\n      editAction: EditActions.INIT,\n      polylineOptions: polylineOptions,\n    };\n    this.updateSubject.next(update);\n    editSubject.next({\n      ...update,\n      positions: this.getPositions(id),\n      points: this.getPoints(id),\n    });\n    return this.editPolyline(\n      id,\n      positions,\n      priority,\n      editSubject,\n      polylineOptions\n    );\n  }\n\n  private editPolyline(id: string,\n                       positions: Cartesian3[],\n                       priority: number,\n                       editSubject: Subject<PolylineEditUpdate>,\n                       options: PolylineEditOptions,\n                       editObservable?: PolylineEditorObservable) {\n\n    const pointDragRegistration = this.mapEventsManager.register({\n      event: options.dragPointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    const pointRemoveRegistration = this.mapEventsManager.register({\n      event: options.removePointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    let shapeDragRegistration;\n    if (options.allowDrag) {\n      shapeDragRegistration = this.mapEventsManager.register({\n        event: options.dragShapeEvent,\n        entityType: EditPolyline,\n        pick: PickOptions.PICK_FIRST,\n        priority,\n        pickFilter: entity => id === entity.editedEntityId,\n      });\n    }\n\n    if (shapeDragRegistration) {\n      shapeDragRegistration\n        .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n        .subscribe(({movement: {startPosition, endPosition, drop}, entities}) => {\n          const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n          const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n          if (!endDragPosition) {\n            return;\n          }\n\n          const update = {\n            id,\n            positions: this.getPositions(id),\n            editMode: EditModes.EDIT,\n            updatedPosition: endDragPosition,\n            draggedPosition: startDragPosition,\n            editAction: drop ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_SHAPE,\n          };\n          this.updateSubject.next(update);\n          editSubject.next({\n            ...update,\n            positions: this.getPositions(id),\n            points: this.getPoints(id),\n          });\n        });\n    }\n\n    pointDragRegistration.pipe(\n      tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n      .subscribe(({movement: {endPosition, drop}, entities}) => {\n        const position = this.coordinateConverter.screenToCartesian3(endPosition);\n        if (!position) {\n          return;\n        }\n        const point: EditPoint = entities[0];\n\n        const update = {\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.EDIT,\n          updatedPosition: position,\n          updatedPoint: point,\n          editAction: drop ? EditActions.DRAG_POINT_FINISH : EditActions.DRAG_POINT,\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n          positions: this.getPositions(id),\n          points: this.getPoints(id),\n        });\n      });\n\n    pointRemoveRegistration.subscribe(({entities}) => {\n      const point: EditPoint = entities[0];\n      const allPositions = [...this.getPositions(id)];\n      if (allPositions.length < 3) {\n        return;\n      }\n      const index = allPositions.findIndex(position => point.getPosition().equals(position as Cartesian3));\n      if (index < 0) {\n        return;\n      }\n\n      const update = {\n        id,\n        positions: allPositions,\n        editMode: EditModes.EDIT,\n        updatedPoint: point,\n        editAction: EditActions.REMOVE_POINT,\n      };\n      this.updateSubject.next(update);\n      editSubject.next({\n        ...update,\n        positions: this.getPositions(id),\n        points: this.getPoints(id),\n      });\n    });\n\n    const observables = [pointDragRegistration, pointRemoveRegistration];\n    if (shapeDragRegistration) {\n      observables.push(shapeDragRegistration);\n    }\n    this.observablesMap.set(id, observables);\n    return this.createEditorObservable(editSubject, id);\n  }\n\n  private setOptions(options: PolylineEditOptions) {\n    const defaultClone = JSON.parse(JSON.stringify(DEFAULT_POLYLINE_OPTIONS));\n    const polylineOptions = Object.assign(defaultClone, options);\n    polylineOptions.pointProps = Object.assign({}, DEFAULT_POLYLINE_OPTIONS.pointProps, options.pointProps);\n    polylineOptions.polylineProps = Object.assign({},\n      DEFAULT_POLYLINE_OPTIONS.polylineProps, options.polylineProps);\n    return polylineOptions;\n  }\n\n\n  private createEditorObservable(observableToExtend: any, id: string): PolylineEditorObservable {\n    observableToExtend.dispose = () => {\n      const observables = this.observablesMap.get(id);\n      if (observables) {\n        observables.forEach(obs => obs.dispose());\n      }\n      this.observablesMap.delete(id);\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.DISPOSE,\n      });\n    };\n\n    observableToExtend.enable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.ENABLE,\n      });\n    };\n\n    observableToExtend.disable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.DISABLE,\n      });\n    };\n\n    observableToExtend.setManually = (points: {\n      position: Cartesian3,\n      pointProp?: PointProps\n    }[] | Cartesian3[], polylineProps?: PolylineProps) => {\n      const polyline = this.polylinesManager.get(id);\n      polyline.setManually(points, polylineProps);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_MANUALLY,\n      });\n    };\n\n    observableToExtend.setLabelsRenderFn = (callback: any) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_EDIT_LABELS_RENDER_CALLBACK,\n        labelsRenderFn: callback,\n      });\n    };\n\n    observableToExtend.updateLabels = (labels: LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.UPDATE_EDIT_LABELS,\n        updateLabels: labels,\n      });\n    };\n    observableToExtend.getCurrentPoints = () => this.getPoints(id);\n\n    observableToExtend.getEditValue = () => observableToExtend.getValue();\n\n    observableToExtend.getLabels = (): LabelProps[] => this.polylinesManager.get(id).labels;\n\n    return observableToExtend as PolylineEditorObservable;\n  }\n\n  private getPositions(id: string) {\n    const polyline = this.polylinesManager.get(id);\n    return polyline.getRealPositions();\n  }\n\n  private getPoints(id: string) {\n    const polyline = this.polylinesManager.get(id);\n    return polyline.getRealPoints();\n  }\n}\n","import { CoordinateConverter } from './../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { AcLayerComponent } from './../../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { Injectable } from '@angular/core';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { PolygonEditOptions } from '../../../models/polygon-edit-options';\nimport { EditablePolyline } from '../../../models/editable-polyline';\n\n@Injectable()\nexport class PolylinesManagerService {\n  polylines: Map<string, EditablePolyline> = new Map<string, EditablePolyline>();\n\n  createEditablePolyline(id: string, editPolylinesLayer: AcLayerComponent, editPointsLayer: AcLayerComponent,\n                         coordinateConverter: CoordinateConverter, polylineOptions?: PolygonEditOptions, positions?: Cartesian3[]) {\n    const editablePolyline = new EditablePolyline(\n      id,\n      editPolylinesLayer,\n      editPointsLayer,\n      coordinateConverter,\n      polylineOptions,\n      positions);\n    this.polylines.set(id, editablePolyline\n    );\n  }\n\n  get(id: string): EditablePolyline {\n    return this.polylines.get(id);\n  }\n\n  clear() {\n    this.polylines.forEach(polyline => polyline.dispose());\n    this.polylines.clear();\n  }\n}\n","import { ChangeDetectionStrategy, Component, OnDestroy, ViewChild } from '@angular/core';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { AcNotification } from '../../../angular-cesium/models/ac-notification';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { AcLayerComponent } from '../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapEventsManagerService } from '../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { Subject } from 'rxjs';\nimport { CameraService } from '../../../angular-cesium/services/camera/camera.service';\nimport { EditPoint } from '../../models/edit-point';\nimport { PolylinesEditorService } from '../../services/entity-editors/polyline-editor/polylines-editor.service';\nimport { PolylinesManagerService } from '../../services/entity-editors/polyline-editor/polylines-manager.service';\nimport { PolylineEditUpdate } from '../../models/polyline-edit-update';\nimport { EditablePolyline } from '../../models/editable-polyline';\nimport { LabelProps } from '../../models/label-props';\n\n@Component({\n  selector: 'polylines-editor',\n  template: /*html*/ `\n    <ac-layer #editPolylinesLayer acFor=\"let polyline of editPolylines$\" [context]=\"this\">\n      <ac-polyline-primitive-desc\n        props=\"{\n        positions: polyline.getPositions(),\n        width: polyline.props.width,\n        material: polyline.props.material()\n    }\"\n      >\n      </ac-polyline-primitive-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor=\"let point of editPoints$\" [context]=\"this\">\n      <ac-point-desc\n        props=\"{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }\"\n      >\n      </ac-point-desc>\n    </ac-layer>\n\n    <ac-layer #polylineLabelsLayer acFor=\"let polylineLabels of polylineLabels$\" [context]=\"this\">\n      <ac-array-desc acFor=\"let label of polylineLabels.labels\" [idGetter]=\"getLabelId\">\n        <ac-label-primitive-desc\n          props=\"{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }\"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n  `,\n  providers: [CoordinateConverter, PolylinesManagerService],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class PolylinesEditorComponent implements OnDestroy {\n  private editLabelsRenderFn: (update: PolylineEditUpdate, labels: LabelProps[]) => LabelProps[];\n  public Cesium = Cesium;\n  public editPoints$ = new Subject<AcNotification>();\n  public editPolylines$ = new Subject<AcNotification>();\n  public polylineLabels$ = new Subject<AcNotification>();\n\n  @ViewChild('editPointsLayer') private editPointsLayer: AcLayerComponent;\n  @ViewChild('editPolylinesLayer') private editPolylinesLayer: AcLayerComponent;\n  @ViewChild('polylineLabelsLayer') private polylineLabelsLayer: AcLayerComponent;\n\n  constructor(\n    private polylinesEditor: PolylinesEditorService,\n    private coordinateConverter: CoordinateConverter,\n    private mapEventsManager: MapEventsManagerService,\n    private cameraService: CameraService,\n    private polylinesManager: PolylinesManagerService,\n  ) {\n    this.polylinesEditor.init(this.mapEventsManager, this.coordinateConverter, this.cameraService, polylinesManager);\n    this.startListeningToEditorUpdates();\n  }\n\n  private startListeningToEditorUpdates() {\n    this.polylinesEditor.onUpdate().subscribe((update: PolylineEditUpdate) => {\n      if (update.editMode === EditModes.CREATE || update.editMode === EditModes.CREATE_OR_EDIT) {\n        this.handleCreateUpdates(update);\n      } else if (update.editMode === EditModes.EDIT) {\n        this.handleEditUpdates(update);\n      }\n    });\n  }\n\n  getLabelId(element: any, index: number): string {\n    return index.toString();\n  }\n\n  renderEditLabels(polyline: EditablePolyline, update: PolylineEditUpdate, labels?: LabelProps[]) {\n    update.positions = polyline.getRealPositions();\n    update.points = polyline.getRealPoints();\n\n    if (labels) {\n      polyline.labels = labels;\n      this.polylineLabelsLayer.update(polyline, polyline.getId());\n      return;\n    }\n\n    if (!this.editLabelsRenderFn) {\n      return;\n    }\n\n    polyline.labels = this.editLabelsRenderFn(update, polyline.labels);\n    this.polylineLabelsLayer.update(polyline, polyline.getId());\n  }\n\n  removeEditLabels(polyline: EditablePolyline) {\n    polyline.labels = [];\n    this.polylineLabelsLayer.remove(polyline.getId());\n  }\n\n  handleCreateUpdates(update: PolylineEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.polylinesManager.createEditablePolyline(\n          update.id,\n          this.editPointsLayer,\n          this.editPolylinesLayer,\n          this.coordinateConverter,\n          update.polylineOptions,\n        );\n        break;\n      }\n      case EditActions.MOUSE_MOVE: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (update.updatedPosition) {\n          polyline.moveTempMovingPoint(update.updatedPosition);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.ADD_POINT: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (update.updatedPosition) {\n          polyline.addPoint(update.updatedPosition);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.ADD_LAST_POINT: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (update.updatedPosition) {\n          polyline.addLastPoint(update.updatedPosition);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.DISPOSE: {\n        const polyline = this.polylinesManager.get(update.id);\n        polyline.dispose();\n        this.removeEditLabels(polyline);\n        this.editLabelsRenderFn = undefined;\n        break;\n      }\n      case EditActions.SET_EDIT_LABELS_RENDER_CALLBACK: {\n        const polyline = this.polylinesManager.get(update.id);\n        this.editLabelsRenderFn = update.labelsRenderFn;\n        this.renderEditLabels(polyline, update);\n        break;\n      }\n      case EditActions.UPDATE_EDIT_LABELS: {\n        const polyline = this.polylinesManager.get(update.id);\n        this.renderEditLabels(polyline, update, update.updateLabels);\n        break;\n      }\n      case EditActions.SET_MANUALLY: {\n        const polyline = this.polylinesManager.get(update.id);\n        this.renderEditLabels(polyline, update, update.updateLabels);\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  handleEditUpdates(update: PolylineEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.polylinesManager.createEditablePolyline(\n          update.id,\n          this.editPointsLayer,\n          this.editPolylinesLayer,\n          this.coordinateConverter,\n          update.polylineOptions,\n          update.positions,\n        );\n        break;\n      }\n      case EditActions.DRAG_POINT: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline && polyline.enableEdit) {\n          polyline.movePoint(update.updatedPosition, update.updatedPoint);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_POINT_FINISH: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline && polyline.enableEdit && update.updatedPoint.isVirtualEditPoint()) {\n          polyline.changeVirtualPointToRealPoint(update.updatedPoint);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.REMOVE_POINT: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline && polyline.enableEdit) {\n          polyline.removePoint(update.updatedPoint);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.DISABLE: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline) {\n          polyline.enableEdit = false;\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.ENABLE: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline) {\n          polyline.enableEdit = true;\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline && polyline.enableEdit) {\n          polyline.moveShape(update.draggedPosition, update.updatedPosition);\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n\n      case EditActions.DRAG_SHAPE_FINISH: {\n        const polyline = this.polylinesManager.get(update.id);\n        if (polyline && polyline.enableEdit) {\n          polyline.endMoveShape();\n          this.renderEditLabels(polyline, update);\n        }\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.polylinesManager.clear();\n  }\n\n  getPointSize(point: EditPoint) {\n    return point.isVirtualEditPoint() ? point.props.virtualPointPixelSize : point.props.pixelSize;\n  }\n\n  getPointShow(point: EditPoint) {\n    return point.show && (point.isVirtualEditPoint() ? point.props.showVirtual : point.props.show);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { EditableHippodrome } from '../../../models/editable-hippodrome';\nimport { HippodromeEditOptions } from '../../../models/hippodrome-edit-options';\nimport { AcLayerComponent } from '../../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\n\n@Injectable()\nexport class HippodromeManagerService {\n  hippodromes: Map<string, EditableHippodrome> = new Map<string, EditableHippodrome>();\n\n  createEditableHippodrome(id: string, editHippodromeLayer: AcLayerComponent, editPointsLayer: AcLayerComponent,\n                           coordinateConverter: CoordinateConverter, hippodromeEditOptions?: HippodromeEditOptions,\n                           positions?: Cartesian3[]) {\n    const editableHippodrome = new EditableHippodrome(\n      id,\n      editHippodromeLayer,\n      editPointsLayer,\n      coordinateConverter,\n      hippodromeEditOptions,\n      positions);\n    this.hippodromes.set(id, editableHippodrome);\n  }\n\n  get(id: string): EditableHippodrome {\n    return this.hippodromes.get(id);\n  }\n\n  clear() {\n    this.hippodromes.forEach(hippodrome => hippodrome.dispose());\n    this.hippodromes.clear();\n  }\n}\n","import { publish, tap } from 'rxjs/operators';\nimport { Injectable } from '@angular/core';\nimport { MapEventsManagerService } from '../../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { CesiumEvent } from '../../../../angular-cesium/services/map-events-mananger/consts/cesium-event.enum';\nimport { PickOptions } from '../../../../angular-cesium/services/map-events-mananger/consts/pickOptions.enum';\nimport { EditModes } from '../../../models/edit-mode.enum';\nimport { EditActions } from '../../../models/edit-actions.enum';\nimport { DisposableObservable } from '../../../../angular-cesium/services/map-events-mananger/disposable-observable';\nimport { CoordinateConverter } from '../../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { EditPoint } from '../../../models/edit-point';\nimport { CameraService } from '../../../../angular-cesium/services/camera/camera.service';\nimport { Cartesian3 } from '../../../../angular-cesium/models/cartesian3';\nimport { HippodromeEditOptions } from '../../../models/hippodrome-edit-options';\nimport { HippodromeManagerService } from './hippodrome-manager.service';\nimport { HippodromeEditorObservable } from '../../../models/hippodrome-editor-oboservable';\nimport { HippodromeEditUpdate } from '../../../models/hippodrome-edit-update';\nimport { EditableHippodrome } from '../../../models/editable-hippodrome';\nimport { PointProps } from '../../../models/polyline-edit-options';\nimport { LabelProps } from '../../../models/label-props';\nimport { generateKey } from '../../utils';\n\nexport const DEFAULT_HIPPODROME_OPTIONS: HippodromeEditOptions = {\n  addPointEvent: CesiumEvent.LEFT_CLICK,\n  dragPointEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  dragShapeEvent: CesiumEvent.LEFT_CLICK_DRAG,\n  allowDrag: true,\n  hippodromeProps: {\n    material: Cesium.Color.GREEN.withAlpha(0.5),\n    width: 200000.0,\n    outline: false,\n  },\n  pointProps: {\n    color: Cesium.Color.WHITE.withAlpha(0.9),\n    outlineColor: Cesium.Color.BLACK,\n    outlineWidth: 1,\n    pixelSize: 15,\n    virtualPointPixelSize: 8,\n    show: true,\n    showVirtual: true,\n  },\n};\n\n/**\n * Service for creating editable hippodromes\n *\n * You must provide `HippodromeEditorService` yourself.\n * HippodromeEditorService works together with `<hippodromes-editor>` component. Therefor you need to create `<hippodromes-editor>`\n * for each `PolylineEditorService`, And of course somewhere under `<ac-map>`/\n *\n * + `create` for starting a creation of the shape over the map. Returns a extension of `HippodromeEditorObservable`.\n * + `edit` for editing shape over the map starting from a given positions. Returns an extension of `HippodromeEditorObservable`.\n * + To stop editing call `dsipose()` from the `HippodromeEditorObservable` you get back from `create()` \\ `edit()`.\n *\n * **Labels over editted shapes**\n * Angular Cesium allows you to draw labels over a shape that is being edited with one of the editors.\n * To add label drawing logic to your editor use the function `setLabelsRenderFn()` that is defined on the\n * `HippodromeEditorObservable` that is returned from calling `create()` \\ `edit()` of one of the editor services.\n * `setLabelsRenderFn()` - receives a callback that is called every time the shape is redrawn\n * (except when the shape is being dragged). The callback is called with the last shape state and with an array of the current labels.\n * The callback should return type `LabelProps[]`.\n * You can also use `updateLabels()` to pass an array of labels of type `LabelProps[]` to be drawn.\n *\n *\n * usage:\n * ```typescript\n *  // Start creating hippodrome\n *  const editing$ = hippodromeEditorService.create();\n *  this.editing$.subscribe(editResult => {\n *\t\t\t\tconsole.log(editResult.positions);\n *\t\t});\n *\n *  // Or edit hippodromes from existing hippodromes cartesian3 positions\n *  const editing$ = this.hippodromeEditor.edit(initialPos);\n *\n * ```\n */\n@Injectable()\nexport class HippodromeEditorService {\n  private mapEventsManager: MapEventsManagerService;\n  private updateSubject = new Subject<HippodromeEditUpdate>();\n  private updatePublisher = publish<HippodromeEditUpdate>()(this.updateSubject); // TODO maybe not needed\n  private coordinateConverter: CoordinateConverter;\n  private cameraService: CameraService;\n  private hippodromeManager: HippodromeManagerService;\n  private observablesMap = new Map<string, DisposableObservable<any>[]>();\n\n  init(mapEventsManager: MapEventsManagerService,\n       coordinateConverter: CoordinateConverter,\n       cameraService: CameraService,\n       managerService: HippodromeManagerService) {\n    this.mapEventsManager = mapEventsManager;\n    this.coordinateConverter = coordinateConverter;\n    this.cameraService = cameraService;\n    this.hippodromeManager = managerService;\n    this.updatePublisher.connect();\n  }\n\n  onUpdate(): Observable<HippodromeEditUpdate> {\n    return this.updatePublisher;\n  }\n\n  create(options = DEFAULT_HIPPODROME_OPTIONS, eventPriority = 100): HippodromeEditorObservable {\n    const positions: Cartesian3[] = [];\n    const id = generateKey();\n    const hippodromeOptions = this.setOptions(options);\n\n    const clientEditSubject = new BehaviorSubject<HippodromeEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.CREATE\n    });\n    let finishedCreate = false;\n\n    this.updateSubject.next({\n      id,\n      positions,\n      editMode: EditModes.CREATE,\n      editAction: EditActions.INIT,\n      hippodromeOptions: hippodromeOptions,\n    });\n\n    const mouseMoveRegistration = this.mapEventsManager.register({\n      event: CesiumEvent.MOUSE_MOVE,\n      pick: PickOptions.NO_PICK,\n      priority: eventPriority,\n    });\n    const addPointRegistration = this.mapEventsManager.register({\n      event: hippodromeOptions.addPointEvent,\n      pick: PickOptions.NO_PICK,\n      priority: eventPriority,\n    });\n\n    this.observablesMap.set(id, [mouseMoveRegistration, addPointRegistration]);\n    const editorObservable = this.createEditorObservable(clientEditSubject, id);\n\n    mouseMoveRegistration.subscribe(({movement: {endPosition}}) => {\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n\n      if (position) {\n        this.updateSubject.next({\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.CREATE,\n          updatedPosition: position,\n          editAction: EditActions.MOUSE_MOVE,\n        });\n      }\n    });\n\n    addPointRegistration.subscribe(({movement: {endPosition}}) => {\n      if (finishedCreate) {\n        return;\n      }\n      const position = this.coordinateConverter.screenToCartesian3(endPosition);\n      if (!position) {\n        return;\n      }\n\n      const allPositions = this.getPositions(id);\n      const isFirstPoint = this.getPositions(id).length === 0;\n\n      const updateValue = {\n        id,\n        positions: allPositions,\n        editMode: EditModes.CREATE,\n        updatedPosition: position,\n        editAction: EditActions.ADD_POINT,\n      };\n      this.updateSubject.next(updateValue);\n      clientEditSubject.next({\n        ...updateValue,\n        positions: this.getPositions(id),\n        points: this.getPoints(id),\n        width: this.getWidth(id),\n      });\n\n      if (!isFirstPoint) {\n        const changeMode = {\n          id,\n          editMode: EditModes.CREATE,\n          editAction: EditActions.CHANGE_TO_EDIT,\n        };\n        this.updateSubject.next(changeMode);\n        clientEditSubject.next(changeMode);\n        if (this.observablesMap.has(id)) {\n          this.observablesMap.get(id).forEach(registration => registration.dispose());\n        }\n        this.observablesMap.delete(id);\n        this.editHippodrome(id, eventPriority, clientEditSubject, hippodromeOptions, editorObservable);\n        finishedCreate = true;\n      }\n    });\n\n    return editorObservable;\n  }\n\n  edit(positions: Cartesian3[], options = DEFAULT_HIPPODROME_OPTIONS, priority = 100): HippodromeEditorObservable {\n    if (positions.length !== 2) {\n      throw new Error('Hippodrome editor error edit(): polygon should have 2 positions but received ' + positions);\n    }\n    const id = generateKey();\n    const hippodromeEditOptions = this.setOptions(options);\n    const editSubject = new BehaviorSubject<HippodromeEditUpdate>({\n      id,\n      editAction: null,\n      editMode: EditModes.EDIT\n    });\n    const update = {\n      id,\n      positions: positions,\n      editMode: EditModes.EDIT,\n      editAction: EditActions.INIT,\n      hippodromeOptions: hippodromeEditOptions,\n    };\n    this.updateSubject.next(update);\n    editSubject.next({\n      ...update,\n      positions: this.getPositions(id),\n      points: this.getPoints(id),\n      width: this.getWidth(id),\n    });\n    return this.editHippodrome(\n      id,\n      priority,\n      editSubject,\n      hippodromeEditOptions\n    );\n  }\n\n  private editHippodrome(id: string,\n                         priority: number,\n                         editSubject: Subject<HippodromeEditUpdate>,\n                         options: HippodromeEditOptions,\n                         editObservable?: HippodromeEditorObservable): HippodromeEditorObservable {\n    let shapeDragRegistration;\n    if (options.allowDrag) {\n      shapeDragRegistration = this.mapEventsManager.register({\n        event: options.dragShapeEvent,\n        entityType: EditableHippodrome,\n        pick: PickOptions.PICK_FIRST,\n        priority,\n        pickFilter: entity => id === entity.id,\n      });\n    }\n    const pointDragRegistration = this.mapEventsManager.register({\n      event: options.dragPointEvent,\n      entityType: EditPoint,\n      pick: PickOptions.PICK_FIRST,\n      priority,\n      pickFilter: entity => id === entity.editedEntityId,\n    });\n\n    pointDragRegistration.pipe(\n      tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n      .subscribe(({movement: {endPosition, drop}, entities}) => {\n        const position = this.coordinateConverter.screenToCartesian3(endPosition);\n        if (!position) {\n          return;\n        }\n        const point: EditPoint = entities[0];\n\n        const update = {\n          id,\n          positions: this.getPositions(id),\n          editMode: EditModes.EDIT,\n          updatedPosition: position,\n          updatedPoint: point,\n          editAction: drop ? EditActions.DRAG_POINT_FINISH : EditActions.DRAG_POINT,\n        };\n        this.updateSubject.next(update);\n        editSubject.next({\n          ...update,\n          positions: this.getPositions(id),\n          points: this.getPoints(id),\n          width: this.getWidth(id),\n        });\n      });\n\n    if (shapeDragRegistration) {\n      shapeDragRegistration\n        .pipe(tap(({movement: {drop}}) => this.cameraService.enableInputs(drop)))\n        .subscribe(({movement: {startPosition, endPosition, drop}, entities}) => {\n          const endDragPosition = this.coordinateConverter.screenToCartesian3(endPosition);\n          const startDragPosition = this.coordinateConverter.screenToCartesian3(startPosition);\n          if (!endDragPosition) {\n            return;\n          }\n\n          const update = {\n            id,\n            positions: this.getPositions(id),\n            editMode: EditModes.EDIT,\n            updatedPosition: endDragPosition,\n            draggedPosition: startDragPosition,\n            editAction: drop ? EditActions.DRAG_SHAPE_FINISH : EditActions.DRAG_SHAPE,\n          };\n          this.updateSubject.next(update);\n          editSubject.next({\n            ...update,\n            positions: this.getPositions(id),\n            points: this.getPoints(id),\n            width: this.getWidth(id),\n          });\n        });\n    }\n\n    const observables = [pointDragRegistration];\n    if (shapeDragRegistration) {\n      observables.push(shapeDragRegistration);\n    }\n\n    this.observablesMap.set(id, observables);\n    return this.createEditorObservable(editSubject, id);\n  }\n\n  private setOptions(options: HippodromeEditOptions): HippodromeEditOptions {\n    const defaultClone = JSON.parse(JSON.stringify(DEFAULT_HIPPODROME_OPTIONS));\n    const hippodromeOptions = Object.assign(defaultClone, options);\n    hippodromeOptions.hippodromeProps = Object.assign({}, DEFAULT_HIPPODROME_OPTIONS.hippodromeProps, options.hippodromeProps);\n    hippodromeOptions.pointProps = Object.assign({}, DEFAULT_HIPPODROME_OPTIONS.pointProps, options.pointProps);\n    return hippodromeOptions;\n  }\n\n\n  private createEditorObservable(observableToExtend: any, id: string): HippodromeEditorObservable {\n    observableToExtend.dispose = () => {\n      const observables = this.observablesMap.get(id);\n      if (observables) {\n        observables.forEach(obs => obs.dispose());\n      }\n      this.observablesMap.delete(id);\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.DISPOSE,\n      });\n    };\n\n    observableToExtend.enable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.ENABLE,\n      });\n    };\n\n    observableToExtend.disable = () => {\n      this.updateSubject.next({\n        id,\n        positions: this.getPositions(id),\n        editMode: EditModes.EDIT,\n        editAction: EditActions.DISABLE,\n      });\n    };\n\n    observableToExtend.setManually = (firstPosition: Cartesian3,\n                                      secondPosition: Cartesian3,\n                                      widthMeters: number,\n                                      firstPointProp?: PointProps,\n                                      secondPointProp?: PointProps) => {\n      const firstP = new EditPoint(id, firstPosition, firstPointProp ? firstPointProp : DEFAULT_HIPPODROME_OPTIONS.pointProps);\n      const secP = new EditPoint(id, secondPosition, secondPointProp ? secondPointProp : DEFAULT_HIPPODROME_OPTIONS.pointProps);\n\n      const hippodrome = this.hippodromeManager.get(id);\n      hippodrome.setPointsManually([firstP, secP], widthMeters);\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_MANUALLY,\n      });\n    };\n\n    observableToExtend.setLabelsRenderFn = (callback: any) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.SET_EDIT_LABELS_RENDER_CALLBACK,\n        labelsRenderFn: callback,\n      });\n    };\n\n    observableToExtend.updateLabels = (labels: LabelProps[]) => {\n      this.updateSubject.next({\n        id,\n        editMode: EditModes.CREATE_OR_EDIT,\n        editAction: EditActions.UPDATE_EDIT_LABELS,\n        updateLabels: labels,\n      });\n    };\n\n    observableToExtend.getCurrentPoints = () => this.getPoints(id);\n    observableToExtend.getEditValue = () => observableToExtend.getValue();\n    observableToExtend.getLabels = (): LabelProps[] => this.hippodromeManager.get(id).labels;\n    observableToExtend.getCurrentWidth = (): number => this.getWidth(id);\n\n    return observableToExtend as HippodromeEditorObservable;\n  }\n\n  private getPositions(id: any) {\n    const hippodrome = this.hippodromeManager.get(id);\n    return hippodrome.getRealPositions();\n  }\n\n  private getPoints(id: any) {\n    const hippodrome = this.hippodromeManager.get(id);\n    return hippodrome.getRealPoints();\n  }\n\n  private getWidth(id: string) {\n    const hippodrome = this.hippodromeManager.get(id);\n    return hippodrome.getWidth();\n  }\n}\n","import { ChangeDetectionStrategy, Component, OnDestroy, ViewChild } from '@angular/core';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { AcNotification } from '../../../angular-cesium/models/ac-notification';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { AcLayerComponent } from '../../../angular-cesium/components/ac-layer/ac-layer.component';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapEventsManagerService } from '../../../angular-cesium/services/map-events-mananger/map-events-manager';\nimport { Subject } from 'rxjs';\nimport { CameraService } from '../../../angular-cesium/services/camera/camera.service';\nimport { EditPoint } from '../../models/edit-point';\nimport { HippodromeManagerService } from '../../services/entity-editors/hippodrome-editor/hippodrome-manager.service';\nimport { HippodromeEditorService } from '../../services/entity-editors/hippodrome-editor/hippodrome-editor.service';\nimport { HippodromeEditUpdate } from '../../models/hippodrome-edit-update';\nimport { LabelProps } from '../../models/label-props';\nimport { EditableHippodrome } from '../../models/editable-hippodrome';\n\n@Component({\n  selector: 'hippodrome-editor',\n  template: /*html*/ `\n    <ac-layer #editHippodromesLayer acFor=\"let hippodrome of editHippodromes$\" [context]=\"this\">\n      <ac-corridor-desc\n        props=\"{\n\t\tpositions: hippodrome.getRealPositionsCallbackProperty(),\n\t\tcornerType: Cesium.CornerType.ROUNDED,\n\t\tmaterial: hippodrome.hippodromeProps.material,\n\t\twidth : hippodrome.hippodromeProps.width,\n\t\toutline: hippodrome.hippodromeProps.outline,\n\t\toutlineColor: hippodrome.hippodromeProps.outlineColor,\n        outlineWidth: hippodrome.hippodromeProps.outlineWidth,\n        height: 0\n\t}\"\n      >\n      </ac-corridor-desc>\n\n      <ac-array-desc acFor=\"let label of hippodrome.labels\" [idGetter]=\"getLabelId\">\n        <ac-label-primitive-desc\n          props=\"{\n            position: label.position,\n            backgroundColor: label.backgroundColor,\n            backgroundPadding: label.backgroundPadding,\n            distanceDisplayCondition: label.distanceDisplayCondition,\n            eyeOffset: label.eyeOffset,\n            fillColor: label.fillColor,\n            font: label.font,\n            heightReference: label.heightReference,\n            horizontalOrigin: label.horizontalOrigin,\n            outlineColor: label.outlineColor,\n            outlineWidth: label.outlineWidth,\n            pixelOffset: label.pixelOffset,\n            pixelOffsetScaleByDistance: label.pixelOffsetScaleByDistance,\n            scale: label.scale,\n            scaleByDistance: label.scaleByDistance,\n            show: label.show,\n            showBackground: label.showBackground,\n            style: label.style,\n            text: label.text,\n            translucencyByDistance: label.translucencyByDistance,\n            verticalOrigin: label.verticalOrigin\n        }\"\n        >\n        </ac-label-primitive-desc>\n      </ac-array-desc>\n    </ac-layer>\n\n    <ac-layer #editPointsLayer acFor=\"let point of editPoints$\" [context]=\"this\">\n      <ac-point-desc\n        props=\"{\n        position: point.getPosition(),\n        pixelSize: getPointSize(point),\n        color: point.props.color,\n        outlineColor: point.props.outlineColor,\n        outlineWidth: point.props.outlineWidth,\n        show: getPointShow(point)\n    }\"\n      >\n      </ac-point-desc>\n    </ac-layer>\n  `,\n  providers: [CoordinateConverter, HippodromeManagerService],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class HippodromeEditorComponent implements OnDestroy {\n  private editLabelsRenderFn: (update: HippodromeEditUpdate, labels: LabelProps[]) => LabelProps[];\n  public Cesium = Cesium;\n  public editPoints$ = new Subject<AcNotification>();\n  public editHippodromes$ = new Subject<AcNotification>();\n\n  @ViewChild('editPointsLayer') private editPointsLayer: AcLayerComponent;\n  @ViewChild('editHippodromesLayer') private editHippodromesLayer: AcLayerComponent;\n\n  constructor(\n    private hippodromesEditor: HippodromeEditorService,\n    private coordinateConverter: CoordinateConverter,\n    private mapEventsManager: MapEventsManagerService,\n    private cameraService: CameraService,\n    private hippodromesManager: HippodromeManagerService,\n  ) {\n    this.hippodromesEditor.init(this.mapEventsManager, this.coordinateConverter, this.cameraService, hippodromesManager);\n    this.startListeningToEditorUpdates();\n  }\n\n  private startListeningToEditorUpdates() {\n    this.hippodromesEditor.onUpdate().subscribe((update: HippodromeEditUpdate) => {\n      if (update.editMode === EditModes.CREATE || update.editMode === EditModes.CREATE_OR_EDIT) {\n        this.handleCreateUpdates(update);\n      } else if (update.editMode === EditModes.EDIT) {\n        this.handleEditUpdates(update);\n      }\n    });\n  }\n\n  getLabelId(element: any, index: number): string {\n    return index.toString();\n  }\n\n  renderEditLabels(hippodrome: EditableHippodrome, update: HippodromeEditUpdate, labels?: LabelProps[]) {\n    update.positions = hippodrome.getRealPositions();\n    update.points = hippodrome.getRealPoints();\n\n    if (labels) {\n      hippodrome.labels = labels;\n      this.editHippodromesLayer.update(hippodrome, hippodrome.getId());\n      return;\n    }\n\n    if (!this.editLabelsRenderFn) {\n      return;\n    }\n\n    hippodrome.labels = this.editLabelsRenderFn(update, hippodrome.labels);\n    this.editHippodromesLayer.update(hippodrome, hippodrome.getId());\n  }\n\n  removeEditLabels(hippodrome: EditableHippodrome) {\n    hippodrome.labels = [];\n    this.editHippodromesLayer.update(hippodrome, hippodrome.getId());\n  }\n\n  handleCreateUpdates(update: HippodromeEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.hippodromesManager.createEditableHippodrome(\n          update.id,\n          this.editPointsLayer,\n          this.editHippodromesLayer,\n          this.coordinateConverter,\n          update.hippodromeOptions,\n        );\n        break;\n      }\n      case EditActions.MOUSE_MOVE: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (update.updatedPosition) {\n          hippodrome.moveTempMovingPoint(update.updatedPosition);\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.ADD_POINT: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (update.updatedPosition) {\n          hippodrome.addPoint(update.updatedPosition);\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.DISPOSE: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        hippodrome.dispose();\n        this.removeEditLabels(hippodrome);\n        break;\n      }\n      case EditActions.SET_EDIT_LABELS_RENDER_CALLBACK: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        this.editLabelsRenderFn = update.labelsRenderFn;\n        this.renderEditLabels(hippodrome, update);\n        break;\n      }\n      case EditActions.UPDATE_EDIT_LABELS: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        this.renderEditLabels(hippodrome, update, update.updateLabels);\n        break;\n      }\n      case EditActions.SET_MANUALLY: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        this.renderEditLabels(hippodrome, update, update.updateLabels);\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  handleEditUpdates(update: HippodromeEditUpdate) {\n    switch (update.editAction) {\n      case EditActions.INIT: {\n        this.hippodromesManager.createEditableHippodrome(\n          update.id,\n          this.editPointsLayer,\n          this.editHippodromesLayer,\n          this.coordinateConverter,\n          update.hippodromeOptions,\n          update.positions,\n        );\n        break;\n      }\n      case EditActions.DRAG_POINT: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome && hippodrome.enableEdit) {\n          hippodrome.movePoint(update.updatedPosition, update.updatedPoint);\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_POINT_FINISH: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome && hippodrome.enableEdit) {\n          hippodrome.endMovePoint();\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.DISABLE: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome) {\n          hippodrome.enableEdit = false;\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.ENABLE: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome) {\n          hippodrome.enableEdit = true;\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      case EditActions.DRAG_SHAPE: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome && hippodrome.enableEdit) {\n          hippodrome.moveShape(update.draggedPosition, update.updatedPosition);\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n\n      case EditActions.DRAG_SHAPE_FINISH: {\n        const hippodrome = this.hippodromesManager.get(update.id);\n        if (hippodrome && hippodrome.enableEdit) {\n          hippodrome.endMoveShape();\n          this.renderEditLabels(hippodrome, update);\n        }\n        break;\n      }\n      default: {\n        return;\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.hippodromesManager.clear();\n  }\n\n  getPointSize(point: EditPoint) {\n    return point.isVirtualEditPoint() ? point.props.virtualPointPixelSize : point.props.pixelSize;\n  }\n\n  getPointShow(point: EditPoint) {\n    return point.show && (point.isVirtualEditPoint() ? point.props.showVirtual : point.props.show);\n  }\n}\n","import { fromEvent as observableFromEvent, Observable, Subject } from 'rxjs';\n\nimport { map, merge, takeUntil, tap } from 'rxjs/operators';\nimport { Inject, Injectable } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { Vec2 } from '../../angular-cesium/models/vec2';\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { MapsManagerService } from '../../angular-cesium/services/maps-manager/maps-manager.service';\n\nexport interface IconDragEvent {\n  initialScreenPosition: Vec2;\n  screenPosition: Vec2;\n  mapPosition: Cartesian3;\n  drop: boolean;\n}\n\n/**\n * The Service is used to preform, handle and subscribe to icon dragging when using the `DraggableToMapDirective`.\n * For more info check `DraggableToMapDirective` docs.\n */\n\n@Injectable()\nexport class DraggableToMapService {\n\n  private coordinateConverter: CoordinateConverter;\n  private dragObservable: Observable<IconDragEvent>;\n  private stopper: Subject<any>;\n  private mainSubject = new Subject<IconDragEvent>();\n\n  constructor(@Inject(DOCUMENT) private document: any, private mapsManager: MapsManagerService) {\n  }\n\n  setCoordinateConverter(coordinateConverter: CoordinateConverter) {\n    this.coordinateConverter = coordinateConverter;\n  }\n\n  drag(imageSrc: string, style?: any) {\n    if (!this.coordinateConverter) {\n      const mapComponent = this.mapsManager.getMap();\n      if (mapComponent) {\n        this.coordinateConverter = mapComponent.getCoordinateConverter();\n      }\n    }\n    this.cancel();\n    const imgElement = document.createElement('img');\n    imgElement.src = imageSrc;\n    imgElement.style.position = 'fixed';\n    imgElement.style.visibility = 'hidden';\n    imgElement.style.width = '30px';\n    imgElement.style.height = '30px';\n    imgElement.style['user-drag'] = 'none';\n    imgElement.style['user-select'] = 'none';\n    imgElement.style['-moz-user-select'] = 'none';\n    imgElement.style['-webkit-user-drag'] = 'none';\n    imgElement.style['-webkit-user-select'] = 'none';\n    imgElement.style['-ms-user-select'] = 'none';\n    Object.assign(imgElement.style, style);\n    document.body.appendChild(imgElement);\n\n    this.createDragObservable();\n    this.dragObservable.subscribe(\n      (e) => {\n        imgElement.style.visibility = 'visible';\n        imgElement.style.left = e.screenPosition.x - imgElement.clientWidth / 2 + 'px';\n        imgElement.style.top = e.screenPosition.y - imgElement.clientHeight / 2 + 'px';\n        this.mainSubject.next(e);\n        if (e.drop) {\n          imgElement.remove();\n        }\n      },\n      (e: any) => {\n        imgElement.remove();\n      },\n      () => {\n        imgElement.remove();\n      }\n    );\n  }\n\n  dragUpdates(): Observable<IconDragEvent> {\n    return this.mainSubject;\n  }\n\n  cancel() {\n    if (this.stopper) {\n      this.stopper.next(true);\n      this.stopper = undefined;\n      this.dragObservable = undefined;\n    }\n  }\n\n  private createDragObservable() {\n    const stopper = new Subject();\n    const dropSubject = new Subject<any>();\n    const pointerUp = observableFromEvent(document, 'pointerup');\n    const pointerMove = observableFromEvent(document, 'pointermove');\n\n    let dragStartPositionX: number;\n    let dragStartPositionY: number;\n    let lastMove: any;\n    const moveObservable = pointerMove.pipe(map((e: any) => {\n        dragStartPositionX = dragStartPositionX ? dragStartPositionX : e.x;\n        dragStartPositionY = dragStartPositionY ? dragStartPositionY : e.y;\n        lastMove = {\n          drop: false,\n          initialScreenPosition: {\n            x: dragStartPositionX,\n            y: dragStartPositionY,\n          },\n          screenPosition: {\n            x: e.x,\n            y: e.y,\n          },\n          mapPosition: this.coordinateConverter ?\n            this.coordinateConverter.screenToCartesian3({x: e.x, y: e.y}) : undefined,\n        };\n        return lastMove;\n      }),\n      takeUntil(pointerUp),\n      tap(undefined, undefined, () => {\n        if (lastMove) {\n          const dropEvent = Object.assign({}, lastMove);\n          dropEvent.drop = true;\n          dropSubject.next(dropEvent);\n        }\n      }), );\n\n    this.dragObservable = moveObservable.pipe(merge(dropSubject), takeUntil(stopper), );\n    this.stopper = stopper;\n  }\n}\n","import { Directive, ElementRef, HostListener, Input, OnInit } from '@angular/core';\nimport { DraggableToMapService } from '../services/draggable-to-map.service';\n\n/**\n * This directive is used to allow dragging of icons from outside the map over the map\n * while being notified of the dragging position and drop position with an observable exposed from `DraggableToMapService`.\n * @Input {src: string, style?: any} | string -\n * the [src: string | string] should be the image src of the dragged image.\n * The style is an optional style object for the image.\n *\n * example:\n * ```\n * <a href=\"...\" class=\"...\" [draggableToMap]=\"{src: '../assets/GitHub-Mark-Light.png', style: {width: '50px', height: '50px'}}\">\n *     <img class=\"github\" src=\"../assets/GitHub-Mark-Light.png\">\n * </a>\n * ```\n *\n * In order the get notified of the dragging location  and drop state subscribe to `DraggableToMapService.dragUpdates()`\n * ```\n *  this.iconDragService.dragUpdates().subscribe(e => console.log(e));\n * ```\n *\n * In order the cancel dragging use `DraggableToMapService.cancel()`\n * ```\n *  this.iconDragService.cancel();\n * ```\n */\n\n@Directive({selector: '[draggableToMap]'})\nexport class DraggableToMapDirective implements OnInit {\n  @Input() draggableToMap: { src: string, style?: any } | string;\n  private src: string;\n  private style: any;\n\n  constructor(el: ElementRef, private iconDragService: DraggableToMapService) {\n    el.nativeElement.style['user-drag'] = 'none';\n    el.nativeElement.style['user-select'] = 'none';\n    el.nativeElement.style['-moz-user-select'] = 'none';\n    el.nativeElement.style['-webkit-user-drag'] = 'none';\n    el.nativeElement.style['-webkit-user-select'] = 'none';\n    el.nativeElement.style['-ms-user-select'] = 'none';\n  }\n\n  ngOnInit(): void {\n    if (typeof this.draggableToMap === 'string') {\n      this.src = this.draggableToMap;\n    } else {\n      this.src = this.draggableToMap.src;\n      this.style = this.draggableToMap.style;\n    }\n  }\n\n  @HostListener('mousedown')\n  onMouseDown() {\n    this.iconDragService.drag(this.src, this.style);\n  }\n}\n","import { ChangeDetectionStrategy, Component, ElementRef, Input, OnDestroy, OnInit } from '@angular/core';\nimport { fromEvent as observableFromEvent, Subscription } from 'rxjs';\nimport { switchMap, takeUntil } from 'rxjs/operators';\nimport { CesiumService } from '../../../../angular-cesium/services/cesium/cesium.service';\n\n\n/**\n * Toolbar widget, act as a container for ac-toolbar-button components\n * allowing drag configuration and passing `toolbarClass` as attributes\n *\n * Usage:\n * ```\n * <ac-toolbar [allowDrag]=\"true\">\n <ac-toolbar-button [iconUrl]=\"'assets/home-icon.svg'\" (onClick)=\"goHome()\">\n </ac-toolbar-button>\n <ac-toolbar-button [iconUrl]=\"'assets/explore-icon.svg'\" (onClick)=\"rangeAndBearing()\">\n </ac-toolbar-button>\n </ac-toolbar>\n * ```\n *\n */\n@Component(\n  {\n    selector: 'ac-toolbar',\n    template: `\n        <div class=\"{{toolbarClass}}\">\n            <div *ngIf=\"allowDrag\">\n                <ac-toolbar-button>\n                    <ac-drag-icon></ac-drag-icon>\n                </ac-toolbar-button>\n            </div>\n\n            <ng-content></ng-content>\n        </div>\n    `,\n    styles: [`\n        :host {\n            position: absolute;\n            top: 20px;\n            left: 20px;\n            width: 20px;\n            height: 20px;\n            z-index: 999;\n            -webkit-user-drag: none;\n        }\n    `],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n  }\n)\nexport class AcToolbarComponent implements OnInit, OnDestroy {\n  @Input()\n  toolbarClass: string;\n  @Input()\n  allowDrag = true;\n\n  dragStyle = {\n    'height.px': 20,\n    'width.px': 20,\n  };\n\n  private subscription: Subscription;\n\n  constructor(private element: ElementRef, private cesiumService: CesiumService) {\n  }\n\n  ngOnInit() {\n    this.cesiumService.getMap().getMapContainer().appendChild(this.element.nativeElement);\n    if (this.allowDrag) {\n      const mouseDown$ = observableFromEvent(this.element.nativeElement, 'mousedown');\n      const mouseMove$ = observableFromEvent(document, 'mousemove');\n      const mouseUp$ = observableFromEvent(document, 'mouseup');\n\n      const drag$ = mouseDown$.pipe(switchMap(() => mouseMove$.pipe(takeUntil(mouseUp$))));\n\n      this.subscription = drag$.subscribe((event: MouseEvent) => {\n        this.element.nativeElement.style.left = event.x + 'px';\n        this.element.nativeElement.style.top = event.y + 'px';\n      });\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n}\n","import { Component } from '@angular/core';\n\n@Component(\n  {\n    selector: 'ac-drag-icon',\n    template: `\n        <svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\"  x=\"0px\" y=\"0px\"  height=\"25\"  width=\"25\"\n\t viewBox=\"0 0 476.737 476.737\" style=\"enable-background:new 0 0 476.737 476.737;\" xml:space=\"preserve\">\n<g>\n\t<g>\n\t\t<path style=\"fill:#010002;\" d=\"M475.498,232.298l-3.401-5.149l-63.565-63.565c-6.198-6.198-16.304-6.198-22.47,0\n\t\t\tc-6.198,6.198-6.198,16.273,0,22.47l36.423,36.423H254.26V54.253l36.423,36.423c6.166,6.198,16.273,6.198,22.47,0\n\t\t\tc6.166-6.198,6.166-16.273,0-22.47L249.588,4.64l-0.159-0.095l-4.99-3.305L238.369,0h-0.064l-6.007,1.24l-4.99,3.305l-0.191,0.095\n\t\t\tl-63.565,63.565c-6.198,6.198-6.198,16.273,0,22.47s16.273,6.198,22.47,0l36.455-36.423v168.225H54.253l36.423-36.423\n\t\t\tc6.198-6.198,6.198-16.273,0-22.47s-16.273-6.198-22.47,0L4.64,227.149l-0.095,0.159l-3.305,4.99L0,238.369v0.064l1.24,6.007\n\t\t\tl3.305,4.958l0.095,0.191l63.565,63.565c6.198,6.198,16.273,6.198,22.47,0c6.198-6.166,6.198-16.273,0-22.47L54.253,254.26\n\t\t\th168.225v168.225l-36.423-36.423c-6.198-6.166-16.273-6.166-22.47,0c-6.198,6.198-6.198,16.304,0,22.47l63.565,63.565l5.149,3.432\n\t\t\tl6.007,1.208h0.064l6.07-1.24l5.149-3.401l63.565-63.565c6.166-6.198,6.166-16.304,0-22.47c-6.198-6.198-16.304-6.198-22.47,0\n\t\t\tl-36.423,36.423V254.26h168.225l-36.423,36.423c-6.166,6.166-6.166,16.273,0,22.47c6.198,6.166,16.304,6.166,22.47,0\n\t\t\tl63.565-63.565l3.432-5.149l1.208-6.007v-0.064L475.498,232.298z\"/>\n\t</g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n<g>\n</g>\n</svg>\n    `,\n  }\n)\nexport class DragIconComponent {\n  constructor() {\n  }\n}\n","import { ChangeDetectionStrategy, Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\n\n/**\n * Toolbar button widget, act as a single button inside ac-toolbar component\n * Can accepts content components or passing [iconUrl]\n * configure with: `[iconUrl]`,`[buttonClass]`,`[iconClass]`,`(onClick)`\n *\n * Usage:\n * ```\n * <ac-toolbar [allowDrag]=\"true\">\n <ac-toolbar-button [iconUrl]=\"'assets/home-icon.svg'\" (onClick)=\"goHome()\">\n </ac-toolbar-button>\n <ac-toolbar-button [iconUrl]=\"'assets/explore-icon.svg'\" (onClick)=\"rangeAndBearing()\">\n </ac-toolbar-button>\n </ac-toolbar>\n * ```\n *\n */\n@Component(\n  {\n    selector: 'ac-toolbar-button',\n    template: `\n        <div (click)=\"onClick.emit()\" class=\"button-container {{buttonClass}}\">\n            <img *ngIf=\"iconUrl\" [src]=\"iconUrl\" class=\"icon {{iconClass}}\"/>\n            <ng-content></ng-content>\n        </div>\n    `,\n    styles: [`\n        .button-container {\n            border-radius: 1px;\n            background-color: rgba(255, 255, 255, 0.8);\n            height: 30px;\n            width: 30px;\n            padding: 5px;\n            transition: all 0.2s;\n            cursor: pointer;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n        }\n\n        .button-container:hover {\n            background-color: rgba(255, 255, 255, 0.95);\n        }\n\n        .icon {\n            height: 30px;\n            width: 30px;\n        }\n    `],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n  }\n)\nexport class AcToolbarButtonComponent implements OnInit {\n\n  @Input()\n  iconUrl: string;\n\n  @Input()\n  buttonClass: string;\n\n  @Input()\n  iconClass: string;\n\n  @Output()\n  onClick = new EventEmitter();\n\n  constructor() {\n  }\n\n  ngOnInit() {\n\n  }\n}\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { CoordinateConverter } from '../../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\nimport { EditActions } from '../../models/edit-actions.enum';\nimport { PolylineEditorObservable } from '../../models/polyline-editor-observable';\nimport { PolylineEditOptions } from '../../models/polyline-edit-options';\nimport { LabelProps, LabelStyle } from '../../models/label-props';\nimport { PolylineEditUpdate } from '../../models/polyline-edit-update';\nimport { EditModes } from '../../models/edit-mode.enum';\nimport { PolylinesEditorService } from '../../services/entity-editors/polyline-editor/polylines-editor.service';\n\n/**\n *\n * Range and bearing component that is used to draw range and bearing on the map.\n * The inputs are used to customize the range and bearing style and behavior.\n * Create component reference and use the `create()` function to start creating R&B on the map.\n * The function receives an optional RangeAndBearingOptions object that defines the created range and bearing style and behavior\n * (on top of the default and global definitions).\n *\n * Usage:\n *\n * my-component.ts:\n *\n * ```\n * \\@ViewChild('rangeAndBearing') private rangeAndBearing: RangeAndBearingComponent; // Get R&B reference\n *  // ...\n * this.rangeAndBearing.create({style: { pointProps: { pixelSize: 12 } }, bearingLabelsStyle: { fillColor: Cesium.Color.GREEN } });\n * ```\n *\n * my-component.html\n * ```\n * <range-and-bearing #rangeAndBearing></range-and-bearing> // Optional inputs defines global style and behavior.\n * ```\n *\n */\n@Component({\n  selector: 'range-and-bearing',\n  template: `\n    <polylines-editor></polylines-editor>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [PolylinesEditorService],\n})\nexport class RangeAndBearingComponent {\n  @Input() lineEditOptions?: PolylineEditOptions = {};\n  @Input() labelsStyle?: LabelStyle = {};\n  @Input() distanceLabelsStyle?: LabelStyle = {};\n  @Input() bearingLabelsStyle?: LabelStyle = {};\n  @Input() bearingStringFn?: (value: number) => string;\n  @Input() distanceStringFn?: (value: number) => string;\n  @Input() labelsRenderFn?: (update: PolylineEditUpdate, labels: LabelProps[]) => LabelProps[];\n\n  constructor(private polylineEditor: PolylinesEditorService, private coordinateConverter: CoordinateConverter) {\n  }\n\n  create(\n    {\n      lineEditOptions = {},\n      labelsStyle = {},\n      distanceLabelsStyle = {},\n      bearingLabelsStyle = {},\n      bearingStringFn,\n      distanceStringFn,\n      labelsRenderFn,\n    }: RangeAndBearingOptions = {lineEditOptions: {}, labelsStyle: {}, distanceLabelsStyle: {}, bearingLabelsStyle: {}},\n  ): PolylineEditorObservable {\n    const rnb = this.polylineEditor.create({\n      allowDrag: false,\n      pointProps: {\n        showVirtual: false,\n        pixelSize: 8,\n      },\n      polylineProps: {\n        width: 2,\n      },\n      ...this.lineEditOptions,\n      ...lineEditOptions,\n    });\n\n    if (labelsRenderFn) {\n      rnb.setLabelsRenderFn(labelsRenderFn);\n    } else if (this.labelsRenderFn) {\n      rnb.setLabelsRenderFn(this.labelsRenderFn);\n    } else {\n      rnb.setLabelsRenderFn(update => {\n        const positions = update.positions;\n        let totalDistance = 0;\n        if (!positions || positions.length === 0) {\n          return [];\n        }\n        return (update.editMode === EditModes.CREATE && update.editAction !== EditActions.ADD_LAST_POINT\n            ? [...positions, update.updatedPosition]\n            : positions\n        ).reduce(\n          (labels, position, index, array) => {\n            if (index !== 0) {\n              const previousPosition = array[index - 1];\n              const bearing = this.coordinateConverter.bearingToCartesian(previousPosition, position);\n              const distance = Cesium.Cartesian3.distance(previousPosition, position) / 1000;\n              labels.push(\n                {\n                  text:\n                    (bearingStringFn && bearingStringFn(bearing)) ||\n                    (this.bearingStringFn && this.bearingStringFn(bearing)) ||\n                    `${bearing.toFixed(2)}`,\n                  scale: 0.2,\n                  font: '80px Helvetica',\n                  pixelOffset: new Cesium.Cartesian2(-20, -8),\n                  position: new Cesium.Cartesian3(\n                    (position.x + previousPosition.x) / 2,\n                    (position.y + previousPosition.y) / 2,\n                    (position.z + previousPosition.z) / 2,\n                  ),\n                  fillColor: Cesium.Color.WHITE,\n                  outlineColor: Cesium.Color.WHITE,\n                  showBackground: true,\n                  ...(this.labelsStyle as any),\n                  ...(labelsStyle as any),\n                  ...(this.bearingLabelsStyle as any),\n                  ...(bearingLabelsStyle as any),\n                },\n                {\n                  text:\n                    (distanceStringFn && distanceStringFn(totalDistance + distance)) ||\n                    (this.distanceStringFn && this.distanceStringFn(totalDistance + distance)) ||\n                    `${(totalDistance + distance).toFixed(2)} Km`,\n                  scale: 0.2,\n                  font: '80px Helvetica',\n                  pixelOffset: new Cesium.Cartesian2(-35, -8),\n                  position: position,\n                  fillColor: Cesium.Color.WHITE,\n                  outlineColor: Cesium.Color.WHITE,\n                  showBackground: true,\n                  ...(this.labelsStyle as any),\n                  ...(labelsStyle as any),\n                  ...(this.distanceLabelsStyle as any),\n                  ...(distanceLabelsStyle as any),\n                },\n              );\n\n              totalDistance += distance;\n            }\n\n            return labels;\n          },\n          [\n            {\n              text: (distanceStringFn && distanceStringFn(0)) || (this.distanceStringFn && this.distanceStringFn(0)) || `0 Km`,\n              scale: 0.2,\n              font: '80px Helvetica',\n              pixelOffset: new Cesium.Cartesian2(-20, -8),\n              position: positions[0],\n              fillColor: Cesium.Color.WHITE,\n              outlineColor: Cesium.Color.WHITE,\n              showBackground: true,\n              ...(this.labelsStyle as any),\n              ...(labelsStyle as any),\n              ...(this.distanceLabelsStyle as any),\n              ...(distanceLabelsStyle as any),\n            },\n          ],\n        );\n      });\n    }\n\n    return rnb;\n  }\n}\n\nexport interface RangeAndBearingOptions {\n  lineEditOptions?: PolylineEditOptions;\n  labelsStyle?: LabelStyle;\n  distanceLabelsStyle?: LabelStyle;\n  bearingLabelsStyle?: LabelStyle;\n  bearingStringFn?: (value: number) => string;\n  distanceStringFn?: (value: number) => string;\n  labelsRenderFn?: (update: PolylineEditUpdate, labels: LabelProps[]) => LabelProps[];\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { MapsManagerService } from '../../angular-cesium/services/maps-manager/maps-manager.service';\nimport { CameraService } from '../../angular-cesium/services/camera/camera.service';\nimport { CesiumService } from '../../angular-cesium/services/cesium/cesium.service';\nimport { AcMapComponent } from '../../angular-cesium/components/ac-map/ac-map.component';\n\ninterface ZoomData {\n  container: HTMLElement;\n  borderElement?: HTMLElement;\n  resetOnEscapePressFunc?: EventListenerOrEventListenerObject;\n}\n\n/**\n * The Service is as a \"zoom to rectangle\" tool\n *\n * example:\n * ```\n * constructor(\n *   private cameraService: CameraService,\n *   private cesiumService: CesiumService,\n *   private zoomToRectangleService: ZoomToRectangleService,\n * ) {\n *   this.zoomToRectangleService.init(cesiumService, cameraService);\n * }\n * ...\n * this.zoomToRectangleService.activate({onComplete: () => this.zoomToRectangleService.disable()});\n * ```\n *\n * `init()` - initialize the service with CameraService and CesiumService.\n * If no mapId is provided to activate() - must be called before calling `activate()`.\n *\n * `disable()` - disables the tool.\n *\n * `activate()` -\n * @param options\n * {\n *  onStart - optional - a callback that will be called when the user start drawing the rectangle\n *  onComplete - optional - a callback that will be called when the tool zoom in\n *  autoDisableOnZoom - optional - determines if the tool should auto disable after zoom - default: true\n *  animationDurationInSeconds - optional - zoom animation duration in seconds - default: 0.5\n *  borderStyle - optional - the style of the rectangle element border - default: '3px dashed #FFFFFF'\n *  backgroundColor - optional - the background color of the rectangle element - default: 'transparent'\n *  resetKeyCode - optional - the key code of the key that is used to reset the drawing of the rectangle - default: 27 (ESC key)\n * }\n * @param mapId - optional - the mapId of the map that the tool will be used in.\n *\n */\n\n@Injectable()\nexport class ZoomToRectangleService {\n  constructor(\n    private mapsManager: MapsManagerService,\n    @Optional() cameraService: CameraService,\n    @Optional() cesiumService: CesiumService,\n  ) {\n  }\n\n  private cameraService: CameraService;\n  private cesiumService: CesiumService;\n\n  private mapsZoomElements = new Map<string, ZoomData>();\n  private defaultOptions = {\n    animationDurationInSeconds: 0.5,\n    resetKeyCode: 27,\n    borderStyle: '2px solid rgba(0,0,0,0.5)',\n    backgroundColor: 'rgba(0,0,0,0.2)',\n    autoDisableOnZoom: true,\n  };\n\n  init(cesiumService: CesiumService, cameraService: CameraService) {\n    this.cameraService = cameraService;\n    this.cesiumService = cesiumService;\n  }\n\n  activate(\n    options: {\n      onStart?: (acMap?: AcMapComponent) => any;\n      onComplete?: (acMap?: AcMapComponent) => any;\n      autoDisableOnZoom?: boolean;\n      animationDurationInSeconds?: number;\n      borderStyle?: string;\n      backgroundColor?: string;\n      resetKeyCode?: number;\n    } = {},\n    mapId?: string,\n  ) {\n    if ((!this.cameraService || !this.cesiumService) && !mapId) {\n      throw new Error(`The function must receive a mapId if the service wasn't initialized`);\n    }\n    const finalOptions = Object.assign({}, this.defaultOptions, options);\n    let cameraService = this.cameraService;\n    let mapContainer;\n    let map;\n    if (this.cesiumService) {\n      mapContainer = this.cesiumService.getViewer().container;\n      map = this.cesiumService.getMap();\n    }\n    if (mapId) {\n      map = this.mapsManager.getMap(mapId);\n      if (!map) {\n        throw new Error(`Map not found with id: ${mapId}`);\n      }\n      cameraService = map.getCameraService();\n      mapContainer = map.getCesiumViewer().container;\n    }\n\n    if (!cameraService || !mapContainer) {\n      throw new Error(`The function must receive a mapId if the service wasn't initialized`);\n    }\n    this.disable(mapId);\n    const container = document.createElement('div');\n    mapContainer.style.position = 'relative';\n    container.style.position = 'absolute';\n    container.style.width = '100%';\n    container.style.height = '100%';\n    container.style.top = '0';\n    container.style.left = '0';\n    mapContainer.appendChild(container);\n    const mapZoomData: ZoomData = {container};\n    this.mapsZoomElements.set(mapId || this.cesiumService.getMap().getId(), mapZoomData);\n    let mouse = {\n      endX: 0,\n      endY: 0,\n      startX: 0,\n      startY: 0,\n    };\n    let borderElement: HTMLElement | undefined;\n\n    container.onmousedown = e => {\n      if (!borderElement) {\n        if (options && options.onStart) {\n          options.onStart(map);\n        }\n\n        const rect = (e.currentTarget as any).getBoundingClientRect();\n        const offsetX = e.clientX - rect.left;\n        const offsetY = e.clientY - rect.top;\n        mouse.startX = offsetX;\n        mouse.startY = offsetY;\n        borderElement = document.createElement('div');\n        borderElement.className = 'zoom-to-rectangle-border';\n        borderElement.style.position = 'absolute';\n        borderElement.style.border = finalOptions.borderStyle;\n        borderElement.style.backgroundColor = finalOptions.backgroundColor;\n        borderElement.style.left = mouse.startX + 'px';\n        borderElement.style.top = mouse.startY + 'px';\n        container.appendChild(borderElement);\n        mapZoomData.borderElement = borderElement;\n      }\n    };\n\n    container.onmouseup = e => {\n      if (borderElement) {\n        const zoomApplied = this.zoomCameraToRectangle(cameraService, mouse, finalOptions.animationDurationInSeconds);\n        if (borderElement) {\n          borderElement.remove();\n          borderElement = undefined;\n          mapZoomData.borderElement = undefined;\n        }\n        mouse = {\n          endX: 0,\n          endY: 0,\n          startX: 0,\n          startY: 0,\n        };\n        if (!!finalOptions.onComplete) {\n          finalOptions.onComplete(map);\n        }\n        if (finalOptions.autoDisableOnZoom && zoomApplied) {\n          this.disable(mapId);\n        }\n      }\n    };\n\n    container.onmousemove = e => {\n      if (borderElement) {\n        const rect = (e.currentTarget as any).getBoundingClientRect();\n        const offsetX = e.clientX - rect.left;\n        const offsetY = e.clientY - rect.top;\n        mouse.endX = offsetX;\n        mouse.endY = offsetY;\n        borderElement.style.width = Math.abs(mouse.endX - mouse.startX) + 'px';\n        borderElement.style.height = Math.abs(mouse.endY - mouse.startY) + 'px';\n        borderElement.style.left = Math.min(mouse.startX, mouse.endX) + 'px';\n        borderElement.style.top = Math.min(mouse.startY, mouse.endY) + 'px';\n      }\n    };\n\n    const resetOnEscapePress = e => {\n      if (e.keyCode === finalOptions.resetKeyCode && borderElement) {\n        borderElement.remove();\n        borderElement = undefined;\n        mapZoomData.borderElement = undefined;\n        mouse = {\n          endX: 0,\n          endY: 0,\n          startX: 0,\n          startY: 0,\n        };\n      }\n    };\n    document.addEventListener('keydown', resetOnEscapePress);\n    mapZoomData.resetOnEscapePressFunc = resetOnEscapePress;\n  }\n\n  disable(mapId?: string) {\n    if (!this.cesiumService && !mapId) {\n      throw new Error('If the service was not initialized with CesiumService, mapId must be provided');\n    }\n    const data = this.mapsZoomElements.get(mapId || this.cesiumService.getMap().getId());\n    if (data) {\n      data.container.remove();\n      if (data.borderElement) {\n        data.borderElement.remove();\n      }\n      if (data.resetOnEscapePressFunc) {\n        document.removeEventListener('keydown', data.resetOnEscapePressFunc);\n      }\n    }\n    this.mapsZoomElements.delete(mapId);\n  }\n\n  private zoomCameraToRectangle(\n    cameraService: CameraService,\n    positions: { endX: number; endY: number; startX: number; startY: number },\n    animationDuration,\n  ): boolean {\n    const camera = cameraService.getCamera();\n    const cartesian1 = camera.pickEllipsoid({x: positions.startX, y: positions.startY});\n    const cartesian2 = camera.pickEllipsoid({x: positions.endX, y: positions.endY});\n    if (!cartesian1 || !cartesian2) {\n      return false;\n    }\n    const cartographic1 = Cesium.Cartographic.fromCartesian(cartesian1);\n    const cartographic2 = Cesium.Cartographic.fromCartesian(cartesian2);\n    cameraService.cameraFlyTo({\n      destination: new Cesium.Rectangle(\n        Math.min(cartographic1.longitude, cartographic2.longitude),\n        Math.min(cartographic1.latitude, cartographic2.latitude),\n        Math.max(cartographic1.longitude, cartographic2.longitude),\n        Math.max(cartographic1.latitude, cartographic2.latitude),\n      ),\n      duration: animationDuration,\n    });\n    return true;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { AngularCesiumModule } from '../angular-cesium/angular-cesium.module';\nimport { PolygonsEditorComponent } from './components/polygons-editor/polygons-editor.component';\nimport { CirclesEditorComponent } from './components/circles-editor/circles-editor.component';\nimport { EllipsesEditorComponent } from './components/ellipses-editor/ellipses-editor.component';\nimport { PolylinesEditorComponent } from './components/polylines-editor/polylines-editor.component';\nimport { HippodromeEditorComponent } from './components/hippodrome-editor/hippodrome-editor.component';\nimport { DraggableToMapDirective } from './directives/draggable-to-map.directive';\nimport { DraggableToMapService } from './services/draggable-to-map.service';\nimport { AcToolbarComponent } from './components/toolbar/ac-toolbar/ac-toolbar.component';\nimport { DragIconComponent } from './components/toolbar/ac-toolbar/drag-icon.component';\nimport { AcToolbarButtonComponent } from './components/toolbar/ac-toolbar-button/ac-toolbar-button.component';\nimport { RangeAndBearingComponent } from './components/range-and-bearing/range-and-bearing.component';\nimport { ZoomToRectangleService } from './services/zoom-to-rectangle.service';\n\n@NgModule({\n  imports: [CommonModule, AngularCesiumModule],\n  declarations: [\n    HippodromeEditorComponent,\n    PolygonsEditorComponent,\n    CirclesEditorComponent,\n    EllipsesEditorComponent,\n    PolylinesEditorComponent,\n    DraggableToMapDirective,\n    DragIconComponent,\n    AcToolbarComponent,\n    AcToolbarButtonComponent,\n    RangeAndBearingComponent,\n  ],\n  exports: [\n    HippodromeEditorComponent,\n    PolygonsEditorComponent,\n    CirclesEditorComponent,\n    EllipsesEditorComponent,\n    PolylinesEditorComponent,\n    DraggableToMapDirective,\n    AcToolbarComponent,\n    AcToolbarButtonComponent,\n    RangeAndBearingComponent,\n  ],\n  providers: [\n    DraggableToMapService,\n    ZoomToRectangleService,\n  ]\n})\nexport class AngularCesiumWidgetsModule {\n}\n"]}